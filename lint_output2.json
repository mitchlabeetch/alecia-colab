
> alecia-colab@ lint /app
> turbo lint --continue -- "apps/web/components/kanban/TimelineView.tsx" "--verbose" "--reporter=json"

• Packages in scope: alecia-colab-web, novel, tsconfig
• Running lint in 3 packages
• Remote caching disabled
novel:lint: cache hit, replaying logs 2e697a169663a045
novel:lint:
novel:lint: > novel@1.0.0 lint /app/packages/headless
novel:lint: > biome lint ./src "apps/web/components/kanban/TimelineView.tsx" "--verbose" "--reporter=json"
novel:lint:
novel:lint: The --json option is unstable/experimental and its output might change between patches/minor releases.
novel:lint: {"summary":{"changed":0,"unchanged":20,"matches":0,"duration":{"secs":0,"nanos":13682922},"errors":0,"warnings":0,"skipped":0,"suggestedFixesSkipped":0,"diagnosticsNotPrinted":0},"diagnostics":[{"category":"internalError/io","severity":"error","description":"No such file or directory (os error 2)","message":[{"elements":[],"content":"No such file or directory (os error 2)"}],"advices":{"advices":[]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"apps/web/components/kanban/TimelineView.tsx"},"span":null,"sourceCode":null},"tags":["internal"],"source":null}],"command":"lint"}
alecia-colab-web:lint: cache miss, executing 4159293a7edea6dd
alecia-colab-web:lint:
alecia-colab-web:lint: > alecia-colab-web@0.1.0 lint /app/apps/web
alecia-colab-web:lint: > biome lint . "apps/web/components/kanban/TimelineView.tsx" "--verbose" "--reporter=json"
alecia-colab-web:lint:
alecia-colab-web:lint: The --json option is unstable/experimental and its output might change between patches/minor releases.
alecia-colab-web:lint: {"summary":{"changed":0,"unchanged":171,"matches":0,"duration":{"secs":0,"nanos":98819541},"errors":67,"warnings":7,"skipped":0,"suggestedFixesSkipped":0,"diagnosticsNotPrinted":0},"diagnostics":[{"category":"internalError/io","severity":"error","description":"No such file or directory (os error 2)","message":[{"elements":[],"content":"No such file or directory (os error 2)"}],"advices":{"advices":[]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"apps/web/components/kanban/TimelineView.tsx"},"span":null,"sourceCode":null},"tags":["internal"],"source":null},{"category":"lint/style/noNonNullAssertion","severity":"error","description":"Forbidden non-null assertion.","message":[{"elements":[],"content":"Forbidden non-null assertion."}],"advices":{"advices":[]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/calendar/calendar-client.tsx"},"span":[2266,2279],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { useDeals } from \"@/hooks/use-convex\";\nimport { cn } from \"@/lib/utils\";\nimport { Briefcase, Calendar as CalendarIcon, ChevronLeft, ChevronRight, Loader2 } from \"lucide-react\";\nimport { useState } from \"react\";\n\nconst WEEKDAYS = [\"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\", \"Dim\"];\nconst MONTHS = [\n  \"Janvier\",\n  \"Février\",\n  \"Mars\",\n  \"Avril\",\n  \"Mai\",\n  \"Juin\",\n  \"Juillet\",\n  \"Août\",\n  \"Septembre\",\n  \"Octobre\",\n  \"Novembre\",\n  \"Décembre\",\n];\n\nexport function CalendarClient() {\n  const { deals, isLoading } = useDeals();\n  const [currentDate, setCurrentDate] = useState(new Date());\n\n  const getDaysInMonth = (date: Date) => {\n    return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();\n  };\n\n  const getFirstDayOfMonth = (date: Date) => {\n    // 0 = Sunday, 1 = Monday, etc.\n    // We want 0 = Monday, 6 = Sunday for the grid\n    const day = new Date(date.getFullYear(), date.getMonth(), 1).getDay();\n    return (day + 6) % 7;\n  };\n\n  const prevMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));\n  };\n\n  const nextMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));\n  };\n\n  const currentMonthName = MONTHS[currentDate.getMonth()];\n  const currentYear = currentDate.getFullYear();\n  const daysInMonth = getDaysInMonth(currentDate);\n  const firstDay = getFirstDayOfMonth(currentDate);\n\n  // Generate calendar grid cells\n  const days = [];\n  // Empty cells for previous month\n  for (let i = 0; i < firstDay; i++) {\n    days.push(null);\n  }\n  // Days of current month\n  for (let i = 1; i <= daysInMonth; i++) {\n    days.push(i);\n  }\n\n  // Filter deals for the displayed month\n  const dealsInMonth = deals?.filter((deal) => {\n    if (!deal.dueDate) return false;\n    const dealDate = new Date(deal.dueDate);\n    return dealDate.getMonth() === currentDate.getMonth() && dealDate.getFullYear() === currentDate.getFullYear();\n  });\n\n  const getDealsForDay = (day: number) => {\n    return dealsInMonth?.filter((deal) => {\n      const dealDate = new Date(deal.dueDate!); // Checked in filter above\n      return dealDate.getDate() === day;\n    });\n  };\n\n  return (\n    <AppShell>\n      <div className=\"flex flex-col h-full space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <CalendarIcon className=\"h-6 w-6 text-primary\" />\n            <h1 className=\"text-2xl font-bold tracking-tight\">Calendrier</h1>\n          </div>\n          <div className=\"flex items-center gap-2 bg-muted/50 p-1 rounded-lg border\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={prevMonth}>\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <span className=\"min-w-[140px] text-center font-medium\">\n              {currentMonthName} {currentYear}\n            </span>\n            <Button variant=\"ghost\" size=\"icon\" onClick={nextMonth}>\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <div className=\"w-[100px]\" /> {/* Spacer for centering alignment if needed, or actions */}\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : (\n          <div className=\"flex-1 border rounded-lg overflow-hidden bg-background flex flex-col shadow-sm\">\n            {/* Weekday Headers */}\n            <div className=\"grid grid-cols-7 border-b bg-muted/30\">\n              {WEEKDAYS.map((day) => (\n                <div\n                  key={day}\n                  className=\"py-3 text-center text-sm font-semibold text-muted-foreground border-r last:border-r-0\"\n                >\n                  {day}\n                </div>\n              ))}\n            </div>\n\n            {/* Calendar Grid */}\n            <div className=\"grid grid-cols-7 flex-1 auto-rows-fr\">\n              {days.map((day, index) => {\n                const dayDeals = day ? getDealsForDay(day) : [];\n                const isToday =\n                  day === new Date().getDate() &&\n                  currentDate.getMonth() === new Date().getMonth() &&\n                  currentDate.getFullYear() === new Date().getFullYear();\n\n                return (\n                  <div\n                    key={index}\n                    className={cn(\n                      \"min-h-[120px] p-2 border-b border-r last:border-r-0 relative transition-colors hover:bg-muted/10\",\n                      !day && \"bg-muted/5\",\n                      (index + 1) % 7 === 0 && \"border-r-0\", // Remove right border for last column\n                      index >= days.length - 7 && \"border-b-0\", // Remove bottom border for last row (approx)\n                    )}\n                  >\n                    {day && (\n                      <>\n                        <div\n                          className={cn(\n                            \"flex items-center justify-center w-7 h-7 rounded-full text-sm font-medium mb-1\",\n                            isToday ? \"bg-primary text-primary-foreground\" : \"text-foreground\",\n                          )}\n                        >\n                          {day}\n                        </div>\n                        <div className=\"space-y-1\">\n                          {dayDeals?.map((deal) => (\n                            <div\n                              key={deal._id}\n                              className=\"group flex flex-col gap-0.5 p-1.5 rounded-md bg-primary/10 border border-primary/20 text-xs hover:bg-primary/20 transition-colors cursor-pointer\"\n                              title={`${deal.company} - ${deal.stage}`}\n                            >\n                              <div className=\"font-semibold truncate flex items-center gap-1\">\n                                <Briefcase className=\"h-3 w-3 opacity-70\" />\n                                {deal.company}\n                              </div>\n                              {deal.valuation && <div className=\"text-[10px] opacity-80 pl-4\">{deal.valuation}</div>}\n                              <Badge\n                                variant=\"outline\"\n                                className=\"text-[10px] h-4 px-1 w-fit bg-background/50 border-primary/20\"\n                              >\n                                {deal.stage}\n                              </Badge>\n                            </div>\n                          ))}\n                        </div>\n                      </>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n    </AppShell>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[4194,4199],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { useDeals } from \"@/hooks/use-convex\";\nimport { cn } from \"@/lib/utils\";\nimport { Briefcase, Calendar as CalendarIcon, ChevronLeft, ChevronRight, Loader2 } from \"lucide-react\";\nimport { useState } from \"react\";\n\nconst WEEKDAYS = [\"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\", \"Dim\"];\nconst MONTHS = [\n  \"Janvier\",\n  \"Février\",\n  \"Mars\",\n  \"Avril\",\n  \"Mai\",\n  \"Juin\",\n  \"Juillet\",\n  \"Août\",\n  \"Septembre\",\n  \"Octobre\",\n  \"Novembre\",\n  \"Décembre\",\n];\n\nexport function CalendarClient() {\n  const { deals, isLoading } = useDeals();\n  const [currentDate, setCurrentDate] = useState(new Date());\n\n  const getDaysInMonth = (date: Date) => {\n    return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();\n  };\n\n  const getFirstDayOfMonth = (date: Date) => {\n    // 0 = Sunday, 1 = Monday, etc.\n    // We want 0 = Monday, 6 = Sunday for the grid\n    const day = new Date(date.getFullYear(), date.getMonth(), 1).getDay();\n    return (day + 6) % 7;\n  };\n\n  const prevMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));\n  };\n\n  const nextMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));\n  };\n\n  const currentMonthName = MONTHS[currentDate.getMonth()];\n  const currentYear = currentDate.getFullYear();\n  const daysInMonth = getDaysInMonth(currentDate);\n  const firstDay = getFirstDayOfMonth(currentDate);\n\n  // Generate calendar grid cells\n  const days = [];\n  // Empty cells for previous month\n  for (let i = 0; i < firstDay; i++) {\n    days.push(null);\n  }\n  // Days of current month\n  for (let i = 1; i <= daysInMonth; i++) {\n    days.push(i);\n  }\n\n  // Filter deals for the displayed month\n  const dealsInMonth = deals?.filter((deal) => {\n    if (!deal.dueDate) return false;\n    const dealDate = new Date(deal.dueDate);\n    return dealDate.getMonth() === currentDate.getMonth() && dealDate.getFullYear() === currentDate.getFullYear();\n  });\n\n  const getDealsForDay = (day: number) => {\n    return dealsInMonth?.filter((deal) => {\n      const dealDate = new Date(deal.dueDate!); // Checked in filter above\n      return dealDate.getDate() === day;\n    });\n  };\n\n  return (\n    <AppShell>\n      <div className=\"flex flex-col h-full space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <CalendarIcon className=\"h-6 w-6 text-primary\" />\n            <h1 className=\"text-2xl font-bold tracking-tight\">Calendrier</h1>\n          </div>\n          <div className=\"flex items-center gap-2 bg-muted/50 p-1 rounded-lg border\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={prevMonth}>\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <span className=\"min-w-[140px] text-center font-medium\">\n              {currentMonthName} {currentYear}\n            </span>\n            <Button variant=\"ghost\" size=\"icon\" onClick={nextMonth}>\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <div className=\"w-[100px]\" /> {/* Spacer for centering alignment if needed, or actions */}\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : (\n          <div className=\"flex-1 border rounded-lg overflow-hidden bg-background flex flex-col shadow-sm\">\n            {/* Weekday Headers */}\n            <div className=\"grid grid-cols-7 border-b bg-muted/30\">\n              {WEEKDAYS.map((day) => (\n                <div\n                  key={day}\n                  className=\"py-3 text-center text-sm font-semibold text-muted-foreground border-r last:border-r-0\"\n                >\n                  {day}\n                </div>\n              ))}\n            </div>\n\n            {/* Calendar Grid */}\n            <div className=\"grid grid-cols-7 flex-1 auto-rows-fr\">\n              {days.map((day, index) => {\n                const dayDeals = day ? getDealsForDay(day) : [];\n                const isToday =\n                  day === new Date().getDate() &&\n                  currentDate.getMonth() === new Date().getMonth() &&\n                  currentDate.getFullYear() === new Date().getFullYear();\n\n                return (\n                  <div\n                    key={index}\n                    className={cn(\n                      \"min-h-[120px] p-2 border-b border-r last:border-r-0 relative transition-colors hover:bg-muted/10\",\n                      !day && \"bg-muted/5\",\n                      (index + 1) % 7 === 0 && \"border-r-0\", // Remove right border for last column\n                      index >= days.length - 7 && \"border-b-0\", // Remove bottom border for last row (approx)\n                    )}\n                  >\n                    {day && (\n                      <>\n                        <div\n                          className={cn(\n                            \"flex items-center justify-center w-7 h-7 rounded-full text-sm font-medium mb-1\",\n                            isToday ? \"bg-primary text-primary-foreground\" : \"text-foreground\",\n                          )}\n                        >\n                          {day}\n                        </div>\n                        <div className=\"space-y-1\">\n                          {dayDeals?.map((deal) => (\n                            <div\n                              key={deal._id}\n                              className=\"group flex flex-col gap-0.5 p-1.5 rounded-md bg-primary/10 border border-primary/20 text-xs hover:bg-primary/20 transition-colors cursor-pointer\"\n                              title={`${deal.company} - ${deal.stage}`}\n                            >\n                              <div className=\"font-semibold truncate flex items-center gap-1\">\n                                <Briefcase className=\"h-3 w-3 opacity-70\" />\n                                {deal.company}\n                              </div>\n                              {deal.valuation && <div className=\"text-[10px] opacity-80 pl-4\">{deal.valuation}</div>}\n                              <Badge\n                                variant=\"outline\"\n                                className=\"text-[10px] h-4 px-1 w-fit bg-background/50 border-primary/20\"\n                              >\n                                {deal.stage}\n                              </Badge>\n                            </div>\n                          ))}\n                        </div>\n                      </>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n    </AppShell>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/calendar/calendar-client.tsx"},"span":[4571,4576],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { useDeals } from \"@/hooks/use-convex\";\nimport { cn } from \"@/lib/utils\";\nimport { Briefcase, Calendar as CalendarIcon, ChevronLeft, ChevronRight, Loader2 } from \"lucide-react\";\nimport { useState } from \"react\";\n\nconst WEEKDAYS = [\"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\", \"Dim\"];\nconst MONTHS = [\n  \"Janvier\",\n  \"Février\",\n  \"Mars\",\n  \"Avril\",\n  \"Mai\",\n  \"Juin\",\n  \"Juillet\",\n  \"Août\",\n  \"Septembre\",\n  \"Octobre\",\n  \"Novembre\",\n  \"Décembre\",\n];\n\nexport function CalendarClient() {\n  const { deals, isLoading } = useDeals();\n  const [currentDate, setCurrentDate] = useState(new Date());\n\n  const getDaysInMonth = (date: Date) => {\n    return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();\n  };\n\n  const getFirstDayOfMonth = (date: Date) => {\n    // 0 = Sunday, 1 = Monday, etc.\n    // We want 0 = Monday, 6 = Sunday for the grid\n    const day = new Date(date.getFullYear(), date.getMonth(), 1).getDay();\n    return (day + 6) % 7;\n  };\n\n  const prevMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));\n  };\n\n  const nextMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));\n  };\n\n  const currentMonthName = MONTHS[currentDate.getMonth()];\n  const currentYear = currentDate.getFullYear();\n  const daysInMonth = getDaysInMonth(currentDate);\n  const firstDay = getFirstDayOfMonth(currentDate);\n\n  // Generate calendar grid cells\n  const days = [];\n  // Empty cells for previous month\n  for (let i = 0; i < firstDay; i++) {\n    days.push(null);\n  }\n  // Days of current month\n  for (let i = 1; i <= daysInMonth; i++) {\n    days.push(i);\n  }\n\n  // Filter deals for the displayed month\n  const dealsInMonth = deals?.filter((deal) => {\n    if (!deal.dueDate) return false;\n    const dealDate = new Date(deal.dueDate);\n    return dealDate.getMonth() === currentDate.getMonth() && dealDate.getFullYear() === currentDate.getFullYear();\n  });\n\n  const getDealsForDay = (day: number) => {\n    return dealsInMonth?.filter((deal) => {\n      const dealDate = new Date(deal.dueDate!); // Checked in filter above\n      return dealDate.getDate() === day;\n    });\n  };\n\n  return (\n    <AppShell>\n      <div className=\"flex flex-col h-full space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <CalendarIcon className=\"h-6 w-6 text-primary\" />\n            <h1 className=\"text-2xl font-bold tracking-tight\">Calendrier</h1>\n          </div>\n          <div className=\"flex items-center gap-2 bg-muted/50 p-1 rounded-lg border\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={prevMonth}>\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <span className=\"min-w-[140px] text-center font-medium\">\n              {currentMonthName} {currentYear}\n            </span>\n            <Button variant=\"ghost\" size=\"icon\" onClick={nextMonth}>\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <div className=\"w-[100px]\" /> {/* Spacer for centering alignment if needed, or actions */}\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : (\n          <div className=\"flex-1 border rounded-lg overflow-hidden bg-background flex flex-col shadow-sm\">\n            {/* Weekday Headers */}\n            <div className=\"grid grid-cols-7 border-b bg-muted/30\">\n              {WEEKDAYS.map((day) => (\n                <div\n                  key={day}\n                  className=\"py-3 text-center text-sm font-semibold text-muted-foreground border-r last:border-r-0\"\n                >\n                  {day}\n                </div>\n              ))}\n            </div>\n\n            {/* Calendar Grid */}\n            <div className=\"grid grid-cols-7 flex-1 auto-rows-fr\">\n              {days.map((day, index) => {\n                const dayDeals = day ? getDealsForDay(day) : [];\n                const isToday =\n                  day === new Date().getDate() &&\n                  currentDate.getMonth() === new Date().getMonth() &&\n                  currentDate.getFullYear() === new Date().getFullYear();\n\n                return (\n                  <div\n                    key={index}\n                    className={cn(\n                      \"min-h-[120px] p-2 border-b border-r last:border-r-0 relative transition-colors hover:bg-muted/10\",\n                      !day && \"bg-muted/5\",\n                      (index + 1) % 7 === 0 && \"border-r-0\", // Remove right border for last column\n                      index >= days.length - 7 && \"border-b-0\", // Remove bottom border for last row (approx)\n                    )}\n                  >\n                    {day && (\n                      <>\n                        <div\n                          className={cn(\n                            \"flex items-center justify-center w-7 h-7 rounded-full text-sm font-medium mb-1\",\n                            isToday ? \"bg-primary text-primary-foreground\" : \"text-foreground\",\n                          )}\n                        >\n                          {day}\n                        </div>\n                        <div className=\"space-y-1\">\n                          {dayDeals?.map((deal) => (\n                            <div\n                              key={deal._id}\n                              className=\"group flex flex-col gap-0.5 p-1.5 rounded-md bg-primary/10 border border-primary/20 text-xs hover:bg-primary/20 transition-colors cursor-pointer\"\n                              title={`${deal.company} - ${deal.stage}`}\n                            >\n                              <div className=\"font-semibold truncate flex items-center gap-1\">\n                                <Briefcase className=\"h-3 w-3 opacity-70\" />\n                                {deal.company}\n                              </div>\n                              {deal.valuation && <div className=\"text-[10px] opacity-80 pl-4\">{deal.valuation}</div>}\n                              <Badge\n                                variant=\"outline\"\n                                className=\"text-[10px] h-4 px-1 w-fit bg-background/50 border-primary/20\"\n                              >\n                                {deal.stage}\n                              </Badge>\n                            </div>\n                          ))}\n                        </div>\n                      </>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n    </AppShell>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/colab/boards/[boardId]/page.tsx"},"span":[3086,3089],"sourceCode":"\"use client\";\n\nimport { KanbanBoard } from \"@/components/kanban/Board\";\nimport { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/tailwind/ui/popover\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { useQuery } from \"convex/react\";\nimport { Calendar as CalendarIcon, Filter, Tag } from \"lucide-react\";\nimport React, { useState } from \"react\";\n\ninterface PageProps {\n  params: Promise<{\n    boardId: string;\n  }>;\n}\n\nexport default function SingleBoardPage({ params }: PageProps) {\n  const { boardId } = React.use(params);\n  // @ts-ignore\n  const boardData = useQuery(api.boards.getBoard, { boardId: boardId as Id<\"colab_boards\"> });\n\n  const [filters, setFilters] = useState<{\n    labelId?: string;\n    dueDate?: Date;\n  }>({});\n\n  if (!boardData) {\n    return (\n      <div className=\"flex items-center justify-center h-screen\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\" />\n      </div>\n    );\n  }\n\n  const activeFilterCount = Object.keys(filters).length;\n\n  return (\n    <div className=\"flex flex-col h-[calc(100vh-4rem)]\">\n      <div className=\"border-b px-6 py-3 bg-background flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <h1 className=\"text-xl font-bold\">{boardData.name}</h1>\n          <div className=\"h-6 w-px bg-border\" />\n\n          {/* Filter Bar */}\n          <Popover>\n            <PopoverTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" className={activeFilterCount > 0 ? \"bg-secondary\" : \"\"}>\n                <Filter className=\"mr-2 h-4 w-4\" />\n                Filtres\n                {activeFilterCount > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-2 px-1 h-5\">\n                    {activeFilterCount}\n                  </Badge>\n                )}\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-80 p-4\" align=\"start\">\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium leading-none\">Filtrer par</h4>\n\n                {/* Labels Filter */}\n                <div className=\"space-y-2\">\n                  <span className=\"text-xs font-medium text-muted-foreground uppercase flex items-center gap-2\">\n                    <Tag className=\"h-3 w-3\" /> Étiquettes\n                  </span>\n                  <div className=\"flex flex-wrap gap-2\">\n                    <Badge\n                      variant={filters.labelId === undefined ? \"default\" : \"outline\"}\n                      className=\"cursor-pointer\"\n                      onClick={() =>\n                        setFilters((prev) => {\n                          const { labelId, ...rest } = prev;\n                          return rest;\n                        })\n                      }\n                    >\n                      Tous\n                    </Badge>\n                    {boardData.labels?.map((label: any) => (\n                      <Badge\n                        key={label._id}\n                        style={{\n                          backgroundColor: filters.labelId === label._id ? label.colorCode : undefined,\n                          borderColor: label.colorCode,\n                          color: filters.labelId === label._id ? \"white\" : label.colorCode,\n                        }}\n                        variant=\"outline\"\n                        className=\"cursor-pointer\"\n                        onClick={() => setFilters((prev) => ({ ...prev, labelId: label._id }))}\n                      >\n                        {label.name}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Due Date Filter (Simple) */}\n                <div className=\"space-y-2\">\n                  <span className=\"text-xs font-medium text-muted-foreground uppercase flex items-center gap-2\">\n                    <CalendarIcon className=\"h-3 w-3\" /> Échéance\n                  </span>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant={filters.dueDate ? \"secondary\" : \"outline\"}\n                      size=\"sm\"\n                      className=\"h-7 text-xs\"\n                      onClick={() =>\n                        setFilters((prev) =>\n                          filters.dueDate ? (({ dueDate, ...rest }) => rest)(prev) : { ...prev, dueDate: new Date() },\n                        )\n                      }\n                    >\n                      En retard ou aujourd'hui\n                    </Button>\n                  </div>\n                </div>\n\n                {activeFilterCount > 0 && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"w-full text-muted-foreground\"\n                    onClick={() => setFilters({})}\n                  >\n                    Effacer tout\n                  </Button>\n                )}\n              </div>\n            </PopoverContent>\n          </Popover>\n        </div>\n\n        {/* Right side options if any */}\n        <div className=\"flex items-center gap-2\">{/* Avatars of members could go here */}</div>\n      </div>\n\n      <div className=\"flex-1 overflow-x-auto overflow-y-hidden p-6 bg-muted/20\">\n        <KanbanBoard board={boardData} lists={boardData.lists} cards={boardData.cards} filters={filters} />\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[577,578],"sourceCode":"\"use client\";\n\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport dynamicImport from \"next/dynamic\";\n\n// Force dynamic rendering to avoid SSG issues with Clerk\nexport const dynamic = \"force-dynamic\";\n\n// Dynamically import Dashboard to avoid SSR issues with Clerk hooks\nconst Dashboard = dynamicImport(() => import(\"./Dashboard\"), {\n  ssr: false,\n  loading: () => (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <Skeleton className=\"h-32 w-full\" />\n      <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n        {[...Array(6)].map((_, i) => (\n          <Skeleton key={i} className=\"h-48 w-full\" />\n        ))}\n      </div>\n    </div>\n  ),\n});\n\nexport default function DashboardPage() {\n  return <Dashboard />;\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/dashboard/page.tsx"},"span":[610,611],"sourceCode":"\"use client\";\n\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport dynamicImport from \"next/dynamic\";\n\n// Force dynamic rendering to avoid SSG issues with Clerk\nexport const dynamic = \"force-dynamic\";\n\n// Dynamically import Dashboard to avoid SSR issues with Clerk hooks\nconst Dashboard = dynamicImport(() => import(\"./Dashboard\"), {\n  ssr: false,\n  loading: () => (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <Skeleton className=\"h-32 w-full\" />\n      <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n        {[...Array(6)].map((_, i) => (\n          <Skeleton key={i} className=\"h-48 w-full\" />\n        ))}\n      </div>\n    </div>\n  ),\n});\n\nexport default function DashboardPage() {\n  return <Dashboard />;\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[553,554],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport dynamicImport from \"next/dynamic\";\n\nexport const dynamic = \"force-dynamic\";\nexport const runtime = \"nodejs\";\n\nconst DocumentsContent = dynamicImport(() => import(\"./DocumentsContent\"), {\n  ssr: false,\n  loading: () => (\n    <AppShell>\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-12 w-64\" />\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {[...Array(6)].map((_, i) => (\n            <Skeleton key={i} className=\"h-48 w-full\" />\n          ))}\n        </div>\n      </div>\n    </AppShell>\n  ),\n});\n\nexport default function DocumentsPage() {\n  return <DocumentsContent />;\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/documents/page.tsx"},"span":[588,589],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport dynamicImport from \"next/dynamic\";\n\nexport const dynamic = \"force-dynamic\";\nexport const runtime = \"nodejs\";\n\nconst DocumentsContent = dynamicImport(() => import(\"./DocumentsContent\"), {\n  ssr: false,\n  loading: () => (\n    <AppShell>\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-12 w-64\" />\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {[...Array(6)].map((_, i) => (\n            <Skeleton key={i} className=\"h-48 w-full\" />\n          ))}\n        </div>\n      </div>\n    </AppShell>\n  ),\n});\n\nexport default function DocumentsPage() {\n  return <DocumentsContent />;\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/dashboard/Dashboard.tsx"},"span":[9485,9488],"sourceCode":"\"use client\";\n\n/**\n * Dashboard Page - Main home page\n * Features: Welcome message, quick actions, recent documents, activity feed\n */\n\nimport { RecentFiles } from \"@/components/recent-files\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Separator } from \"@/components/tailwind/ui/separator\";\nimport { useDeals, useDocuments } from \"@/hooks/use-convex\";\nimport { formatRelativeTime } from \"@/lib/format-relative-time\";\nimport { fr, t } from \"@/lib/i18n\";\nimport { useUser } from \"@clerk/nextjs\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  CheckCircle2,\n  Clock,\n  FileText,\n  Globe,\n  LayoutDashboard,\n  Users,\n} from \"lucide-react\";\nimport { motion } from \"motion/react\";\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nconst quickActions = [\n  {\n    icon: Briefcase,\n    label: fr.actions.newDeal,\n    description: \"Créer un nouveau deal dans le pipeline\",\n    href: \"/pipeline\",\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n  },\n  {\n    icon: FileText,\n    label: fr.actions.newDocument,\n    description: \"Créer un nouveau document de collaboration\",\n    href: \"/documents\",\n    color: \"text-green-500\",\n    bgColor: \"bg-green-500/10\",\n  },\n  {\n    icon: Building,\n    label: fr.actions.newCompanyProfile,\n    description: \"Ajouter un profil d'entreprise\",\n    href: \"/companies\",\n    color: \"text-purple-500\",\n    bgColor: \"bg-purple-500/10\",\n  },\n];\n\nconst getTimestamp = (timestamp?: number, fallback?: number) => timestamp ?? fallback ?? 0;\n\nconst isDealNew = (deal: { updatedAt?: number; createdAt?: number }) =>\n  !deal.updatedAt || deal.updatedAt === deal.createdAt;\n\nconst getInitials = (name?: string) => {\n  if (!name) return \"?\";\n  return (\n    name\n      .split(\" \")\n      .filter(Boolean)\n      .map((part) => part[0])\n      .join(\"\")\n      .slice(0, 2) || \"?\"\n  );\n};\n\nexport default function Dashboard() {\n  const [hasAuth, setHasAuth] = useState(false);\n\n  // Safe check for Clerk environment\n  useEffect(() => {\n    if (process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY) {\n      setHasAuth(true);\n    }\n  }, []);\n\n  return hasAuth ? <DashboardContent /> : <DashboardContentMock />;\n}\n\nfunction DashboardContent() {\n  const { user, isLoaded } = useUser();\n  const { documents, isLoading: documentsLoading, isConvexAvailable: isDocumentsAvailable } = useDocuments(user?.id);\n  const { deals, isLoading: dealsLoading, isConvexAvailable: isDealsAvailable } = useDeals(user?.id);\n\n  // Reuse logic...\n  // To avoid duplicating huge code blocks, I should have extracted the main logic.\n  // But given constraints, I will keep it inline in this component\n  // and have a mock component that doesn't use hooks.\n  // Actually, I can just use a conditional hook call? No, that's illegal in React.\n  // So splitting is correct.\n\n  // Wait, duplicating the whole logic is bad.\n  // I will refactor DashboardContent to accept user/data as props or use hooks if auth is present.\n  // But useUser throws if not in provider.\n  // So DashboardContent MUST be a separate component that is only rendered if auth is present.\n\n  // However, I need to copy the logic.\n  // Since I can't easily extract all the logic without rewriting a lot,\n  // I will just use the existing logic for DashboardContent\n  // and create a simplified mock for the \"no-auth\" case (dev environment).\n\n  const isDocumentsLoading = documentsLoading && isDocumentsAvailable;\n  const isDealsLoading = dealsLoading && isDealsAvailable;\n  const isDataLoading = !isLoaded || isDocumentsLoading || isDealsLoading;\n  const activeDocuments = useMemo(() => documents.filter((document) => !document.isArchived), [documents]);\n  const activeDeals = useMemo(() => deals.filter((deal) => !deal.isArchived), [deals]);\n  const inProgressDeals = useMemo(\n    () => activeDeals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const closedDeals = useMemo(\n    () => activeDeals.filter((deal) => [\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const displayName = user?.fullName || user?.firstName || user?.username || \"Utilisateur\";\n\n  const memberIds = useMemo(() => {\n    const ids = new Set<string>();\n    if (user?.id) {\n      ids.add(user.id);\n    }\n    activeDocuments.forEach((document) => {\n      if (document.userId) {\n        ids.add(document.userId);\n      }\n    });\n    activeDeals.forEach((deal) => {\n      if (deal.userId) {\n        ids.add(deal.userId);\n      }\n    });\n    return ids;\n  }, [activeDocuments, activeDeals, user?.id]);\n\n  const getDocumentTimestamp = (document: (typeof documents)[number]) =>\n    getTimestamp(document.updatedAt, document.createdAt ?? document._creationTime);\n  const getDealTimestamp = (deal: (typeof deals)[number]) =>\n    getTimestamp(deal.updatedAt, deal.createdAt ?? deal._creationTime);\n\n  const recentDocuments = useMemo(\n    () =>\n      activeDocuments\n        .map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: document._id,\n            title: document.title || t(\"editor.untitled\"),\n            description: document.dealId ? fr.dashboard.documentLinkedToDeal : fr.dashboard.documentCollaboration,\n            time: formatRelativeTime(timestamp),\n            collaborators: document.userId ? 1 : 0,\n            href: `/documents/${document._id}`,\n            timestamp,\n          };\n        })\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 3),\n    [activeDocuments],\n  );\n\n  const activityFeed = useMemo(\n    () =>\n      [\n        ...activeDocuments.map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: `document-${document._id}`,\n            user: document.userId === user?.id ? displayName : fr.common.collaborator,\n            action: fr.activity.updatedDocument,\n            target: document.title || t(\"editor.untitled\"),\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n        ...activeDeals.map((deal) => {\n          const timestamp = getDealTimestamp(deal);\n          const isNewDeal = isDealNew(deal);\n          return {\n            id: `deal-${deal._id}`,\n            user: deal.lead || (deal.userId === user?.id ? displayName : fr.common.team),\n            action: isNewDeal ? fr.activity.createdDeal : fr.activity.updatedDeal,\n            target: deal.company,\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n      ]\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 5),\n    [activeDeals, activeDocuments, displayName, user?.id],\n  );\n\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: isDataLoading ? \"—\" : inProgressDeals.length.toString(),\n      icon: Briefcase,\n      trend: isDataLoading ? fr.loader.loading : `${activeDeals.length} ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: isDataLoading ? \"—\" : activeDocuments.length.toString(),\n      icon: FileText,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : recentDocuments[0]\n          ? `${fr.dashboard.lastUpdate} ${recentDocuments[0].time}`\n          : fr.dashboard.noDocuments,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: isDataLoading ? \"—\" : memberIds.size.toString(),\n      icon: Users,\n      trend: isDataLoading ? fr.loader.loading : memberIds.size > 0 ? fr.dashboard.activeTeam : fr.dashboard.noMembers,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: isDataLoading ? \"—\" : closedDeals.length.toString(),\n      icon: CheckCircle2,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : closedDeals.length > 0\n          ? `${closedDeals.length} ${fr.dashboard.dealsClosed}`\n          : fr.dashboard.noClosedDeals,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={isLoaded}\n      user={user}\n      stats={stats}\n      recentDocuments={recentDocuments}\n      activityFeed={activityFeed}\n      isDocumentsLoading={isDocumentsLoading}\n      isDataLoading={isDataLoading}\n    />\n  );\n}\n\n// Mock content for dev/no-auth environment\nfunction DashboardContentMock() {\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: \"12\",\n      icon: Briefcase,\n      trend: `15 ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: \"8\",\n      icon: FileText,\n      trend: `${fr.dashboard.lastUpdate} 2h ago`,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: \"4\",\n      icon: Users,\n      trend: fr.dashboard.activeTeam,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: \"5\",\n      icon: CheckCircle2,\n      trend: `5 ${fr.dashboard.dealsClosed}`,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={true}\n      user={{ firstName: \"Demo\", username: \"User\" } as any}\n      stats={stats}\n      recentDocuments={[]}\n      activityFeed={[]}\n      isDocumentsLoading={false}\n      isDataLoading={false}\n    />\n  );\n}\n\n// UI Component to share layout\nfunction DashboardUI({ isLoaded, user, stats, recentDocuments, activityFeed, isDocumentsLoading, isDataLoading }: any) {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome Section */}\n      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }}>\n        <h1 className=\"text-4xl font-bold\">\n          {fr.dashboard.welcomeBack}\n          {isLoaded && user && <span className=\"text-primary\">, {user.firstName || user.username}</span>}\n        </h1>\n        <p className=\"mt-2 text-muted-foreground\">Gérez vos deals, documents et collaborations en un seul endroit</p>\n      </motion.div>\n\n      {/* Stats Grid */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.1 }}\n        className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\"\n      >\n        {stats.map((stat: any) => {\n          const Icon = stat.icon;\n          return (\n            <Card key={stat.id}>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{stat.label}</CardTitle>\n                <Icon className={`h-4 w-4 ${stat.color}`} />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stat.value}</div>\n                <p className=\"text-xs text-muted-foreground\">{stat.trend}</p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </motion.div>\n\n      {/* Quick Actions */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.2 }}\n      >\n        <h2 className=\"text-2xl font-bold mb-4\">{fr.dashboard.quickActions}</h2>\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          {quickActions.map((action) => {\n            const Icon = action.icon;\n            return (\n              <Link key={action.href} href={action.href}>\n                <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                  <CardHeader>\n                    <div className={`w-12 h-12 rounded-lg ${action.bgColor} flex items-center justify-center mb-4`}>\n                      <Icon className={`h-6 w-6 ${action.color}`} />\n                    </div>\n                    <CardTitle>{action.label}</CardTitle>\n                    <CardDescription>{action.description}</CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n            );\n          })}\n        </div>\n      </motion.div>\n\n      {/* Recent Files & Quick Navigation */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.15 }}\n        className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\"\n      >\n        {/* Recent Files Card */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Recent Documents</CardTitle>\n            <CardDescription>Pick up where you left off</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {/* RecentFiles component also likely uses hooks, so we should mock it or be careful */}\n            {/* Assuming RecentFiles is safe or we wrap it. For now let's hope it handles missing auth or we mock it too */}\n            {/* Just to be safe, if we are in mock mode, we show placeholder */}\n            {process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY ? (\n              <RecentFiles limit={5} showCreateButton={true} />\n            ) : (\n              <div className=\"text-sm text-muted-foreground\">Recent files unavailable in demo mode.</div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Quick Navigation Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Quick Navigation</CardTitle>\n            <CardDescription>Jump to frequently used areas</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/dashboard\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <LayoutDashboard className=\"h-4 w-4 mr-2\" />\n                Admin Dashboard\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/contacts\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Users className=\"h-4 w-4 mr-2\" />\n                CRM Contacts\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/companies\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Building className=\"h-4 w-4 mr-2\" />\n                Companies\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"https://alecia.markets\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Globe className=\"h-4 w-4 mr-2\" />\n                Website\n              </a>\n            </Button>\n          </CardContent>\n        </Card>\n      </motion.div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        {/* Recent Documents */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.3 }}\n          className=\"lg:col-span-2\"\n        >\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>{fr.dashboard.recentDocuments}</CardTitle>\n                <Button variant=\"ghost\" size=\"sm\" asChild>\n                  <Link href=\"/documents\">\n                    Voir tout <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </Link>\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isDocumentsLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : recentDocuments.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.nav.noRecentDocuments}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {recentDocuments.map((doc: any, index: number) => (\n                    <div key={doc.id}>\n                      <Link href={doc.href} className=\"block\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex items-start gap-3\">\n                            <div className=\"rounded-lg bg-primary/10 p-2\">\n                              <FileText className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <h4 className=\"font-medium\">{doc.title}</h4>\n                              <p className=\"text-sm text-muted-foreground\">{doc.description}</p>\n                              <div className=\"flex items-center gap-3 mt-2 text-xs text-muted-foreground\">\n                                <span className=\"flex items-center gap-1\">\n                                  <Clock className=\"h-3 w-3\" />\n                                  {doc.time}\n                                </span>\n                                <span className=\"flex items-center gap-1\">\n                                  <Users className=\"h-3 w-3\" />\n                                  {doc.collaborators}{\" \"}\n                                  {doc.collaborators === 1\n                                    ? fr.common.collaboratorSingle\n                                    : fr.common.collaboratorPlural}\n                                </span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </Link>\n                      {index < recentDocuments.length - 1 && <Separator className=\"mt-4\" />}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        {/* Activity Feed */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.4 }}\n        >\n          <Card>\n            <CardHeader>\n              <CardTitle>{fr.dashboard.activityFeed}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isDataLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : activityFeed.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.dashboard.noRecentActivity}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {activityFeed.map((activity: any) => {\n                    const initials = getInitials(activity.user);\n                    return (\n                      <div key={activity.id} className=\"flex gap-3\">\n                        <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-xs font-semibold text-primary\">\n                          {initials || \"?\"}\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm\">\n                            <span className=\"font-medium\">{activity.user}</span>{\" \"}\n                            <span className=\"text-muted-foreground\">{activity.action}</span>{\" \"}\n                            <span className=\"font-medium\">{activity.target}</span>\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">{activity.time}</p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/dashboard/Dashboard.tsx"},"span":[9783,9786],"sourceCode":"\"use client\";\n\n/**\n * Dashboard Page - Main home page\n * Features: Welcome message, quick actions, recent documents, activity feed\n */\n\nimport { RecentFiles } from \"@/components/recent-files\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Separator } from \"@/components/tailwind/ui/separator\";\nimport { useDeals, useDocuments } from \"@/hooks/use-convex\";\nimport { formatRelativeTime } from \"@/lib/format-relative-time\";\nimport { fr, t } from \"@/lib/i18n\";\nimport { useUser } from \"@clerk/nextjs\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  CheckCircle2,\n  Clock,\n  FileText,\n  Globe,\n  LayoutDashboard,\n  Users,\n} from \"lucide-react\";\nimport { motion } from \"motion/react\";\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nconst quickActions = [\n  {\n    icon: Briefcase,\n    label: fr.actions.newDeal,\n    description: \"Créer un nouveau deal dans le pipeline\",\n    href: \"/pipeline\",\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n  },\n  {\n    icon: FileText,\n    label: fr.actions.newDocument,\n    description: \"Créer un nouveau document de collaboration\",\n    href: \"/documents\",\n    color: \"text-green-500\",\n    bgColor: \"bg-green-500/10\",\n  },\n  {\n    icon: Building,\n    label: fr.actions.newCompanyProfile,\n    description: \"Ajouter un profil d'entreprise\",\n    href: \"/companies\",\n    color: \"text-purple-500\",\n    bgColor: \"bg-purple-500/10\",\n  },\n];\n\nconst getTimestamp = (timestamp?: number, fallback?: number) => timestamp ?? fallback ?? 0;\n\nconst isDealNew = (deal: { updatedAt?: number; createdAt?: number }) =>\n  !deal.updatedAt || deal.updatedAt === deal.createdAt;\n\nconst getInitials = (name?: string) => {\n  if (!name) return \"?\";\n  return (\n    name\n      .split(\" \")\n      .filter(Boolean)\n      .map((part) => part[0])\n      .join(\"\")\n      .slice(0, 2) || \"?\"\n  );\n};\n\nexport default function Dashboard() {\n  const [hasAuth, setHasAuth] = useState(false);\n\n  // Safe check for Clerk environment\n  useEffect(() => {\n    if (process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY) {\n      setHasAuth(true);\n    }\n  }, []);\n\n  return hasAuth ? <DashboardContent /> : <DashboardContentMock />;\n}\n\nfunction DashboardContent() {\n  const { user, isLoaded } = useUser();\n  const { documents, isLoading: documentsLoading, isConvexAvailable: isDocumentsAvailable } = useDocuments(user?.id);\n  const { deals, isLoading: dealsLoading, isConvexAvailable: isDealsAvailable } = useDeals(user?.id);\n\n  // Reuse logic...\n  // To avoid duplicating huge code blocks, I should have extracted the main logic.\n  // But given constraints, I will keep it inline in this component\n  // and have a mock component that doesn't use hooks.\n  // Actually, I can just use a conditional hook call? No, that's illegal in React.\n  // So splitting is correct.\n\n  // Wait, duplicating the whole logic is bad.\n  // I will refactor DashboardContent to accept user/data as props or use hooks if auth is present.\n  // But useUser throws if not in provider.\n  // So DashboardContent MUST be a separate component that is only rendered if auth is present.\n\n  // However, I need to copy the logic.\n  // Since I can't easily extract all the logic without rewriting a lot,\n  // I will just use the existing logic for DashboardContent\n  // and create a simplified mock for the \"no-auth\" case (dev environment).\n\n  const isDocumentsLoading = documentsLoading && isDocumentsAvailable;\n  const isDealsLoading = dealsLoading && isDealsAvailable;\n  const isDataLoading = !isLoaded || isDocumentsLoading || isDealsLoading;\n  const activeDocuments = useMemo(() => documents.filter((document) => !document.isArchived), [documents]);\n  const activeDeals = useMemo(() => deals.filter((deal) => !deal.isArchived), [deals]);\n  const inProgressDeals = useMemo(\n    () => activeDeals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const closedDeals = useMemo(\n    () => activeDeals.filter((deal) => [\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const displayName = user?.fullName || user?.firstName || user?.username || \"Utilisateur\";\n\n  const memberIds = useMemo(() => {\n    const ids = new Set<string>();\n    if (user?.id) {\n      ids.add(user.id);\n    }\n    activeDocuments.forEach((document) => {\n      if (document.userId) {\n        ids.add(document.userId);\n      }\n    });\n    activeDeals.forEach((deal) => {\n      if (deal.userId) {\n        ids.add(deal.userId);\n      }\n    });\n    return ids;\n  }, [activeDocuments, activeDeals, user?.id]);\n\n  const getDocumentTimestamp = (document: (typeof documents)[number]) =>\n    getTimestamp(document.updatedAt, document.createdAt ?? document._creationTime);\n  const getDealTimestamp = (deal: (typeof deals)[number]) =>\n    getTimestamp(deal.updatedAt, deal.createdAt ?? deal._creationTime);\n\n  const recentDocuments = useMemo(\n    () =>\n      activeDocuments\n        .map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: document._id,\n            title: document.title || t(\"editor.untitled\"),\n            description: document.dealId ? fr.dashboard.documentLinkedToDeal : fr.dashboard.documentCollaboration,\n            time: formatRelativeTime(timestamp),\n            collaborators: document.userId ? 1 : 0,\n            href: `/documents/${document._id}`,\n            timestamp,\n          };\n        })\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 3),\n    [activeDocuments],\n  );\n\n  const activityFeed = useMemo(\n    () =>\n      [\n        ...activeDocuments.map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: `document-${document._id}`,\n            user: document.userId === user?.id ? displayName : fr.common.collaborator,\n            action: fr.activity.updatedDocument,\n            target: document.title || t(\"editor.untitled\"),\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n        ...activeDeals.map((deal) => {\n          const timestamp = getDealTimestamp(deal);\n          const isNewDeal = isDealNew(deal);\n          return {\n            id: `deal-${deal._id}`,\n            user: deal.lead || (deal.userId === user?.id ? displayName : fr.common.team),\n            action: isNewDeal ? fr.activity.createdDeal : fr.activity.updatedDeal,\n            target: deal.company,\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n      ]\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 5),\n    [activeDeals, activeDocuments, displayName, user?.id],\n  );\n\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: isDataLoading ? \"—\" : inProgressDeals.length.toString(),\n      icon: Briefcase,\n      trend: isDataLoading ? fr.loader.loading : `${activeDeals.length} ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: isDataLoading ? \"—\" : activeDocuments.length.toString(),\n      icon: FileText,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : recentDocuments[0]\n          ? `${fr.dashboard.lastUpdate} ${recentDocuments[0].time}`\n          : fr.dashboard.noDocuments,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: isDataLoading ? \"—\" : memberIds.size.toString(),\n      icon: Users,\n      trend: isDataLoading ? fr.loader.loading : memberIds.size > 0 ? fr.dashboard.activeTeam : fr.dashboard.noMembers,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: isDataLoading ? \"—\" : closedDeals.length.toString(),\n      icon: CheckCircle2,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : closedDeals.length > 0\n          ? `${closedDeals.length} ${fr.dashboard.dealsClosed}`\n          : fr.dashboard.noClosedDeals,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={isLoaded}\n      user={user}\n      stats={stats}\n      recentDocuments={recentDocuments}\n      activityFeed={activityFeed}\n      isDocumentsLoading={isDocumentsLoading}\n      isDataLoading={isDataLoading}\n    />\n  );\n}\n\n// Mock content for dev/no-auth environment\nfunction DashboardContentMock() {\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: \"12\",\n      icon: Briefcase,\n      trend: `15 ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: \"8\",\n      icon: FileText,\n      trend: `${fr.dashboard.lastUpdate} 2h ago`,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: \"4\",\n      icon: Users,\n      trend: fr.dashboard.activeTeam,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: \"5\",\n      icon: CheckCircle2,\n      trend: `5 ${fr.dashboard.dealsClosed}`,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={true}\n      user={{ firstName: \"Demo\", username: \"User\" } as any}\n      stats={stats}\n      recentDocuments={[]}\n      activityFeed={[]}\n      isDocumentsLoading={false}\n      isDataLoading={false}\n    />\n  );\n}\n\n// UI Component to share layout\nfunction DashboardUI({ isLoaded, user, stats, recentDocuments, activityFeed, isDocumentsLoading, isDataLoading }: any) {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome Section */}\n      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }}>\n        <h1 className=\"text-4xl font-bold\">\n          {fr.dashboard.welcomeBack}\n          {isLoaded && user && <span className=\"text-primary\">, {user.firstName || user.username}</span>}\n        </h1>\n        <p className=\"mt-2 text-muted-foreground\">Gérez vos deals, documents et collaborations en un seul endroit</p>\n      </motion.div>\n\n      {/* Stats Grid */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.1 }}\n        className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\"\n      >\n        {stats.map((stat: any) => {\n          const Icon = stat.icon;\n          return (\n            <Card key={stat.id}>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{stat.label}</CardTitle>\n                <Icon className={`h-4 w-4 ${stat.color}`} />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stat.value}</div>\n                <p className=\"text-xs text-muted-foreground\">{stat.trend}</p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </motion.div>\n\n      {/* Quick Actions */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.2 }}\n      >\n        <h2 className=\"text-2xl font-bold mb-4\">{fr.dashboard.quickActions}</h2>\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          {quickActions.map((action) => {\n            const Icon = action.icon;\n            return (\n              <Link key={action.href} href={action.href}>\n                <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                  <CardHeader>\n                    <div className={`w-12 h-12 rounded-lg ${action.bgColor} flex items-center justify-center mb-4`}>\n                      <Icon className={`h-6 w-6 ${action.color}`} />\n                    </div>\n                    <CardTitle>{action.label}</CardTitle>\n                    <CardDescription>{action.description}</CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n            );\n          })}\n        </div>\n      </motion.div>\n\n      {/* Recent Files & Quick Navigation */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.15 }}\n        className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\"\n      >\n        {/* Recent Files Card */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Recent Documents</CardTitle>\n            <CardDescription>Pick up where you left off</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {/* RecentFiles component also likely uses hooks, so we should mock it or be careful */}\n            {/* Assuming RecentFiles is safe or we wrap it. For now let's hope it handles missing auth or we mock it too */}\n            {/* Just to be safe, if we are in mock mode, we show placeholder */}\n            {process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY ? (\n              <RecentFiles limit={5} showCreateButton={true} />\n            ) : (\n              <div className=\"text-sm text-muted-foreground\">Recent files unavailable in demo mode.</div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Quick Navigation Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Quick Navigation</CardTitle>\n            <CardDescription>Jump to frequently used areas</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/dashboard\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <LayoutDashboard className=\"h-4 w-4 mr-2\" />\n                Admin Dashboard\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/contacts\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Users className=\"h-4 w-4 mr-2\" />\n                CRM Contacts\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/companies\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Building className=\"h-4 w-4 mr-2\" />\n                Companies\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"https://alecia.markets\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Globe className=\"h-4 w-4 mr-2\" />\n                Website\n              </a>\n            </Button>\n          </CardContent>\n        </Card>\n      </motion.div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        {/* Recent Documents */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.3 }}\n          className=\"lg:col-span-2\"\n        >\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>{fr.dashboard.recentDocuments}</CardTitle>\n                <Button variant=\"ghost\" size=\"sm\" asChild>\n                  <Link href=\"/documents\">\n                    Voir tout <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </Link>\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isDocumentsLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : recentDocuments.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.nav.noRecentDocuments}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {recentDocuments.map((doc: any, index: number) => (\n                    <div key={doc.id}>\n                      <Link href={doc.href} className=\"block\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex items-start gap-3\">\n                            <div className=\"rounded-lg bg-primary/10 p-2\">\n                              <FileText className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <h4 className=\"font-medium\">{doc.title}</h4>\n                              <p className=\"text-sm text-muted-foreground\">{doc.description}</p>\n                              <div className=\"flex items-center gap-3 mt-2 text-xs text-muted-foreground\">\n                                <span className=\"flex items-center gap-1\">\n                                  <Clock className=\"h-3 w-3\" />\n                                  {doc.time}\n                                </span>\n                                <span className=\"flex items-center gap-1\">\n                                  <Users className=\"h-3 w-3\" />\n                                  {doc.collaborators}{\" \"}\n                                  {doc.collaborators === 1\n                                    ? fr.common.collaboratorSingle\n                                    : fr.common.collaboratorPlural}\n                                </span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </Link>\n                      {index < recentDocuments.length - 1 && <Separator className=\"mt-4\" />}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        {/* Activity Feed */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.4 }}\n        >\n          <Card>\n            <CardHeader>\n              <CardTitle>{fr.dashboard.activityFeed}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isDataLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : activityFeed.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.dashboard.noRecentActivity}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {activityFeed.map((activity: any) => {\n                    const initials = getInitials(activity.user);\n                    return (\n                      <div key={activity.id} className=\"flex gap-3\">\n                        <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-xs font-semibold text-primary\">\n                          {initials || \"?\"}\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm\">\n                            <span className=\"font-medium\">{activity.user}</span>{\" \"}\n                            <span className=\"text-muted-foreground\">{activity.action}</span>{\" \"}\n                            <span className=\"font-medium\">{activity.target}</span>\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">{activity.time}</p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/dashboard/Dashboard.tsx"},"span":[10585,10588],"sourceCode":"\"use client\";\n\n/**\n * Dashboard Page - Main home page\n * Features: Welcome message, quick actions, recent documents, activity feed\n */\n\nimport { RecentFiles } from \"@/components/recent-files\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Separator } from \"@/components/tailwind/ui/separator\";\nimport { useDeals, useDocuments } from \"@/hooks/use-convex\";\nimport { formatRelativeTime } from \"@/lib/format-relative-time\";\nimport { fr, t } from \"@/lib/i18n\";\nimport { useUser } from \"@clerk/nextjs\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  CheckCircle2,\n  Clock,\n  FileText,\n  Globe,\n  LayoutDashboard,\n  Users,\n} from \"lucide-react\";\nimport { motion } from \"motion/react\";\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nconst quickActions = [\n  {\n    icon: Briefcase,\n    label: fr.actions.newDeal,\n    description: \"Créer un nouveau deal dans le pipeline\",\n    href: \"/pipeline\",\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n  },\n  {\n    icon: FileText,\n    label: fr.actions.newDocument,\n    description: \"Créer un nouveau document de collaboration\",\n    href: \"/documents\",\n    color: \"text-green-500\",\n    bgColor: \"bg-green-500/10\",\n  },\n  {\n    icon: Building,\n    label: fr.actions.newCompanyProfile,\n    description: \"Ajouter un profil d'entreprise\",\n    href: \"/companies\",\n    color: \"text-purple-500\",\n    bgColor: \"bg-purple-500/10\",\n  },\n];\n\nconst getTimestamp = (timestamp?: number, fallback?: number) => timestamp ?? fallback ?? 0;\n\nconst isDealNew = (deal: { updatedAt?: number; createdAt?: number }) =>\n  !deal.updatedAt || deal.updatedAt === deal.createdAt;\n\nconst getInitials = (name?: string) => {\n  if (!name) return \"?\";\n  return (\n    name\n      .split(\" \")\n      .filter(Boolean)\n      .map((part) => part[0])\n      .join(\"\")\n      .slice(0, 2) || \"?\"\n  );\n};\n\nexport default function Dashboard() {\n  const [hasAuth, setHasAuth] = useState(false);\n\n  // Safe check for Clerk environment\n  useEffect(() => {\n    if (process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY) {\n      setHasAuth(true);\n    }\n  }, []);\n\n  return hasAuth ? <DashboardContent /> : <DashboardContentMock />;\n}\n\nfunction DashboardContent() {\n  const { user, isLoaded } = useUser();\n  const { documents, isLoading: documentsLoading, isConvexAvailable: isDocumentsAvailable } = useDocuments(user?.id);\n  const { deals, isLoading: dealsLoading, isConvexAvailable: isDealsAvailable } = useDeals(user?.id);\n\n  // Reuse logic...\n  // To avoid duplicating huge code blocks, I should have extracted the main logic.\n  // But given constraints, I will keep it inline in this component\n  // and have a mock component that doesn't use hooks.\n  // Actually, I can just use a conditional hook call? No, that's illegal in React.\n  // So splitting is correct.\n\n  // Wait, duplicating the whole logic is bad.\n  // I will refactor DashboardContent to accept user/data as props or use hooks if auth is present.\n  // But useUser throws if not in provider.\n  // So DashboardContent MUST be a separate component that is only rendered if auth is present.\n\n  // However, I need to copy the logic.\n  // Since I can't easily extract all the logic without rewriting a lot,\n  // I will just use the existing logic for DashboardContent\n  // and create a simplified mock for the \"no-auth\" case (dev environment).\n\n  const isDocumentsLoading = documentsLoading && isDocumentsAvailable;\n  const isDealsLoading = dealsLoading && isDealsAvailable;\n  const isDataLoading = !isLoaded || isDocumentsLoading || isDealsLoading;\n  const activeDocuments = useMemo(() => documents.filter((document) => !document.isArchived), [documents]);\n  const activeDeals = useMemo(() => deals.filter((deal) => !deal.isArchived), [deals]);\n  const inProgressDeals = useMemo(\n    () => activeDeals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const closedDeals = useMemo(\n    () => activeDeals.filter((deal) => [\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const displayName = user?.fullName || user?.firstName || user?.username || \"Utilisateur\";\n\n  const memberIds = useMemo(() => {\n    const ids = new Set<string>();\n    if (user?.id) {\n      ids.add(user.id);\n    }\n    activeDocuments.forEach((document) => {\n      if (document.userId) {\n        ids.add(document.userId);\n      }\n    });\n    activeDeals.forEach((deal) => {\n      if (deal.userId) {\n        ids.add(deal.userId);\n      }\n    });\n    return ids;\n  }, [activeDocuments, activeDeals, user?.id]);\n\n  const getDocumentTimestamp = (document: (typeof documents)[number]) =>\n    getTimestamp(document.updatedAt, document.createdAt ?? document._creationTime);\n  const getDealTimestamp = (deal: (typeof deals)[number]) =>\n    getTimestamp(deal.updatedAt, deal.createdAt ?? deal._creationTime);\n\n  const recentDocuments = useMemo(\n    () =>\n      activeDocuments\n        .map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: document._id,\n            title: document.title || t(\"editor.untitled\"),\n            description: document.dealId ? fr.dashboard.documentLinkedToDeal : fr.dashboard.documentCollaboration,\n            time: formatRelativeTime(timestamp),\n            collaborators: document.userId ? 1 : 0,\n            href: `/documents/${document._id}`,\n            timestamp,\n          };\n        })\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 3),\n    [activeDocuments],\n  );\n\n  const activityFeed = useMemo(\n    () =>\n      [\n        ...activeDocuments.map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: `document-${document._id}`,\n            user: document.userId === user?.id ? displayName : fr.common.collaborator,\n            action: fr.activity.updatedDocument,\n            target: document.title || t(\"editor.untitled\"),\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n        ...activeDeals.map((deal) => {\n          const timestamp = getDealTimestamp(deal);\n          const isNewDeal = isDealNew(deal);\n          return {\n            id: `deal-${deal._id}`,\n            user: deal.lead || (deal.userId === user?.id ? displayName : fr.common.team),\n            action: isNewDeal ? fr.activity.createdDeal : fr.activity.updatedDeal,\n            target: deal.company,\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n      ]\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 5),\n    [activeDeals, activeDocuments, displayName, user?.id],\n  );\n\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: isDataLoading ? \"—\" : inProgressDeals.length.toString(),\n      icon: Briefcase,\n      trend: isDataLoading ? fr.loader.loading : `${activeDeals.length} ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: isDataLoading ? \"—\" : activeDocuments.length.toString(),\n      icon: FileText,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : recentDocuments[0]\n          ? `${fr.dashboard.lastUpdate} ${recentDocuments[0].time}`\n          : fr.dashboard.noDocuments,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: isDataLoading ? \"—\" : memberIds.size.toString(),\n      icon: Users,\n      trend: isDataLoading ? fr.loader.loading : memberIds.size > 0 ? fr.dashboard.activeTeam : fr.dashboard.noMembers,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: isDataLoading ? \"—\" : closedDeals.length.toString(),\n      icon: CheckCircle2,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : closedDeals.length > 0\n          ? `${closedDeals.length} ${fr.dashboard.dealsClosed}`\n          : fr.dashboard.noClosedDeals,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={isLoaded}\n      user={user}\n      stats={stats}\n      recentDocuments={recentDocuments}\n      activityFeed={activityFeed}\n      isDocumentsLoading={isDocumentsLoading}\n      isDataLoading={isDataLoading}\n    />\n  );\n}\n\n// Mock content for dev/no-auth environment\nfunction DashboardContentMock() {\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: \"12\",\n      icon: Briefcase,\n      trend: `15 ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: \"8\",\n      icon: FileText,\n      trend: `${fr.dashboard.lastUpdate} 2h ago`,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: \"4\",\n      icon: Users,\n      trend: fr.dashboard.activeTeam,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: \"5\",\n      icon: CheckCircle2,\n      trend: `5 ${fr.dashboard.dealsClosed}`,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={true}\n      user={{ firstName: \"Demo\", username: \"User\" } as any}\n      stats={stats}\n      recentDocuments={[]}\n      activityFeed={[]}\n      isDocumentsLoading={false}\n      isDataLoading={false}\n    />\n  );\n}\n\n// UI Component to share layout\nfunction DashboardUI({ isLoaded, user, stats, recentDocuments, activityFeed, isDocumentsLoading, isDataLoading }: any) {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome Section */}\n      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }}>\n        <h1 className=\"text-4xl font-bold\">\n          {fr.dashboard.welcomeBack}\n          {isLoaded && user && <span className=\"text-primary\">, {user.firstName || user.username}</span>}\n        </h1>\n        <p className=\"mt-2 text-muted-foreground\">Gérez vos deals, documents et collaborations en un seul endroit</p>\n      </motion.div>\n\n      {/* Stats Grid */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.1 }}\n        className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\"\n      >\n        {stats.map((stat: any) => {\n          const Icon = stat.icon;\n          return (\n            <Card key={stat.id}>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{stat.label}</CardTitle>\n                <Icon className={`h-4 w-4 ${stat.color}`} />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stat.value}</div>\n                <p className=\"text-xs text-muted-foreground\">{stat.trend}</p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </motion.div>\n\n      {/* Quick Actions */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.2 }}\n      >\n        <h2 className=\"text-2xl font-bold mb-4\">{fr.dashboard.quickActions}</h2>\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          {quickActions.map((action) => {\n            const Icon = action.icon;\n            return (\n              <Link key={action.href} href={action.href}>\n                <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                  <CardHeader>\n                    <div className={`w-12 h-12 rounded-lg ${action.bgColor} flex items-center justify-center mb-4`}>\n                      <Icon className={`h-6 w-6 ${action.color}`} />\n                    </div>\n                    <CardTitle>{action.label}</CardTitle>\n                    <CardDescription>{action.description}</CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n            );\n          })}\n        </div>\n      </motion.div>\n\n      {/* Recent Files & Quick Navigation */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.15 }}\n        className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\"\n      >\n        {/* Recent Files Card */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Recent Documents</CardTitle>\n            <CardDescription>Pick up where you left off</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {/* RecentFiles component also likely uses hooks, so we should mock it or be careful */}\n            {/* Assuming RecentFiles is safe or we wrap it. For now let's hope it handles missing auth or we mock it too */}\n            {/* Just to be safe, if we are in mock mode, we show placeholder */}\n            {process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY ? (\n              <RecentFiles limit={5} showCreateButton={true} />\n            ) : (\n              <div className=\"text-sm text-muted-foreground\">Recent files unavailable in demo mode.</div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Quick Navigation Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Quick Navigation</CardTitle>\n            <CardDescription>Jump to frequently used areas</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/dashboard\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <LayoutDashboard className=\"h-4 w-4 mr-2\" />\n                Admin Dashboard\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/contacts\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Users className=\"h-4 w-4 mr-2\" />\n                CRM Contacts\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/companies\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Building className=\"h-4 w-4 mr-2\" />\n                Companies\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"https://alecia.markets\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Globe className=\"h-4 w-4 mr-2\" />\n                Website\n              </a>\n            </Button>\n          </CardContent>\n        </Card>\n      </motion.div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        {/* Recent Documents */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.3 }}\n          className=\"lg:col-span-2\"\n        >\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>{fr.dashboard.recentDocuments}</CardTitle>\n                <Button variant=\"ghost\" size=\"sm\" asChild>\n                  <Link href=\"/documents\">\n                    Voir tout <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </Link>\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isDocumentsLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : recentDocuments.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.nav.noRecentDocuments}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {recentDocuments.map((doc: any, index: number) => (\n                    <div key={doc.id}>\n                      <Link href={doc.href} className=\"block\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex items-start gap-3\">\n                            <div className=\"rounded-lg bg-primary/10 p-2\">\n                              <FileText className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <h4 className=\"font-medium\">{doc.title}</h4>\n                              <p className=\"text-sm text-muted-foreground\">{doc.description}</p>\n                              <div className=\"flex items-center gap-3 mt-2 text-xs text-muted-foreground\">\n                                <span className=\"flex items-center gap-1\">\n                                  <Clock className=\"h-3 w-3\" />\n                                  {doc.time}\n                                </span>\n                                <span className=\"flex items-center gap-1\">\n                                  <Users className=\"h-3 w-3\" />\n                                  {doc.collaborators}{\" \"}\n                                  {doc.collaborators === 1\n                                    ? fr.common.collaboratorSingle\n                                    : fr.common.collaboratorPlural}\n                                </span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </Link>\n                      {index < recentDocuments.length - 1 && <Separator className=\"mt-4\" />}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        {/* Activity Feed */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.4 }}\n        >\n          <Card>\n            <CardHeader>\n              <CardTitle>{fr.dashboard.activityFeed}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isDataLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : activityFeed.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.dashboard.noRecentActivity}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {activityFeed.map((activity: any) => {\n                    const initials = getInitials(activity.user);\n                    return (\n                      <div key={activity.id} className=\"flex gap-3\">\n                        <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-xs font-semibold text-primary\">\n                          {initials || \"?\"}\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm\">\n                            <span className=\"font-medium\">{activity.user}</span>{\" \"}\n                            <span className=\"text-muted-foreground\">{activity.action}</span>{\" \"}\n                            <span className=\"font-medium\">{activity.target}</span>\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">{activity.time}</p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/dashboard/Dashboard.tsx"},"span":[16119,16122],"sourceCode":"\"use client\";\n\n/**\n * Dashboard Page - Main home page\n * Features: Welcome message, quick actions, recent documents, activity feed\n */\n\nimport { RecentFiles } from \"@/components/recent-files\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Separator } from \"@/components/tailwind/ui/separator\";\nimport { useDeals, useDocuments } from \"@/hooks/use-convex\";\nimport { formatRelativeTime } from \"@/lib/format-relative-time\";\nimport { fr, t } from \"@/lib/i18n\";\nimport { useUser } from \"@clerk/nextjs\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  CheckCircle2,\n  Clock,\n  FileText,\n  Globe,\n  LayoutDashboard,\n  Users,\n} from \"lucide-react\";\nimport { motion } from \"motion/react\";\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nconst quickActions = [\n  {\n    icon: Briefcase,\n    label: fr.actions.newDeal,\n    description: \"Créer un nouveau deal dans le pipeline\",\n    href: \"/pipeline\",\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n  },\n  {\n    icon: FileText,\n    label: fr.actions.newDocument,\n    description: \"Créer un nouveau document de collaboration\",\n    href: \"/documents\",\n    color: \"text-green-500\",\n    bgColor: \"bg-green-500/10\",\n  },\n  {\n    icon: Building,\n    label: fr.actions.newCompanyProfile,\n    description: \"Ajouter un profil d'entreprise\",\n    href: \"/companies\",\n    color: \"text-purple-500\",\n    bgColor: \"bg-purple-500/10\",\n  },\n];\n\nconst getTimestamp = (timestamp?: number, fallback?: number) => timestamp ?? fallback ?? 0;\n\nconst isDealNew = (deal: { updatedAt?: number; createdAt?: number }) =>\n  !deal.updatedAt || deal.updatedAt === deal.createdAt;\n\nconst getInitials = (name?: string) => {\n  if (!name) return \"?\";\n  return (\n    name\n      .split(\" \")\n      .filter(Boolean)\n      .map((part) => part[0])\n      .join(\"\")\n      .slice(0, 2) || \"?\"\n  );\n};\n\nexport default function Dashboard() {\n  const [hasAuth, setHasAuth] = useState(false);\n\n  // Safe check for Clerk environment\n  useEffect(() => {\n    if (process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY) {\n      setHasAuth(true);\n    }\n  }, []);\n\n  return hasAuth ? <DashboardContent /> : <DashboardContentMock />;\n}\n\nfunction DashboardContent() {\n  const { user, isLoaded } = useUser();\n  const { documents, isLoading: documentsLoading, isConvexAvailable: isDocumentsAvailable } = useDocuments(user?.id);\n  const { deals, isLoading: dealsLoading, isConvexAvailable: isDealsAvailable } = useDeals(user?.id);\n\n  // Reuse logic...\n  // To avoid duplicating huge code blocks, I should have extracted the main logic.\n  // But given constraints, I will keep it inline in this component\n  // and have a mock component that doesn't use hooks.\n  // Actually, I can just use a conditional hook call? No, that's illegal in React.\n  // So splitting is correct.\n\n  // Wait, duplicating the whole logic is bad.\n  // I will refactor DashboardContent to accept user/data as props or use hooks if auth is present.\n  // But useUser throws if not in provider.\n  // So DashboardContent MUST be a separate component that is only rendered if auth is present.\n\n  // However, I need to copy the logic.\n  // Since I can't easily extract all the logic without rewriting a lot,\n  // I will just use the existing logic for DashboardContent\n  // and create a simplified mock for the \"no-auth\" case (dev environment).\n\n  const isDocumentsLoading = documentsLoading && isDocumentsAvailable;\n  const isDealsLoading = dealsLoading && isDealsAvailable;\n  const isDataLoading = !isLoaded || isDocumentsLoading || isDealsLoading;\n  const activeDocuments = useMemo(() => documents.filter((document) => !document.isArchived), [documents]);\n  const activeDeals = useMemo(() => deals.filter((deal) => !deal.isArchived), [deals]);\n  const inProgressDeals = useMemo(\n    () => activeDeals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const closedDeals = useMemo(\n    () => activeDeals.filter((deal) => [\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const displayName = user?.fullName || user?.firstName || user?.username || \"Utilisateur\";\n\n  const memberIds = useMemo(() => {\n    const ids = new Set<string>();\n    if (user?.id) {\n      ids.add(user.id);\n    }\n    activeDocuments.forEach((document) => {\n      if (document.userId) {\n        ids.add(document.userId);\n      }\n    });\n    activeDeals.forEach((deal) => {\n      if (deal.userId) {\n        ids.add(deal.userId);\n      }\n    });\n    return ids;\n  }, [activeDocuments, activeDeals, user?.id]);\n\n  const getDocumentTimestamp = (document: (typeof documents)[number]) =>\n    getTimestamp(document.updatedAt, document.createdAt ?? document._creationTime);\n  const getDealTimestamp = (deal: (typeof deals)[number]) =>\n    getTimestamp(deal.updatedAt, deal.createdAt ?? deal._creationTime);\n\n  const recentDocuments = useMemo(\n    () =>\n      activeDocuments\n        .map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: document._id,\n            title: document.title || t(\"editor.untitled\"),\n            description: document.dealId ? fr.dashboard.documentLinkedToDeal : fr.dashboard.documentCollaboration,\n            time: formatRelativeTime(timestamp),\n            collaborators: document.userId ? 1 : 0,\n            href: `/documents/${document._id}`,\n            timestamp,\n          };\n        })\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 3),\n    [activeDocuments],\n  );\n\n  const activityFeed = useMemo(\n    () =>\n      [\n        ...activeDocuments.map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: `document-${document._id}`,\n            user: document.userId === user?.id ? displayName : fr.common.collaborator,\n            action: fr.activity.updatedDocument,\n            target: document.title || t(\"editor.untitled\"),\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n        ...activeDeals.map((deal) => {\n          const timestamp = getDealTimestamp(deal);\n          const isNewDeal = isDealNew(deal);\n          return {\n            id: `deal-${deal._id}`,\n            user: deal.lead || (deal.userId === user?.id ? displayName : fr.common.team),\n            action: isNewDeal ? fr.activity.createdDeal : fr.activity.updatedDeal,\n            target: deal.company,\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n      ]\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 5),\n    [activeDeals, activeDocuments, displayName, user?.id],\n  );\n\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: isDataLoading ? \"—\" : inProgressDeals.length.toString(),\n      icon: Briefcase,\n      trend: isDataLoading ? fr.loader.loading : `${activeDeals.length} ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: isDataLoading ? \"—\" : activeDocuments.length.toString(),\n      icon: FileText,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : recentDocuments[0]\n          ? `${fr.dashboard.lastUpdate} ${recentDocuments[0].time}`\n          : fr.dashboard.noDocuments,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: isDataLoading ? \"—\" : memberIds.size.toString(),\n      icon: Users,\n      trend: isDataLoading ? fr.loader.loading : memberIds.size > 0 ? fr.dashboard.activeTeam : fr.dashboard.noMembers,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: isDataLoading ? \"—\" : closedDeals.length.toString(),\n      icon: CheckCircle2,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : closedDeals.length > 0\n          ? `${closedDeals.length} ${fr.dashboard.dealsClosed}`\n          : fr.dashboard.noClosedDeals,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={isLoaded}\n      user={user}\n      stats={stats}\n      recentDocuments={recentDocuments}\n      activityFeed={activityFeed}\n      isDocumentsLoading={isDocumentsLoading}\n      isDataLoading={isDataLoading}\n    />\n  );\n}\n\n// Mock content for dev/no-auth environment\nfunction DashboardContentMock() {\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: \"12\",\n      icon: Briefcase,\n      trend: `15 ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: \"8\",\n      icon: FileText,\n      trend: `${fr.dashboard.lastUpdate} 2h ago`,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: \"4\",\n      icon: Users,\n      trend: fr.dashboard.activeTeam,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: \"5\",\n      icon: CheckCircle2,\n      trend: `5 ${fr.dashboard.dealsClosed}`,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={true}\n      user={{ firstName: \"Demo\", username: \"User\" } as any}\n      stats={stats}\n      recentDocuments={[]}\n      activityFeed={[]}\n      isDocumentsLoading={false}\n      isDataLoading={false}\n    />\n  );\n}\n\n// UI Component to share layout\nfunction DashboardUI({ isLoaded, user, stats, recentDocuments, activityFeed, isDocumentsLoading, isDataLoading }: any) {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome Section */}\n      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }}>\n        <h1 className=\"text-4xl font-bold\">\n          {fr.dashboard.welcomeBack}\n          {isLoaded && user && <span className=\"text-primary\">, {user.firstName || user.username}</span>}\n        </h1>\n        <p className=\"mt-2 text-muted-foreground\">Gérez vos deals, documents et collaborations en un seul endroit</p>\n      </motion.div>\n\n      {/* Stats Grid */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.1 }}\n        className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\"\n      >\n        {stats.map((stat: any) => {\n          const Icon = stat.icon;\n          return (\n            <Card key={stat.id}>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{stat.label}</CardTitle>\n                <Icon className={`h-4 w-4 ${stat.color}`} />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stat.value}</div>\n                <p className=\"text-xs text-muted-foreground\">{stat.trend}</p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </motion.div>\n\n      {/* Quick Actions */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.2 }}\n      >\n        <h2 className=\"text-2xl font-bold mb-4\">{fr.dashboard.quickActions}</h2>\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          {quickActions.map((action) => {\n            const Icon = action.icon;\n            return (\n              <Link key={action.href} href={action.href}>\n                <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                  <CardHeader>\n                    <div className={`w-12 h-12 rounded-lg ${action.bgColor} flex items-center justify-center mb-4`}>\n                      <Icon className={`h-6 w-6 ${action.color}`} />\n                    </div>\n                    <CardTitle>{action.label}</CardTitle>\n                    <CardDescription>{action.description}</CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n            );\n          })}\n        </div>\n      </motion.div>\n\n      {/* Recent Files & Quick Navigation */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.15 }}\n        className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\"\n      >\n        {/* Recent Files Card */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Recent Documents</CardTitle>\n            <CardDescription>Pick up where you left off</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {/* RecentFiles component also likely uses hooks, so we should mock it or be careful */}\n            {/* Assuming RecentFiles is safe or we wrap it. For now let's hope it handles missing auth or we mock it too */}\n            {/* Just to be safe, if we are in mock mode, we show placeholder */}\n            {process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY ? (\n              <RecentFiles limit={5} showCreateButton={true} />\n            ) : (\n              <div className=\"text-sm text-muted-foreground\">Recent files unavailable in demo mode.</div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Quick Navigation Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Quick Navigation</CardTitle>\n            <CardDescription>Jump to frequently used areas</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/dashboard\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <LayoutDashboard className=\"h-4 w-4 mr-2\" />\n                Admin Dashboard\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/contacts\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Users className=\"h-4 w-4 mr-2\" />\n                CRM Contacts\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/companies\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Building className=\"h-4 w-4 mr-2\" />\n                Companies\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"https://alecia.markets\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Globe className=\"h-4 w-4 mr-2\" />\n                Website\n              </a>\n            </Button>\n          </CardContent>\n        </Card>\n      </motion.div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        {/* Recent Documents */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.3 }}\n          className=\"lg:col-span-2\"\n        >\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>{fr.dashboard.recentDocuments}</CardTitle>\n                <Button variant=\"ghost\" size=\"sm\" asChild>\n                  <Link href=\"/documents\">\n                    Voir tout <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </Link>\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isDocumentsLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : recentDocuments.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.nav.noRecentDocuments}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {recentDocuments.map((doc: any, index: number) => (\n                    <div key={doc.id}>\n                      <Link href={doc.href} className=\"block\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex items-start gap-3\">\n                            <div className=\"rounded-lg bg-primary/10 p-2\">\n                              <FileText className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <h4 className=\"font-medium\">{doc.title}</h4>\n                              <p className=\"text-sm text-muted-foreground\">{doc.description}</p>\n                              <div className=\"flex items-center gap-3 mt-2 text-xs text-muted-foreground\">\n                                <span className=\"flex items-center gap-1\">\n                                  <Clock className=\"h-3 w-3\" />\n                                  {doc.time}\n                                </span>\n                                <span className=\"flex items-center gap-1\">\n                                  <Users className=\"h-3 w-3\" />\n                                  {doc.collaborators}{\" \"}\n                                  {doc.collaborators === 1\n                                    ? fr.common.collaboratorSingle\n                                    : fr.common.collaboratorPlural}\n                                </span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </Link>\n                      {index < recentDocuments.length - 1 && <Separator className=\"mt-4\" />}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        {/* Activity Feed */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.4 }}\n        >\n          <Card>\n            <CardHeader>\n              <CardTitle>{fr.dashboard.activityFeed}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isDataLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : activityFeed.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.dashboard.noRecentActivity}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {activityFeed.map((activity: any) => {\n                    const initials = getInitials(activity.user);\n                    return (\n                      <div key={activity.id} className=\"flex gap-3\">\n                        <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-xs font-semibold text-primary\">\n                          {initials || \"?\"}\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm\">\n                            <span className=\"font-medium\">{activity.user}</span>{\" \"}\n                            <span className=\"text-muted-foreground\">{activity.action}</span>{\" \"}\n                            <span className=\"font-medium\">{activity.target}</span>\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">{activity.time}</p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/dashboard/Dashboard.tsx"},"span":[18688,18691],"sourceCode":"\"use client\";\n\n/**\n * Dashboard Page - Main home page\n * Features: Welcome message, quick actions, recent documents, activity feed\n */\n\nimport { RecentFiles } from \"@/components/recent-files\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Separator } from \"@/components/tailwind/ui/separator\";\nimport { useDeals, useDocuments } from \"@/hooks/use-convex\";\nimport { formatRelativeTime } from \"@/lib/format-relative-time\";\nimport { fr, t } from \"@/lib/i18n\";\nimport { useUser } from \"@clerk/nextjs\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  CheckCircle2,\n  Clock,\n  FileText,\n  Globe,\n  LayoutDashboard,\n  Users,\n} from \"lucide-react\";\nimport { motion } from \"motion/react\";\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nconst quickActions = [\n  {\n    icon: Briefcase,\n    label: fr.actions.newDeal,\n    description: \"Créer un nouveau deal dans le pipeline\",\n    href: \"/pipeline\",\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n  },\n  {\n    icon: FileText,\n    label: fr.actions.newDocument,\n    description: \"Créer un nouveau document de collaboration\",\n    href: \"/documents\",\n    color: \"text-green-500\",\n    bgColor: \"bg-green-500/10\",\n  },\n  {\n    icon: Building,\n    label: fr.actions.newCompanyProfile,\n    description: \"Ajouter un profil d'entreprise\",\n    href: \"/companies\",\n    color: \"text-purple-500\",\n    bgColor: \"bg-purple-500/10\",\n  },\n];\n\nconst getTimestamp = (timestamp?: number, fallback?: number) => timestamp ?? fallback ?? 0;\n\nconst isDealNew = (deal: { updatedAt?: number; createdAt?: number }) =>\n  !deal.updatedAt || deal.updatedAt === deal.createdAt;\n\nconst getInitials = (name?: string) => {\n  if (!name) return \"?\";\n  return (\n    name\n      .split(\" \")\n      .filter(Boolean)\n      .map((part) => part[0])\n      .join(\"\")\n      .slice(0, 2) || \"?\"\n  );\n};\n\nexport default function Dashboard() {\n  const [hasAuth, setHasAuth] = useState(false);\n\n  // Safe check for Clerk environment\n  useEffect(() => {\n    if (process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY) {\n      setHasAuth(true);\n    }\n  }, []);\n\n  return hasAuth ? <DashboardContent /> : <DashboardContentMock />;\n}\n\nfunction DashboardContent() {\n  const { user, isLoaded } = useUser();\n  const { documents, isLoading: documentsLoading, isConvexAvailable: isDocumentsAvailable } = useDocuments(user?.id);\n  const { deals, isLoading: dealsLoading, isConvexAvailable: isDealsAvailable } = useDeals(user?.id);\n\n  // Reuse logic...\n  // To avoid duplicating huge code blocks, I should have extracted the main logic.\n  // But given constraints, I will keep it inline in this component\n  // and have a mock component that doesn't use hooks.\n  // Actually, I can just use a conditional hook call? No, that's illegal in React.\n  // So splitting is correct.\n\n  // Wait, duplicating the whole logic is bad.\n  // I will refactor DashboardContent to accept user/data as props or use hooks if auth is present.\n  // But useUser throws if not in provider.\n  // So DashboardContent MUST be a separate component that is only rendered if auth is present.\n\n  // However, I need to copy the logic.\n  // Since I can't easily extract all the logic without rewriting a lot,\n  // I will just use the existing logic for DashboardContent\n  // and create a simplified mock for the \"no-auth\" case (dev environment).\n\n  const isDocumentsLoading = documentsLoading && isDocumentsAvailable;\n  const isDealsLoading = dealsLoading && isDealsAvailable;\n  const isDataLoading = !isLoaded || isDocumentsLoading || isDealsLoading;\n  const activeDocuments = useMemo(() => documents.filter((document) => !document.isArchived), [documents]);\n  const activeDeals = useMemo(() => deals.filter((deal) => !deal.isArchived), [deals]);\n  const inProgressDeals = useMemo(\n    () => activeDeals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const closedDeals = useMemo(\n    () => activeDeals.filter((deal) => [\"closed-won\", \"closed-lost\"].includes(deal.stage)),\n    [activeDeals],\n  );\n  const displayName = user?.fullName || user?.firstName || user?.username || \"Utilisateur\";\n\n  const memberIds = useMemo(() => {\n    const ids = new Set<string>();\n    if (user?.id) {\n      ids.add(user.id);\n    }\n    activeDocuments.forEach((document) => {\n      if (document.userId) {\n        ids.add(document.userId);\n      }\n    });\n    activeDeals.forEach((deal) => {\n      if (deal.userId) {\n        ids.add(deal.userId);\n      }\n    });\n    return ids;\n  }, [activeDocuments, activeDeals, user?.id]);\n\n  const getDocumentTimestamp = (document: (typeof documents)[number]) =>\n    getTimestamp(document.updatedAt, document.createdAt ?? document._creationTime);\n  const getDealTimestamp = (deal: (typeof deals)[number]) =>\n    getTimestamp(deal.updatedAt, deal.createdAt ?? deal._creationTime);\n\n  const recentDocuments = useMemo(\n    () =>\n      activeDocuments\n        .map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: document._id,\n            title: document.title || t(\"editor.untitled\"),\n            description: document.dealId ? fr.dashboard.documentLinkedToDeal : fr.dashboard.documentCollaboration,\n            time: formatRelativeTime(timestamp),\n            collaborators: document.userId ? 1 : 0,\n            href: `/documents/${document._id}`,\n            timestamp,\n          };\n        })\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 3),\n    [activeDocuments],\n  );\n\n  const activityFeed = useMemo(\n    () =>\n      [\n        ...activeDocuments.map((document) => {\n          const timestamp = getDocumentTimestamp(document);\n          return {\n            id: `document-${document._id}`,\n            user: document.userId === user?.id ? displayName : fr.common.collaborator,\n            action: fr.activity.updatedDocument,\n            target: document.title || t(\"editor.untitled\"),\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n        ...activeDeals.map((deal) => {\n          const timestamp = getDealTimestamp(deal);\n          const isNewDeal = isDealNew(deal);\n          return {\n            id: `deal-${deal._id}`,\n            user: deal.lead || (deal.userId === user?.id ? displayName : fr.common.team),\n            action: isNewDeal ? fr.activity.createdDeal : fr.activity.updatedDeal,\n            target: deal.company,\n            time: formatRelativeTime(timestamp),\n            timestamp,\n          };\n        }),\n      ]\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .slice(0, 5),\n    [activeDeals, activeDocuments, displayName, user?.id],\n  );\n\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: isDataLoading ? \"—\" : inProgressDeals.length.toString(),\n      icon: Briefcase,\n      trend: isDataLoading ? fr.loader.loading : `${activeDeals.length} ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: isDataLoading ? \"—\" : activeDocuments.length.toString(),\n      icon: FileText,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : recentDocuments[0]\n          ? `${fr.dashboard.lastUpdate} ${recentDocuments[0].time}`\n          : fr.dashboard.noDocuments,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: isDataLoading ? \"—\" : memberIds.size.toString(),\n      icon: Users,\n      trend: isDataLoading ? fr.loader.loading : memberIds.size > 0 ? fr.dashboard.activeTeam : fr.dashboard.noMembers,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: isDataLoading ? \"—\" : closedDeals.length.toString(),\n      icon: CheckCircle2,\n      trend: isDataLoading\n        ? fr.loader.loading\n        : closedDeals.length > 0\n          ? `${closedDeals.length} ${fr.dashboard.dealsClosed}`\n          : fr.dashboard.noClosedDeals,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={isLoaded}\n      user={user}\n      stats={stats}\n      recentDocuments={recentDocuments}\n      activityFeed={activityFeed}\n      isDocumentsLoading={isDocumentsLoading}\n      isDataLoading={isDataLoading}\n    />\n  );\n}\n\n// Mock content for dev/no-auth environment\nfunction DashboardContentMock() {\n  const stats = [\n    {\n      id: \"deals\",\n      label: fr.dashboard.stats.dealsInProgress,\n      value: \"12\",\n      icon: Briefcase,\n      trend: `15 ${fr.common.total}`,\n      color: \"text-blue-500\",\n    },\n    {\n      id: \"documents\",\n      label: fr.dashboard.stats.documentsCreated,\n      value: \"8\",\n      icon: FileText,\n      trend: `${fr.dashboard.lastUpdate} 2h ago`,\n      color: \"text-green-500\",\n    },\n    {\n      id: \"members\",\n      label: fr.dashboard.stats.teamMembers,\n      value: \"4\",\n      icon: Users,\n      trend: fr.dashboard.activeTeam,\n      color: \"text-purple-500\",\n    },\n    {\n      id: \"tasks\",\n      label: fr.dashboard.stats.tasksCompleted,\n      value: \"5\",\n      icon: CheckCircle2,\n      trend: `5 ${fr.dashboard.dealsClosed}`,\n      color: \"text-orange-500\",\n    },\n  ];\n\n  return (\n    <DashboardUI\n      isLoaded={true}\n      user={{ firstName: \"Demo\", username: \"User\" } as any}\n      stats={stats}\n      recentDocuments={[]}\n      activityFeed={[]}\n      isDocumentsLoading={false}\n      isDataLoading={false}\n    />\n  );\n}\n\n// UI Component to share layout\nfunction DashboardUI({ isLoaded, user, stats, recentDocuments, activityFeed, isDocumentsLoading, isDataLoading }: any) {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome Section */}\n      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }}>\n        <h1 className=\"text-4xl font-bold\">\n          {fr.dashboard.welcomeBack}\n          {isLoaded && user && <span className=\"text-primary\">, {user.firstName || user.username}</span>}\n        </h1>\n        <p className=\"mt-2 text-muted-foreground\">Gérez vos deals, documents et collaborations en un seul endroit</p>\n      </motion.div>\n\n      {/* Stats Grid */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.1 }}\n        className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\"\n      >\n        {stats.map((stat: any) => {\n          const Icon = stat.icon;\n          return (\n            <Card key={stat.id}>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{stat.label}</CardTitle>\n                <Icon className={`h-4 w-4 ${stat.color}`} />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stat.value}</div>\n                <p className=\"text-xs text-muted-foreground\">{stat.trend}</p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </motion.div>\n\n      {/* Quick Actions */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.2 }}\n      >\n        <h2 className=\"text-2xl font-bold mb-4\">{fr.dashboard.quickActions}</h2>\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          {quickActions.map((action) => {\n            const Icon = action.icon;\n            return (\n              <Link key={action.href} href={action.href}>\n                <Card className=\"hover:shadow-lg transition-shadow cursor-pointer h-full\">\n                  <CardHeader>\n                    <div className={`w-12 h-12 rounded-lg ${action.bgColor} flex items-center justify-center mb-4`}>\n                      <Icon className={`h-6 w-6 ${action.color}`} />\n                    </div>\n                    <CardTitle>{action.label}</CardTitle>\n                    <CardDescription>{action.description}</CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n            );\n          })}\n        </div>\n      </motion.div>\n\n      {/* Recent Files & Quick Navigation */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.15 }}\n        className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\"\n      >\n        {/* Recent Files Card */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Recent Documents</CardTitle>\n            <CardDescription>Pick up where you left off</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {/* RecentFiles component also likely uses hooks, so we should mock it or be careful */}\n            {/* Assuming RecentFiles is safe or we wrap it. For now let's hope it handles missing auth or we mock it too */}\n            {/* Just to be safe, if we are in mock mode, we show placeholder */}\n            {process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY ? (\n              <RecentFiles limit={5} showCreateButton={true} />\n            ) : (\n              <div className=\"text-sm text-muted-foreground\">Recent files unavailable in demo mode.</div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Quick Navigation Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Quick Navigation</CardTitle>\n            <CardDescription>Jump to frequently used areas</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/dashboard\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <LayoutDashboard className=\"h-4 w-4 mr-2\" />\n                Admin Dashboard\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/contacts\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Users className=\"h-4 w-4 mr-2\" />\n                CRM Contacts\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"/admin/crm/companies\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Building className=\"h-4 w-4 mr-2\" />\n                Companies\n              </a>\n            </Button>\n            <Button variant=\"ghost\" className=\"w-full justify-start\" asChild>\n              <a href=\"https://alecia.markets\" target=\"_blank\" rel=\"noopener noreferrer\">\n                <Globe className=\"h-4 w-4 mr-2\" />\n                Website\n              </a>\n            </Button>\n          </CardContent>\n        </Card>\n      </motion.div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        {/* Recent Documents */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.3 }}\n          className=\"lg:col-span-2\"\n        >\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle>{fr.dashboard.recentDocuments}</CardTitle>\n                <Button variant=\"ghost\" size=\"sm\" asChild>\n                  <Link href=\"/documents\">\n                    Voir tout <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </Link>\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {isDocumentsLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : recentDocuments.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.nav.noRecentDocuments}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {recentDocuments.map((doc: any, index: number) => (\n                    <div key={doc.id}>\n                      <Link href={doc.href} className=\"block\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex items-start gap-3\">\n                            <div className=\"rounded-lg bg-primary/10 p-2\">\n                              <FileText className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <h4 className=\"font-medium\">{doc.title}</h4>\n                              <p className=\"text-sm text-muted-foreground\">{doc.description}</p>\n                              <div className=\"flex items-center gap-3 mt-2 text-xs text-muted-foreground\">\n                                <span className=\"flex items-center gap-1\">\n                                  <Clock className=\"h-3 w-3\" />\n                                  {doc.time}\n                                </span>\n                                <span className=\"flex items-center gap-1\">\n                                  <Users className=\"h-3 w-3\" />\n                                  {doc.collaborators}{\" \"}\n                                  {doc.collaborators === 1\n                                    ? fr.common.collaboratorSingle\n                                    : fr.common.collaboratorPlural}\n                                </span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </Link>\n                      {index < recentDocuments.length - 1 && <Separator className=\"mt-4\" />}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        {/* Activity Feed */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.4 }}\n        >\n          <Card>\n            <CardHeader>\n              <CardTitle>{fr.dashboard.activityFeed}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isDataLoading ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.loader.loading}</p>\n              ) : activityFeed.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">{fr.dashboard.noRecentActivity}</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {activityFeed.map((activity: any) => {\n                    const initials = getInitials(activity.user);\n                    return (\n                      <div key={activity.id} className=\"flex gap-3\">\n                        <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-xs font-semibold text-primary\">\n                          {initials || \"?\"}\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm\">\n                            <span className=\"font-medium\">{activity.user}</span>{\" \"}\n                            <span className=\"text-muted-foreground\">{activity.action}</span>{\" \"}\n                            <span className=\"font-medium\">{activity.target}</span>\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">{activity.time}</p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[4980,4985],"sourceCode":"\"use client\";\n\n/**\n * ClientHomePage - Page d'accueil utilisateur (Client Component)\n * Route: colab.alecia.markets/home\n */\n\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/tailwind/ui/tabs\";\nimport { SignInButton, SignedIn, SignedOut, UserButton } from \"@clerk/nextjs\";\nimport { Briefcase, Clock, FileText, FolderOpen, Plus, TrendingUp, Users } from \"lucide-react\";\nimport nextDynamic from \"next/dynamic\";\nimport { useState } from \"react\";\n\n// Dynamic imports for heavy components\nconst TailwindAdvancedEditor = nextDynamic(() => import(\"@/components/tailwind/advanced-editor\"), {\n  ssr: false,\n  loading: () => <div className=\"animate-pulse h-96 bg-muted rounded-lg\" />,\n});\n\nconst DealPipeline = nextDynamic(() => import(\"@/components/deal-pipeline\"), {\n  ssr: false,\n  loading: () => <div className=\"animate-pulse h-64 bg-muted rounded-lg\" />,\n});\n\n// Stats\nconst stats = [\n  { label: \"Deals actifs\", value: 12, icon: Briefcase, color: \"text-blue-500\" },\n  { label: \"Documents\", value: 48, icon: FileText, color: \"text-green-500\" },\n  { label: \"Équipe\", value: 6, icon: Users, color: \"text-purple-500\" },\n  { label: \"Ce mois\", value: \"+3\", icon: TrendingUp, color: \"text-orange-500\" },\n];\n\n// Activités récentes\nconst recentActivity = [\n  { title: \"Deal Acquisition XYZ\", time: \"Il y a 2h\", type: \"deal\" },\n  { title: \"Note de synthèse modifiée\", time: \"Il y a 4h\", type: \"doc\" },\n  { title: \"Nouveau membre ajouté\", time: \"Hier\", type: \"team\" },\n  { title: \"Due diligence terminée\", time: \"Il y a 2j\", type: \"deal\" },\n];\n\nexport default function ClientHomePage() {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-40\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-3\">\n              <Briefcase className=\"h-6 w-6 text-primary\" />\n              <span className=\"text-xl font-semibold\">Alecia Colab</span>\n            </div>\n\n            <div className=\"flex items-center gap-4\">\n              <SignedOut>\n                <SignInButton mode=\"modal\">\n                  <Button>Connexion</Button>\n                </SignInButton>\n              </SignedOut>\n              <SignedIn>\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                  <Plus className=\"h-4 w-4\" />\n                  Nouveau Deal\n                </Button>\n                <UserButton />\n              </SignedIn>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Welcome */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-2xl font-bold text-foreground\">Bienvenue sur Alecia Colab</h1>\n          <p className=\"text-muted-foreground mt-1\">Votre plateforme M&A de centralisation et collaboration</p>\n        </div>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8\">\n          {stats.map((stat) => (\n            <div key={stat.label} className=\"bg-card border rounded-xl p-4 hover:shadow-md transition-shadow\">\n              <div className=\"flex items-center gap-3\">\n                <div className={`p-2 rounded-lg bg-muted ${stat.color}`}>\n                  <stat.icon className=\"h-5 w-5\" />\n                </div>\n                <div>\n                  <p className=\"text-2xl font-bold\">{stat.value}</p>\n                  <p className=\"text-sm text-muted-foreground\">{stat.label}</p>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Tabs */}\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full max-w-lg grid-cols-3\">\n            <TabsTrigger value=\"overview\" className=\"gap-2\">\n              <FolderOpen className=\"h-4 w-4\" />\n              Vue d'ensemble\n            </TabsTrigger>\n            <TabsTrigger value=\"editor\" className=\"gap-2\">\n              <FileText className=\"h-4 w-4\" />\n              Éditeur\n            </TabsTrigger>\n            <TabsTrigger value=\"pipeline\" className=\"gap-2\">\n              <Briefcase className=\"h-4 w-4\" />\n              Pipeline\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-6\">\n            {/* Recent Activity */}\n            <div className=\"bg-card border rounded-xl p-6\">\n              <h2 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n                <Clock className=\"h-5 w-5 text-muted-foreground\" />\n                Activité récente\n              </h2>\n              <div className=\"space-y-3\">\n                {recentActivity.map((item, index) => (\n                  <div key={index} className=\"flex items-center justify-between py-2 border-b last:border-0\">\n                    <div className=\"flex items-center gap-3\">\n                      <div\n                        className={`w-2 h-2 rounded-full ${\n                          item.type === \"deal\" ? \"bg-blue-500\" : item.type === \"doc\" ? \"bg-green-500\" : \"bg-purple-500\"\n                        }`}\n                      />\n                      <span className=\"text-sm\">{item.title}</span>\n                    </div>\n                    <span className=\"text-xs text-muted-foreground\">{item.time}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Quick Actions */}\n            <div className=\"grid md:grid-cols-3 gap-4\">\n              <Button variant=\"outline\" className=\"h-24 flex-col gap-2\">\n                <Plus className=\"h-6 w-6\" />\n                <span>Créer un deal</span>\n              </Button>\n              <Button variant=\"outline\" className=\"h-24 flex-col gap-2\">\n                <FileText className=\"h-6 w-6\" />\n                <span>Nouvelle note</span>\n              </Button>\n              <Button variant=\"outline\" className=\"h-24 flex-col gap-2\">\n                <Users className=\"h-6 w-6\" />\n                <span>Inviter un membre</span>\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"editor\">\n            <div className=\"bg-card border rounded-xl p-6\">\n              <TailwindAdvancedEditor documentId=\"demo-document-v1\" />\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"pipeline\">\n            <div className=\"bg-card border rounded-xl p-6\">\n              <DealPipeline />\n            </div>\n          </TabsContent>\n        </Tabs>\n      </main>\n\n      {/* Footer */}\n      <footer className=\"border-t mt-16 py-6 text-center text-sm text-muted-foreground\">\n        <p>© 2026 Alecia. Tous droits réservés.</p>\n      </footer>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/home/ClientHomePage.tsx"},"span":[5020,5025],"sourceCode":"\"use client\";\n\n/**\n * ClientHomePage - Page d'accueil utilisateur (Client Component)\n * Route: colab.alecia.markets/home\n */\n\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/tailwind/ui/tabs\";\nimport { SignInButton, SignedIn, SignedOut, UserButton } from \"@clerk/nextjs\";\nimport { Briefcase, Clock, FileText, FolderOpen, Plus, TrendingUp, Users } from \"lucide-react\";\nimport nextDynamic from \"next/dynamic\";\nimport { useState } from \"react\";\n\n// Dynamic imports for heavy components\nconst TailwindAdvancedEditor = nextDynamic(() => import(\"@/components/tailwind/advanced-editor\"), {\n  ssr: false,\n  loading: () => <div className=\"animate-pulse h-96 bg-muted rounded-lg\" />,\n});\n\nconst DealPipeline = nextDynamic(() => import(\"@/components/deal-pipeline\"), {\n  ssr: false,\n  loading: () => <div className=\"animate-pulse h-64 bg-muted rounded-lg\" />,\n});\n\n// Stats\nconst stats = [\n  { label: \"Deals actifs\", value: 12, icon: Briefcase, color: \"text-blue-500\" },\n  { label: \"Documents\", value: 48, icon: FileText, color: \"text-green-500\" },\n  { label: \"Équipe\", value: 6, icon: Users, color: \"text-purple-500\" },\n  { label: \"Ce mois\", value: \"+3\", icon: TrendingUp, color: \"text-orange-500\" },\n];\n\n// Activités récentes\nconst recentActivity = [\n  { title: \"Deal Acquisition XYZ\", time: \"Il y a 2h\", type: \"deal\" },\n  { title: \"Note de synthèse modifiée\", time: \"Il y a 4h\", type: \"doc\" },\n  { title: \"Nouveau membre ajouté\", time: \"Hier\", type: \"team\" },\n  { title: \"Due diligence terminée\", time: \"Il y a 2j\", type: \"deal\" },\n];\n\nexport default function ClientHomePage() {\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-40\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-3\">\n              <Briefcase className=\"h-6 w-6 text-primary\" />\n              <span className=\"text-xl font-semibold\">Alecia Colab</span>\n            </div>\n\n            <div className=\"flex items-center gap-4\">\n              <SignedOut>\n                <SignInButton mode=\"modal\">\n                  <Button>Connexion</Button>\n                </SignInButton>\n              </SignedOut>\n              <SignedIn>\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                  <Plus className=\"h-4 w-4\" />\n                  Nouveau Deal\n                </Button>\n                <UserButton />\n              </SignedIn>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Welcome */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-2xl font-bold text-foreground\">Bienvenue sur Alecia Colab</h1>\n          <p className=\"text-muted-foreground mt-1\">Votre plateforme M&A de centralisation et collaboration</p>\n        </div>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8\">\n          {stats.map((stat) => (\n            <div key={stat.label} className=\"bg-card border rounded-xl p-4 hover:shadow-md transition-shadow\">\n              <div className=\"flex items-center gap-3\">\n                <div className={`p-2 rounded-lg bg-muted ${stat.color}`}>\n                  <stat.icon className=\"h-5 w-5\" />\n                </div>\n                <div>\n                  <p className=\"text-2xl font-bold\">{stat.value}</p>\n                  <p className=\"text-sm text-muted-foreground\">{stat.label}</p>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Tabs */}\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full max-w-lg grid-cols-3\">\n            <TabsTrigger value=\"overview\" className=\"gap-2\">\n              <FolderOpen className=\"h-4 w-4\" />\n              Vue d'ensemble\n            </TabsTrigger>\n            <TabsTrigger value=\"editor\" className=\"gap-2\">\n              <FileText className=\"h-4 w-4\" />\n              Éditeur\n            </TabsTrigger>\n            <TabsTrigger value=\"pipeline\" className=\"gap-2\">\n              <Briefcase className=\"h-4 w-4\" />\n              Pipeline\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-6\">\n            {/* Recent Activity */}\n            <div className=\"bg-card border rounded-xl p-6\">\n              <h2 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n                <Clock className=\"h-5 w-5 text-muted-foreground\" />\n                Activité récente\n              </h2>\n              <div className=\"space-y-3\">\n                {recentActivity.map((item, index) => (\n                  <div key={index} className=\"flex items-center justify-between py-2 border-b last:border-0\">\n                    <div className=\"flex items-center gap-3\">\n                      <div\n                        className={`w-2 h-2 rounded-full ${\n                          item.type === \"deal\" ? \"bg-blue-500\" : item.type === \"doc\" ? \"bg-green-500\" : \"bg-purple-500\"\n                        }`}\n                      />\n                      <span className=\"text-sm\">{item.title}</span>\n                    </div>\n                    <span className=\"text-xs text-muted-foreground\">{item.time}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Quick Actions */}\n            <div className=\"grid md:grid-cols-3 gap-4\">\n              <Button variant=\"outline\" className=\"h-24 flex-col gap-2\">\n                <Plus className=\"h-6 w-6\" />\n                <span>Créer un deal</span>\n              </Button>\n              <Button variant=\"outline\" className=\"h-24 flex-col gap-2\">\n                <FileText className=\"h-6 w-6\" />\n                <span>Nouvelle note</span>\n              </Button>\n              <Button variant=\"outline\" className=\"h-24 flex-col gap-2\">\n                <Users className=\"h-6 w-6\" />\n                <span>Inviter un membre</span>\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"editor\">\n            <div className=\"bg-card border rounded-xl p-6\">\n              <TailwindAdvancedEditor documentId=\"demo-document-v1\" />\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"pipeline\">\n            <div className=\"bg-card border rounded-xl p-6\">\n              <DealPipeline />\n            </div>\n          </TabsContent>\n        </Tabs>\n      </main>\n\n      {/* Footer */}\n      <footer className=\"border-t mt-16 py-6 text-center text-sm text-muted-foreground\">\n        <p>© 2026 Alecia. Tous droits réservés.</p>\n      </footer>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./hooks/use-presence.ts"},"span":[577,580],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { api } from \"../convex/_generated/api\";\n\nconst HEARTBEAT_INTERVAL = 10000; // 10 seconds\nconst USER_COLORS = [\n  \"#FF6B6B\",\n  \"#4ECDC4\",\n  \"#45B7D1\",\n  \"#96CEB4\",\n  \"#FFEAA7\",\n  \"#DDA0DD\",\n  \"#98D8C8\",\n  \"#F7DC6F\",\n  \"#BB8FCE\",\n  \"#85C1E9\",\n];\n\ninterface UsePresenceOptions {\n  resourceType: \"document\" | \"deal\";\n  resourceId: string;\n  enabled?: boolean;\n}\n\n// Lazy import useUser to avoid SSR issues\nlet useUserHook: (() => { user: any }) | null = null;\n\nfunction getUser() {\n  if (typeof window === \"undefined\") return null;\n\n  try {\n    // Dynamically access Clerk's useUser if available\n    if (!useUserHook) {\n      const clerk = require(\"@clerk/nextjs\");\n      useUserHook = clerk.useUser;\n    }\n    return useUserHook?.()?.user || null;\n  } catch {\n    return null;\n  }\n}\n\nexport function usePresence({ resourceType, resourceId, enabled = true }: UsePresenceOptions) {\n  const [mounted, setMounted] = useState(false);\n  const [user, setUser] = useState<any>(null);\n  const heartbeatRef = useRef<NodeJS.Timeout | null>(null);\n\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  // Only run on client\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const activeUsers = useQuery(\n    api.presence.getActiveUsers,\n    isConvexConfigured && enabled && mounted ? { resourceType, resourceId } : \"skip\",\n  );\n\n  const heartbeat = useMutation(api.presence.heartbeat);\n  const leave = useMutation(api.presence.leave);\n\n  // Generate consistent color for user based on ID\n  const getUserColor = useCallback((userId: string) => {\n    let hash = 0;\n    for (let i = 0; i < userId.length; i++) {\n      hash = (hash << 5) - hash + userId.charCodeAt(i);\n      hash |= 0;\n    }\n    return USER_COLORS[Math.abs(hash) % USER_COLORS.length];\n  }, []);\n\n  // Safely get user on client side\n  useEffect(() => {\n    if (!mounted) return;\n\n    try {\n      const _clerk = require(\"@clerk/nextjs\");\n      // This is a workaround - in a real app, you'd use useUser directly\n      // but for SSR safety, we delay it\n      const currentUser = getUser();\n      setUser(currentUser);\n    } catch {\n      setUser(null);\n    }\n  }, [mounted]);\n\n  // Send heartbeat\n  const sendHeartbeat = useCallback(async () => {\n    if (!user?.id || !isConvexConfigured) return;\n\n    try {\n      await heartbeat({\n        resourceType,\n        resourceId,\n        userId: user.id,\n        userName: user.fullName || user.firstName || \"Anonymous\",\n        userColor: getUserColor(user.id),\n      });\n    } catch (error) {\n      console.error(\"Presence heartbeat error:\", error);\n    }\n  }, [user, resourceType, resourceId, heartbeat, getUserColor, isConvexConfigured]);\n\n  // Setup heartbeat interval\n  useEffect(() => {\n    if (!enabled || !user?.id || !isConvexConfigured || !mounted) return;\n\n    // Send initial heartbeat\n    sendHeartbeat();\n\n    // Setup interval\n    heartbeatRef.current = setInterval(sendHeartbeat, HEARTBEAT_INTERVAL);\n\n    // Cleanup on unmount or resource change\n    return () => {\n      if (heartbeatRef.current) {\n        clearInterval(heartbeatRef.current);\n      }\n      // Leave the resource\n      if (user?.id) {\n        leave({ resourceType, resourceId, userId: user.id }).catch(() => {});\n      }\n    };\n  }, [enabled, user?.id, resourceType, resourceId, sendHeartbeat, leave, isConvexConfigured, mounted]);\n\n  // Filter out current user\n  const otherUsers = activeUsers?.filter((u) => u.userId !== user?.id) || [];\n\n  return {\n    activeUsers: activeUsers || [],\n    otherUsers,\n    isLoading: activeUsers === undefined,\n    currentUserId: user?.id,\n  };\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./hooks/use-presence.ts"},"span":[1104,1107],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { api } from \"../convex/_generated/api\";\n\nconst HEARTBEAT_INTERVAL = 10000; // 10 seconds\nconst USER_COLORS = [\n  \"#FF6B6B\",\n  \"#4ECDC4\",\n  \"#45B7D1\",\n  \"#96CEB4\",\n  \"#FFEAA7\",\n  \"#DDA0DD\",\n  \"#98D8C8\",\n  \"#F7DC6F\",\n  \"#BB8FCE\",\n  \"#85C1E9\",\n];\n\ninterface UsePresenceOptions {\n  resourceType: \"document\" | \"deal\";\n  resourceId: string;\n  enabled?: boolean;\n}\n\n// Lazy import useUser to avoid SSR issues\nlet useUserHook: (() => { user: any }) | null = null;\n\nfunction getUser() {\n  if (typeof window === \"undefined\") return null;\n\n  try {\n    // Dynamically access Clerk's useUser if available\n    if (!useUserHook) {\n      const clerk = require(\"@clerk/nextjs\");\n      useUserHook = clerk.useUser;\n    }\n    return useUserHook?.()?.user || null;\n  } catch {\n    return null;\n  }\n}\n\nexport function usePresence({ resourceType, resourceId, enabled = true }: UsePresenceOptions) {\n  const [mounted, setMounted] = useState(false);\n  const [user, setUser] = useState<any>(null);\n  const heartbeatRef = useRef<NodeJS.Timeout | null>(null);\n\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  // Only run on client\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const activeUsers = useQuery(\n    api.presence.getActiveUsers,\n    isConvexConfigured && enabled && mounted ? { resourceType, resourceId } : \"skip\",\n  );\n\n  const heartbeat = useMutation(api.presence.heartbeat);\n  const leave = useMutation(api.presence.leave);\n\n  // Generate consistent color for user based on ID\n  const getUserColor = useCallback((userId: string) => {\n    let hash = 0;\n    for (let i = 0; i < userId.length; i++) {\n      hash = (hash << 5) - hash + userId.charCodeAt(i);\n      hash |= 0;\n    }\n    return USER_COLORS[Math.abs(hash) % USER_COLORS.length];\n  }, []);\n\n  // Safely get user on client side\n  useEffect(() => {\n    if (!mounted) return;\n\n    try {\n      const _clerk = require(\"@clerk/nextjs\");\n      // This is a workaround - in a real app, you'd use useUser directly\n      // but for SSR safety, we delay it\n      const currentUser = getUser();\n      setUser(currentUser);\n    } catch {\n      setUser(null);\n    }\n  }, [mounted]);\n\n  // Send heartbeat\n  const sendHeartbeat = useCallback(async () => {\n    if (!user?.id || !isConvexConfigured) return;\n\n    try {\n      await heartbeat({\n        resourceType,\n        resourceId,\n        userId: user.id,\n        userName: user.fullName || user.firstName || \"Anonymous\",\n        userColor: getUserColor(user.id),\n      });\n    } catch (error) {\n      console.error(\"Presence heartbeat error:\", error);\n    }\n  }, [user, resourceType, resourceId, heartbeat, getUserColor, isConvexConfigured]);\n\n  // Setup heartbeat interval\n  useEffect(() => {\n    if (!enabled || !user?.id || !isConvexConfigured || !mounted) return;\n\n    // Send initial heartbeat\n    sendHeartbeat();\n\n    // Setup interval\n    heartbeatRef.current = setInterval(sendHeartbeat, HEARTBEAT_INTERVAL);\n\n    // Cleanup on unmount or resource change\n    return () => {\n      if (heartbeatRef.current) {\n        clearInterval(heartbeatRef.current);\n      }\n      // Leave the resource\n      if (user?.id) {\n        leave({ resourceType, resourceId, userId: user.id }).catch(() => {});\n      }\n    };\n  }, [enabled, user?.id, resourceType, resourceId, sendHeartbeat, leave, isConvexConfigured, mounted]);\n\n  // Filter out current user\n  const otherUsers = activeUsers?.filter((u) => u.userId !== user?.id) || [];\n\n  return {\n    activeUsers: activeUsers || [],\n    otherUsers,\n    isLoading: activeUsers === undefined,\n    currentUserId: user?.id,\n  };\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[660,661],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport { fr } from \"@/lib/i18n\";\nimport { Clock } from \"lucide-react\";\nimport dynamicImport from \"next/dynamic\";\n\n// Prevent static generation\nexport const dynamic = \"force-dynamic\";\nexport const runtime = \"nodejs\";\n\n// Dynamically import RecentFiles to avoid SSR issues with Clerk\nconst RecentFiles = dynamicImport(\n  () => import(\"@/components/recent-files/RecentFiles\").then((mod) => ({ default: mod.RecentFiles })),\n  {\n    ssr: false,\n    loading: () => (\n      <div className=\"space-y-4\">\n        {[...Array(5)].map((_, i) => (\n          <Skeleton key={i} className=\"h-16 w-full\" />\n        ))}\n      </div>\n    ),\n  },\n);\n\nexport default function RecentPage() {\n  return (\n    <AppShell>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-2\">\n          <Clock className=\"h-8 w-8\" />\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight\">{fr.nav.recent}</h1>\n            <p className=\"text-muted-foreground\">Vos documents récemment consultés</p>\n          </div>\n        </div>\n        <RecentFiles limit={20} showCreateButton />\n      </div>\n    </AppShell>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/recent/page.tsx"},"span":[693,694],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport { fr } from \"@/lib/i18n\";\nimport { Clock } from \"lucide-react\";\nimport dynamicImport from \"next/dynamic\";\n\n// Prevent static generation\nexport const dynamic = \"force-dynamic\";\nexport const runtime = \"nodejs\";\n\n// Dynamically import RecentFiles to avoid SSR issues with Clerk\nconst RecentFiles = dynamicImport(\n  () => import(\"@/components/recent-files/RecentFiles\").then((mod) => ({ default: mod.RecentFiles })),\n  {\n    ssr: false,\n    loading: () => (\n      <div className=\"space-y-4\">\n        {[...Array(5)].map((_, i) => (\n          <Skeleton key={i} className=\"h-16 w-full\" />\n        ))}\n      </div>\n    ),\n  },\n);\n\nexport default function RecentPage() {\n  return (\n    <AppShell>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-2\">\n          <Clock className=\"h-8 w-8\" />\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight\">{fr.nav.recent}</h1>\n            <p className=\"text-muted-foreground\">Vos documents récemment consultés</p>\n          </div>\n        </div>\n        <RecentFiles limit={20} showCreateButton />\n      </div>\n    </AppShell>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[520,521],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport dynamicImport from \"next/dynamic\";\n\nexport const dynamic = \"force-dynamic\";\nexport const runtime = \"nodejs\";\n\nconst SettingsContent = dynamicImport(() => import(\"./SettingsContent\"), {\n  ssr: false,\n  loading: () => (\n    <AppShell>\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-12 w-64\" />\n        <div className=\"space-y-4\">\n          {[...Array(4)].map((_, i) => (\n            <Skeleton key={i} className=\"h-32 w-full\" />\n          ))}\n        </div>\n      </div>\n    </AppShell>\n  ),\n});\n\nexport default function SettingsPage() {\n  return <SettingsContent />;\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./app/settings/page.tsx"},"span":[555,556],"sourceCode":"\"use client\";\n\nimport { AppShell } from \"@/components/layout/AppShell\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport dynamicImport from \"next/dynamic\";\n\nexport const dynamic = \"force-dynamic\";\nexport const runtime = \"nodejs\";\n\nconst SettingsContent = dynamicImport(() => import(\"./SettingsContent\"), {\n  ssr: false,\n  loading: () => (\n    <AppShell>\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-12 w-64\" />\n        <div className=\"space-y-4\">\n          {[...Array(4)].map((_, i) => (\n            <Skeleton key={i} className=\"h-32 w-full\" />\n          ))}\n        </div>\n      </div>\n    </AppShell>\n  ),\n});\n\nexport default function SettingsPage() {\n  return <SettingsContent />;\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[4055,4060],"sourceCode":"\"use client\";\n\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useMemo } from \"react\";\nimport { useState } from \"react\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Button } from \"../tailwind/ui/button\";\nimport { Card, CardContent } from \"../tailwind/ui/card\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  createdAt: number;\n  dueDate?: number;\n}\n\ninterface CalendarViewProps {\n  deals: Deal[];\n  onDealClick?: (dealId: Id<\"colab_deals\">) => void;\n}\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-500\",\n  \"due-diligence\": \"bg-yellow-500\",\n  negotiation: \"bg-orange-500\",\n  closing: \"bg-purple-500\",\n  \"closed-won\": \"bg-green-500\",\n  \"closed-lost\": \"bg-red-500\",\n};\n\nimport { fr } from \"@/lib/i18n\";\n\nconst DAYS = fr.calendar.days.short;\nconst MONTHS = fr.calendar.months.long;\n\nexport function CalendarView({ deals, onDealClick }: CalendarViewProps) {\n  const [currentDate, setCurrentDate] = useState(new Date());\n\n  const { calendarDays, dealsOnDate } = useMemo(() => {\n    const year = currentDate.getFullYear();\n    const month = currentDate.getMonth();\n\n    // First day of month\n    const firstDay = new Date(year, month, 1);\n    const startingDay = firstDay.getDay();\n\n    // Days in month\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\n\n    // Create calendar grid\n    const days: (number | null)[] = [];\n\n    // Empty cells before first day\n    for (let i = 0; i < startingDay; i++) {\n      days.push(null);\n    }\n\n    // Days of the month\n    for (let i = 1; i <= daysInMonth; i++) {\n      days.push(i);\n    }\n\n    // Map deals to dates (by dueDate or createdAt)\n    const dealsByDate: Record<string, Deal[]> = {};\n\n    deals.forEach((deal) => {\n      const dateToUse = deal.dueDate || deal.createdAt;\n      const date = new Date(dateToUse);\n      if (date.getFullYear() === year && date.getMonth() === month) {\n        const key = date.getDate().toString();\n        if (!dealsByDate[key]) {\n          dealsByDate[key] = [];\n        }\n        dealsByDate[key].push(deal);\n      }\n    });\n\n    return { calendarDays: days, dealsOnDate: dealsByDate };\n  }, [currentDate, deals]);\n\n  const goToPreviousMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));\n  };\n\n  const goToNextMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));\n  };\n\n  const goToToday = () => {\n    setCurrentDate(new Date());\n  };\n\n  const today = new Date();\n  const isCurrentMonth =\n    today.getFullYear() === currentDate.getFullYear() && today.getMonth() === currentDate.getMonth();\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"icon\" onClick={goToPreviousMonth}>\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"outline\" size=\"icon\" onClick={goToNextMonth}>\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n          <h2 className=\"text-lg font-semibold ml-2\">\n            {MONTHS[currentDate.getMonth()]} {currentDate.getFullYear()}\n          </h2>\n        </div>\n        <Button variant=\"outline\" size=\"sm\" onClick={goToToday}>\n          {fr.calendar.today}\n        </Button>\n      </div>\n\n      {/* Calendar Grid */}\n      <div className=\"border rounded-lg overflow-hidden\">\n        {/* Day headers */}\n        <div className=\"grid grid-cols-7 bg-muted/50\">\n          {DAYS.map((day) => (\n            <div key={day} className=\"px-2 py-2 text-center text-sm font-medium text-muted-foreground border-b\">\n              {day}\n            </div>\n          ))}\n        </div>\n\n        {/* Calendar cells */}\n        <div className=\"grid grid-cols-7\">\n          {calendarDays.map((day, index) => {\n            const dayDeals = day ? dealsOnDate[day.toString()] || [] : [];\n            const isToday = isCurrentMonth && day === today.getDate();\n\n            return (\n              <div\n                key={index}\n                className={`min-h-[100px] border-b border-r p-1 ${day ? \"bg-background\" : \"bg-muted/20\"}`}\n              >\n                {day && (\n                  <>\n                    <div\n                      className={`text-sm font-medium mb-1 w-6 h-6 flex items-center justify-center rounded-full ${\n                        isToday ? \"bg-primary text-primary-foreground\" : \"text-muted-foreground\"\n                      }`}\n                    >\n                      {day}\n                    </div>\n                    <div className=\"space-y-1\">\n                      {dayDeals.slice(0, 3).map((deal) => (\n                        <Card\n                          key={deal._id}\n                          className=\"cursor-pointer hover:shadow-sm transition-shadow\"\n                          onClick={() => onDealClick?.(deal._id)}\n                        >\n                          <CardContent className=\"p-1.5\">\n                            <div className=\"flex items-center gap-1\">\n                              <div className={`w-2 h-2 rounded-full ${stageColors[deal.stage]}`} />\n                              <span className=\"text-xs truncate flex-1\">{deal.company}</span>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                      {dayDeals.length > 3 && (\n                        <div className=\"text-xs text-muted-foreground text-center\">+{dayDeals.length - 3} more</div>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Legend */}\n      <div className=\"flex flex-wrap gap-3 text-xs text-muted-foreground\">\n        {Object.entries(stageColors).map(([stage, color]) => (\n          <div key={stage} className=\"flex items-center gap-1\">\n            <div className={`w-2 h-2 rounded-full ${color}`} />\n            <span className=\"capitalize\">{stage.replace(\"-\", \" \")}</span>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/CalendarView.tsx"},"span":[4275,4280],"sourceCode":"\"use client\";\n\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useMemo } from \"react\";\nimport { useState } from \"react\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Button } from \"../tailwind/ui/button\";\nimport { Card, CardContent } from \"../tailwind/ui/card\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  createdAt: number;\n  dueDate?: number;\n}\n\ninterface CalendarViewProps {\n  deals: Deal[];\n  onDealClick?: (dealId: Id<\"colab_deals\">) => void;\n}\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-500\",\n  \"due-diligence\": \"bg-yellow-500\",\n  negotiation: \"bg-orange-500\",\n  closing: \"bg-purple-500\",\n  \"closed-won\": \"bg-green-500\",\n  \"closed-lost\": \"bg-red-500\",\n};\n\nimport { fr } from \"@/lib/i18n\";\n\nconst DAYS = fr.calendar.days.short;\nconst MONTHS = fr.calendar.months.long;\n\nexport function CalendarView({ deals, onDealClick }: CalendarViewProps) {\n  const [currentDate, setCurrentDate] = useState(new Date());\n\n  const { calendarDays, dealsOnDate } = useMemo(() => {\n    const year = currentDate.getFullYear();\n    const month = currentDate.getMonth();\n\n    // First day of month\n    const firstDay = new Date(year, month, 1);\n    const startingDay = firstDay.getDay();\n\n    // Days in month\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\n\n    // Create calendar grid\n    const days: (number | null)[] = [];\n\n    // Empty cells before first day\n    for (let i = 0; i < startingDay; i++) {\n      days.push(null);\n    }\n\n    // Days of the month\n    for (let i = 1; i <= daysInMonth; i++) {\n      days.push(i);\n    }\n\n    // Map deals to dates (by dueDate or createdAt)\n    const dealsByDate: Record<string, Deal[]> = {};\n\n    deals.forEach((deal) => {\n      const dateToUse = deal.dueDate || deal.createdAt;\n      const date = new Date(dateToUse);\n      if (date.getFullYear() === year && date.getMonth() === month) {\n        const key = date.getDate().toString();\n        if (!dealsByDate[key]) {\n          dealsByDate[key] = [];\n        }\n        dealsByDate[key].push(deal);\n      }\n    });\n\n    return { calendarDays: days, dealsOnDate: dealsByDate };\n  }, [currentDate, deals]);\n\n  const goToPreviousMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));\n  };\n\n  const goToNextMonth = () => {\n    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));\n  };\n\n  const goToToday = () => {\n    setCurrentDate(new Date());\n  };\n\n  const today = new Date();\n  const isCurrentMonth =\n    today.getFullYear() === currentDate.getFullYear() && today.getMonth() === currentDate.getMonth();\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"icon\" onClick={goToPreviousMonth}>\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"outline\" size=\"icon\" onClick={goToNextMonth}>\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n          <h2 className=\"text-lg font-semibold ml-2\">\n            {MONTHS[currentDate.getMonth()]} {currentDate.getFullYear()}\n          </h2>\n        </div>\n        <Button variant=\"outline\" size=\"sm\" onClick={goToToday}>\n          {fr.calendar.today}\n        </Button>\n      </div>\n\n      {/* Calendar Grid */}\n      <div className=\"border rounded-lg overflow-hidden\">\n        {/* Day headers */}\n        <div className=\"grid grid-cols-7 bg-muted/50\">\n          {DAYS.map((day) => (\n            <div key={day} className=\"px-2 py-2 text-center text-sm font-medium text-muted-foreground border-b\">\n              {day}\n            </div>\n          ))}\n        </div>\n\n        {/* Calendar cells */}\n        <div className=\"grid grid-cols-7\">\n          {calendarDays.map((day, index) => {\n            const dayDeals = day ? dealsOnDate[day.toString()] || [] : [];\n            const isToday = isCurrentMonth && day === today.getDate();\n\n            return (\n              <div\n                key={index}\n                className={`min-h-[100px] border-b border-r p-1 ${day ? \"bg-background\" : \"bg-muted/20\"}`}\n              >\n                {day && (\n                  <>\n                    <div\n                      className={`text-sm font-medium mb-1 w-6 h-6 flex items-center justify-center rounded-full ${\n                        isToday ? \"bg-primary text-primary-foreground\" : \"text-muted-foreground\"\n                      }`}\n                    >\n                      {day}\n                    </div>\n                    <div className=\"space-y-1\">\n                      {dayDeals.slice(0, 3).map((deal) => (\n                        <Card\n                          key={deal._id}\n                          className=\"cursor-pointer hover:shadow-sm transition-shadow\"\n                          onClick={() => onDealClick?.(deal._id)}\n                        >\n                          <CardContent className=\"p-1.5\">\n                            <div className=\"flex items-center gap-1\">\n                              <div className={`w-2 h-2 rounded-full ${stageColors[deal.stage]}`} />\n                              <span className=\"text-xs truncate flex-1\">{deal.company}</span>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                      {dayDeals.length > 3 && (\n                        <div className=\"text-xs text-muted-foreground text-center\">+{dayDeals.length - 3} more</div>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Legend */}\n      <div className=\"flex flex-wrap gap-3 text-xs text-muted-foreground\">\n        {Object.entries(stageColors).map(([stage, color]) => (\n          <div key={stage} className=\"flex items-center gap-1\">\n            <div className={`w-2 h-2 rounded-full ${color}`} />\n            <span className=\"capitalize\">{stage.replace(\"-\", \" \")}</span>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useKeyWithClickEvents","severity":"error","description":"Enforce to have the onClick mouse event with the onKeyUp, the onKeyDown, or the onKeyPress keyboard event.","message":[{"elements":[],"content":"Enforce to have the "},{"elements":["Emphasis"],"content":"onClick"},{"elements":[],"content":" mouse event with the "},{"elements":["Emphasis"],"content":"onKeyUp"},{"elements":[],"content":", the "},{"elements":["Emphasis"],"content":"onKeyDown"},{"elements":[],"content":", or the "},{"elements":["Emphasis"],"content":"onKeyPress"},{"elements":[],"content":" keyboard event."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Actions triggered using mouse events should have corresponding keyboard events to account for keyboard-only navigation."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/TableView.tsx"},"span":[7383,7591],"sourceCode":"\"use client\";\n\nimport {\n  type ColumnFiltersState,\n  type SortingState,\n  createColumnHelper,\n  flexRender,\n  getCoreRowModel,\n  getFilteredRowModel,\n  getSortedRowModel,\n  useReactTable,\n} from \"@tanstack/react-table\";\nimport { ArrowDown, ArrowUp, ArrowUpDown, Search } from \"lucide-react\";\nimport { useMemo, useState } from \"react\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Badge } from \"../tailwind/ui/badge\";\nimport { Button } from \"../tailwind/ui/button\";\nimport { Input } from \"../tailwind/ui/input\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\ntype Priority = \"high\" | \"medium\" | \"low\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  lead?: string;\n  createdAt: number;\n  updatedAt: number;\n  dueDate?: number;\n  priority?: Priority;\n  tags?: string[];\n}\n\ninterface TableViewProps {\n  deals: Deal[];\n  onDealClick?: (dealId: Id<\"colab_deals\">) => void;\n}\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100\",\n  \"due-diligence\": \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\",\n  negotiation: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100\",\n  closing: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100\",\n  \"closed-won\": \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\",\n  \"closed-lost\": \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n};\n\nconst priorityColors: Record<Priority, string> = {\n  high: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n  medium: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\",\n  low: \"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100\",\n};\n\nconst columnHelper = createColumnHelper<Deal>();\n\nexport function TableView({ deals, onDealClick }: TableViewProps) {\n  const [sorting, setSorting] = useState<SortingState>([]);\n  const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([]);\n  const [globalFilter, setGlobalFilter] = useState(\"\");\n\n  const columns = useMemo(\n    () => [\n      columnHelper.accessor(\"company\", {\n        header: ({ column }) => (\n          <Button\n            variant=\"ghost\"\n            onClick={() => column.toggleSorting(column.getIsSorted() === \"asc\")}\n            className=\"flex items-center gap-1 -ml-4\"\n          >\n            Company\n            {column.getIsSorted() === \"asc\" ? (\n              <ArrowUp className=\"h-4 w-4\" />\n            ) : column.getIsSorted() === \"desc\" ? (\n              <ArrowDown className=\"h-4 w-4\" />\n            ) : (\n              <ArrowUpDown className=\"h-4 w-4\" />\n            )}\n          </Button>\n        ),\n        cell: (info) => <span className=\"font-medium\">{info.getValue()}</span>,\n      }),\n      columnHelper.accessor(\"stage\", {\n        header: \"Stage\",\n        cell: (info) => <Badge className={stageColors[info.getValue()]}>{info.getValue().replace(\"-\", \" \")}</Badge>,\n      }),\n      columnHelper.accessor(\"valuation\", {\n        header: ({ column }) => (\n          <Button\n            variant=\"ghost\"\n            onClick={() => column.toggleSorting(column.getIsSorted() === \"asc\")}\n            className=\"flex items-center gap-1 -ml-4\"\n          >\n            Valuation\n            <ArrowUpDown className=\"h-4 w-4\" />\n          </Button>\n        ),\n        cell: (info) => info.getValue() || \"—\",\n      }),\n      columnHelper.accessor(\"lead\", {\n        header: \"Lead\",\n        cell: (info) => info.getValue() || \"—\",\n      }),\n      columnHelper.accessor(\"priority\", {\n        header: \"Priority\",\n        cell: (info) => {\n          const priority = info.getValue();\n          if (!priority) return \"—\";\n          return <Badge className={priorityColors[priority]}>{priority}</Badge>;\n        },\n      }),\n      columnHelper.accessor(\"dueDate\", {\n        header: ({ column }) => (\n          <Button\n            variant=\"ghost\"\n            onClick={() => column.toggleSorting(column.getIsSorted() === \"asc\")}\n            className=\"flex items-center gap-1 -ml-4\"\n          >\n            Due Date\n            <ArrowUpDown className=\"h-4 w-4\" />\n          </Button>\n        ),\n        cell: (info) => {\n          const date = info.getValue();\n          if (!date) return \"—\";\n          return new Date(date).toLocaleDateString();\n        },\n      }),\n      columnHelper.accessor(\"createdAt\", {\n        header: ({ column }) => (\n          <Button\n            variant=\"ghost\"\n            onClick={() => column.toggleSorting(column.getIsSorted() === \"asc\")}\n            className=\"flex items-center gap-1 -ml-4\"\n          >\n            Created\n            <ArrowUpDown className=\"h-4 w-4\" />\n          </Button>\n        ),\n        cell: (info) => new Date(info.getValue()).toLocaleDateString(),\n      }),\n      columnHelper.accessor(\"tags\", {\n        header: \"Tags\",\n        cell: (info) => {\n          const tags = info.getValue();\n          if (!tags || tags.length === 0) return \"—\";\n          return (\n            <div className=\"flex gap-1 flex-wrap\">\n              {tags.slice(0, 3).map((tag) => (\n                <Badge key={tag} variant=\"outline\" className=\"text-xs\">\n                  {tag}\n                </Badge>\n              ))}\n              {tags.length > 3 && (\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  +{tags.length - 3}\n                </Badge>\n              )}\n            </div>\n          );\n        },\n      }),\n    ],\n    [],\n  );\n\n  const table = useReactTable({\n    data: deals,\n    columns,\n    state: {\n      sorting,\n      columnFilters,\n      globalFilter,\n    },\n    onSortingChange: setSorting,\n    onColumnFiltersChange: setColumnFilters,\n    onGlobalFilterChange: setGlobalFilter,\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    getFilteredRowModel: getFilteredRowModel(),\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Search */}\n      <div className=\"relative max-w-sm\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search deals...\"\n          value={globalFilter}\n          onChange={(e) => setGlobalFilter(e.target.value)}\n          className=\"pl-9\"\n        />\n      </div>\n\n      {/* Table */}\n      <div className=\"rounded-md border\">\n        <table className=\"w-full\">\n          <thead className=\"bg-muted/50\">\n            {table.getHeaderGroups().map((headerGroup) => (\n              <tr key={headerGroup.id}>\n                {headerGroup.headers.map((header) => (\n                  <th key={header.id} className=\"px-4 py-3 text-left text-sm font-medium text-muted-foreground\">\n                    {header.isPlaceholder ? null : flexRender(header.column.columnDef.header, header.getContext())}\n                  </th>\n                ))}\n              </tr>\n            ))}\n          </thead>\n          <tbody>\n            {table.getRowModel().rows.length === 0 ? (\n              <tr>\n                <td colSpan={columns.length} className=\"px-4 py-8 text-center text-muted-foreground\">\n                  No deals found\n                </td>\n              </tr>\n            ) : (\n              table.getRowModel().rows.map((row) => (\n                <tr\n                  key={row.id}\n                  className=\"border-t hover:bg-muted/50 cursor-pointer transition-colors\"\n                  onClick={() => onDealClick?.(row.original._id)}\n                >\n                  {row.getVisibleCells().map((cell) => (\n                    <td key={cell.id} className=\"px-4 py-3 text-sm\">\n                      {flexRender(cell.column.columnDef.cell, cell.getContext())}\n                    </td>\n                  ))}\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n\n      {/* Footer */}\n      <div className=\"text-sm text-muted-foreground\">{table.getFilteredRowModel().rows.length} deal(s)</div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[4618,4712],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[7910,8222],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[8314,8724],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[8921,9214],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/correctness/noUnusedVariables","severity":"warning","description":"This variable is unused.","message":[{"elements":[],"content":"This variable is unused."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Unused variables usually are result of incomplete refactoring, typos and other source of bugs."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[9558,9567],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/correctness/noUnusedVariables","severity":"warning","description":"This variable is unused.","message":[{"elements":[],"content":"This variable is unused."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Unused variables usually are result of incomplete refactoring, typos and other source of bugs."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[9571,9577],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[10810,10963],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[11122,11297],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/PropertyEditor.tsx"},"span":[12684,12916],"sourceCode":"\"use client\";\n\n/**\n * PropertyEditor - Éditeur de propriétés personnalisées pour deals\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronDown, GripVertical, Plus, Trash2, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\n\ntype PropertyType = \"text\" | \"number\" | \"date\" | \"select\" | \"multiselect\" | \"checkbox\";\n\ninterface PropertyOption {\n  id: string;\n  label: string;\n  color: string;\n}\n\ninterface PropertyDefinition {\n  _id: Id<\"colab_property_definitions\">;\n  name: string;\n  type: PropertyType;\n  options?: PropertyOption[];\n  order: number;\n}\n\ninterface PropertyEditorProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst propertyTypeLabels: Record<PropertyType, string> = {\n  text: \"Texte\",\n  number: \"Nombre\",\n  date: \"Date\",\n  select: \"Sélection\",\n  multiselect: \"Multi-sélection\",\n  checkbox: \"Case à cocher\",\n};\n\nconst defaultColors = [\n  \"#EF4444\",\n  \"#F97316\",\n  \"#EAB308\",\n  \"#22C55E\",\n  \"#14B8A6\",\n  \"#3B82F6\",\n  \"#8B5CF6\",\n  \"#EC4899\",\n  \"#6366F1\",\n  \"#64748B\",\n];\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nexport default function PropertyEditor({ isOpen, onClose }: PropertyEditorProps) {\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  const properties = useQuery(api.propertyDefinitions.listProperties, isConvexConfigured ? {} : \"skip\");\n\n  const createProperty = useMutation(api.propertyDefinitions.createProperty);\n  const _updateProperty = useMutation(api.propertyDefinitions.updateProperty);\n  const deleteProperty = useMutation(api.propertyDefinitions.deleteProperty);\n  const addPropertyOption = useMutation(api.propertyDefinitions.addPropertyOption);\n\n  const [newPropertyName, setNewPropertyName] = useState(\"\");\n  const [newPropertyType, setNewPropertyType] = useState<PropertyType>(\"text\");\n  const [isAddingProperty, setIsAddingProperty] = useState(false);\n  const [editingProperty, setEditingProperty] = useState<Id<\"colab_property_definitions\"> | null>(null);\n\n  const handleCreateProperty = useCallback(async () => {\n    if (!newPropertyName.trim()) return;\n\n    try {\n      await createProperty({\n        name: newPropertyName.trim(),\n        type: newPropertyType,\n        options: newPropertyType === \"select\" || newPropertyType === \"multiselect\" ? [] : undefined,\n      });\n      setNewPropertyName(\"\");\n      setNewPropertyType(\"text\");\n      setIsAddingProperty(false);\n    } catch (error) {\n      console.error(\"Erreur création propriété:\", error);\n    }\n  }, [newPropertyName, newPropertyType, createProperty]);\n\n  const handleDeleteProperty = useCallback(\n    async (id: Id<\"colab_property_definitions\">) => {\n      if (!confirm(\"Êtes-vous sûr de vouloir supprimer cette propriété ?\")) return;\n\n      try {\n        await deleteProperty({ id });\n      } catch (error) {\n        console.error(\"Erreur suppression propriété:\", error);\n      }\n    },\n    [deleteProperty],\n  );\n\n  const handleAddOption = useCallback(\n    async (propertyId: Id<\"colab_property_definitions\">, label: string) => {\n      try {\n        await addPropertyOption({\n          propertyId,\n          option: {\n            id: generateId(),\n            label,\n            color: defaultColors[Math.floor(Math.random() * defaultColors.length)],\n          },\n        });\n      } catch (error) {\n        console.error(\"Erreur ajout option:\", error);\n      }\n    },\n    [addPropertyOption],\n  );\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          transition={{ type: \"spring\", duration: 0.3 }}\n          className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* En-tête */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Propriétés personnalisées</h2>\n            <button onClick={onClose} className=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800\">\n              <X className=\"h-5 w-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Contenu */}\n          <div className=\"p-4 max-h-[60vh] overflow-y-auto\">\n            {!isConvexConfigured ? (\n              <div className=\"text-center py-8 text-gray-500\">\n                <p>Convex non configuré.</p>\n                <p className=\"text-sm mt-1\">Configurez NEXT_PUBLIC_CONVEX_URL pour utiliser les propriétés.</p>\n              </div>\n            ) : properties === undefined ? (\n              <div className=\"flex justify-center py-8\">\n                <div className=\"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full\" />\n              </div>\n            ) : (\n              <>\n                {/* Liste des propriétés */}\n                <div className=\"space-y-2\">\n                  {properties.map((property) => (\n                    <PropertyItem\n                      key={property._id}\n                      property={property as PropertyDefinition}\n                      isEditing={editingProperty === property._id}\n                      onEdit={() => setEditingProperty(property._id)}\n                      onDelete={() => handleDeleteProperty(property._id)}\n                      onAddOption={(label) => handleAddOption(property._id, label)}\n                    />\n                  ))}\n                </div>\n\n                {properties.length === 0 && !isAddingProperty && (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>Aucune propriété personnalisée.</p>\n                    <p className=\"text-sm mt-1\">Créez votre première propriété ci-dessous.</p>\n                  </div>\n                )}\n\n                {/* Ajouter une propriété */}\n                {isAddingProperty ? (\n                  <motion.div\n                    initial={{ opacity: 0, y: -10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"space-y-3\">\n                      <input\n                        type=\"text\"\n                        placeholder=\"Nom de la propriété\"\n                        value={newPropertyName}\n                        onChange={(e) => setNewPropertyName(e.target.value)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      />\n\n                      <select\n                        value={newPropertyType}\n                        onChange={(e) => setNewPropertyType(e.target.value as PropertyType)}\n                        className=\"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-900\"\n                      >\n                        {Object.entries(propertyTypeLabels).map(([value, label]) => (\n                          <option key={value} value={value}>\n                            {label}\n                          </option>\n                        ))}\n                      </select>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={handleCreateProperty}\n                          disabled={!newPropertyName.trim()}\n                          className=\"flex-1 px-3 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50\"\n                        >\n                          Créer\n                        </button>\n                        <button\n                          onClick={() => {\n                            setIsAddingProperty(false);\n                            setNewPropertyName(\"\");\n                            setNewPropertyType(\"text\");\n                          }}\n                          className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md\"\n                        >\n                          Annuler\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                ) : (\n                  <button\n                    onClick={() => setIsAddingProperty(true)}\n                    className=\"mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    Ajouter une propriété\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Item de propriété individuel\n */\nfunction PropertyItem({\n  property,\n  isEditing,\n  onEdit,\n  onDelete,\n  onAddOption,\n}: {\n  property: PropertyDefinition;\n  isEditing: boolean;\n  onEdit: () => void;\n  onDelete: () => void;\n  onAddOption: (label: string) => void;\n}) {\n  const [showOptions, setShowOptions] = useState(false);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n\n  const hasOptions = property.type === \"select\" || property.type === \"multiselect\";\n\n  const handleAddOption = () => {\n    if (!newOptionLabel.trim()) return;\n    onAddOption(newOptionLabel.trim());\n    setNewOptionLabel(\"\");\n  };\n\n  return (\n    <div className=\"group p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <GripVertical className=\"h-4 w-4 text-gray-400 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity\" />\n\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-medium text-gray-900 dark:text-white text-sm\">{property.name}</span>\n            <span className=\"text-xs px-1.5 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400\">\n              {propertyTypeLabels[property.type]}\n            </span>\n          </div>\n        </div>\n\n        {hasOptions && (\n          <button\n            onClick={() => setShowOptions(!showOptions)}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <ChevronDown className={cn(\"h-4 w-4 text-gray-500 transition-transform\", showOptions && \"rotate-180\")} />\n          </button>\n        )}\n\n        <button\n          onClick={onDelete}\n          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded opacity-0 group-hover:opacity-100 transition-opacity\"\n        >\n          <Trash2 className=\"h-4 w-4 text-red-500\" />\n        </button>\n      </div>\n\n      {/* Options pour select/multiselect */}\n      <AnimatePresence>\n        {showOptions && hasOptions && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 overflow-hidden\"\n          >\n            <div className=\"space-y-2\">\n              {property.options?.map((option) => (\n                <div key={option.id} className=\"flex items-center gap-2\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: option.color }} />\n                  <span className=\"text-sm text-gray-700 dark:text-gray-300\">{option.label}</span>\n                </div>\n              ))}\n\n              <div className=\"flex gap-2 mt-2\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Nouvelle option...\"\n                  value={newOptionLabel}\n                  onChange={(e) => setNewOptionLabel(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleAddOption()}\n                  className=\"flex-1 px-2 py-1 text-sm border border-gray-200 dark:border-gray-700 rounded bg-white dark:bg-gray-900\"\n                />\n                <button\n                  onClick={handleAddOption}\n                  disabled={!newOptionLabel.trim()}\n                  className=\"px-2 py-1 text-xs bg-primary text-primary-foreground rounded disabled:opacity-50\"\n                >\n                  <Plus className=\"h-3 w-3\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/editor/extensions/callout-extension.ts"},"span":[215,218],"sourceCode":"import { Node } from \"@tiptap/core\";\nimport { ReactNodeViewRenderer } from \"@tiptap/react\";\nimport { CalloutComponent } from \"./CalloutComponent\";\n\nexport interface CalloutOptions {\n  HTMLAttributes: Record<string, any>;\n}\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    callout: {\n      /**\n       * Set a callout node\n       */\n      setCallout: (attributes?: { type: \"info\" | \"warning\" | \"success\" | \"error\" }) => ReturnType;\n      /**\n       * Toggle a callout node\n       */\n      toggleCallout: (attributes?: { type: \"info\" | \"warning\" | \"success\" | \"error\" }) => ReturnType;\n    };\n  }\n}\n\nexport const CalloutExtension = Node.create<CalloutOptions>({\n  name: \"callout\",\n\n  group: \"block\",\n\n  content: \"block+\",\n\n  draggable: true,\n\n  addAttributes() {\n    return {\n      type: {\n        default: \"info\",\n        parseHTML: (element) => element.getAttribute(\"data-type\"),\n        renderHTML: (attributes) => {\n          return { \"data-type\": attributes.type };\n        },\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'div[data-type=\"callout\"]',\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"div\", { \"data-type\": \"callout\", ...HTMLAttributes }, 0];\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(CalloutComponent);\n  },\n\n  addCommands() {\n    return {\n      setCallout:\n        (attributes) =>\n        ({ commands }) => {\n          return commands.setNode(this.name, attributes);\n        },\n      toggleCallout:\n        (attributes) =>\n        ({ commands }) => {\n          return commands.toggleNode(this.name, \"paragraph\", attributes);\n        },\n    };\n  },\n});\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/editor/extensions/kanban-extension.ts"},"span":[212,215],"sourceCode":"import { Node } from \"@tiptap/core\";\nimport { ReactNodeViewRenderer } from \"@tiptap/react\";\nimport { KanbanComponent } from \"./KanbanComponent\";\n\nexport interface KanbanOptions {\n  HTMLAttributes: Record<string, any>;\n}\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    kanban: {\n      /**\n       * Insert a kanban board\n       */\n      setKanban: (attributes?: { boardId?: string }) => ReturnType;\n    };\n  }\n}\n\nexport const KanbanExtension = Node.create<KanbanOptions>({\n  name: \"kanban\",\n\n  group: \"block\",\n\n  atom: true,\n\n  addAttributes() {\n    return {\n      boardId: {\n        default: null,\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'div[data-type=\"kanban\"]',\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"div\", { \"data-type\": \"kanban\", ...HTMLAttributes }];\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(KanbanComponent);\n  },\n\n  addCommands() {\n    return {\n      setKanban:\n        (attributes) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: attributes,\n          });\n        },\n    };\n  },\n});\n"},"tags":[],"source":null},{"category":"lint/a11y/noLabelWithoutControl","severity":"error","description":"A form label must be associated with an input.","message":[{"elements":[],"content":"A form label must be associated with an input."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Consider adding a `for` or `htmlFor` attribute to the label element or moving the input element to inside the label element."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/index.tsx"},"span":[7454,7535],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  Calendar,\n  DollarSign,\n  Loader2,\n  MoreVertical,\n  Plus,\n  TrendingUp,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Badge } from \"../tailwind/ui/badge\";\nimport { Button } from \"../tailwind/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"../tailwind/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"../tailwind/ui/dialog\";\nimport { ScrollArea } from \"../tailwind/ui/scroll-area\";\n\nimport DealFlowCanvas from \"../deal-flow/DealFlowCanvas\";\nimport { CalendarView } from \"./CalendarView\";\nimport { TableView } from \"./TableView\";\n// Multi-view components\nimport { ViewSwitcher, type ViewType } from \"./ViewSwitcher\";\n\nimport { fr } from \"@/lib/i18n\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  lead?: string;\n  createdAt: number;\n  updatedAt: number;\n  dueDate?: number;\n  priority?: \"high\" | \"medium\" | \"low\";\n  tags?: string[];\n}\n\n// Mock deals as fallback when Convex is not available\nconst mockDeals: Deal[] = [\n  {\n    _id: \"mock-1\" as Id<\"colab_deals\">,\n    company: \"TechVenture Inc.\",\n    stage: \"due-diligence\",\n    valuation: \"$25M\",\n    lead: \"John Doe\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    priority: \"high\",\n  },\n  {\n    _id: \"mock-2\" as Id<\"colab_deals\">,\n    company: \"HealthCare Solutions\",\n    stage: \"negotiation\",\n    valuation: \"$50M\",\n    lead: \"Jane Smith\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    priority: \"medium\",\n  },\n  {\n    _id: \"mock-3\" as Id<\"colab_deals\">,\n    company: \"FinTech Innovations\",\n    stage: \"sourcing\",\n    valuation: \"$15M\",\n    lead: \"Mike Johnson\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    dueDate: Date.now() + 7 * 24 * 60 * 60 * 1000, // 7 days from now\n  },\n];\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100\",\n  \"due-diligence\": \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\",\n  negotiation: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100\",\n  closing: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100\",\n  \"closed-won\": \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\",\n  \"closed-lost\": \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n};\n\nconst stageLabels: Record<DealStage, string> = {\n  sourcing: fr.pipeline.stages.sourcing,\n  \"due-diligence\": fr.pipeline.stages.dueDiligence,\n  negotiation: fr.pipeline.stages.negotiation,\n  closing: fr.pipeline.stages.closing,\n  \"closed-won\": fr.pipeline.stages.closedWon,\n  \"closed-lost\": fr.pipeline.stages.closedLost,\n};\n\nconst pipelineStages: DealStage[] = [\"sourcing\", \"due-diligence\", \"negotiation\", \"closing\"];\n\nexport default function DealPipeline() {\n  // View state with URL persistence\n  const [currentView, setCurrentView] = useState<ViewType>(\"kanban\");\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newDealCompany, setNewDealCompany] = useState(\"\");\n  const [newDealValuation, setNewDealValuation] = useState(\"\");\n  const [newDealLead, setNewDealLead] = useState(\"\");\n  const [selectedStage, setSelectedStage] = useState<DealStage | null>(null);\n\n  // Read view from URL on mount\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      const params = new URLSearchParams(window.location.search);\n      const view = params.get(\"view\") as ViewType;\n      if (view && [\"kanban\", \"table\", \"calendar\", \"flow\"].includes(view)) {\n        setCurrentView(view);\n      }\n    }\n  }, []);\n\n  // Update URL when view changes\n  const handleViewChange = (view: ViewType) => {\n    setCurrentView(view);\n    if (typeof window !== \"undefined\") {\n      const url = new URL(window.location.href);\n      url.searchParams.set(\"view\", view);\n      window.history.replaceState({}, \"\", url.toString());\n    }\n  };\n\n  // Convex queries\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n  const convexDeals = useQuery(api.deals.list, isConvexConfigured ? {} : \"skip\");\n  const createDeal = useMutation(api.deals.create);\n  const moveDealStage = useMutation(api.deals.moveStage);\n\n  const deals: Deal[] = convexDeals ?? mockDeals;\n  const isLoading = isConvexConfigured && convexDeals === undefined;\n\n  const filteredDeals = selectedStage\n    ? deals.filter((deal) => deal.stage === selectedStage)\n    : deals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage));\n\n  const dealsByStage = pipelineStages.reduce(\n    (acc, stage) => {\n      acc[stage] = deals.filter((d) => d.stage === stage).length;\n      return acc;\n    },\n    {} as Record<DealStage, number>,\n  );\n\n  const handleCreateDeal = async () => {\n    if (!newDealCompany.trim()) return;\n    try {\n      await createDeal({\n        company: newDealCompany,\n        stage: \"sourcing\",\n        valuation: newDealValuation || undefined,\n        lead: newDealLead || undefined,\n      });\n      setNewDealCompany(\"\");\n      setNewDealValuation(\"\");\n      setNewDealLead(\"\");\n      setIsCreateOpen(false);\n    } catch (error) {\n      console.error(\"Failed to create deal:\", error);\n    }\n  };\n\n  const handleMoveToNextStage = async (deal: Deal) => {\n    const currentIndex = pipelineStages.indexOf(deal.stage);\n    if (currentIndex === -1 || currentIndex >= pipelineStages.length - 1) return;\n    const nextStage = pipelineStages[currentIndex + 1];\n    try {\n      await moveDealStage({ id: deal._id, stage: nextStage });\n    } catch (error) {\n      console.error(\"Failed to move deal:\", error);\n    }\n  };\n\n  const formatDate = (timestamp: number) => new Date(timestamp).toLocaleDateString();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <div className=\"flex items-center gap-4\">\n          <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n            <Briefcase className=\"h-6 w-6\" />\n            {fr.pipeline.title}\n          </h2>\n          {!isConvexConfigured && (\n            <Badge variant=\"outline\" className=\"text-xs\">\n              {fr.pipeline.demoMode}\n            </Badge>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          <ViewSwitcher currentView={currentView} onViewChange={handleViewChange} showFlowView={true} />\n\n          <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n            <DialogTrigger asChild>\n              <Button disabled={!isConvexConfigured}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                {fr.actions.newDeal}\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>{fr.pipeline.createDeal}</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.companyName} *</label>\n                  <input\n                    type=\"text\"\n                    value={newDealCompany}\n                    onChange={(e) => setNewDealCompany(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder={fr.form.enterValue}\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.valuation}</label>\n                  <input\n                    type=\"text\"\n                    value={newDealValuation}\n                    onChange={(e) => setNewDealValuation(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder=\"ex: 10 m€\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.dealLead}</label>\n                  <input\n                    type=\"text\"\n                    value={newDealLead}\n                    onChange={(e) => setNewDealLead(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder={fr.form.enterValue}\n                  />\n                </div>\n                <Button onClick={handleCreateDeal} className=\"w-full\">\n                  {fr.pipeline.createDeal}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Stage Summary (only for Kanban) */}\n      {currentView === \"kanban\" && (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {pipelineStages.map((stage) => (\n            <Card\n              key={stage}\n              className={`cursor-pointer transition-all hover:shadow-md ${\n                selectedStage === stage ? \"ring-2 ring-primary\" : \"\"\n              }`}\n              onClick={() => setSelectedStage(selectedStage === stage ? null : stage)}\n            >\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{stageLabels[stage]}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{dealsByStage[stage] || 0}</div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* View Content */}\n      {currentView === \"kanban\" && (\n        <ScrollArea className=\"h-[500px]\">\n          <div className=\"space-y-3\">\n            {filteredDeals.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">{fr.pipeline.noDealsFound}</div>\n            ) : (\n              filteredDeals.map((deal) => (\n                <Card key={deal._id} className=\"hover:shadow-md transition-all\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"space-y-2 flex-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <Building className=\"h-4 w-4 text-muted-foreground\" />\n                          <h3 className=\"font-semibold\">{deal.company}</h3>\n                        </div>\n                        <div className=\"flex flex-wrap gap-3 text-sm text-muted-foreground\">\n                          {deal.valuation && (\n                            <div className=\"flex items-center gap-1\">\n                              <DollarSign className=\"h-3 w-3\" />\n                              <span>{deal.valuation}</span>\n                            </div>\n                          )}\n                          {deal.lead && (\n                            <div className=\"flex items-center gap-1\">\n                              <TrendingUp className=\"h-3 w-3\" />\n                              <span>{deal.lead}</span>\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-1\">\n                            <Calendar className=\"h-3 w-3\" />\n                            <span>{formatDate(deal.createdAt)}</span>\n                          </div>\n                        </div>\n                        <div className=\"flex gap-2 flex-wrap\">\n                          <Badge className={stageColors[deal.stage]}>{stageLabels[deal.stage]}</Badge>\n                          {deal.priority && (\n                            <Badge variant=\"outline\" className=\"capitalize\">\n                              {deal.priority}\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        {isConvexConfigured && pipelineStages.indexOf(deal.stage) < pipelineStages.length - 1 && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleMoveToNextStage(deal)}\n                            title=\"Move to next stage\"\n                          >\n                            <ArrowRight className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                        <Button variant=\"ghost\" size=\"icon\">\n                          <MoreVertical className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </ScrollArea>\n      )}\n\n      {currentView === \"table\" && <TableView deals={deals} />}\n\n      {currentView === \"calendar\" && <CalendarView deals={deals} />}\n\n      {currentView === \"flow\" && <DealFlowCanvas />}\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/noLabelWithoutControl","severity":"error","description":"A form label must be associated with an input.","message":[{"elements":[],"content":"A form label must be associated with an input."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Consider adding a `for` or `htmlFor` attribute to the label element or moving the input element to inside the label element."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/index.tsx"},"span":[7917,7994],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  Calendar,\n  DollarSign,\n  Loader2,\n  MoreVertical,\n  Plus,\n  TrendingUp,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Badge } from \"../tailwind/ui/badge\";\nimport { Button } from \"../tailwind/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"../tailwind/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"../tailwind/ui/dialog\";\nimport { ScrollArea } from \"../tailwind/ui/scroll-area\";\n\nimport DealFlowCanvas from \"../deal-flow/DealFlowCanvas\";\nimport { CalendarView } from \"./CalendarView\";\nimport { TableView } from \"./TableView\";\n// Multi-view components\nimport { ViewSwitcher, type ViewType } from \"./ViewSwitcher\";\n\nimport { fr } from \"@/lib/i18n\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  lead?: string;\n  createdAt: number;\n  updatedAt: number;\n  dueDate?: number;\n  priority?: \"high\" | \"medium\" | \"low\";\n  tags?: string[];\n}\n\n// Mock deals as fallback when Convex is not available\nconst mockDeals: Deal[] = [\n  {\n    _id: \"mock-1\" as Id<\"colab_deals\">,\n    company: \"TechVenture Inc.\",\n    stage: \"due-diligence\",\n    valuation: \"$25M\",\n    lead: \"John Doe\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    priority: \"high\",\n  },\n  {\n    _id: \"mock-2\" as Id<\"colab_deals\">,\n    company: \"HealthCare Solutions\",\n    stage: \"negotiation\",\n    valuation: \"$50M\",\n    lead: \"Jane Smith\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    priority: \"medium\",\n  },\n  {\n    _id: \"mock-3\" as Id<\"colab_deals\">,\n    company: \"FinTech Innovations\",\n    stage: \"sourcing\",\n    valuation: \"$15M\",\n    lead: \"Mike Johnson\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    dueDate: Date.now() + 7 * 24 * 60 * 60 * 1000, // 7 days from now\n  },\n];\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100\",\n  \"due-diligence\": \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\",\n  negotiation: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100\",\n  closing: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100\",\n  \"closed-won\": \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\",\n  \"closed-lost\": \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n};\n\nconst stageLabels: Record<DealStage, string> = {\n  sourcing: fr.pipeline.stages.sourcing,\n  \"due-diligence\": fr.pipeline.stages.dueDiligence,\n  negotiation: fr.pipeline.stages.negotiation,\n  closing: fr.pipeline.stages.closing,\n  \"closed-won\": fr.pipeline.stages.closedWon,\n  \"closed-lost\": fr.pipeline.stages.closedLost,\n};\n\nconst pipelineStages: DealStage[] = [\"sourcing\", \"due-diligence\", \"negotiation\", \"closing\"];\n\nexport default function DealPipeline() {\n  // View state with URL persistence\n  const [currentView, setCurrentView] = useState<ViewType>(\"kanban\");\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newDealCompany, setNewDealCompany] = useState(\"\");\n  const [newDealValuation, setNewDealValuation] = useState(\"\");\n  const [newDealLead, setNewDealLead] = useState(\"\");\n  const [selectedStage, setSelectedStage] = useState<DealStage | null>(null);\n\n  // Read view from URL on mount\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      const params = new URLSearchParams(window.location.search);\n      const view = params.get(\"view\") as ViewType;\n      if (view && [\"kanban\", \"table\", \"calendar\", \"flow\"].includes(view)) {\n        setCurrentView(view);\n      }\n    }\n  }, []);\n\n  // Update URL when view changes\n  const handleViewChange = (view: ViewType) => {\n    setCurrentView(view);\n    if (typeof window !== \"undefined\") {\n      const url = new URL(window.location.href);\n      url.searchParams.set(\"view\", view);\n      window.history.replaceState({}, \"\", url.toString());\n    }\n  };\n\n  // Convex queries\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n  const convexDeals = useQuery(api.deals.list, isConvexConfigured ? {} : \"skip\");\n  const createDeal = useMutation(api.deals.create);\n  const moveDealStage = useMutation(api.deals.moveStage);\n\n  const deals: Deal[] = convexDeals ?? mockDeals;\n  const isLoading = isConvexConfigured && convexDeals === undefined;\n\n  const filteredDeals = selectedStage\n    ? deals.filter((deal) => deal.stage === selectedStage)\n    : deals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage));\n\n  const dealsByStage = pipelineStages.reduce(\n    (acc, stage) => {\n      acc[stage] = deals.filter((d) => d.stage === stage).length;\n      return acc;\n    },\n    {} as Record<DealStage, number>,\n  );\n\n  const handleCreateDeal = async () => {\n    if (!newDealCompany.trim()) return;\n    try {\n      await createDeal({\n        company: newDealCompany,\n        stage: \"sourcing\",\n        valuation: newDealValuation || undefined,\n        lead: newDealLead || undefined,\n      });\n      setNewDealCompany(\"\");\n      setNewDealValuation(\"\");\n      setNewDealLead(\"\");\n      setIsCreateOpen(false);\n    } catch (error) {\n      console.error(\"Failed to create deal:\", error);\n    }\n  };\n\n  const handleMoveToNextStage = async (deal: Deal) => {\n    const currentIndex = pipelineStages.indexOf(deal.stage);\n    if (currentIndex === -1 || currentIndex >= pipelineStages.length - 1) return;\n    const nextStage = pipelineStages[currentIndex + 1];\n    try {\n      await moveDealStage({ id: deal._id, stage: nextStage });\n    } catch (error) {\n      console.error(\"Failed to move deal:\", error);\n    }\n  };\n\n  const formatDate = (timestamp: number) => new Date(timestamp).toLocaleDateString();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <div className=\"flex items-center gap-4\">\n          <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n            <Briefcase className=\"h-6 w-6\" />\n            {fr.pipeline.title}\n          </h2>\n          {!isConvexConfigured && (\n            <Badge variant=\"outline\" className=\"text-xs\">\n              {fr.pipeline.demoMode}\n            </Badge>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          <ViewSwitcher currentView={currentView} onViewChange={handleViewChange} showFlowView={true} />\n\n          <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n            <DialogTrigger asChild>\n              <Button disabled={!isConvexConfigured}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                {fr.actions.newDeal}\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>{fr.pipeline.createDeal}</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.companyName} *</label>\n                  <input\n                    type=\"text\"\n                    value={newDealCompany}\n                    onChange={(e) => setNewDealCompany(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder={fr.form.enterValue}\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.valuation}</label>\n                  <input\n                    type=\"text\"\n                    value={newDealValuation}\n                    onChange={(e) => setNewDealValuation(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder=\"ex: 10 m€\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.dealLead}</label>\n                  <input\n                    type=\"text\"\n                    value={newDealLead}\n                    onChange={(e) => setNewDealLead(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder={fr.form.enterValue}\n                  />\n                </div>\n                <Button onClick={handleCreateDeal} className=\"w-full\">\n                  {fr.pipeline.createDeal}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Stage Summary (only for Kanban) */}\n      {currentView === \"kanban\" && (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {pipelineStages.map((stage) => (\n            <Card\n              key={stage}\n              className={`cursor-pointer transition-all hover:shadow-md ${\n                selectedStage === stage ? \"ring-2 ring-primary\" : \"\"\n              }`}\n              onClick={() => setSelectedStage(selectedStage === stage ? null : stage)}\n            >\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{stageLabels[stage]}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{dealsByStage[stage] || 0}</div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* View Content */}\n      {currentView === \"kanban\" && (\n        <ScrollArea className=\"h-[500px]\">\n          <div className=\"space-y-3\">\n            {filteredDeals.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">{fr.pipeline.noDealsFound}</div>\n            ) : (\n              filteredDeals.map((deal) => (\n                <Card key={deal._id} className=\"hover:shadow-md transition-all\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"space-y-2 flex-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <Building className=\"h-4 w-4 text-muted-foreground\" />\n                          <h3 className=\"font-semibold\">{deal.company}</h3>\n                        </div>\n                        <div className=\"flex flex-wrap gap-3 text-sm text-muted-foreground\">\n                          {deal.valuation && (\n                            <div className=\"flex items-center gap-1\">\n                              <DollarSign className=\"h-3 w-3\" />\n                              <span>{deal.valuation}</span>\n                            </div>\n                          )}\n                          {deal.lead && (\n                            <div className=\"flex items-center gap-1\">\n                              <TrendingUp className=\"h-3 w-3\" />\n                              <span>{deal.lead}</span>\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-1\">\n                            <Calendar className=\"h-3 w-3\" />\n                            <span>{formatDate(deal.createdAt)}</span>\n                          </div>\n                        </div>\n                        <div className=\"flex gap-2 flex-wrap\">\n                          <Badge className={stageColors[deal.stage]}>{stageLabels[deal.stage]}</Badge>\n                          {deal.priority && (\n                            <Badge variant=\"outline\" className=\"capitalize\">\n                              {deal.priority}\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        {isConvexConfigured && pipelineStages.indexOf(deal.stage) < pipelineStages.length - 1 && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleMoveToNextStage(deal)}\n                            title=\"Move to next stage\"\n                          >\n                            <ArrowRight className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                        <Button variant=\"ghost\" size=\"icon\">\n                          <MoreVertical className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </ScrollArea>\n      )}\n\n      {currentView === \"table\" && <TableView deals={deals} />}\n\n      {currentView === \"calendar\" && <CalendarView deals={deals} />}\n\n      {currentView === \"flow\" && <DealFlowCanvas />}\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/noLabelWithoutControl","severity":"error","description":"A form label must be associated with an input.","message":[{"elements":[],"content":"A form label must be associated with an input."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Consider adding a `for` or `htmlFor` attribute to the label element or moving the input element to inside the label element."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/deal-pipeline/index.tsx"},"span":[8373,8449],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  Calendar,\n  DollarSign,\n  Loader2,\n  MoreVertical,\n  Plus,\n  TrendingUp,\n} from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Badge } from \"../tailwind/ui/badge\";\nimport { Button } from \"../tailwind/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"../tailwind/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"../tailwind/ui/dialog\";\nimport { ScrollArea } from \"../tailwind/ui/scroll-area\";\n\nimport DealFlowCanvas from \"../deal-flow/DealFlowCanvas\";\nimport { CalendarView } from \"./CalendarView\";\nimport { TableView } from \"./TableView\";\n// Multi-view components\nimport { ViewSwitcher, type ViewType } from \"./ViewSwitcher\";\n\nimport { fr } from \"@/lib/i18n\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  lead?: string;\n  createdAt: number;\n  updatedAt: number;\n  dueDate?: number;\n  priority?: \"high\" | \"medium\" | \"low\";\n  tags?: string[];\n}\n\n// Mock deals as fallback when Convex is not available\nconst mockDeals: Deal[] = [\n  {\n    _id: \"mock-1\" as Id<\"colab_deals\">,\n    company: \"TechVenture Inc.\",\n    stage: \"due-diligence\",\n    valuation: \"$25M\",\n    lead: \"John Doe\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    priority: \"high\",\n  },\n  {\n    _id: \"mock-2\" as Id<\"colab_deals\">,\n    company: \"HealthCare Solutions\",\n    stage: \"negotiation\",\n    valuation: \"$50M\",\n    lead: \"Jane Smith\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    priority: \"medium\",\n  },\n  {\n    _id: \"mock-3\" as Id<\"colab_deals\">,\n    company: \"FinTech Innovations\",\n    stage: \"sourcing\",\n    valuation: \"$15M\",\n    lead: \"Mike Johnson\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    dueDate: Date.now() + 7 * 24 * 60 * 60 * 1000, // 7 days from now\n  },\n];\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100\",\n  \"due-diligence\": \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\",\n  negotiation: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100\",\n  closing: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100\",\n  \"closed-won\": \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\",\n  \"closed-lost\": \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n};\n\nconst stageLabels: Record<DealStage, string> = {\n  sourcing: fr.pipeline.stages.sourcing,\n  \"due-diligence\": fr.pipeline.stages.dueDiligence,\n  negotiation: fr.pipeline.stages.negotiation,\n  closing: fr.pipeline.stages.closing,\n  \"closed-won\": fr.pipeline.stages.closedWon,\n  \"closed-lost\": fr.pipeline.stages.closedLost,\n};\n\nconst pipelineStages: DealStage[] = [\"sourcing\", \"due-diligence\", \"negotiation\", \"closing\"];\n\nexport default function DealPipeline() {\n  // View state with URL persistence\n  const [currentView, setCurrentView] = useState<ViewType>(\"kanban\");\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newDealCompany, setNewDealCompany] = useState(\"\");\n  const [newDealValuation, setNewDealValuation] = useState(\"\");\n  const [newDealLead, setNewDealLead] = useState(\"\");\n  const [selectedStage, setSelectedStage] = useState<DealStage | null>(null);\n\n  // Read view from URL on mount\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      const params = new URLSearchParams(window.location.search);\n      const view = params.get(\"view\") as ViewType;\n      if (view && [\"kanban\", \"table\", \"calendar\", \"flow\"].includes(view)) {\n        setCurrentView(view);\n      }\n    }\n  }, []);\n\n  // Update URL when view changes\n  const handleViewChange = (view: ViewType) => {\n    setCurrentView(view);\n    if (typeof window !== \"undefined\") {\n      const url = new URL(window.location.href);\n      url.searchParams.set(\"view\", view);\n      window.history.replaceState({}, \"\", url.toString());\n    }\n  };\n\n  // Convex queries\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n  const convexDeals = useQuery(api.deals.list, isConvexConfigured ? {} : \"skip\");\n  const createDeal = useMutation(api.deals.create);\n  const moveDealStage = useMutation(api.deals.moveStage);\n\n  const deals: Deal[] = convexDeals ?? mockDeals;\n  const isLoading = isConvexConfigured && convexDeals === undefined;\n\n  const filteredDeals = selectedStage\n    ? deals.filter((deal) => deal.stage === selectedStage)\n    : deals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage));\n\n  const dealsByStage = pipelineStages.reduce(\n    (acc, stage) => {\n      acc[stage] = deals.filter((d) => d.stage === stage).length;\n      return acc;\n    },\n    {} as Record<DealStage, number>,\n  );\n\n  const handleCreateDeal = async () => {\n    if (!newDealCompany.trim()) return;\n    try {\n      await createDeal({\n        company: newDealCompany,\n        stage: \"sourcing\",\n        valuation: newDealValuation || undefined,\n        lead: newDealLead || undefined,\n      });\n      setNewDealCompany(\"\");\n      setNewDealValuation(\"\");\n      setNewDealLead(\"\");\n      setIsCreateOpen(false);\n    } catch (error) {\n      console.error(\"Failed to create deal:\", error);\n    }\n  };\n\n  const handleMoveToNextStage = async (deal: Deal) => {\n    const currentIndex = pipelineStages.indexOf(deal.stage);\n    if (currentIndex === -1 || currentIndex >= pipelineStages.length - 1) return;\n    const nextStage = pipelineStages[currentIndex + 1];\n    try {\n      await moveDealStage({ id: deal._id, stage: nextStage });\n    } catch (error) {\n      console.error(\"Failed to move deal:\", error);\n    }\n  };\n\n  const formatDate = (timestamp: number) => new Date(timestamp).toLocaleDateString();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <div className=\"flex items-center gap-4\">\n          <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n            <Briefcase className=\"h-6 w-6\" />\n            {fr.pipeline.title}\n          </h2>\n          {!isConvexConfigured && (\n            <Badge variant=\"outline\" className=\"text-xs\">\n              {fr.pipeline.demoMode}\n            </Badge>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-3\">\n          <ViewSwitcher currentView={currentView} onViewChange={handleViewChange} showFlowView={true} />\n\n          <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n            <DialogTrigger asChild>\n              <Button disabled={!isConvexConfigured}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                {fr.actions.newDeal}\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>{fr.pipeline.createDeal}</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.companyName} *</label>\n                  <input\n                    type=\"text\"\n                    value={newDealCompany}\n                    onChange={(e) => setNewDealCompany(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder={fr.form.enterValue}\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.valuation}</label>\n                  <input\n                    type=\"text\"\n                    value={newDealValuation}\n                    onChange={(e) => setNewDealValuation(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder=\"ex: 10 m€\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">{fr.pipeline.fields.dealLead}</label>\n                  <input\n                    type=\"text\"\n                    value={newDealLead}\n                    onChange={(e) => setNewDealLead(e.target.value)}\n                    className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                    placeholder={fr.form.enterValue}\n                  />\n                </div>\n                <Button onClick={handleCreateDeal} className=\"w-full\">\n                  {fr.pipeline.createDeal}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Stage Summary (only for Kanban) */}\n      {currentView === \"kanban\" && (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {pipelineStages.map((stage) => (\n            <Card\n              key={stage}\n              className={`cursor-pointer transition-all hover:shadow-md ${\n                selectedStage === stage ? \"ring-2 ring-primary\" : \"\"\n              }`}\n              onClick={() => setSelectedStage(selectedStage === stage ? null : stage)}\n            >\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{stageLabels[stage]}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{dealsByStage[stage] || 0}</div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* View Content */}\n      {currentView === \"kanban\" && (\n        <ScrollArea className=\"h-[500px]\">\n          <div className=\"space-y-3\">\n            {filteredDeals.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">{fr.pipeline.noDealsFound}</div>\n            ) : (\n              filteredDeals.map((deal) => (\n                <Card key={deal._id} className=\"hover:shadow-md transition-all\">\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"space-y-2 flex-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <Building className=\"h-4 w-4 text-muted-foreground\" />\n                          <h3 className=\"font-semibold\">{deal.company}</h3>\n                        </div>\n                        <div className=\"flex flex-wrap gap-3 text-sm text-muted-foreground\">\n                          {deal.valuation && (\n                            <div className=\"flex items-center gap-1\">\n                              <DollarSign className=\"h-3 w-3\" />\n                              <span>{deal.valuation}</span>\n                            </div>\n                          )}\n                          {deal.lead && (\n                            <div className=\"flex items-center gap-1\">\n                              <TrendingUp className=\"h-3 w-3\" />\n                              <span>{deal.lead}</span>\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-1\">\n                            <Calendar className=\"h-3 w-3\" />\n                            <span>{formatDate(deal.createdAt)}</span>\n                          </div>\n                        </div>\n                        <div className=\"flex gap-2 flex-wrap\">\n                          <Badge className={stageColors[deal.stage]}>{stageLabels[deal.stage]}</Badge>\n                          {deal.priority && (\n                            <Badge variant=\"outline\" className=\"capitalize\">\n                              {deal.priority}\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        {isConvexConfigured && pipelineStages.indexOf(deal.stage) < pipelineStages.length - 1 && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleMoveToNextStage(deal)}\n                            title=\"Move to next stage\"\n                          >\n                            <ArrowRight className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                        <Button variant=\"ghost\" size=\"icon\">\n                          <MoreVertical className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </ScrollArea>\n      )}\n\n      {currentView === \"table\" && <TableView deals={deals} />}\n\n      {currentView === \"calendar\" && <CalendarView deals={deals} />}\n\n      {currentView === \"flow\" && <DealFlowCanvas />}\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/feedback/Alert.tsx"},"span":[2574,2907],"sourceCode":"\"use client\";\n\n/**\n * Alert - Composants d'alerte\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { AlertCircle, AlertTriangle, CheckCircle2, Info, X } from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useState } from \"react\";\n\ntype AlertVariant = \"info\" | \"success\" | \"warning\" | \"error\";\n\ninterface AlertProps {\n  variant?: AlertVariant;\n  title?: string;\n  children: React.ReactNode;\n  dismissible?: boolean;\n  onDismiss?: () => void;\n  className?: string;\n}\n\nconst variantConfig = {\n  info: {\n    icon: Info,\n    bg: \"bg-blue-50 dark:bg-blue-950/30\",\n    border: \"border-blue-200 dark:border-blue-800\",\n    text: \"text-blue-800 dark:text-blue-200\",\n    iconColor: \"text-blue-500 dark:text-blue-400\",\n  },\n  success: {\n    icon: CheckCircle2,\n    bg: \"bg-green-50 dark:bg-green-950/30\",\n    border: \"border-green-200 dark:border-green-800\",\n    text: \"text-green-800 dark:text-green-200\",\n    iconColor: \"text-green-500 dark:text-green-400\",\n  },\n  warning: {\n    icon: AlertTriangle,\n    bg: \"bg-yellow-50 dark:bg-yellow-950/30\",\n    border: \"border-yellow-200 dark:border-yellow-800\",\n    text: \"text-yellow-800 dark:text-yellow-200\",\n    iconColor: \"text-yellow-500 dark:text-yellow-400\",\n  },\n  error: {\n    icon: AlertCircle,\n    bg: \"bg-red-50 dark:bg-red-950/30\",\n    border: \"border-red-200 dark:border-red-800\",\n    text: \"text-red-800 dark:text-red-200\",\n    iconColor: \"text-red-500 dark:text-red-400\",\n  },\n};\n\nexport default function Alert({\n  variant = \"info\",\n  title,\n  children,\n  dismissible = false,\n  onDismiss,\n  className,\n}: AlertProps) {\n  const [isVisible, setIsVisible] = useState(true);\n  const config = variantConfig[variant];\n  const Icon = config.icon;\n\n  const handleDismiss = () => {\n    setIsVisible(false);\n    onDismiss?.();\n  };\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0, y: -10 }}\n          animate={{ opacity: 1, y: 0 }}\n          exit={{ opacity: 0, y: -10 }}\n          transition={{ duration: 0.2 }}\n          role=\"alert\"\n          className={cn(\"relative flex gap-3 rounded-lg border p-4\", config.bg, config.border, className)}\n        >\n          <Icon className={cn(\"h-5 w-5 flex-shrink-0 mt-0.5\", config.iconColor)} />\n\n          <div className=\"flex-1\">\n            {title && <h5 className={cn(\"font-medium mb-1\", config.text)}>{title}</h5>}\n            <div className={cn(\"text-sm\", config.text)}>{children}</div>\n          </div>\n\n          {dismissible && (\n            <button\n              onClick={handleDismiss}\n              className={cn(\n                \"flex-shrink-0 p-1 rounded-md\",\n                \"hover:bg-black/5 dark:hover:bg-white/5\",\n                \"transition-colors duration-150\",\n                config.text,\n              )}\n              aria-label=\"Fermer l'alerte\"\n            >\n              <X className=\"h-4 w-4\" />\n            </button>\n          )}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n\n/**\n * Alertes pré-configurées en français\n */\n\nexport function AlertSucces({\n  children,\n  title = \"Succès\",\n}: {\n  children: React.ReactNode;\n  title?: string;\n}) {\n  return (\n    <Alert variant=\"success\" title={title}>\n      {children}\n    </Alert>\n  );\n}\n\nexport function AlertErreur({\n  children,\n  title = \"Erreur\",\n}: {\n  children: React.ReactNode;\n  title?: string;\n}) {\n  return (\n    <Alert variant=\"error\" title={title}>\n      {children}\n    </Alert>\n  );\n}\n\nexport function AlertAvertissement({\n  children,\n  title = \"Attention\",\n}: {\n  children: React.ReactNode;\n  title?: string;\n}) {\n  return (\n    <Alert variant=\"warning\" title={title}>\n      {children}\n    </Alert>\n  );\n}\n\nexport function AlertInfo({\n  children,\n  title = \"Information\",\n}: {\n  children: React.ReactNode;\n  title?: string;\n}) {\n  return (\n    <Alert variant=\"info\" title={title}>\n      {children}\n    </Alert>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/ListColumn.tsx"},"span":[605,608],"sourceCode":"import { Button } from \"@/components/tailwind/ui/button\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { MoreHorizontal, Plus } from \"lucide-react\";\nimport { Draggable } from \"react-beautiful-dnd\";\nimport { StrictModeDroppable } from \"./StrictModeDroppable\";\nimport { TaskCard } from \"./TaskCard\";\n\ninterface ListColumnProps {\n  list: {\n    _id: Id<\"colab_lists\">;\n    name: string;\n  };\n  index: number;\n  // biome-ignore lint/suspicious/noExplicitAny: Card type is complex\n  cards: any[];\n  onAddCard: (listId: string) => void;\n  onCardClick: (cardId: string) => void;\n  boardLabels: any[];\n}\n\nexport function ListColumn({ list, index, cards, onAddCard, onCardClick, boardLabels }: ListColumnProps) {\n  return (\n    <Draggable draggableId={list._id} index={index}>\n      {(provided, _snapshot) => (\n        <div\n          ref={provided.innerRef}\n          {...provided.draggableProps}\n          {...provided.dragHandleProps}\n          className=\"w-80 flex-shrink-0 flex flex-col max-h-full bg-muted/20 rounded-lg border shadow-sm\"\n        >\n          <div className=\"flex items-center justify-between p-3 border-b bg-muted/50 rounded-t-lg cursor-grab active:cursor-grabbing\">\n            <h3 className=\"font-semibold text-sm px-1\">{list.name}</h3>\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </div>\n\n          <div className=\"flex-1 p-2 overflow-y-auto min-h-[100px]\">\n            <StrictModeDroppable droppableId={list._id} type=\"CARD\">\n              {(provided, snapshot) => (\n                <div\n                  ref={provided.innerRef}\n                  {...provided.droppableProps}\n                  className={`flex flex-col gap-2 min-h-[10px] transition-colors rounded-md p-1 ${snapshot.isDraggingOver ? \"bg-primary/5\" : \"\"}`}\n                >\n                  {cards.map((card, index) => (\n                    <TaskCard\n                      key={card._id}\n                      card={card}\n                      index={index}\n                      onClick={onCardClick}\n                      boardLabels={boardLabels}\n                    />\n                  ))}\n                  {provided.placeholder}\n                </div>\n              )}\n            </StrictModeDroppable>\n\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start text-muted-foreground mt-2 hover:bg-muted/50\"\n              onClick={() => onAddCard(list._id)}\n            >\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Ajouter une carte\n            </Button>\n          </div>\n        </div>\n      )}\n    </Draggable>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/TaskCard.tsx"},"span":[502,505],"sourceCode":"import { Card, CardContent } from \"@/components/tailwind/ui/card\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { AlignLeft, Calendar } from \"lucide-react\";\nimport { Draggable } from \"react-beautiful-dnd\";\n\ninterface TaskCardProps {\n  card: {\n    _id: Id<\"colab_cards\">;\n    title: string;\n    description?: string;\n    dueDate?: number;\n    labelIds?: Id<\"colab_labels\">[];\n    // Add other fields as needed\n  };\n  index: number;\n  onClick: (cardId: string) => void;\n  boardLabels: any[];\n}\n\nexport function TaskCard({ card, index, onClick, boardLabels }: TaskCardProps) {\n  const cardLabels = boardLabels.filter((l) => card.labelIds?.includes(l._id));\n\n  return (\n    <Draggable draggableId={card._id} index={index}>\n      {(provided, snapshot) => (\n        <div\n          ref={provided.innerRef}\n          {...provided.draggableProps}\n          {...provided.dragHandleProps}\n          style={provided.draggableProps.style}\n          onClick={() => onClick(card._id)}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" || e.key === \" \") {\n              onClick(card._id);\n            }\n          }}\n        >\n          <Card\n            className={`hover:border-primary/50 transition-colors cursor-pointer ${snapshot.isDragging ? \"shadow-lg rotate-2\" : \"\"}`}\n          >\n            <CardContent className=\"p-3 space-y-2\">\n              {cardLabels.length > 0 && (\n                <div className=\"flex flex-wrap gap-1\">\n                  {cardLabels.map((label) => (\n                    <span\n                      key={label._id}\n                      className=\"text-[10px] px-2 py-0.5 rounded-full font-medium text-white\"\n                      style={{ backgroundColor: label.colorCode }}\n                    >\n                      {label.name}\n                    </span>\n                  ))}\n                </div>\n              )}\n\n              <div className=\"text-sm font-medium leading-none\">{card.title}</div>\n\n              <div className=\"flex items-center gap-3 text-xs text-muted-foreground\">\n                {card.dueDate && (\n                  <div\n                    className={`flex items-center gap-1 ${card.dueDate < Date.now() ? \"text-red-500 font-bold\" : \"\"}`}\n                  >\n                    <Calendar className=\"h-3 w-3\" />\n                    {new Date(card.dueDate).toLocaleDateString(\"fr-FR\")}\n                  </div>\n                )}\n                {card.description && <AlignLeft className=\"h-3 w-3\" />}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n    </Draggable>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/style/noNonNullAssertion","severity":"error","description":"Forbidden non-null assertion.","message":[{"elements":[],"content":"Forbidden non-null assertion."}],"advices":{"advices":[]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./convex/deals.ts"},"span":[910,922],"sourceCode":"import { v } from \"convex/values\";\nimport { mutation, query } from \"./_generated/server\";\n\n// Valid deal stages\nconst dealStages = v.union(\n  v.literal(\"sourcing\"),\n  v.literal(\"due-diligence\"),\n  v.literal(\"negotiation\"),\n  v.literal(\"closing\"),\n  v.literal(\"closed-won\"),\n  v.literal(\"closed-lost\"),\n);\n\n// Get all deals\nexport const list = query({\n  args: {\n    userId: v.optional(v.string()),\n    stage: v.optional(dealStages),\n  },\n  handler: async (ctx, args) => {\n    // Optimization: Use indexes when possible to avoid full table scans\n\n    if (args.userId) {\n      // Use 'by_user' index.\n      // Note: This index is [\"userId\"], so results are ordered by userId, then _creationTime.\n      // We want creation time desc.\n      // Convex allows efficient reverse order on index queries.\n      const deals = await ctx.db\n        .query(\"colab_deals\")\n        .withIndex(\"by_user\", (q) => q.eq(\"userId\", args.userId!))\n        .order(\"desc\")\n        .collect();\n\n      // Filter by stage if provided\n      if (args.stage) {\n        return deals.filter((d) => d.stage === args.stage);\n      }\n      return deals;\n    }\n\n    if (args.stage) {\n      // Use 'by_stage' index\n      const deals = await ctx.db\n        .query(\"colab_deals\")\n        .withIndex(\"by_stage\", (q) => q.eq(\"stage\", args.stage!))\n        // 'by_stage' is [\"stage\"], so implicit second field is _creationTime.\n        // .order(\"desc\") gives us _creationTime desc.\n        .order(\"desc\")\n        .collect();\n\n      return deals.filter((d) => !d.isArchived);\n    }\n\n    // Fallback: Full scan but filter active deals in DB\n    return await ctx.db\n      .query(\"colab_deals\")\n      .order(\"desc\")\n      .filter((q) => q.neq(q.field(\"isArchived\"), true))\n      .collect();\n  },\n});\n\n// Get a single deal\nexport const get = query({\n  args: { id: v.id(\"colab_deals\") },\n  handler: async (ctx, args) => {\n    return await ctx.db.get(args.id);\n  },\n});\n\n// Get deals grouped by stage (for pipeline view)\nexport const getByStage = query({\n  args: {},\n  handler: async (ctx) => {\n    const deals = await ctx.db\n      .query(\"colab_deals\")\n      .filter((q) => q.neq(q.field(\"isArchived\"), true))\n      .collect();\n\n    return {\n      sourcing: deals.filter((d) => d.stage === \"sourcing\"),\n      \"due-diligence\": deals.filter((d) => d.stage === \"due-diligence\"),\n      negotiation: deals.filter((d) => d.stage === \"negotiation\"),\n      closing: deals.filter((d) => d.stage === \"closing\"),\n      \"closed-won\": deals.filter((d) => d.stage === \"closed-won\"),\n      \"closed-lost\": deals.filter((d) => d.stage === \"closed-lost\"),\n    };\n  },\n});\n\n// Create a new deal\nexport const create = mutation({\n  args: {\n    company: v.string(),\n    stage: dealStages,\n    valuation: v.optional(v.string()),\n    lead: v.optional(v.string()),\n    description: v.optional(v.string()),\n    userId: v.optional(v.string()),\n  },\n  handler: async (ctx, args) => {\n    const now = Date.now();\n    return await ctx.db.insert(\"colab_deals\", {\n      company: args.company,\n      stage: args.stage,\n      valuation: args.valuation,\n      lead: args.lead,\n      description: args.description,\n      userId: args.userId,\n      createdAt: now,\n      updatedAt: now,\n    });\n  },\n});\n\n// Update a deal\nexport const update = mutation({\n  args: {\n    id: v.id(\"colab_deals\"),\n    company: v.optional(v.string()),\n    stage: v.optional(dealStages),\n    valuation: v.optional(v.string()),\n    lead: v.optional(v.string()),\n    description: v.optional(v.string()),\n  },\n  handler: async (ctx, args) => {\n    const { id, ...updates } = args;\n    return await ctx.db.patch(id, {\n      ...updates,\n      updatedAt: Date.now(),\n    });\n  },\n});\n\n// Move deal to a different stage\nexport const moveStage = mutation({\n  args: {\n    id: v.id(\"colab_deals\"),\n    stage: dealStages,\n  },\n  handler: async (ctx, args) => {\n    return await ctx.db.patch(args.id, {\n      stage: args.stage,\n      updatedAt: Date.now(),\n    });\n  },\n});\n\n// Archive a deal\nexport const archive = mutation({\n  args: { id: v.id(\"colab_deals\") },\n  handler: async (ctx, args) => {\n    return await ctx.db.patch(args.id, {\n      isArchived: true,\n      updatedAt: Date.now(),\n    });\n  },\n});\n\n// Delete a deal permanently\nexport const remove = mutation({\n  args: { id: v.id(\"colab_deals\") },\n  handler: async (ctx, args) => {\n    return await ctx.db.delete(args.id);\n  },\n});\n"},"tags":[],"source":null},{"category":"lint/style/noNonNullAssertion","severity":"error","description":"Forbidden non-null assertion.","message":[{"elements":[],"content":"Forbidden non-null assertion."}],"advices":{"advices":[]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./convex/deals.ts"},"span":[1292,1303],"sourceCode":"import { v } from \"convex/values\";\nimport { mutation, query } from \"./_generated/server\";\n\n// Valid deal stages\nconst dealStages = v.union(\n  v.literal(\"sourcing\"),\n  v.literal(\"due-diligence\"),\n  v.literal(\"negotiation\"),\n  v.literal(\"closing\"),\n  v.literal(\"closed-won\"),\n  v.literal(\"closed-lost\"),\n);\n\n// Get all deals\nexport const list = query({\n  args: {\n    userId: v.optional(v.string()),\n    stage: v.optional(dealStages),\n  },\n  handler: async (ctx, args) => {\n    // Optimization: Use indexes when possible to avoid full table scans\n\n    if (args.userId) {\n      // Use 'by_user' index.\n      // Note: This index is [\"userId\"], so results are ordered by userId, then _creationTime.\n      // We want creation time desc.\n      // Convex allows efficient reverse order on index queries.\n      const deals = await ctx.db\n        .query(\"colab_deals\")\n        .withIndex(\"by_user\", (q) => q.eq(\"userId\", args.userId!))\n        .order(\"desc\")\n        .collect();\n\n      // Filter by stage if provided\n      if (args.stage) {\n        return deals.filter((d) => d.stage === args.stage);\n      }\n      return deals;\n    }\n\n    if (args.stage) {\n      // Use 'by_stage' index\n      const deals = await ctx.db\n        .query(\"colab_deals\")\n        .withIndex(\"by_stage\", (q) => q.eq(\"stage\", args.stage!))\n        // 'by_stage' is [\"stage\"], so implicit second field is _creationTime.\n        // .order(\"desc\") gives us _creationTime desc.\n        .order(\"desc\")\n        .collect();\n\n      return deals.filter((d) => !d.isArchived);\n    }\n\n    // Fallback: Full scan but filter active deals in DB\n    return await ctx.db\n      .query(\"colab_deals\")\n      .order(\"desc\")\n      .filter((q) => q.neq(q.field(\"isArchived\"), true))\n      .collect();\n  },\n});\n\n// Get a single deal\nexport const get = query({\n  args: { id: v.id(\"colab_deals\") },\n  handler: async (ctx, args) => {\n    return await ctx.db.get(args.id);\n  },\n});\n\n// Get deals grouped by stage (for pipeline view)\nexport const getByStage = query({\n  args: {},\n  handler: async (ctx) => {\n    const deals = await ctx.db\n      .query(\"colab_deals\")\n      .filter((q) => q.neq(q.field(\"isArchived\"), true))\n      .collect();\n\n    return {\n      sourcing: deals.filter((d) => d.stage === \"sourcing\"),\n      \"due-diligence\": deals.filter((d) => d.stage === \"due-diligence\"),\n      negotiation: deals.filter((d) => d.stage === \"negotiation\"),\n      closing: deals.filter((d) => d.stage === \"closing\"),\n      \"closed-won\": deals.filter((d) => d.stage === \"closed-won\"),\n      \"closed-lost\": deals.filter((d) => d.stage === \"closed-lost\"),\n    };\n  },\n});\n\n// Create a new deal\nexport const create = mutation({\n  args: {\n    company: v.string(),\n    stage: dealStages,\n    valuation: v.optional(v.string()),\n    lead: v.optional(v.string()),\n    description: v.optional(v.string()),\n    userId: v.optional(v.string()),\n  },\n  handler: async (ctx, args) => {\n    const now = Date.now();\n    return await ctx.db.insert(\"colab_deals\", {\n      company: args.company,\n      stage: args.stage,\n      valuation: args.valuation,\n      lead: args.lead,\n      description: args.description,\n      userId: args.userId,\n      createdAt: now,\n      updatedAt: now,\n    });\n  },\n});\n\n// Update a deal\nexport const update = mutation({\n  args: {\n    id: v.id(\"colab_deals\"),\n    company: v.optional(v.string()),\n    stage: v.optional(dealStages),\n    valuation: v.optional(v.string()),\n    lead: v.optional(v.string()),\n    description: v.optional(v.string()),\n  },\n  handler: async (ctx, args) => {\n    const { id, ...updates } = args;\n    return await ctx.db.patch(id, {\n      ...updates,\n      updatedAt: Date.now(),\n    });\n  },\n});\n\n// Move deal to a different stage\nexport const moveStage = mutation({\n  args: {\n    id: v.id(\"colab_deals\"),\n    stage: dealStages,\n  },\n  handler: async (ctx, args) => {\n    return await ctx.db.patch(args.id, {\n      stage: args.stage,\n      updatedAt: Date.now(),\n    });\n  },\n});\n\n// Archive a deal\nexport const archive = mutation({\n  args: { id: v.id(\"colab_deals\") },\n  handler: async (ctx, args) => {\n    return await ctx.db.patch(args.id, {\n      isArchived: true,\n      updatedAt: Date.now(),\n    });\n  },\n});\n\n// Delete a deal permanently\nexport const remove = mutation({\n  args: { id: v.id(\"colab_deals\") },\n  handler: async (ctx, args) => {\n    return await ctx.db.delete(args.id);\n  },\n});\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/CardModal.tsx"},"span":[1142,1145],"sourceCode":"import { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/tailwind/ui/dialog\";\nimport { Input } from \"@/components/tailwind/ui/input\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/tailwind/ui/popover\";\nimport { ScrollArea } from \"@/components/tailwind/ui/scroll-area\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { format } from \"date-fns\";\nimport { fr } from \"date-fns/locale\";\nimport { Activity, Calendar, CheckSquare, Clock, Tag } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\nconst KANBAN_STRINGS = {\n  addCard: \"Ajouter une carte\",\n  labels: \"Étiquettes\",\n  dueDate: \"Échéance\",\n  activity: \"Activité\",\n  move: \"Déplacer\",\n};\n\ninterface CardModalProps {\n  cardId: string;\n  open: boolean;\n  onClose: () => void;\n  boardLabels: any[];\n  boardId: Id<\"colab_boards\">;\n}\n\nexport function CardModal({ cardId, open, onClose, boardLabels, boardId }: CardModalProps) {\n  const { user } = useUser();\n  // @ts-ignore\n  const card = useQuery(api.boards.getCard, { cardId: cardId as Id<\"colab_cards\"> });\n  const updateCard = useMutation(api.boards.updateCard);\n  // @ts-ignore\n  const checklists = useQuery(api.boards.getChecklists, { cardId: cardId as Id<\"colab_cards\"> });\n  const addChecklist = useMutation(api.boards.addChecklist);\n  const deleteChecklist = useMutation(api.boards.deleteChecklist);\n  const addChecklistItem = useMutation(api.boards.addChecklistItem);\n  const toggleItem = useMutation(api.boards.toggleChecklistItem);\n  const deleteItem = useMutation(api.boards.deleteChecklistItem);\n  const addLabel = useMutation(api.boards.addLabel);\n  // @ts-ignore\n  const activities = useQuery(api.boards.getCardActivities, { cardId: cardId as Id<\"colab_cards\"> });\n\n  const [description, setDescription] = useState(\"\");\n  const [isEditingDesc, setIsEditingDesc] = useState(false);\n  const [newChecklistName, setNewChecklistName] = useState(\"\");\n  const [newItemContents, setNewItemContents] = useState<Record<string, string>>({});\n  const [newLabelName, setNewLabelName] = useState(\"\");\n  const [newLabelColor, setNewLabelColor] = useState(\"#EF4444\"); // Default red\n\n  useEffect(() => {\n    if (card) {\n      setDescription(card.description || \"\");\n    }\n  }, [card]);\n\n  const handleSaveDescription = async () => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, description, userId: user.id });\n    setIsEditingDesc(false);\n  };\n\n  const handleUpdateTitle = async (newTitle: string) => {\n    if (!user || !newTitle.trim()) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, title: newTitle, userId: user.id });\n  };\n\n  const handleAddChecklist = async () => {\n    if (!newChecklistName.trim()) return;\n    // @ts-ignore\n    await addChecklist({ name: newChecklistName, cardId: cardId as Id<\"colab_cards\"> });\n    setNewChecklistName(\"\");\n  };\n\n  const handleAddItem = async (checklistId: string) => {\n    const content = newItemContents[checklistId];\n    if (!content?.trim()) return;\n    // @ts-ignore\n    await addChecklistItem({ content, checklistId: checklistId as Id<\"colab_checklists\"> });\n    setNewItemContents((prev) => ({ ...prev, [checklistId]: \"\" }));\n  };\n\n  const toggleLabel = async (labelId: Id<\"colab_labels\">) => {\n    if (!card || !user) return;\n    const currentLabels = card.labelIds || [];\n    const newLabels = currentLabels.includes(labelId)\n      ? currentLabels.filter((id: string) => id !== labelId)\n      : [...currentLabels, labelId];\n\n    // @ts-ignore\n    await updateCard({ cardId: cardId, labelIds: newLabels, userId: user.id });\n  };\n\n  const handleCreateLabel = async () => {\n    if (!newLabelName.trim()) return;\n    // @ts-ignore\n    await addLabel({ name: newLabelName, colorCode: newLabelColor, boardId });\n    setNewLabelName(\"\");\n  };\n\n  const handleDateSelect = async (date: Date | undefined) => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId, dueDate: date ? date.getTime() : undefined, userId: user.id });\n  };\n\n  if (!card) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl h-[85vh] flex flex-col p-0 gap-0 overflow-hidden\">\n        {/* Banner if exists (future) */}\n        <div className=\"flex h-full\">\n          {/* Main Content */}\n          <div className=\"flex-1 flex flex-col h-full overflow-hidden border-r\">\n            <DialogHeader className=\"p-6 pb-2\">\n              <DialogTitle>\n                <Input\n                  value={card.title}\n                  onChange={(e) => handleUpdateTitle(e.target.value)} // Note: this will update on every keystroke which is bad. Ideally use onBlur.\n                  onBlur={(e) => handleUpdateTitle(e.target.value)}\n                  className=\"text-xl font-bold border-none shadow-none p-0 h-auto focus-visible:ring-0\"\n                />\n              </DialogTitle>\n              <div className=\"text-sm text-muted-foreground ml-1\">\n                dans la liste <span className=\"underline decoration-dotted\">Current List</span>\n              </div>\n            </DialogHeader>\n\n            <ScrollArea className=\"flex-1 p-6 pt-2\">\n              <div className=\"space-y-6\">\n                {/* Labels Display */}\n                {(card.labelIds?.length || 0) > 0 && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.labels}</h3>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {boardLabels\n                        .filter((l) => card.labelIds?.includes(l._id))\n                        .map((label) => (\n                          <Badge\n                            key={label._id}\n                            style={{ backgroundColor: label.colorCode }}\n                            className=\"hover:opacity-80 cursor-pointer text-white\"\n                          >\n                            {label.name}\n                          </Badge>\n                        ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Due Date Display */}\n                {card.dueDate && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.dueDate}</h3>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant=\"outline\"\n                        className={`flex gap-2 p-2 ${card.dueDate < Date.now() ? \"border-red-500 text-red-500 bg-red-50\" : \"\"}`}\n                      >\n                        <Clock className=\"h-4 w-4\" />\n                        {format(card.dueDate, \"d MMMM yyyy\", { locale: fr })}\n                        {card.dueDate < Date.now() && <span className=\"text-xs font-bold ml-1\">EN RETARD</span>}\n                      </Badge>\n                    </div>\n                  </div>\n                )}\n\n                {/* Description */}\n                <div className=\"space-y-2\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">Description</h3>\n                  {isEditingDesc ? (\n                    <div className=\"space-y-2\">\n                      <Textarea\n                        value={description}\n                        onChange={(e) => setDescription(e.target.value)}\n                        className=\"min-h-[100px]\"\n                        placeholder=\"Ajouter une description plus détaillée...\"\n                      />\n                      <div className=\"flex gap-2\">\n                        <Button size=\"sm\" onClick={handleSaveDescription}>\n                          Enregistrer\n                        </Button>\n                        <Button size=\"sm\" variant=\"ghost\" onClick={() => setIsEditingDesc(false)}>\n                          Annuler\n                        </Button>\n                      </div>\n                    </div>\n                  ) : (\n                    // biome-ignore lint/a11y/useKeyWithClickEvents: Interactive div is fine for this specific edit mode\n                    <div\n                      onClick={() => setIsEditingDesc(true)}\n                      className=\"min-h-[60px] p-3 rounded-md bg-muted/20 hover:bg-muted/50 cursor-pointer transition-all text-sm whitespace-pre-wrap\"\n                    >\n                      {card.description || (\n                        <span className=\"text-muted-foreground italic\">Ajouter une description...</span>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Checklists */}\n                <div className=\"space-y-4\">\n                  {checklists?.map((list: any) => {\n                    const progress = list.items?.length\n                      ? Math.round((list.items.filter((i: any) => i.completed).length / list.items.length) * 100)\n                      : 0;\n\n                    return (\n                      <div key={list._id} className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <h3 className=\"font-semibold flex items-center gap-2\">\n                            <CheckSquare className=\"h-4 w-4\" /> {list.name}\n                          </h3>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-6 text-red-500\"\n                            onClick={() => deleteChecklist({ checklistId: list._id })}\n                          >\n                            Supprimer\n                          </Button>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                          <span className=\"w-8\">{progress}%</span>\n                          <div className=\"h-1.5 flex-1 bg-muted rounded-full overflow-hidden\">\n                            <div\n                              className=\"h-full bg-primary transition-all duration-500\"\n                              style={{ width: `${progress}%` }}\n                            />\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-1\">\n                          {list.items?.map((item: any) => (\n                            <div\n                              key={item._id}\n                              className=\"flex items-center gap-2 group hover:bg-muted/20 p-1 rounded -mx-1\"\n                            >\n                              <input\n                                type=\"checkbox\"\n                                checked={item.completed}\n                                // @ts-ignore\n                                onChange={(e) => toggleItem({ itemId: item._id, completed: e.target.checked })}\n                                className=\"h-4 w-4 rounded border-gray-300 accent-primary\"\n                              />\n                              <span\n                                className={`flex-1 text-sm ${item.completed ? \"line-through text-muted-foreground\" : \"\"}`}\n                              >\n                                {item.content}\n                              </span>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-6 w-6 opacity-0 group-hover:opacity-100\"\n                                onClick={() => deleteItem({ itemId: item._id })}\n                              >\n                                <span className=\"sr-only\">Delete</span>\n                                <span aria-hidden=\"true\">×</span>\n                              </Button>\n                            </div>\n                          ))}\n                        </div>\n\n                        <div className=\"pl-6\">\n                          <div className=\"flex gap-2\">\n                            <Input\n                              placeholder=\"Ajouter un élément...\"\n                              value={newItemContents[list._id] || \"\"}\n                              onChange={(e) => setNewItemContents((prev) => ({ ...prev, [list._id]: e.target.value }))}\n                              onKeyDown={(e) => e.key === \"Enter\" && handleAddItem(list._id)}\n                              className=\"h-8 text-sm\"\n                            />\n                            <Button size=\"sm\" variant=\"secondary\" onClick={() => handleAddItem(list._id)}>\n                              Ajouter\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n\n                {/* Activity Log */}\n                <div className=\"space-y-4 pt-6\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">\n                    <Activity className=\"h-4 w-4\" /> {KANBAN_STRINGS.activity}\n                  </h3>\n                  <div className=\"space-y-3 pl-6\">\n                    {activities?.map((activity: any) => (\n                      <div key={activity._id} className=\"text-sm\">\n                        <span className=\"font-semibold\">Utilisateur</span>{\" \"}\n                        <span className=\"text-muted-foreground\">{activity.action}</span>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {format(activity.createdAt, \"d MMM yyyy 'à' HH:mm\", { locale: fr })}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </ScrollArea>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"w-60 bg-muted/10 p-4 space-y-6 border-l overflow-y-auto\">\n            <div className=\"space-y-2\">\n              <span className=\"text-xs font-semibold text-muted-foreground uppercase\">Ajouter à la carte</span>\n\n              {/* Labels Popover */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Tag className=\"h-4 w-4 mr-2\" /> {KANBAN_STRINGS.labels}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Étiquettes</h4>\n                    <div className=\"space-y-1\">\n                      {boardLabels.map((label) => (\n                        // biome-ignore lint/a11y/useKeyWithClickEvents: Button role\n                        <div\n                          key={label._id}\n                          className=\"flex items-center gap-2 p-1 hover:bg-muted rounded cursor-pointer\"\n                          onClick={() => toggleLabel(label._id)}\n                        >\n                          <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: label.colorCode }} />\n                          <span className=\"flex-1 text-sm\">{label.name}</span>\n                          {card.labelIds?.includes(label._id) && <span className=\"text-xs\">✓</span>}\n                        </div>\n                      ))}\n                    </div>\n                    <div className=\"pt-2 border-t space-y-2\">\n                      <Input\n                        placeholder=\"Nom...\"\n                        className=\"h-8 text-sm\"\n                        value={newLabelName}\n                        onChange={(e) => setNewLabelName(e.target.value)}\n                      />\n                      <div className=\"flex gap-1 justify-between\">\n                        {[\"#EF4444\", \"#F59E0B\", \"#10B981\", \"#3B82F6\", \"#6366F1\", \"#EC4899\"].map((color) => (\n                          // biome-ignore lint/a11y/useKeyWithClickEvents: Color picker\n                          <div\n                            key={color}\n                            className={`w-6 h-6 rounded-full cursor-pointer border-2 ${newLabelColor === color ? \"border-black\" : \"border-transparent\"}`}\n                            style={{ backgroundColor: color }}\n                            onClick={() => setNewLabelColor(color)}\n                          />\n                        ))}\n                      </div>\n                      <Button size=\"sm\" className=\"w-full\" onClick={handleCreateLabel} disabled={!newLabelName}>\n                        Créer\n                      </Button>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Checklist */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <CheckSquare className=\"h-4 w-4 mr-2\" /> Checklist\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Ajouter une checklist</h4>\n                    <Input\n                      placeholder=\"Nom de la checklist...\"\n                      value={newChecklistName}\n                      onChange={(e) => setNewChecklistName(e.target.value)}\n                      className=\"h-8\"\n                      autoFocus\n                    />\n                    <Button size=\"sm\" className=\"w-full\" onClick={handleAddChecklist} disabled={!newChecklistName}>\n                      Ajouter\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Due Date */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Calendar className=\"h-4 w-4 mr-2\" /> Dates\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  {/* Simple Calendar placeholder since I need to verify if we have a Calendar component */}\n                  <div className=\"p-4\">\n                    <input\n                      type=\"date\"\n                      className=\"border rounded p-1 block w-full\"\n                      onChange={(e) => handleDateSelect(e.target.valueAsDate || undefined)}\n                      value={card.dueDate ? new Date(card.dueDate).toISOString().split(\"T\")[0] : \"\"}\n                    />\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"w-full mt-2 text-red-500\"\n                      onClick={() => handleDateSelect(undefined)}\n                    >\n                      Retirer\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/CardModal.tsx"},"span":[9110,9113],"sourceCode":"import { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/tailwind/ui/dialog\";\nimport { Input } from \"@/components/tailwind/ui/input\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/tailwind/ui/popover\";\nimport { ScrollArea } from \"@/components/tailwind/ui/scroll-area\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { format } from \"date-fns\";\nimport { fr } from \"date-fns/locale\";\nimport { Activity, Calendar, CheckSquare, Clock, Tag } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\nconst KANBAN_STRINGS = {\n  addCard: \"Ajouter une carte\",\n  labels: \"Étiquettes\",\n  dueDate: \"Échéance\",\n  activity: \"Activité\",\n  move: \"Déplacer\",\n};\n\ninterface CardModalProps {\n  cardId: string;\n  open: boolean;\n  onClose: () => void;\n  boardLabels: any[];\n  boardId: Id<\"colab_boards\">;\n}\n\nexport function CardModal({ cardId, open, onClose, boardLabels, boardId }: CardModalProps) {\n  const { user } = useUser();\n  // @ts-ignore\n  const card = useQuery(api.boards.getCard, { cardId: cardId as Id<\"colab_cards\"> });\n  const updateCard = useMutation(api.boards.updateCard);\n  // @ts-ignore\n  const checklists = useQuery(api.boards.getChecklists, { cardId: cardId as Id<\"colab_cards\"> });\n  const addChecklist = useMutation(api.boards.addChecklist);\n  const deleteChecklist = useMutation(api.boards.deleteChecklist);\n  const addChecklistItem = useMutation(api.boards.addChecklistItem);\n  const toggleItem = useMutation(api.boards.toggleChecklistItem);\n  const deleteItem = useMutation(api.boards.deleteChecklistItem);\n  const addLabel = useMutation(api.boards.addLabel);\n  // @ts-ignore\n  const activities = useQuery(api.boards.getCardActivities, { cardId: cardId as Id<\"colab_cards\"> });\n\n  const [description, setDescription] = useState(\"\");\n  const [isEditingDesc, setIsEditingDesc] = useState(false);\n  const [newChecklistName, setNewChecklistName] = useState(\"\");\n  const [newItemContents, setNewItemContents] = useState<Record<string, string>>({});\n  const [newLabelName, setNewLabelName] = useState(\"\");\n  const [newLabelColor, setNewLabelColor] = useState(\"#EF4444\"); // Default red\n\n  useEffect(() => {\n    if (card) {\n      setDescription(card.description || \"\");\n    }\n  }, [card]);\n\n  const handleSaveDescription = async () => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, description, userId: user.id });\n    setIsEditingDesc(false);\n  };\n\n  const handleUpdateTitle = async (newTitle: string) => {\n    if (!user || !newTitle.trim()) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, title: newTitle, userId: user.id });\n  };\n\n  const handleAddChecklist = async () => {\n    if (!newChecklistName.trim()) return;\n    // @ts-ignore\n    await addChecklist({ name: newChecklistName, cardId: cardId as Id<\"colab_cards\"> });\n    setNewChecklistName(\"\");\n  };\n\n  const handleAddItem = async (checklistId: string) => {\n    const content = newItemContents[checklistId];\n    if (!content?.trim()) return;\n    // @ts-ignore\n    await addChecklistItem({ content, checklistId: checklistId as Id<\"colab_checklists\"> });\n    setNewItemContents((prev) => ({ ...prev, [checklistId]: \"\" }));\n  };\n\n  const toggleLabel = async (labelId: Id<\"colab_labels\">) => {\n    if (!card || !user) return;\n    const currentLabels = card.labelIds || [];\n    const newLabels = currentLabels.includes(labelId)\n      ? currentLabels.filter((id: string) => id !== labelId)\n      : [...currentLabels, labelId];\n\n    // @ts-ignore\n    await updateCard({ cardId: cardId, labelIds: newLabels, userId: user.id });\n  };\n\n  const handleCreateLabel = async () => {\n    if (!newLabelName.trim()) return;\n    // @ts-ignore\n    await addLabel({ name: newLabelName, colorCode: newLabelColor, boardId });\n    setNewLabelName(\"\");\n  };\n\n  const handleDateSelect = async (date: Date | undefined) => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId, dueDate: date ? date.getTime() : undefined, userId: user.id });\n  };\n\n  if (!card) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl h-[85vh] flex flex-col p-0 gap-0 overflow-hidden\">\n        {/* Banner if exists (future) */}\n        <div className=\"flex h-full\">\n          {/* Main Content */}\n          <div className=\"flex-1 flex flex-col h-full overflow-hidden border-r\">\n            <DialogHeader className=\"p-6 pb-2\">\n              <DialogTitle>\n                <Input\n                  value={card.title}\n                  onChange={(e) => handleUpdateTitle(e.target.value)} // Note: this will update on every keystroke which is bad. Ideally use onBlur.\n                  onBlur={(e) => handleUpdateTitle(e.target.value)}\n                  className=\"text-xl font-bold border-none shadow-none p-0 h-auto focus-visible:ring-0\"\n                />\n              </DialogTitle>\n              <div className=\"text-sm text-muted-foreground ml-1\">\n                dans la liste <span className=\"underline decoration-dotted\">Current List</span>\n              </div>\n            </DialogHeader>\n\n            <ScrollArea className=\"flex-1 p-6 pt-2\">\n              <div className=\"space-y-6\">\n                {/* Labels Display */}\n                {(card.labelIds?.length || 0) > 0 && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.labels}</h3>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {boardLabels\n                        .filter((l) => card.labelIds?.includes(l._id))\n                        .map((label) => (\n                          <Badge\n                            key={label._id}\n                            style={{ backgroundColor: label.colorCode }}\n                            className=\"hover:opacity-80 cursor-pointer text-white\"\n                          >\n                            {label.name}\n                          </Badge>\n                        ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Due Date Display */}\n                {card.dueDate && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.dueDate}</h3>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant=\"outline\"\n                        className={`flex gap-2 p-2 ${card.dueDate < Date.now() ? \"border-red-500 text-red-500 bg-red-50\" : \"\"}`}\n                      >\n                        <Clock className=\"h-4 w-4\" />\n                        {format(card.dueDate, \"d MMMM yyyy\", { locale: fr })}\n                        {card.dueDate < Date.now() && <span className=\"text-xs font-bold ml-1\">EN RETARD</span>}\n                      </Badge>\n                    </div>\n                  </div>\n                )}\n\n                {/* Description */}\n                <div className=\"space-y-2\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">Description</h3>\n                  {isEditingDesc ? (\n                    <div className=\"space-y-2\">\n                      <Textarea\n                        value={description}\n                        onChange={(e) => setDescription(e.target.value)}\n                        className=\"min-h-[100px]\"\n                        placeholder=\"Ajouter une description plus détaillée...\"\n                      />\n                      <div className=\"flex gap-2\">\n                        <Button size=\"sm\" onClick={handleSaveDescription}>\n                          Enregistrer\n                        </Button>\n                        <Button size=\"sm\" variant=\"ghost\" onClick={() => setIsEditingDesc(false)}>\n                          Annuler\n                        </Button>\n                      </div>\n                    </div>\n                  ) : (\n                    // biome-ignore lint/a11y/useKeyWithClickEvents: Interactive div is fine for this specific edit mode\n                    <div\n                      onClick={() => setIsEditingDesc(true)}\n                      className=\"min-h-[60px] p-3 rounded-md bg-muted/20 hover:bg-muted/50 cursor-pointer transition-all text-sm whitespace-pre-wrap\"\n                    >\n                      {card.description || (\n                        <span className=\"text-muted-foreground italic\">Ajouter une description...</span>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Checklists */}\n                <div className=\"space-y-4\">\n                  {checklists?.map((list: any) => {\n                    const progress = list.items?.length\n                      ? Math.round((list.items.filter((i: any) => i.completed).length / list.items.length) * 100)\n                      : 0;\n\n                    return (\n                      <div key={list._id} className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <h3 className=\"font-semibold flex items-center gap-2\">\n                            <CheckSquare className=\"h-4 w-4\" /> {list.name}\n                          </h3>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-6 text-red-500\"\n                            onClick={() => deleteChecklist({ checklistId: list._id })}\n                          >\n                            Supprimer\n                          </Button>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                          <span className=\"w-8\">{progress}%</span>\n                          <div className=\"h-1.5 flex-1 bg-muted rounded-full overflow-hidden\">\n                            <div\n                              className=\"h-full bg-primary transition-all duration-500\"\n                              style={{ width: `${progress}%` }}\n                            />\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-1\">\n                          {list.items?.map((item: any) => (\n                            <div\n                              key={item._id}\n                              className=\"flex items-center gap-2 group hover:bg-muted/20 p-1 rounded -mx-1\"\n                            >\n                              <input\n                                type=\"checkbox\"\n                                checked={item.completed}\n                                // @ts-ignore\n                                onChange={(e) => toggleItem({ itemId: item._id, completed: e.target.checked })}\n                                className=\"h-4 w-4 rounded border-gray-300 accent-primary\"\n                              />\n                              <span\n                                className={`flex-1 text-sm ${item.completed ? \"line-through text-muted-foreground\" : \"\"}`}\n                              >\n                                {item.content}\n                              </span>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-6 w-6 opacity-0 group-hover:opacity-100\"\n                                onClick={() => deleteItem({ itemId: item._id })}\n                              >\n                                <span className=\"sr-only\">Delete</span>\n                                <span aria-hidden=\"true\">×</span>\n                              </Button>\n                            </div>\n                          ))}\n                        </div>\n\n                        <div className=\"pl-6\">\n                          <div className=\"flex gap-2\">\n                            <Input\n                              placeholder=\"Ajouter un élément...\"\n                              value={newItemContents[list._id] || \"\"}\n                              onChange={(e) => setNewItemContents((prev) => ({ ...prev, [list._id]: e.target.value }))}\n                              onKeyDown={(e) => e.key === \"Enter\" && handleAddItem(list._id)}\n                              className=\"h-8 text-sm\"\n                            />\n                            <Button size=\"sm\" variant=\"secondary\" onClick={() => handleAddItem(list._id)}>\n                              Ajouter\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n\n                {/* Activity Log */}\n                <div className=\"space-y-4 pt-6\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">\n                    <Activity className=\"h-4 w-4\" /> {KANBAN_STRINGS.activity}\n                  </h3>\n                  <div className=\"space-y-3 pl-6\">\n                    {activities?.map((activity: any) => (\n                      <div key={activity._id} className=\"text-sm\">\n                        <span className=\"font-semibold\">Utilisateur</span>{\" \"}\n                        <span className=\"text-muted-foreground\">{activity.action}</span>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {format(activity.createdAt, \"d MMM yyyy 'à' HH:mm\", { locale: fr })}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </ScrollArea>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"w-60 bg-muted/10 p-4 space-y-6 border-l overflow-y-auto\">\n            <div className=\"space-y-2\">\n              <span className=\"text-xs font-semibold text-muted-foreground uppercase\">Ajouter à la carte</span>\n\n              {/* Labels Popover */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Tag className=\"h-4 w-4 mr-2\" /> {KANBAN_STRINGS.labels}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Étiquettes</h4>\n                    <div className=\"space-y-1\">\n                      {boardLabels.map((label) => (\n                        // biome-ignore lint/a11y/useKeyWithClickEvents: Button role\n                        <div\n                          key={label._id}\n                          className=\"flex items-center gap-2 p-1 hover:bg-muted rounded cursor-pointer\"\n                          onClick={() => toggleLabel(label._id)}\n                        >\n                          <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: label.colorCode }} />\n                          <span className=\"flex-1 text-sm\">{label.name}</span>\n                          {card.labelIds?.includes(label._id) && <span className=\"text-xs\">✓</span>}\n                        </div>\n                      ))}\n                    </div>\n                    <div className=\"pt-2 border-t space-y-2\">\n                      <Input\n                        placeholder=\"Nom...\"\n                        className=\"h-8 text-sm\"\n                        value={newLabelName}\n                        onChange={(e) => setNewLabelName(e.target.value)}\n                      />\n                      <div className=\"flex gap-1 justify-between\">\n                        {[\"#EF4444\", \"#F59E0B\", \"#10B981\", \"#3B82F6\", \"#6366F1\", \"#EC4899\"].map((color) => (\n                          // biome-ignore lint/a11y/useKeyWithClickEvents: Color picker\n                          <div\n                            key={color}\n                            className={`w-6 h-6 rounded-full cursor-pointer border-2 ${newLabelColor === color ? \"border-black\" : \"border-transparent\"}`}\n                            style={{ backgroundColor: color }}\n                            onClick={() => setNewLabelColor(color)}\n                          />\n                        ))}\n                      </div>\n                      <Button size=\"sm\" className=\"w-full\" onClick={handleCreateLabel} disabled={!newLabelName}>\n                        Créer\n                      </Button>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Checklist */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <CheckSquare className=\"h-4 w-4 mr-2\" /> Checklist\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Ajouter une checklist</h4>\n                    <Input\n                      placeholder=\"Nom de la checklist...\"\n                      value={newChecklistName}\n                      onChange={(e) => setNewChecklistName(e.target.value)}\n                      className=\"h-8\"\n                      autoFocus\n                    />\n                    <Button size=\"sm\" className=\"w-full\" onClick={handleAddChecklist} disabled={!newChecklistName}>\n                      Ajouter\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Due Date */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Calendar className=\"h-4 w-4 mr-2\" /> Dates\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  {/* Simple Calendar placeholder since I need to verify if we have a Calendar component */}\n                  <div className=\"p-4\">\n                    <input\n                      type=\"date\"\n                      className=\"border rounded p-1 block w-full\"\n                      onChange={(e) => handleDateSelect(e.target.valueAsDate || undefined)}\n                      value={card.dueDate ? new Date(card.dueDate).toISOString().split(\"T\")[0] : \"\"}\n                    />\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"w-full mt-2 text-red-500\"\n                      onClick={() => handleDateSelect(undefined)}\n                    >\n                      Retirer\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/CardModal.tsx"},"span":[9234,9237],"sourceCode":"import { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/tailwind/ui/dialog\";\nimport { Input } from \"@/components/tailwind/ui/input\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/tailwind/ui/popover\";\nimport { ScrollArea } from \"@/components/tailwind/ui/scroll-area\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { format } from \"date-fns\";\nimport { fr } from \"date-fns/locale\";\nimport { Activity, Calendar, CheckSquare, Clock, Tag } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\nconst KANBAN_STRINGS = {\n  addCard: \"Ajouter une carte\",\n  labels: \"Étiquettes\",\n  dueDate: \"Échéance\",\n  activity: \"Activité\",\n  move: \"Déplacer\",\n};\n\ninterface CardModalProps {\n  cardId: string;\n  open: boolean;\n  onClose: () => void;\n  boardLabels: any[];\n  boardId: Id<\"colab_boards\">;\n}\n\nexport function CardModal({ cardId, open, onClose, boardLabels, boardId }: CardModalProps) {\n  const { user } = useUser();\n  // @ts-ignore\n  const card = useQuery(api.boards.getCard, { cardId: cardId as Id<\"colab_cards\"> });\n  const updateCard = useMutation(api.boards.updateCard);\n  // @ts-ignore\n  const checklists = useQuery(api.boards.getChecklists, { cardId: cardId as Id<\"colab_cards\"> });\n  const addChecklist = useMutation(api.boards.addChecklist);\n  const deleteChecklist = useMutation(api.boards.deleteChecklist);\n  const addChecklistItem = useMutation(api.boards.addChecklistItem);\n  const toggleItem = useMutation(api.boards.toggleChecklistItem);\n  const deleteItem = useMutation(api.boards.deleteChecklistItem);\n  const addLabel = useMutation(api.boards.addLabel);\n  // @ts-ignore\n  const activities = useQuery(api.boards.getCardActivities, { cardId: cardId as Id<\"colab_cards\"> });\n\n  const [description, setDescription] = useState(\"\");\n  const [isEditingDesc, setIsEditingDesc] = useState(false);\n  const [newChecklistName, setNewChecklistName] = useState(\"\");\n  const [newItemContents, setNewItemContents] = useState<Record<string, string>>({});\n  const [newLabelName, setNewLabelName] = useState(\"\");\n  const [newLabelColor, setNewLabelColor] = useState(\"#EF4444\"); // Default red\n\n  useEffect(() => {\n    if (card) {\n      setDescription(card.description || \"\");\n    }\n  }, [card]);\n\n  const handleSaveDescription = async () => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, description, userId: user.id });\n    setIsEditingDesc(false);\n  };\n\n  const handleUpdateTitle = async (newTitle: string) => {\n    if (!user || !newTitle.trim()) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, title: newTitle, userId: user.id });\n  };\n\n  const handleAddChecklist = async () => {\n    if (!newChecklistName.trim()) return;\n    // @ts-ignore\n    await addChecklist({ name: newChecklistName, cardId: cardId as Id<\"colab_cards\"> });\n    setNewChecklistName(\"\");\n  };\n\n  const handleAddItem = async (checklistId: string) => {\n    const content = newItemContents[checklistId];\n    if (!content?.trim()) return;\n    // @ts-ignore\n    await addChecklistItem({ content, checklistId: checklistId as Id<\"colab_checklists\"> });\n    setNewItemContents((prev) => ({ ...prev, [checklistId]: \"\" }));\n  };\n\n  const toggleLabel = async (labelId: Id<\"colab_labels\">) => {\n    if (!card || !user) return;\n    const currentLabels = card.labelIds || [];\n    const newLabels = currentLabels.includes(labelId)\n      ? currentLabels.filter((id: string) => id !== labelId)\n      : [...currentLabels, labelId];\n\n    // @ts-ignore\n    await updateCard({ cardId: cardId, labelIds: newLabels, userId: user.id });\n  };\n\n  const handleCreateLabel = async () => {\n    if (!newLabelName.trim()) return;\n    // @ts-ignore\n    await addLabel({ name: newLabelName, colorCode: newLabelColor, boardId });\n    setNewLabelName(\"\");\n  };\n\n  const handleDateSelect = async (date: Date | undefined) => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId, dueDate: date ? date.getTime() : undefined, userId: user.id });\n  };\n\n  if (!card) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl h-[85vh] flex flex-col p-0 gap-0 overflow-hidden\">\n        {/* Banner if exists (future) */}\n        <div className=\"flex h-full\">\n          {/* Main Content */}\n          <div className=\"flex-1 flex flex-col h-full overflow-hidden border-r\">\n            <DialogHeader className=\"p-6 pb-2\">\n              <DialogTitle>\n                <Input\n                  value={card.title}\n                  onChange={(e) => handleUpdateTitle(e.target.value)} // Note: this will update on every keystroke which is bad. Ideally use onBlur.\n                  onBlur={(e) => handleUpdateTitle(e.target.value)}\n                  className=\"text-xl font-bold border-none shadow-none p-0 h-auto focus-visible:ring-0\"\n                />\n              </DialogTitle>\n              <div className=\"text-sm text-muted-foreground ml-1\">\n                dans la liste <span className=\"underline decoration-dotted\">Current List</span>\n              </div>\n            </DialogHeader>\n\n            <ScrollArea className=\"flex-1 p-6 pt-2\">\n              <div className=\"space-y-6\">\n                {/* Labels Display */}\n                {(card.labelIds?.length || 0) > 0 && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.labels}</h3>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {boardLabels\n                        .filter((l) => card.labelIds?.includes(l._id))\n                        .map((label) => (\n                          <Badge\n                            key={label._id}\n                            style={{ backgroundColor: label.colorCode }}\n                            className=\"hover:opacity-80 cursor-pointer text-white\"\n                          >\n                            {label.name}\n                          </Badge>\n                        ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Due Date Display */}\n                {card.dueDate && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.dueDate}</h3>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant=\"outline\"\n                        className={`flex gap-2 p-2 ${card.dueDate < Date.now() ? \"border-red-500 text-red-500 bg-red-50\" : \"\"}`}\n                      >\n                        <Clock className=\"h-4 w-4\" />\n                        {format(card.dueDate, \"d MMMM yyyy\", { locale: fr })}\n                        {card.dueDate < Date.now() && <span className=\"text-xs font-bold ml-1\">EN RETARD</span>}\n                      </Badge>\n                    </div>\n                  </div>\n                )}\n\n                {/* Description */}\n                <div className=\"space-y-2\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">Description</h3>\n                  {isEditingDesc ? (\n                    <div className=\"space-y-2\">\n                      <Textarea\n                        value={description}\n                        onChange={(e) => setDescription(e.target.value)}\n                        className=\"min-h-[100px]\"\n                        placeholder=\"Ajouter une description plus détaillée...\"\n                      />\n                      <div className=\"flex gap-2\">\n                        <Button size=\"sm\" onClick={handleSaveDescription}>\n                          Enregistrer\n                        </Button>\n                        <Button size=\"sm\" variant=\"ghost\" onClick={() => setIsEditingDesc(false)}>\n                          Annuler\n                        </Button>\n                      </div>\n                    </div>\n                  ) : (\n                    // biome-ignore lint/a11y/useKeyWithClickEvents: Interactive div is fine for this specific edit mode\n                    <div\n                      onClick={() => setIsEditingDesc(true)}\n                      className=\"min-h-[60px] p-3 rounded-md bg-muted/20 hover:bg-muted/50 cursor-pointer transition-all text-sm whitespace-pre-wrap\"\n                    >\n                      {card.description || (\n                        <span className=\"text-muted-foreground italic\">Ajouter une description...</span>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Checklists */}\n                <div className=\"space-y-4\">\n                  {checklists?.map((list: any) => {\n                    const progress = list.items?.length\n                      ? Math.round((list.items.filter((i: any) => i.completed).length / list.items.length) * 100)\n                      : 0;\n\n                    return (\n                      <div key={list._id} className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <h3 className=\"font-semibold flex items-center gap-2\">\n                            <CheckSquare className=\"h-4 w-4\" /> {list.name}\n                          </h3>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-6 text-red-500\"\n                            onClick={() => deleteChecklist({ checklistId: list._id })}\n                          >\n                            Supprimer\n                          </Button>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                          <span className=\"w-8\">{progress}%</span>\n                          <div className=\"h-1.5 flex-1 bg-muted rounded-full overflow-hidden\">\n                            <div\n                              className=\"h-full bg-primary transition-all duration-500\"\n                              style={{ width: `${progress}%` }}\n                            />\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-1\">\n                          {list.items?.map((item: any) => (\n                            <div\n                              key={item._id}\n                              className=\"flex items-center gap-2 group hover:bg-muted/20 p-1 rounded -mx-1\"\n                            >\n                              <input\n                                type=\"checkbox\"\n                                checked={item.completed}\n                                // @ts-ignore\n                                onChange={(e) => toggleItem({ itemId: item._id, completed: e.target.checked })}\n                                className=\"h-4 w-4 rounded border-gray-300 accent-primary\"\n                              />\n                              <span\n                                className={`flex-1 text-sm ${item.completed ? \"line-through text-muted-foreground\" : \"\"}`}\n                              >\n                                {item.content}\n                              </span>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-6 w-6 opacity-0 group-hover:opacity-100\"\n                                onClick={() => deleteItem({ itemId: item._id })}\n                              >\n                                <span className=\"sr-only\">Delete</span>\n                                <span aria-hidden=\"true\">×</span>\n                              </Button>\n                            </div>\n                          ))}\n                        </div>\n\n                        <div className=\"pl-6\">\n                          <div className=\"flex gap-2\">\n                            <Input\n                              placeholder=\"Ajouter un élément...\"\n                              value={newItemContents[list._id] || \"\"}\n                              onChange={(e) => setNewItemContents((prev) => ({ ...prev, [list._id]: e.target.value }))}\n                              onKeyDown={(e) => e.key === \"Enter\" && handleAddItem(list._id)}\n                              className=\"h-8 text-sm\"\n                            />\n                            <Button size=\"sm\" variant=\"secondary\" onClick={() => handleAddItem(list._id)}>\n                              Ajouter\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n\n                {/* Activity Log */}\n                <div className=\"space-y-4 pt-6\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">\n                    <Activity className=\"h-4 w-4\" /> {KANBAN_STRINGS.activity}\n                  </h3>\n                  <div className=\"space-y-3 pl-6\">\n                    {activities?.map((activity: any) => (\n                      <div key={activity._id} className=\"text-sm\">\n                        <span className=\"font-semibold\">Utilisateur</span>{\" \"}\n                        <span className=\"text-muted-foreground\">{activity.action}</span>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {format(activity.createdAt, \"d MMM yyyy 'à' HH:mm\", { locale: fr })}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </ScrollArea>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"w-60 bg-muted/10 p-4 space-y-6 border-l overflow-y-auto\">\n            <div className=\"space-y-2\">\n              <span className=\"text-xs font-semibold text-muted-foreground uppercase\">Ajouter à la carte</span>\n\n              {/* Labels Popover */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Tag className=\"h-4 w-4 mr-2\" /> {KANBAN_STRINGS.labels}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Étiquettes</h4>\n                    <div className=\"space-y-1\">\n                      {boardLabels.map((label) => (\n                        // biome-ignore lint/a11y/useKeyWithClickEvents: Button role\n                        <div\n                          key={label._id}\n                          className=\"flex items-center gap-2 p-1 hover:bg-muted rounded cursor-pointer\"\n                          onClick={() => toggleLabel(label._id)}\n                        >\n                          <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: label.colorCode }} />\n                          <span className=\"flex-1 text-sm\">{label.name}</span>\n                          {card.labelIds?.includes(label._id) && <span className=\"text-xs\">✓</span>}\n                        </div>\n                      ))}\n                    </div>\n                    <div className=\"pt-2 border-t space-y-2\">\n                      <Input\n                        placeholder=\"Nom...\"\n                        className=\"h-8 text-sm\"\n                        value={newLabelName}\n                        onChange={(e) => setNewLabelName(e.target.value)}\n                      />\n                      <div className=\"flex gap-1 justify-between\">\n                        {[\"#EF4444\", \"#F59E0B\", \"#10B981\", \"#3B82F6\", \"#6366F1\", \"#EC4899\"].map((color) => (\n                          // biome-ignore lint/a11y/useKeyWithClickEvents: Color picker\n                          <div\n                            key={color}\n                            className={`w-6 h-6 rounded-full cursor-pointer border-2 ${newLabelColor === color ? \"border-black\" : \"border-transparent\"}`}\n                            style={{ backgroundColor: color }}\n                            onClick={() => setNewLabelColor(color)}\n                          />\n                        ))}\n                      </div>\n                      <Button size=\"sm\" className=\"w-full\" onClick={handleCreateLabel} disabled={!newLabelName}>\n                        Créer\n                      </Button>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Checklist */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <CheckSquare className=\"h-4 w-4 mr-2\" /> Checklist\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Ajouter une checklist</h4>\n                    <Input\n                      placeholder=\"Nom de la checklist...\"\n                      value={newChecklistName}\n                      onChange={(e) => setNewChecklistName(e.target.value)}\n                      className=\"h-8\"\n                      autoFocus\n                    />\n                    <Button size=\"sm\" className=\"w-full\" onClick={handleAddChecklist} disabled={!newChecklistName}>\n                      Ajouter\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Due Date */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Calendar className=\"h-4 w-4 mr-2\" /> Dates\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  {/* Simple Calendar placeholder since I need to verify if we have a Calendar component */}\n                  <div className=\"p-4\">\n                    <input\n                      type=\"date\"\n                      className=\"border rounded p-1 block w-full\"\n                      onChange={(e) => handleDateSelect(e.target.valueAsDate || undefined)}\n                      value={card.dueDate ? new Date(card.dueDate).toISOString().split(\"T\")[0] : \"\"}\n                    />\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"w-full mt-2 text-red-500\"\n                      onClick={() => handleDateSelect(undefined)}\n                    >\n                      Retirer\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/CardModal.tsx"},"span":[10712,10715],"sourceCode":"import { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/tailwind/ui/dialog\";\nimport { Input } from \"@/components/tailwind/ui/input\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/tailwind/ui/popover\";\nimport { ScrollArea } from \"@/components/tailwind/ui/scroll-area\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { format } from \"date-fns\";\nimport { fr } from \"date-fns/locale\";\nimport { Activity, Calendar, CheckSquare, Clock, Tag } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\nconst KANBAN_STRINGS = {\n  addCard: \"Ajouter une carte\",\n  labels: \"Étiquettes\",\n  dueDate: \"Échéance\",\n  activity: \"Activité\",\n  move: \"Déplacer\",\n};\n\ninterface CardModalProps {\n  cardId: string;\n  open: boolean;\n  onClose: () => void;\n  boardLabels: any[];\n  boardId: Id<\"colab_boards\">;\n}\n\nexport function CardModal({ cardId, open, onClose, boardLabels, boardId }: CardModalProps) {\n  const { user } = useUser();\n  // @ts-ignore\n  const card = useQuery(api.boards.getCard, { cardId: cardId as Id<\"colab_cards\"> });\n  const updateCard = useMutation(api.boards.updateCard);\n  // @ts-ignore\n  const checklists = useQuery(api.boards.getChecklists, { cardId: cardId as Id<\"colab_cards\"> });\n  const addChecklist = useMutation(api.boards.addChecklist);\n  const deleteChecklist = useMutation(api.boards.deleteChecklist);\n  const addChecklistItem = useMutation(api.boards.addChecklistItem);\n  const toggleItem = useMutation(api.boards.toggleChecklistItem);\n  const deleteItem = useMutation(api.boards.deleteChecklistItem);\n  const addLabel = useMutation(api.boards.addLabel);\n  // @ts-ignore\n  const activities = useQuery(api.boards.getCardActivities, { cardId: cardId as Id<\"colab_cards\"> });\n\n  const [description, setDescription] = useState(\"\");\n  const [isEditingDesc, setIsEditingDesc] = useState(false);\n  const [newChecklistName, setNewChecklistName] = useState(\"\");\n  const [newItemContents, setNewItemContents] = useState<Record<string, string>>({});\n  const [newLabelName, setNewLabelName] = useState(\"\");\n  const [newLabelColor, setNewLabelColor] = useState(\"#EF4444\"); // Default red\n\n  useEffect(() => {\n    if (card) {\n      setDescription(card.description || \"\");\n    }\n  }, [card]);\n\n  const handleSaveDescription = async () => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, description, userId: user.id });\n    setIsEditingDesc(false);\n  };\n\n  const handleUpdateTitle = async (newTitle: string) => {\n    if (!user || !newTitle.trim()) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, title: newTitle, userId: user.id });\n  };\n\n  const handleAddChecklist = async () => {\n    if (!newChecklistName.trim()) return;\n    // @ts-ignore\n    await addChecklist({ name: newChecklistName, cardId: cardId as Id<\"colab_cards\"> });\n    setNewChecklistName(\"\");\n  };\n\n  const handleAddItem = async (checklistId: string) => {\n    const content = newItemContents[checklistId];\n    if (!content?.trim()) return;\n    // @ts-ignore\n    await addChecklistItem({ content, checklistId: checklistId as Id<\"colab_checklists\"> });\n    setNewItemContents((prev) => ({ ...prev, [checklistId]: \"\" }));\n  };\n\n  const toggleLabel = async (labelId: Id<\"colab_labels\">) => {\n    if (!card || !user) return;\n    const currentLabels = card.labelIds || [];\n    const newLabels = currentLabels.includes(labelId)\n      ? currentLabels.filter((id: string) => id !== labelId)\n      : [...currentLabels, labelId];\n\n    // @ts-ignore\n    await updateCard({ cardId: cardId, labelIds: newLabels, userId: user.id });\n  };\n\n  const handleCreateLabel = async () => {\n    if (!newLabelName.trim()) return;\n    // @ts-ignore\n    await addLabel({ name: newLabelName, colorCode: newLabelColor, boardId });\n    setNewLabelName(\"\");\n  };\n\n  const handleDateSelect = async (date: Date | undefined) => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId, dueDate: date ? date.getTime() : undefined, userId: user.id });\n  };\n\n  if (!card) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl h-[85vh] flex flex-col p-0 gap-0 overflow-hidden\">\n        {/* Banner if exists (future) */}\n        <div className=\"flex h-full\">\n          {/* Main Content */}\n          <div className=\"flex-1 flex flex-col h-full overflow-hidden border-r\">\n            <DialogHeader className=\"p-6 pb-2\">\n              <DialogTitle>\n                <Input\n                  value={card.title}\n                  onChange={(e) => handleUpdateTitle(e.target.value)} // Note: this will update on every keystroke which is bad. Ideally use onBlur.\n                  onBlur={(e) => handleUpdateTitle(e.target.value)}\n                  className=\"text-xl font-bold border-none shadow-none p-0 h-auto focus-visible:ring-0\"\n                />\n              </DialogTitle>\n              <div className=\"text-sm text-muted-foreground ml-1\">\n                dans la liste <span className=\"underline decoration-dotted\">Current List</span>\n              </div>\n            </DialogHeader>\n\n            <ScrollArea className=\"flex-1 p-6 pt-2\">\n              <div className=\"space-y-6\">\n                {/* Labels Display */}\n                {(card.labelIds?.length || 0) > 0 && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.labels}</h3>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {boardLabels\n                        .filter((l) => card.labelIds?.includes(l._id))\n                        .map((label) => (\n                          <Badge\n                            key={label._id}\n                            style={{ backgroundColor: label.colorCode }}\n                            className=\"hover:opacity-80 cursor-pointer text-white\"\n                          >\n                            {label.name}\n                          </Badge>\n                        ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Due Date Display */}\n                {card.dueDate && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.dueDate}</h3>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant=\"outline\"\n                        className={`flex gap-2 p-2 ${card.dueDate < Date.now() ? \"border-red-500 text-red-500 bg-red-50\" : \"\"}`}\n                      >\n                        <Clock className=\"h-4 w-4\" />\n                        {format(card.dueDate, \"d MMMM yyyy\", { locale: fr })}\n                        {card.dueDate < Date.now() && <span className=\"text-xs font-bold ml-1\">EN RETARD</span>}\n                      </Badge>\n                    </div>\n                  </div>\n                )}\n\n                {/* Description */}\n                <div className=\"space-y-2\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">Description</h3>\n                  {isEditingDesc ? (\n                    <div className=\"space-y-2\">\n                      <Textarea\n                        value={description}\n                        onChange={(e) => setDescription(e.target.value)}\n                        className=\"min-h-[100px]\"\n                        placeholder=\"Ajouter une description plus détaillée...\"\n                      />\n                      <div className=\"flex gap-2\">\n                        <Button size=\"sm\" onClick={handleSaveDescription}>\n                          Enregistrer\n                        </Button>\n                        <Button size=\"sm\" variant=\"ghost\" onClick={() => setIsEditingDesc(false)}>\n                          Annuler\n                        </Button>\n                      </div>\n                    </div>\n                  ) : (\n                    // biome-ignore lint/a11y/useKeyWithClickEvents: Interactive div is fine for this specific edit mode\n                    <div\n                      onClick={() => setIsEditingDesc(true)}\n                      className=\"min-h-[60px] p-3 rounded-md bg-muted/20 hover:bg-muted/50 cursor-pointer transition-all text-sm whitespace-pre-wrap\"\n                    >\n                      {card.description || (\n                        <span className=\"text-muted-foreground italic\">Ajouter une description...</span>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Checklists */}\n                <div className=\"space-y-4\">\n                  {checklists?.map((list: any) => {\n                    const progress = list.items?.length\n                      ? Math.round((list.items.filter((i: any) => i.completed).length / list.items.length) * 100)\n                      : 0;\n\n                    return (\n                      <div key={list._id} className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <h3 className=\"font-semibold flex items-center gap-2\">\n                            <CheckSquare className=\"h-4 w-4\" /> {list.name}\n                          </h3>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-6 text-red-500\"\n                            onClick={() => deleteChecklist({ checklistId: list._id })}\n                          >\n                            Supprimer\n                          </Button>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                          <span className=\"w-8\">{progress}%</span>\n                          <div className=\"h-1.5 flex-1 bg-muted rounded-full overflow-hidden\">\n                            <div\n                              className=\"h-full bg-primary transition-all duration-500\"\n                              style={{ width: `${progress}%` }}\n                            />\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-1\">\n                          {list.items?.map((item: any) => (\n                            <div\n                              key={item._id}\n                              className=\"flex items-center gap-2 group hover:bg-muted/20 p-1 rounded -mx-1\"\n                            >\n                              <input\n                                type=\"checkbox\"\n                                checked={item.completed}\n                                // @ts-ignore\n                                onChange={(e) => toggleItem({ itemId: item._id, completed: e.target.checked })}\n                                className=\"h-4 w-4 rounded border-gray-300 accent-primary\"\n                              />\n                              <span\n                                className={`flex-1 text-sm ${item.completed ? \"line-through text-muted-foreground\" : \"\"}`}\n                              >\n                                {item.content}\n                              </span>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-6 w-6 opacity-0 group-hover:opacity-100\"\n                                onClick={() => deleteItem({ itemId: item._id })}\n                              >\n                                <span className=\"sr-only\">Delete</span>\n                                <span aria-hidden=\"true\">×</span>\n                              </Button>\n                            </div>\n                          ))}\n                        </div>\n\n                        <div className=\"pl-6\">\n                          <div className=\"flex gap-2\">\n                            <Input\n                              placeholder=\"Ajouter un élément...\"\n                              value={newItemContents[list._id] || \"\"}\n                              onChange={(e) => setNewItemContents((prev) => ({ ...prev, [list._id]: e.target.value }))}\n                              onKeyDown={(e) => e.key === \"Enter\" && handleAddItem(list._id)}\n                              className=\"h-8 text-sm\"\n                            />\n                            <Button size=\"sm\" variant=\"secondary\" onClick={() => handleAddItem(list._id)}>\n                              Ajouter\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n\n                {/* Activity Log */}\n                <div className=\"space-y-4 pt-6\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">\n                    <Activity className=\"h-4 w-4\" /> {KANBAN_STRINGS.activity}\n                  </h3>\n                  <div className=\"space-y-3 pl-6\">\n                    {activities?.map((activity: any) => (\n                      <div key={activity._id} className=\"text-sm\">\n                        <span className=\"font-semibold\">Utilisateur</span>{\" \"}\n                        <span className=\"text-muted-foreground\">{activity.action}</span>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {format(activity.createdAt, \"d MMM yyyy 'à' HH:mm\", { locale: fr })}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </ScrollArea>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"w-60 bg-muted/10 p-4 space-y-6 border-l overflow-y-auto\">\n            <div className=\"space-y-2\">\n              <span className=\"text-xs font-semibold text-muted-foreground uppercase\">Ajouter à la carte</span>\n\n              {/* Labels Popover */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Tag className=\"h-4 w-4 mr-2\" /> {KANBAN_STRINGS.labels}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Étiquettes</h4>\n                    <div className=\"space-y-1\">\n                      {boardLabels.map((label) => (\n                        // biome-ignore lint/a11y/useKeyWithClickEvents: Button role\n                        <div\n                          key={label._id}\n                          className=\"flex items-center gap-2 p-1 hover:bg-muted rounded cursor-pointer\"\n                          onClick={() => toggleLabel(label._id)}\n                        >\n                          <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: label.colorCode }} />\n                          <span className=\"flex-1 text-sm\">{label.name}</span>\n                          {card.labelIds?.includes(label._id) && <span className=\"text-xs\">✓</span>}\n                        </div>\n                      ))}\n                    </div>\n                    <div className=\"pt-2 border-t space-y-2\">\n                      <Input\n                        placeholder=\"Nom...\"\n                        className=\"h-8 text-sm\"\n                        value={newLabelName}\n                        onChange={(e) => setNewLabelName(e.target.value)}\n                      />\n                      <div className=\"flex gap-1 justify-between\">\n                        {[\"#EF4444\", \"#F59E0B\", \"#10B981\", \"#3B82F6\", \"#6366F1\", \"#EC4899\"].map((color) => (\n                          // biome-ignore lint/a11y/useKeyWithClickEvents: Color picker\n                          <div\n                            key={color}\n                            className={`w-6 h-6 rounded-full cursor-pointer border-2 ${newLabelColor === color ? \"border-black\" : \"border-transparent\"}`}\n                            style={{ backgroundColor: color }}\n                            onClick={() => setNewLabelColor(color)}\n                          />\n                        ))}\n                      </div>\n                      <Button size=\"sm\" className=\"w-full\" onClick={handleCreateLabel} disabled={!newLabelName}>\n                        Créer\n                      </Button>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Checklist */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <CheckSquare className=\"h-4 w-4 mr-2\" /> Checklist\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Ajouter une checklist</h4>\n                    <Input\n                      placeholder=\"Nom de la checklist...\"\n                      value={newChecklistName}\n                      onChange={(e) => setNewChecklistName(e.target.value)}\n                      className=\"h-8\"\n                      autoFocus\n                    />\n                    <Button size=\"sm\" className=\"w-full\" onClick={handleAddChecklist} disabled={!newChecklistName}>\n                      Ajouter\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Due Date */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Calendar className=\"h-4 w-4 mr-2\" /> Dates\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  {/* Simple Calendar placeholder since I need to verify if we have a Calendar component */}\n                  <div className=\"p-4\">\n                    <input\n                      type=\"date\"\n                      className=\"border rounded p-1 block w-full\"\n                      onChange={(e) => handleDateSelect(e.target.valueAsDate || undefined)}\n                      value={card.dueDate ? new Date(card.dueDate).toISOString().split(\"T\")[0] : \"\"}\n                    />\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"w-full mt-2 text-red-500\"\n                      onClick={() => handleDateSelect(undefined)}\n                    >\n                      Retirer\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/CardModal.tsx"},"span":[13523,13526],"sourceCode":"import { Badge } from \"@/components/tailwind/ui/badge\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/tailwind/ui/dialog\";\nimport { Input } from \"@/components/tailwind/ui/input\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/tailwind/ui/popover\";\nimport { ScrollArea } from \"@/components/tailwind/ui/scroll-area\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { format } from \"date-fns\";\nimport { fr } from \"date-fns/locale\";\nimport { Activity, Calendar, CheckSquare, Clock, Tag } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\nconst KANBAN_STRINGS = {\n  addCard: \"Ajouter une carte\",\n  labels: \"Étiquettes\",\n  dueDate: \"Échéance\",\n  activity: \"Activité\",\n  move: \"Déplacer\",\n};\n\ninterface CardModalProps {\n  cardId: string;\n  open: boolean;\n  onClose: () => void;\n  boardLabels: any[];\n  boardId: Id<\"colab_boards\">;\n}\n\nexport function CardModal({ cardId, open, onClose, boardLabels, boardId }: CardModalProps) {\n  const { user } = useUser();\n  // @ts-ignore\n  const card = useQuery(api.boards.getCard, { cardId: cardId as Id<\"colab_cards\"> });\n  const updateCard = useMutation(api.boards.updateCard);\n  // @ts-ignore\n  const checklists = useQuery(api.boards.getChecklists, { cardId: cardId as Id<\"colab_cards\"> });\n  const addChecklist = useMutation(api.boards.addChecklist);\n  const deleteChecklist = useMutation(api.boards.deleteChecklist);\n  const addChecklistItem = useMutation(api.boards.addChecklistItem);\n  const toggleItem = useMutation(api.boards.toggleChecklistItem);\n  const deleteItem = useMutation(api.boards.deleteChecklistItem);\n  const addLabel = useMutation(api.boards.addLabel);\n  // @ts-ignore\n  const activities = useQuery(api.boards.getCardActivities, { cardId: cardId as Id<\"colab_cards\"> });\n\n  const [description, setDescription] = useState(\"\");\n  const [isEditingDesc, setIsEditingDesc] = useState(false);\n  const [newChecklistName, setNewChecklistName] = useState(\"\");\n  const [newItemContents, setNewItemContents] = useState<Record<string, string>>({});\n  const [newLabelName, setNewLabelName] = useState(\"\");\n  const [newLabelColor, setNewLabelColor] = useState(\"#EF4444\"); // Default red\n\n  useEffect(() => {\n    if (card) {\n      setDescription(card.description || \"\");\n    }\n  }, [card]);\n\n  const handleSaveDescription = async () => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, description, userId: user.id });\n    setIsEditingDesc(false);\n  };\n\n  const handleUpdateTitle = async (newTitle: string) => {\n    if (!user || !newTitle.trim()) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId as Id<\"colab_cards\">, title: newTitle, userId: user.id });\n  };\n\n  const handleAddChecklist = async () => {\n    if (!newChecklistName.trim()) return;\n    // @ts-ignore\n    await addChecklist({ name: newChecklistName, cardId: cardId as Id<\"colab_cards\"> });\n    setNewChecklistName(\"\");\n  };\n\n  const handleAddItem = async (checklistId: string) => {\n    const content = newItemContents[checklistId];\n    if (!content?.trim()) return;\n    // @ts-ignore\n    await addChecklistItem({ content, checklistId: checklistId as Id<\"colab_checklists\"> });\n    setNewItemContents((prev) => ({ ...prev, [checklistId]: \"\" }));\n  };\n\n  const toggleLabel = async (labelId: Id<\"colab_labels\">) => {\n    if (!card || !user) return;\n    const currentLabels = card.labelIds || [];\n    const newLabels = currentLabels.includes(labelId)\n      ? currentLabels.filter((id: string) => id !== labelId)\n      : [...currentLabels, labelId];\n\n    // @ts-ignore\n    await updateCard({ cardId: cardId, labelIds: newLabels, userId: user.id });\n  };\n\n  const handleCreateLabel = async () => {\n    if (!newLabelName.trim()) return;\n    // @ts-ignore\n    await addLabel({ name: newLabelName, colorCode: newLabelColor, boardId });\n    setNewLabelName(\"\");\n  };\n\n  const handleDateSelect = async (date: Date | undefined) => {\n    if (!user) return;\n    // @ts-ignore\n    await updateCard({ cardId: cardId, dueDate: date ? date.getTime() : undefined, userId: user.id });\n  };\n\n  if (!card) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl h-[85vh] flex flex-col p-0 gap-0 overflow-hidden\">\n        {/* Banner if exists (future) */}\n        <div className=\"flex h-full\">\n          {/* Main Content */}\n          <div className=\"flex-1 flex flex-col h-full overflow-hidden border-r\">\n            <DialogHeader className=\"p-6 pb-2\">\n              <DialogTitle>\n                <Input\n                  value={card.title}\n                  onChange={(e) => handleUpdateTitle(e.target.value)} // Note: this will update on every keystroke which is bad. Ideally use onBlur.\n                  onBlur={(e) => handleUpdateTitle(e.target.value)}\n                  className=\"text-xl font-bold border-none shadow-none p-0 h-auto focus-visible:ring-0\"\n                />\n              </DialogTitle>\n              <div className=\"text-sm text-muted-foreground ml-1\">\n                dans la liste <span className=\"underline decoration-dotted\">Current List</span>\n              </div>\n            </DialogHeader>\n\n            <ScrollArea className=\"flex-1 p-6 pt-2\">\n              <div className=\"space-y-6\">\n                {/* Labels Display */}\n                {(card.labelIds?.length || 0) > 0 && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.labels}</h3>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {boardLabels\n                        .filter((l) => card.labelIds?.includes(l._id))\n                        .map((label) => (\n                          <Badge\n                            key={label._id}\n                            style={{ backgroundColor: label.colorCode }}\n                            className=\"hover:opacity-80 cursor-pointer text-white\"\n                          >\n                            {label.name}\n                          </Badge>\n                        ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Due Date Display */}\n                {card.dueDate && (\n                  <div className=\"space-y-1\">\n                    <h3 className=\"text-xs font-semibold text-muted-foreground uppercase\">{KANBAN_STRINGS.dueDate}</h3>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant=\"outline\"\n                        className={`flex gap-2 p-2 ${card.dueDate < Date.now() ? \"border-red-500 text-red-500 bg-red-50\" : \"\"}`}\n                      >\n                        <Clock className=\"h-4 w-4\" />\n                        {format(card.dueDate, \"d MMMM yyyy\", { locale: fr })}\n                        {card.dueDate < Date.now() && <span className=\"text-xs font-bold ml-1\">EN RETARD</span>}\n                      </Badge>\n                    </div>\n                  </div>\n                )}\n\n                {/* Description */}\n                <div className=\"space-y-2\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">Description</h3>\n                  {isEditingDesc ? (\n                    <div className=\"space-y-2\">\n                      <Textarea\n                        value={description}\n                        onChange={(e) => setDescription(e.target.value)}\n                        className=\"min-h-[100px]\"\n                        placeholder=\"Ajouter une description plus détaillée...\"\n                      />\n                      <div className=\"flex gap-2\">\n                        <Button size=\"sm\" onClick={handleSaveDescription}>\n                          Enregistrer\n                        </Button>\n                        <Button size=\"sm\" variant=\"ghost\" onClick={() => setIsEditingDesc(false)}>\n                          Annuler\n                        </Button>\n                      </div>\n                    </div>\n                  ) : (\n                    // biome-ignore lint/a11y/useKeyWithClickEvents: Interactive div is fine for this specific edit mode\n                    <div\n                      onClick={() => setIsEditingDesc(true)}\n                      className=\"min-h-[60px] p-3 rounded-md bg-muted/20 hover:bg-muted/50 cursor-pointer transition-all text-sm whitespace-pre-wrap\"\n                    >\n                      {card.description || (\n                        <span className=\"text-muted-foreground italic\">Ajouter une description...</span>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Checklists */}\n                <div className=\"space-y-4\">\n                  {checklists?.map((list: any) => {\n                    const progress = list.items?.length\n                      ? Math.round((list.items.filter((i: any) => i.completed).length / list.items.length) * 100)\n                      : 0;\n\n                    return (\n                      <div key={list._id} className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <h3 className=\"font-semibold flex items-center gap-2\">\n                            <CheckSquare className=\"h-4 w-4\" /> {list.name}\n                          </h3>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-6 text-red-500\"\n                            onClick={() => deleteChecklist({ checklistId: list._id })}\n                          >\n                            Supprimer\n                          </Button>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                          <span className=\"w-8\">{progress}%</span>\n                          <div className=\"h-1.5 flex-1 bg-muted rounded-full overflow-hidden\">\n                            <div\n                              className=\"h-full bg-primary transition-all duration-500\"\n                              style={{ width: `${progress}%` }}\n                            />\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-1\">\n                          {list.items?.map((item: any) => (\n                            <div\n                              key={item._id}\n                              className=\"flex items-center gap-2 group hover:bg-muted/20 p-1 rounded -mx-1\"\n                            >\n                              <input\n                                type=\"checkbox\"\n                                checked={item.completed}\n                                // @ts-ignore\n                                onChange={(e) => toggleItem({ itemId: item._id, completed: e.target.checked })}\n                                className=\"h-4 w-4 rounded border-gray-300 accent-primary\"\n                              />\n                              <span\n                                className={`flex-1 text-sm ${item.completed ? \"line-through text-muted-foreground\" : \"\"}`}\n                              >\n                                {item.content}\n                              </span>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"h-6 w-6 opacity-0 group-hover:opacity-100\"\n                                onClick={() => deleteItem({ itemId: item._id })}\n                              >\n                                <span className=\"sr-only\">Delete</span>\n                                <span aria-hidden=\"true\">×</span>\n                              </Button>\n                            </div>\n                          ))}\n                        </div>\n\n                        <div className=\"pl-6\">\n                          <div className=\"flex gap-2\">\n                            <Input\n                              placeholder=\"Ajouter un élément...\"\n                              value={newItemContents[list._id] || \"\"}\n                              onChange={(e) => setNewItemContents((prev) => ({ ...prev, [list._id]: e.target.value }))}\n                              onKeyDown={(e) => e.key === \"Enter\" && handleAddItem(list._id)}\n                              className=\"h-8 text-sm\"\n                            />\n                            <Button size=\"sm\" variant=\"secondary\" onClick={() => handleAddItem(list._id)}>\n                              Ajouter\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n\n                {/* Activity Log */}\n                <div className=\"space-y-4 pt-6\">\n                  <h3 className=\"font-semibold flex items-center gap-2\">\n                    <Activity className=\"h-4 w-4\" /> {KANBAN_STRINGS.activity}\n                  </h3>\n                  <div className=\"space-y-3 pl-6\">\n                    {activities?.map((activity: any) => (\n                      <div key={activity._id} className=\"text-sm\">\n                        <span className=\"font-semibold\">Utilisateur</span>{\" \"}\n                        <span className=\"text-muted-foreground\">{activity.action}</span>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {format(activity.createdAt, \"d MMM yyyy 'à' HH:mm\", { locale: fr })}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </ScrollArea>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"w-60 bg-muted/10 p-4 space-y-6 border-l overflow-y-auto\">\n            <div className=\"space-y-2\">\n              <span className=\"text-xs font-semibold text-muted-foreground uppercase\">Ajouter à la carte</span>\n\n              {/* Labels Popover */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Tag className=\"h-4 w-4 mr-2\" /> {KANBAN_STRINGS.labels}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Étiquettes</h4>\n                    <div className=\"space-y-1\">\n                      {boardLabels.map((label) => (\n                        // biome-ignore lint/a11y/useKeyWithClickEvents: Button role\n                        <div\n                          key={label._id}\n                          className=\"flex items-center gap-2 p-1 hover:bg-muted rounded cursor-pointer\"\n                          onClick={() => toggleLabel(label._id)}\n                        >\n                          <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: label.colorCode }} />\n                          <span className=\"flex-1 text-sm\">{label.name}</span>\n                          {card.labelIds?.includes(label._id) && <span className=\"text-xs\">✓</span>}\n                        </div>\n                      ))}\n                    </div>\n                    <div className=\"pt-2 border-t space-y-2\">\n                      <Input\n                        placeholder=\"Nom...\"\n                        className=\"h-8 text-sm\"\n                        value={newLabelName}\n                        onChange={(e) => setNewLabelName(e.target.value)}\n                      />\n                      <div className=\"flex gap-1 justify-between\">\n                        {[\"#EF4444\", \"#F59E0B\", \"#10B981\", \"#3B82F6\", \"#6366F1\", \"#EC4899\"].map((color) => (\n                          // biome-ignore lint/a11y/useKeyWithClickEvents: Color picker\n                          <div\n                            key={color}\n                            className={`w-6 h-6 rounded-full cursor-pointer border-2 ${newLabelColor === color ? \"border-black\" : \"border-transparent\"}`}\n                            style={{ backgroundColor: color }}\n                            onClick={() => setNewLabelColor(color)}\n                          />\n                        ))}\n                      </div>\n                      <Button size=\"sm\" className=\"w-full\" onClick={handleCreateLabel} disabled={!newLabelName}>\n                        Créer\n                      </Button>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Checklist */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <CheckSquare className=\"h-4 w-4 mr-2\" /> Checklist\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-60 p-2\" align=\"start\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">Ajouter une checklist</h4>\n                    <Input\n                      placeholder=\"Nom de la checklist...\"\n                      value={newChecklistName}\n                      onChange={(e) => setNewChecklistName(e.target.value)}\n                      className=\"h-8\"\n                      autoFocus\n                    />\n                    <Button size=\"sm\" className=\"w-full\" onClick={handleAddChecklist} disabled={!newChecklistName}>\n                      Ajouter\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Due Date */}\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button variant=\"secondary\" className=\"w-full justify-start h-8\">\n                    <Calendar className=\"h-4 w-4 mr-2\" /> Dates\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  {/* Simple Calendar placeholder since I need to verify if we have a Calendar component */}\n                  <div className=\"p-4\">\n                    <input\n                      type=\"date\"\n                      className=\"border rounded p-1 block w-full\"\n                      onChange={(e) => handleDateSelect(e.target.valueAsDate || undefined)}\n                      value={card.dueDate ? new Date(card.dueDate).toISOString().split(\"T\")[0] : \"\"}\n                    />\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"w-full mt-2 text-red-500\"\n                      onClick={() => handleDateSelect(undefined)}\n                    >\n                      Retirer\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[1264,1269],"sourceCode":"\"use client\";\n\nimport { ChevronRight, Home } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\n\ninterface BreadcrumbItem {\n  label: string;\n  href?: string;\n}\n\nconst routeLabels: Record<string, string> = {\n  dashboard: \"Dashboard\",\n  documents: \"Documents\",\n  pipeline: \"Pipeline\",\n  deals: \"Deals\",\n  companies: \"Companies\",\n  calendar: \"Calendar\",\n  settings: \"Settings\",\n  recent: \"Recent\",\n  favorites: \"Favorites\",\n  trash: \"Trash\",\n};\n\nexport function ColabBreadcrumbs() {\n  const pathname = usePathname();\n  const segments = pathname?.split(\"/\").filter(Boolean) || [];\n\n  const breadcrumbs: BreadcrumbItem[] = [\n    { label: \"Colab\", href: \"/dashboard\" },\n    ...segments.map((segment, index) => {\n      const href = `/${segments.slice(0, index + 1).join(\"/\")}`;\n      const label = routeLabels[segment] || segment;\n      return { label, href };\n    }),\n  ];\n\n  return (\n    <nav className=\"flex items-center gap-1 px-4 py-2 text-sm border-b bg-background/95 backdrop-blur\">\n      <Link\n        href=\"/dashboard\"\n        className=\"flex items-center gap-1 text-muted-foreground hover:text-foreground transition-colors\"\n      >\n        <Home className=\"h-4 w-4\" />\n      </Link>\n      {breadcrumbs.map((crumb, index) => (\n        <div key={index} className=\"flex items-center gap-1\">\n          <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n          {crumb.href && index < breadcrumbs.length - 1 ? (\n            <Link href={crumb.href} className=\"text-muted-foreground hover:text-foreground transition-colors\">\n              {crumb.label}\n            </Link>\n          ) : (\n            <span className=\"font-medium\">{crumb.label}</span>\n          )}\n        </div>\n      ))}\n    </nav>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/layout/ColabBreadcrumbs.tsx"},"span":[1294,1299],"sourceCode":"\"use client\";\n\nimport { ChevronRight, Home } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\n\ninterface BreadcrumbItem {\n  label: string;\n  href?: string;\n}\n\nconst routeLabels: Record<string, string> = {\n  dashboard: \"Dashboard\",\n  documents: \"Documents\",\n  pipeline: \"Pipeline\",\n  deals: \"Deals\",\n  companies: \"Companies\",\n  calendar: \"Calendar\",\n  settings: \"Settings\",\n  recent: \"Recent\",\n  favorites: \"Favorites\",\n  trash: \"Trash\",\n};\n\nexport function ColabBreadcrumbs() {\n  const pathname = usePathname();\n  const segments = pathname?.split(\"/\").filter(Boolean) || [];\n\n  const breadcrumbs: BreadcrumbItem[] = [\n    { label: \"Colab\", href: \"/dashboard\" },\n    ...segments.map((segment, index) => {\n      const href = `/${segments.slice(0, index + 1).join(\"/\")}`;\n      const label = routeLabels[segment] || segment;\n      return { label, href };\n    }),\n  ];\n\n  return (\n    <nav className=\"flex items-center gap-1 px-4 py-2 text-sm border-b bg-background/95 backdrop-blur\">\n      <Link\n        href=\"/dashboard\"\n        className=\"flex items-center gap-1 text-muted-foreground hover:text-foreground transition-colors\"\n      >\n        <Home className=\"h-4 w-4\" />\n      </Link>\n      {breadcrumbs.map((crumb, index) => (\n        <div key={index} className=\"flex items-center gap-1\">\n          <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n          {crumb.href && index < breadcrumbs.length - 1 ? (\n            <Link href={crumb.href} className=\"text-muted-foreground hover:text-foreground transition-colors\">\n              {crumb.label}\n            </Link>\n          ) : (\n            <span className=\"font-medium\">{crumb.label}</span>\n          )}\n        </div>\n      ))}\n    </nav>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/correctness/noUnusedVariables","severity":"warning","description":"This variable is unused.","message":[{"elements":[],"content":"This variable is unused."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Unused variables usually are result of incomplete refactoring, typos and other source of bugs."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/TimelineView.tsx"},"span":[1280,1285],"sourceCode":"\"use client\";\n\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { cn } from \"@/lib/utils\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { useMutation } from \"convex/react\";\nimport {\n  addDays,\n  addMonths,\n  addWeeks,\n  differenceInDays,\n  format,\n  isSameDay,\n  eachDayOfInterval,\n  startOfMonth,\n  isWeekend,\n  startOfDay,\n} from \"date-fns\";\nimport { fr } from \"date-fns/locale\";\nimport { ChevronLeft, ChevronRight, } from \"lucide-react\";\nimport { useEffect, useState, useMemo, useCallback } from \"react\";\n\nconst TIMELINE_STRINGS = {\n  viewTitle: \"Chronologie\",\n  today: \"Aujourd'hui\",\n  noDate: \"Sans date\",\n  zoom: {\n    day: \"Jour\",\n    week: \"Semaine\",\n    month: \"Mois\",\n  },\n};\n\ntype ZoomLevel = \"day\" | \"week\" | \"month\";\n\ninterface TimelineViewProps {\n  board: {\n    _id: Id<\"colab_boards\">;\n    name: string;\n  };\n  lists: {\n    _id: Id<\"colab_lists\">;\n    name: string;\n    boardId: Id<\"colab_boards\">;\n    index: number;\n  }[];\n  cards: {\n    _id: Id<\"colab_cards\">;\n    title: string;\n    listId: Id<\"colab_lists\">;\n    index: number;\n    startDate?: number;\n    endDate?: number;\n    dueDate?: number;\n  }[];\n}\n\nexport function TimelineView({ board, lists, cards }: TimelineViewProps) {\n  const { user } = useUser();\n  const updateCard = useMutation(api.boards.updateCard);\n  const [zoom, setZoom] = useState<ZoomLevel>(\"day\");\n  const [currentDate, setCurrentDate] = useState(new Date());\n\n  // Drag state\n  const [draggingCard, setDraggingCard] = useState<{\n    id: string;\n    startX: number;\n    initialStart: number;\n    initialEnd: number;\n    type: \"move\" | \"resize\";\n  } | null>(null);\n\n  // Configuration for each zoom level\n  const CELL_WIDTH = zoom === \"day\" ? 50 : zoom === \"week\" ? 20 : 10;\n  const HEADER_HEIGHT = 40;\n  const ROW_HEIGHT = 48;\n  const SIDEBAR_WIDTH = 200;\n\n  // Calculate visible date range based on zoom and currentDate\n  const startDateRange = useMemo(() => startOfDay(addDays(currentDate, -30)), [currentDate]);\n  const endDateRange = useMemo(() => startOfDay(addDays(currentDate, 30)), [currentDate]);\n  const days = useMemo(\n    () => eachDayOfInterval({ start: startDateRange, end: endDateRange }),\n    [startDateRange, endDateRange],\n  );\n\n  // Helper to format dates\n  const formatDate = (date: Date, formatStr: string) => {\n    return format(date, formatStr, { locale: fr });\n  };\n\n  // Calculate position and width for a card\n  const getCardStyle = (card: TimelineViewProps[\"cards\"][0]) => {\n    const start = card.startDate ? new Date(card.startDate) : null;\n    let end = card.endDate ? new Date(card.endDate) : null;\n\n    if (!start) return null;\n\n    if (!end) {\n      end = addDays(start, 1);\n    }\n\n    const dayOffset = differenceInDays(start, startDateRange);\n    const durationDays = differenceInDays(end, start) || 1;\n\n    if (dayOffset + durationDays < 0 || dayOffset > days.length) return null;\n\n    const left = dayOffset * CELL_WIDTH;\n    const width = durationDays * CELL_WIDTH;\n\n    return {\n      left: `${left}px`,\n      width: `${Math.max(width, CELL_WIDTH)}px`,\n    };\n  };\n\n  const handleMouseDown = (e: React.MouseEvent, card: TimelineViewProps[\"cards\"][0], type: \"move\" | \"resize\") => {\n    e.stopPropagation();\n    e.preventDefault(); // Prevent text selection\n\n    if (!card.startDate) return;\n\n    setDraggingCard({\n      id: card._id,\n      startX: e.clientX,\n      initialStart: card.startDate,\n      initialEnd: card.endDate || addDays(new Date(card.startDate), 1).getTime(),\n      type,\n    });\n  };\n\n  const handleMouseMove = useCallback(\n    (e: MouseEvent) => {\n      if (!draggingCard) return;\n\n      // This is purely visual feedback logic would be complex to implement efficiently in React state for every pixel\n      // So we might just update on mouse up, OR we can use a ref for the element to update visual position directly.\n      // But for simplicity in this iteration, we will rely on mouse up to calculate the new date.\n      // To improve UX, we could show a ghost element or update state (might be laggy without optimization).\n      // Let's stick to updating only on MouseUp for now, but to make it feel responsive, maybe we could update a local optimistic state?\n      // No, let's just do it on MouseUp for simplicity and robustness first.\n    },\n    [draggingCard],\n  );\n\n  const handleMouseUp = useCallback(\n    async (e: MouseEvent) => {\n      if (!draggingCard || !user) return;\n\n      const diffX = e.clientX - draggingCard.startX;\n      const diffDays = Math.round(diffX / CELL_WIDTH);\n\n      if (diffDays === 0) {\n        setDraggingCard(null);\n        return;\n      }\n\n      const originalStart = new Date(draggingCard.initialStart);\n      const originalEnd = new Date(draggingCard.initialEnd);\n\n      let newStart = originalStart;\n      let newEnd = originalEnd;\n\n      if (draggingCard.type === \"move\") {\n        newStart = addDays(originalStart, diffDays);\n        newEnd = addDays(originalEnd, diffDays);\n      } else if (draggingCard.type === \"resize\") {\n        newEnd = addDays(originalEnd, diffDays);\n        // Prevent end date before start date\n        if (newEnd <= newStart) {\n          newEnd = addDays(newStart, 1);\n        }\n      }\n\n      // Optimistic update logic could go here, but we'll rely on Convex reactivity\n      await updateCard({\n        cardId: draggingCard.id as Id<\"colab_cards\">,\n        startDate: newStart.getTime(),\n        endDate: newEnd.getTime(),\n        userId: user.id,\n      });\n\n      setDraggingCard(null);\n    },\n    [draggingCard, CELL_WIDTH, updateCard, user],\n  );\n\n  useEffect(() => {\n    if (draggingCard) {\n      window.addEventListener(\"mousemove\", handleMouseMove);\n      window.addEventListener(\"mouseup\", handleMouseUp);\n    } else {\n      window.removeEventListener(\"mousemove\", handleMouseMove);\n      window.removeEventListener(\"mouseup\", handleMouseUp);\n    }\n    return () => {\n      window.removeEventListener(\"mousemove\", handleMouseMove);\n      window.removeEventListener(\"mouseup\", handleMouseUp);\n    };\n  }, [draggingCard, handleMouseMove, handleMouseUp]);\n\n  return (\n    <div className=\"flex flex-col h-full bg-background border rounded-lg overflow-hidden select-none\">\n      {/* Header Controls */}\n      <div className=\"flex items-center justify-between p-4 border-b\">\n        <div className=\"flex items-center gap-4\">\n          <h2 className=\"text-lg font-semibold\">{TIMELINE_STRINGS.viewTitle}</h2>\n          <div className=\"flex items-center gap-1 bg-muted p-1 rounded-md\">\n            <Button variant={zoom === \"day\" ? \"secondary\" : \"ghost\"} size=\"sm\" onClick={() => setZoom(\"day\")}>\n              {TIMELINE_STRINGS.zoom.day}\n            </Button>\n            <Button variant={zoom === \"week\" ? \"secondary\" : \"ghost\"} size=\"sm\" onClick={() => setZoom(\"week\")}>\n              {TIMELINE_STRINGS.zoom.week}\n            </Button>\n            <Button variant={zoom === \"month\" ? \"secondary\" : \"ghost\"} size=\"sm\" onClick={() => setZoom(\"month\")}>\n              {TIMELINE_STRINGS.zoom.month}\n            </Button>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setCurrentDate(new Date())}>\n            {TIMELINE_STRINGS.today}\n          </Button>\n          <div className=\"flex items-center rounded-md border\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => {\n                if (zoom === \"day\") setCurrentDate((d) => addDays(d, -7));\n                if (zoom === \"week\") setCurrentDate((d) => addWeeks(d, -1));\n                if (zoom === \"month\") setCurrentDate((d) => addMonths(d, -1));\n              }}\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <span className=\"px-4 text-sm font-medium min-w-[120px] text-center\">\n              {formatDate(currentDate, zoom === \"month\" ? \"MMMM yyyy\" : \"d MMMM yyyy\")}\n            </span>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => {\n                if (zoom === \"day\") setCurrentDate((d) => addDays(d, 7));\n                if (zoom === \"week\") setCurrentDate((d) => addWeeks(d, 1));\n                if (zoom === \"month\") setCurrentDate((d) => addMonths(d, 1));\n              }}\n            >\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Timeline Content */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* Sidebar (Lists) */}\n        <div className=\"flex-shrink-0 border-r bg-muted/10 overflow-hidden\" style={{ width: SIDEBAR_WIDTH }}>\n          <div\n            className=\"border-b bg-muted/20 font-medium text-sm flex items-center px-4\"\n            style={{ height: HEADER_HEIGHT }}\n          >\n            Listes\n          </div>\n          <div className=\"overflow-y-hidden\">\n            {lists.map((list) => (\n              <div\n                key={list._id}\n                className=\"border-b flex items-center px-4 truncate font-medium text-sm text-muted-foreground\"\n                style={{ height: ROW_HEIGHT }}\n              >\n                {list.name}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Grid */}\n        <div className=\"flex-1 overflow-auto relative cursor-grab active:cursor-grabbing\">\n          <div className=\"flex border-b bg-background sticky top-0 z-10 w-fit\" style={{ height: HEADER_HEIGHT }}>\n            {days.map((day) => {\n              const isToday = isSameDay(day, new Date());\n              const isWknd = isWeekend(day);\n\n              let content = formatDate(day, \"d\");\n              if (zoom === \"week\") content = formatDate(day, \"EEEEE\");\n              if (zoom === \"month\") content = \"\";\n\n              const showMonth = isSameDay(day, startOfMonth(day)) || isSameDay(day, startDateRange);\n\n              return (\n                <div\n                  key={day.toISOString()}\n                  className={cn(\n                    \"flex-shrink-0 border-r flex flex-col justify-end pb-1 text-xs text-center select-none\",\n                    isToday && \"bg-blue-50/50 text-blue-600 font-bold\",\n                    isWknd && !isToday && \"bg-muted/20\",\n                  )}\n                  style={{ width: CELL_WIDTH }}\n                >\n                  {showMonth && (\n                    <span className=\"absolute top-1 left-1 text-[10px] font-semibold text-muted-foreground whitespace-nowrap pl-1\">\n                      {formatDate(day, \"MMMM yyyy\")}\n                    </span>\n                  )}\n                  <span>{content}</span>\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"relative w-fit\">\n            {/* Background Grid */}\n            <div className=\"absolute inset-0 flex pointer-events-none\">\n              {days.map((day) => {\n                const isToday = isSameDay(day, new Date());\n                const isWknd = isWeekend(day);\n                return (\n                  <div\n                    key={day.toISOString()}\n                    className={cn(\n                      \"flex-shrink-0 border-r h-full\",\n                      isToday && \"bg-blue-50/30 border-l border-blue-200 border-r-blue-200\",\n                      isWknd && !isToday && \"bg-muted/10\",\n                    )}\n                    style={{ width: CELL_WIDTH }}\n                  />\n                );\n              })}\n            </div>\n\n            {/* Today Line */}\n            {days.some((d) => isSameDay(d, new Date())) && (\n              <div\n                className=\"absolute top-0 bottom-0 border-l-2 border-blue-500 z-20 pointer-events-none\"\n                style={{\n                  left: differenceInDays(new Date(), startDateRange) * CELL_WIDTH + CELL_WIDTH / 2,\n                }}\n              />\n            )}\n\n            {/* Rows */}\n            {lists.map((list) => {\n              const listCards = cards.filter((c) => c.listId === list._id);\n              return (\n                <div key={list._id} className=\"border-b relative\" style={{ height: ROW_HEIGHT }}>\n                  {listCards.map((card) => {\n                    const style = getCardStyle(card);\n                    if (!style) return null;\n                    const isDragging = draggingCard?.id === card._id;\n\n                    return (\n                      <div\n                        key={card._id}\n                        className={cn(\n                          \"absolute top-1 bottom-1 bg-blue-500 rounded text-xs text-white px-2 flex items-center overflow-hidden cursor-move group hover:bg-blue-600 transition-colors z-10\",\n                          isDragging && \"opacity-70 ring-2 ring-blue-300\",\n                        )}\n                        style={style}\n                        title={`${card.title} (${card.startDate ? formatDate(new Date(card.startDate), \"dd/MM/yyyy\") : \"\"} - ${card.endDate ? formatDate(new Date(card.endDate), \"dd/MM/yyyy\") : \"\"})`}\n                        onMouseDown={(e) => handleMouseDown(e, card, \"move\")}\n                      >\n                        <span className=\"truncate\">{card.title}</span>\n                        {/* Resize handle */}\n                        <div\n                          className=\"absolute right-0 top-0 bottom-0 w-2 cursor-e-resize hover:bg-blue-700 opacity-0 group-hover:opacity-100 transition-opacity z-20\"\n                          onMouseDown={(e) => handleMouseDown(e, card, \"resize\")}\n                        />\n                      </div>\n                    );\n                  })}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/correctness/noUnusedVariables","severity":"warning","description":"This parameter is unused.","message":[{"elements":[],"content":"This parameter is unused."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Unused variables usually are result of incomplete refactoring, typos and other source of bugs."}]]},{"log":["info",[{"elements":[],"content":"Unsafe fix: If this is intentional, prepend "},{"elements":["Emphasis"],"content":"e"},{"elements":[],"content":" with an underscore."}]]},{"diff":{"dictionary":"\"use client\";\n\nimport { Button } from \"@/components/tailwind/ui/button\";\n  const handleMouseMove = useCallback(\n    (e_e: MouseEvent) => {\n      if (!draggingCard) return;\n  );\n}\n","ops":[{"diffOp":{"equal":{"range":[0,72]}}},{"equalLines":{"line_count":129}},{"diffOp":{"equal":{"range":[72,117]}}},{"diffOp":{"delete":{"range":[117,118]}}},{"diffOp":{"insert":{"range":[118,120]}}},{"diffOp":{"equal":{"range":[120,172]}}},{"equalLines":{"line_count":242}},{"diffOp":{"equal":{"range":[172,179]}}}]}}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/kanban/TimelineView.tsx"},"span":[3652,3653],"sourceCode":"\"use client\";\n\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport { cn } from \"@/lib/utils\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { useMutation } from \"convex/react\";\nimport {\n  addDays,\n  addMonths,\n  addWeeks,\n  differenceInDays,\n  format,\n  isSameDay,\n  eachDayOfInterval,\n  startOfMonth,\n  isWeekend,\n  startOfDay,\n} from \"date-fns\";\nimport { fr } from \"date-fns/locale\";\nimport { ChevronLeft, ChevronRight, } from \"lucide-react\";\nimport { useEffect, useState, useMemo, useCallback } from \"react\";\n\nconst TIMELINE_STRINGS = {\n  viewTitle: \"Chronologie\",\n  today: \"Aujourd'hui\",\n  noDate: \"Sans date\",\n  zoom: {\n    day: \"Jour\",\n    week: \"Semaine\",\n    month: \"Mois\",\n  },\n};\n\ntype ZoomLevel = \"day\" | \"week\" | \"month\";\n\ninterface TimelineViewProps {\n  board: {\n    _id: Id<\"colab_boards\">;\n    name: string;\n  };\n  lists: {\n    _id: Id<\"colab_lists\">;\n    name: string;\n    boardId: Id<\"colab_boards\">;\n    index: number;\n  }[];\n  cards: {\n    _id: Id<\"colab_cards\">;\n    title: string;\n    listId: Id<\"colab_lists\">;\n    index: number;\n    startDate?: number;\n    endDate?: number;\n    dueDate?: number;\n  }[];\n}\n\nexport function TimelineView({ board, lists, cards }: TimelineViewProps) {\n  const { user } = useUser();\n  const updateCard = useMutation(api.boards.updateCard);\n  const [zoom, setZoom] = useState<ZoomLevel>(\"day\");\n  const [currentDate, setCurrentDate] = useState(new Date());\n\n  // Drag state\n  const [draggingCard, setDraggingCard] = useState<{\n    id: string;\n    startX: number;\n    initialStart: number;\n    initialEnd: number;\n    type: \"move\" | \"resize\";\n  } | null>(null);\n\n  // Configuration for each zoom level\n  const CELL_WIDTH = zoom === \"day\" ? 50 : zoom === \"week\" ? 20 : 10;\n  const HEADER_HEIGHT = 40;\n  const ROW_HEIGHT = 48;\n  const SIDEBAR_WIDTH = 200;\n\n  // Calculate visible date range based on zoom and currentDate\n  const startDateRange = useMemo(() => startOfDay(addDays(currentDate, -30)), [currentDate]);\n  const endDateRange = useMemo(() => startOfDay(addDays(currentDate, 30)), [currentDate]);\n  const days = useMemo(\n    () => eachDayOfInterval({ start: startDateRange, end: endDateRange }),\n    [startDateRange, endDateRange],\n  );\n\n  // Helper to format dates\n  const formatDate = (date: Date, formatStr: string) => {\n    return format(date, formatStr, { locale: fr });\n  };\n\n  // Calculate position and width for a card\n  const getCardStyle = (card: TimelineViewProps[\"cards\"][0]) => {\n    const start = card.startDate ? new Date(card.startDate) : null;\n    let end = card.endDate ? new Date(card.endDate) : null;\n\n    if (!start) return null;\n\n    if (!end) {\n      end = addDays(start, 1);\n    }\n\n    const dayOffset = differenceInDays(start, startDateRange);\n    const durationDays = differenceInDays(end, start) || 1;\n\n    if (dayOffset + durationDays < 0 || dayOffset > days.length) return null;\n\n    const left = dayOffset * CELL_WIDTH;\n    const width = durationDays * CELL_WIDTH;\n\n    return {\n      left: `${left}px`,\n      width: `${Math.max(width, CELL_WIDTH)}px`,\n    };\n  };\n\n  const handleMouseDown = (e: React.MouseEvent, card: TimelineViewProps[\"cards\"][0], type: \"move\" | \"resize\") => {\n    e.stopPropagation();\n    e.preventDefault(); // Prevent text selection\n\n    if (!card.startDate) return;\n\n    setDraggingCard({\n      id: card._id,\n      startX: e.clientX,\n      initialStart: card.startDate,\n      initialEnd: card.endDate || addDays(new Date(card.startDate), 1).getTime(),\n      type,\n    });\n  };\n\n  const handleMouseMove = useCallback(\n    (e: MouseEvent) => {\n      if (!draggingCard) return;\n\n      // This is purely visual feedback logic would be complex to implement efficiently in React state for every pixel\n      // So we might just update on mouse up, OR we can use a ref for the element to update visual position directly.\n      // But for simplicity in this iteration, we will rely on mouse up to calculate the new date.\n      // To improve UX, we could show a ghost element or update state (might be laggy without optimization).\n      // Let's stick to updating only on MouseUp for now, but to make it feel responsive, maybe we could update a local optimistic state?\n      // No, let's just do it on MouseUp for simplicity and robustness first.\n    },\n    [draggingCard],\n  );\n\n  const handleMouseUp = useCallback(\n    async (e: MouseEvent) => {\n      if (!draggingCard || !user) return;\n\n      const diffX = e.clientX - draggingCard.startX;\n      const diffDays = Math.round(diffX / CELL_WIDTH);\n\n      if (diffDays === 0) {\n        setDraggingCard(null);\n        return;\n      }\n\n      const originalStart = new Date(draggingCard.initialStart);\n      const originalEnd = new Date(draggingCard.initialEnd);\n\n      let newStart = originalStart;\n      let newEnd = originalEnd;\n\n      if (draggingCard.type === \"move\") {\n        newStart = addDays(originalStart, diffDays);\n        newEnd = addDays(originalEnd, diffDays);\n      } else if (draggingCard.type === \"resize\") {\n        newEnd = addDays(originalEnd, diffDays);\n        // Prevent end date before start date\n        if (newEnd <= newStart) {\n          newEnd = addDays(newStart, 1);\n        }\n      }\n\n      // Optimistic update logic could go here, but we'll rely on Convex reactivity\n      await updateCard({\n        cardId: draggingCard.id as Id<\"colab_cards\">,\n        startDate: newStart.getTime(),\n        endDate: newEnd.getTime(),\n        userId: user.id,\n      });\n\n      setDraggingCard(null);\n    },\n    [draggingCard, CELL_WIDTH, updateCard, user],\n  );\n\n  useEffect(() => {\n    if (draggingCard) {\n      window.addEventListener(\"mousemove\", handleMouseMove);\n      window.addEventListener(\"mouseup\", handleMouseUp);\n    } else {\n      window.removeEventListener(\"mousemove\", handleMouseMove);\n      window.removeEventListener(\"mouseup\", handleMouseUp);\n    }\n    return () => {\n      window.removeEventListener(\"mousemove\", handleMouseMove);\n      window.removeEventListener(\"mouseup\", handleMouseUp);\n    };\n  }, [draggingCard, handleMouseMove, handleMouseUp]);\n\n  return (\n    <div className=\"flex flex-col h-full bg-background border rounded-lg overflow-hidden select-none\">\n      {/* Header Controls */}\n      <div className=\"flex items-center justify-between p-4 border-b\">\n        <div className=\"flex items-center gap-4\">\n          <h2 className=\"text-lg font-semibold\">{TIMELINE_STRINGS.viewTitle}</h2>\n          <div className=\"flex items-center gap-1 bg-muted p-1 rounded-md\">\n            <Button variant={zoom === \"day\" ? \"secondary\" : \"ghost\"} size=\"sm\" onClick={() => setZoom(\"day\")}>\n              {TIMELINE_STRINGS.zoom.day}\n            </Button>\n            <Button variant={zoom === \"week\" ? \"secondary\" : \"ghost\"} size=\"sm\" onClick={() => setZoom(\"week\")}>\n              {TIMELINE_STRINGS.zoom.week}\n            </Button>\n            <Button variant={zoom === \"month\" ? \"secondary\" : \"ghost\"} size=\"sm\" onClick={() => setZoom(\"month\")}>\n              {TIMELINE_STRINGS.zoom.month}\n            </Button>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setCurrentDate(new Date())}>\n            {TIMELINE_STRINGS.today}\n          </Button>\n          <div className=\"flex items-center rounded-md border\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => {\n                if (zoom === \"day\") setCurrentDate((d) => addDays(d, -7));\n                if (zoom === \"week\") setCurrentDate((d) => addWeeks(d, -1));\n                if (zoom === \"month\") setCurrentDate((d) => addMonths(d, -1));\n              }}\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <span className=\"px-4 text-sm font-medium min-w-[120px] text-center\">\n              {formatDate(currentDate, zoom === \"month\" ? \"MMMM yyyy\" : \"d MMMM yyyy\")}\n            </span>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => {\n                if (zoom === \"day\") setCurrentDate((d) => addDays(d, 7));\n                if (zoom === \"week\") setCurrentDate((d) => addWeeks(d, 1));\n                if (zoom === \"month\") setCurrentDate((d) => addMonths(d, 1));\n              }}\n            >\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Timeline Content */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* Sidebar (Lists) */}\n        <div className=\"flex-shrink-0 border-r bg-muted/10 overflow-hidden\" style={{ width: SIDEBAR_WIDTH }}>\n          <div\n            className=\"border-b bg-muted/20 font-medium text-sm flex items-center px-4\"\n            style={{ height: HEADER_HEIGHT }}\n          >\n            Listes\n          </div>\n          <div className=\"overflow-y-hidden\">\n            {lists.map((list) => (\n              <div\n                key={list._id}\n                className=\"border-b flex items-center px-4 truncate font-medium text-sm text-muted-foreground\"\n                style={{ height: ROW_HEIGHT }}\n              >\n                {list.name}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Grid */}\n        <div className=\"flex-1 overflow-auto relative cursor-grab active:cursor-grabbing\">\n          <div className=\"flex border-b bg-background sticky top-0 z-10 w-fit\" style={{ height: HEADER_HEIGHT }}>\n            {days.map((day) => {\n              const isToday = isSameDay(day, new Date());\n              const isWknd = isWeekend(day);\n\n              let content = formatDate(day, \"d\");\n              if (zoom === \"week\") content = formatDate(day, \"EEEEE\");\n              if (zoom === \"month\") content = \"\";\n\n              const showMonth = isSameDay(day, startOfMonth(day)) || isSameDay(day, startDateRange);\n\n              return (\n                <div\n                  key={day.toISOString()}\n                  className={cn(\n                    \"flex-shrink-0 border-r flex flex-col justify-end pb-1 text-xs text-center select-none\",\n                    isToday && \"bg-blue-50/50 text-blue-600 font-bold\",\n                    isWknd && !isToday && \"bg-muted/20\",\n                  )}\n                  style={{ width: CELL_WIDTH }}\n                >\n                  {showMonth && (\n                    <span className=\"absolute top-1 left-1 text-[10px] font-semibold text-muted-foreground whitespace-nowrap pl-1\">\n                      {formatDate(day, \"MMMM yyyy\")}\n                    </span>\n                  )}\n                  <span>{content}</span>\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"relative w-fit\">\n            {/* Background Grid */}\n            <div className=\"absolute inset-0 flex pointer-events-none\">\n              {days.map((day) => {\n                const isToday = isSameDay(day, new Date());\n                const isWknd = isWeekend(day);\n                return (\n                  <div\n                    key={day.toISOString()}\n                    className={cn(\n                      \"flex-shrink-0 border-r h-full\",\n                      isToday && \"bg-blue-50/30 border-l border-blue-200 border-r-blue-200\",\n                      isWknd && !isToday && \"bg-muted/10\",\n                    )}\n                    style={{ width: CELL_WIDTH }}\n                  />\n                );\n              })}\n            </div>\n\n            {/* Today Line */}\n            {days.some((d) => isSameDay(d, new Date())) && (\n              <div\n                className=\"absolute top-0 bottom-0 border-l-2 border-blue-500 z-20 pointer-events-none\"\n                style={{\n                  left: differenceInDays(new Date(), startDateRange) * CELL_WIDTH + CELL_WIDTH / 2,\n                }}\n              />\n            )}\n\n            {/* Rows */}\n            {lists.map((list) => {\n              const listCards = cards.filter((c) => c.listId === list._id);\n              return (\n                <div key={list._id} className=\"border-b relative\" style={{ height: ROW_HEIGHT }}>\n                  {listCards.map((card) => {\n                    const style = getCardStyle(card);\n                    if (!style) return null;\n                    const isDragging = draggingCard?.id === card._id;\n\n                    return (\n                      <div\n                        key={card._id}\n                        className={cn(\n                          \"absolute top-1 bottom-1 bg-blue-500 rounded text-xs text-white px-2 flex items-center overflow-hidden cursor-move group hover:bg-blue-600 transition-colors z-10\",\n                          isDragging && \"opacity-70 ring-2 ring-blue-300\",\n                        )}\n                        style={style}\n                        title={`${card.title} (${card.startDate ? formatDate(new Date(card.startDate), \"dd/MM/yyyy\") : \"\"} - ${card.endDate ? formatDate(new Date(card.endDate), \"dd/MM/yyyy\") : \"\"})`}\n                        onMouseDown={(e) => handleMouseDown(e, card, \"move\")}\n                      >\n                        <span className=\"truncate\">{card.title}</span>\n                        {/* Resize handle */}\n                        <div\n                          className=\"absolute right-0 top-0 bottom-0 w-2 cursor-e-resize hover:bg-blue-700 opacity-0 group-hover:opacity-100 transition-opacity z-20\"\n                          onMouseDown={(e) => handleMouseDown(e, card, \"resize\")}\n                        />\n                      </div>\n                    );\n                  })}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"},"tags":["fixable"],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[1646,1647],"sourceCode":"\"use client\";\n\n/**\n * Counter - Compteur animé pour valeurs financières\n * Adapté pour Alecia Colab - Format français (500 m€)\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { type MotionValue, motion, useSpring, useTransform } from \"motion/react\";\nimport type React from \"react\";\nimport { useEffect } from \"react\";\n\ntype PlaceValue = number | \".\";\n\ninterface NumberProps {\n  mv: MotionValue<number>;\n  number: number;\n  height: number;\n}\n\nfunction AnimatedNumber({ mv, number, height }: NumberProps) {\n  const y = useTransform(mv, (latest) => {\n    const placeValue = latest % 10;\n    const offset = (10 + number - placeValue) % 10;\n    let memo = offset * height;\n    if (offset > 5) {\n      memo -= 10 * height;\n    }\n    return memo;\n  });\n\n  return (\n    <motion.span className=\"absolute top-0 right-0 bottom-0 left-0 flex items-center justify-center\" style={{ y }}>\n      {number}\n    </motion.span>\n  );\n}\n\ninterface DigitProps {\n  place: PlaceValue;\n  value: number;\n  height: number;\n}\n\nfunction Digit({ place, value, height }: DigitProps) {\n  if (place === \".\") {\n    return (\n      <span className=\"relative font-variant-numeric-tabular-nums\" style={{ height, width: \"0.5ch\" }}>\n        ,\n      </span>\n    );\n  }\n\n  const valueRoundedToPlace = Math.floor(value / place);\n  const animatedValue = useSpring(valueRoundedToPlace, {\n    stiffness: 100,\n    damping: 20,\n  });\n\n  useEffect(() => {\n    animatedValue.set(valueRoundedToPlace);\n  }, [animatedValue, valueRoundedToPlace]);\n\n  return (\n    <span className=\"relative font-variant-numeric-tabular-nums\" style={{ height, width: \"1ch\" }}>\n      {Array.from({ length: 10 }, (_, i) => (\n        <AnimatedNumber key={i} mv={animatedValue} number={i} height={height} />\n      ))}\n    </span>\n  );\n}\n\ninterface CounterProps {\n  value: number;\n  fontSize?: number;\n  suffix?: string;\n  prefix?: string;\n  className?: string;\n  textColor?: string;\n  fontWeight?: React.CSSProperties[\"fontWeight\"];\n}\n\n/**\n * Formatte un nombre en format français (m pour millions)\n * Ex: 500000000 -> \"500 m\"\n */\nfunction formatValue(value: number): { displayValue: number; suffix: string } {\n  if (value >= 1000000000) {\n    return { displayValue: value / 1000000000, suffix: \" Md\" };\n  }\n  if (value >= 1000000) {\n    return { displayValue: value / 1000000, suffix: \" m\" };\n  }\n  if (value >= 1000) {\n    return { displayValue: value / 1000, suffix: \" k\" };\n  }\n  return { displayValue: value, suffix: \"\" };\n}\n\nexport default function Counter({\n  value,\n  fontSize = 48,\n  suffix = \"€\",\n  prefix,\n  className,\n  textColor = \"inherit\",\n  fontWeight = 600,\n}: CounterProps) {\n  const height = fontSize;\n  const { displayValue, suffix: autoSuffix } = formatValue(value);\n\n  // Générer les places pour le nombre formaté\n  const valueStr = displayValue.toFixed(displayValue % 1 === 0 ? 0 : 1);\n  const places: PlaceValue[] = [...valueStr].map((ch, i, a) => {\n    if (ch === \".\") return \".\";\n    const dotIndex = a.indexOf(\".\");\n    const isInteger = dotIndex === -1;\n    const exponent = isInteger ? a.length - i - 1 : i < dotIndex ? dotIndex - i - 1 : -(i - dotIndex);\n    return 10 ** exponent;\n  });\n\n  return (\n    <span className={cn(\"relative inline-block\", className)}>\n      <span\n        className=\"flex overflow-hidden leading-none\"\n        style={{\n          fontSize,\n          color: textColor,\n          fontWeight,\n          gap: 2,\n          borderRadius: 4,\n        }}\n      >\n        {prefix && <span>{prefix}</span>}\n        {places.map((place, index) => (\n          <Digit key={`${place}-${index}`} place={place} value={displayValue} height={height} />\n        ))}\n        <span className=\"ml-1\">\n          {autoSuffix}\n          {suffix}\n        </span>\n      </span>\n    </span>\n  );\n}\n\n/**\n * Composant simplifié pour les montants M&A\n * Format: \"500 m€\" (espace avant m€)\n */\nexport function MoneyCounter({\n  value,\n  className,\n  size = \"lg\",\n}: {\n  value: number;\n  className?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n}) {\n  const sizeConfig = {\n    sm: { fontSize: 24, fontWeight: 500 },\n    md: { fontSize: 36, fontWeight: 600 },\n    lg: { fontSize: 48, fontWeight: 700 },\n  };\n\n  const config = sizeConfig[size];\n\n  return (\n    <Counter value={value} fontSize={config.fontSize} fontWeight={config.fontWeight} suffix=\"€\" className={className} />\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/motion/Counter.tsx"},"span":[1683,1684],"sourceCode":"\"use client\";\n\n/**\n * Counter - Compteur animé pour valeurs financières\n * Adapté pour Alecia Colab - Format français (500 m€)\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { type MotionValue, motion, useSpring, useTransform } from \"motion/react\";\nimport type React from \"react\";\nimport { useEffect } from \"react\";\n\ntype PlaceValue = number | \".\";\n\ninterface NumberProps {\n  mv: MotionValue<number>;\n  number: number;\n  height: number;\n}\n\nfunction AnimatedNumber({ mv, number, height }: NumberProps) {\n  const y = useTransform(mv, (latest) => {\n    const placeValue = latest % 10;\n    const offset = (10 + number - placeValue) % 10;\n    let memo = offset * height;\n    if (offset > 5) {\n      memo -= 10 * height;\n    }\n    return memo;\n  });\n\n  return (\n    <motion.span className=\"absolute top-0 right-0 bottom-0 left-0 flex items-center justify-center\" style={{ y }}>\n      {number}\n    </motion.span>\n  );\n}\n\ninterface DigitProps {\n  place: PlaceValue;\n  value: number;\n  height: number;\n}\n\nfunction Digit({ place, value, height }: DigitProps) {\n  if (place === \".\") {\n    return (\n      <span className=\"relative font-variant-numeric-tabular-nums\" style={{ height, width: \"0.5ch\" }}>\n        ,\n      </span>\n    );\n  }\n\n  const valueRoundedToPlace = Math.floor(value / place);\n  const animatedValue = useSpring(valueRoundedToPlace, {\n    stiffness: 100,\n    damping: 20,\n  });\n\n  useEffect(() => {\n    animatedValue.set(valueRoundedToPlace);\n  }, [animatedValue, valueRoundedToPlace]);\n\n  return (\n    <span className=\"relative font-variant-numeric-tabular-nums\" style={{ height, width: \"1ch\" }}>\n      {Array.from({ length: 10 }, (_, i) => (\n        <AnimatedNumber key={i} mv={animatedValue} number={i} height={height} />\n      ))}\n    </span>\n  );\n}\n\ninterface CounterProps {\n  value: number;\n  fontSize?: number;\n  suffix?: string;\n  prefix?: string;\n  className?: string;\n  textColor?: string;\n  fontWeight?: React.CSSProperties[\"fontWeight\"];\n}\n\n/**\n * Formatte un nombre en format français (m pour millions)\n * Ex: 500000000 -> \"500 m\"\n */\nfunction formatValue(value: number): { displayValue: number; suffix: string } {\n  if (value >= 1000000000) {\n    return { displayValue: value / 1000000000, suffix: \" Md\" };\n  }\n  if (value >= 1000000) {\n    return { displayValue: value / 1000000, suffix: \" m\" };\n  }\n  if (value >= 1000) {\n    return { displayValue: value / 1000, suffix: \" k\" };\n  }\n  return { displayValue: value, suffix: \"\" };\n}\n\nexport default function Counter({\n  value,\n  fontSize = 48,\n  suffix = \"€\",\n  prefix,\n  className,\n  textColor = \"inherit\",\n  fontWeight = 600,\n}: CounterProps) {\n  const height = fontSize;\n  const { displayValue, suffix: autoSuffix } = formatValue(value);\n\n  // Générer les places pour le nombre formaté\n  const valueStr = displayValue.toFixed(displayValue % 1 === 0 ? 0 : 1);\n  const places: PlaceValue[] = [...valueStr].map((ch, i, a) => {\n    if (ch === \".\") return \".\";\n    const dotIndex = a.indexOf(\".\");\n    const isInteger = dotIndex === -1;\n    const exponent = isInteger ? a.length - i - 1 : i < dotIndex ? dotIndex - i - 1 : -(i - dotIndex);\n    return 10 ** exponent;\n  });\n\n  return (\n    <span className={cn(\"relative inline-block\", className)}>\n      <span\n        className=\"flex overflow-hidden leading-none\"\n        style={{\n          fontSize,\n          color: textColor,\n          fontWeight,\n          gap: 2,\n          borderRadius: 4,\n        }}\n      >\n        {prefix && <span>{prefix}</span>}\n        {places.map((place, index) => (\n          <Digit key={`${place}-${index}`} place={place} value={displayValue} height={height} />\n        ))}\n        <span className=\"ml-1\">\n          {autoSuffix}\n          {suffix}\n        </span>\n      </span>\n    </span>\n  );\n}\n\n/**\n * Composant simplifié pour les montants M&A\n * Format: \"500 m€\" (espace avant m€)\n */\nexport function MoneyCounter({\n  value,\n  className,\n  size = \"lg\",\n}: {\n  value: number;\n  className?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n}) {\n  const sizeConfig = {\n    sm: { fontSize: 24, fontWeight: 500 },\n    md: { fontSize: 36, fontWeight: 600 },\n    lg: { fontSize: 48, fontWeight: 700 },\n  };\n\n  const config = sizeConfig[size];\n\n  return (\n    <Counter value={value} fontSize={config.fontSize} fontWeight={config.fontWeight} suffix=\"€\" className={className} />\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[3512,3517],"sourceCode":"\"use client\";\n\n/**\n * Counter - Compteur animé pour valeurs financières\n * Adapté pour Alecia Colab - Format français (500 m€)\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { type MotionValue, motion, useSpring, useTransform } from \"motion/react\";\nimport type React from \"react\";\nimport { useEffect } from \"react\";\n\ntype PlaceValue = number | \".\";\n\ninterface NumberProps {\n  mv: MotionValue<number>;\n  number: number;\n  height: number;\n}\n\nfunction AnimatedNumber({ mv, number, height }: NumberProps) {\n  const y = useTransform(mv, (latest) => {\n    const placeValue = latest % 10;\n    const offset = (10 + number - placeValue) % 10;\n    let memo = offset * height;\n    if (offset > 5) {\n      memo -= 10 * height;\n    }\n    return memo;\n  });\n\n  return (\n    <motion.span className=\"absolute top-0 right-0 bottom-0 left-0 flex items-center justify-center\" style={{ y }}>\n      {number}\n    </motion.span>\n  );\n}\n\ninterface DigitProps {\n  place: PlaceValue;\n  value: number;\n  height: number;\n}\n\nfunction Digit({ place, value, height }: DigitProps) {\n  if (place === \".\") {\n    return (\n      <span className=\"relative font-variant-numeric-tabular-nums\" style={{ height, width: \"0.5ch\" }}>\n        ,\n      </span>\n    );\n  }\n\n  const valueRoundedToPlace = Math.floor(value / place);\n  const animatedValue = useSpring(valueRoundedToPlace, {\n    stiffness: 100,\n    damping: 20,\n  });\n\n  useEffect(() => {\n    animatedValue.set(valueRoundedToPlace);\n  }, [animatedValue, valueRoundedToPlace]);\n\n  return (\n    <span className=\"relative font-variant-numeric-tabular-nums\" style={{ height, width: \"1ch\" }}>\n      {Array.from({ length: 10 }, (_, i) => (\n        <AnimatedNumber key={i} mv={animatedValue} number={i} height={height} />\n      ))}\n    </span>\n  );\n}\n\ninterface CounterProps {\n  value: number;\n  fontSize?: number;\n  suffix?: string;\n  prefix?: string;\n  className?: string;\n  textColor?: string;\n  fontWeight?: React.CSSProperties[\"fontWeight\"];\n}\n\n/**\n * Formatte un nombre en format français (m pour millions)\n * Ex: 500000000 -> \"500 m\"\n */\nfunction formatValue(value: number): { displayValue: number; suffix: string } {\n  if (value >= 1000000000) {\n    return { displayValue: value / 1000000000, suffix: \" Md\" };\n  }\n  if (value >= 1000000) {\n    return { displayValue: value / 1000000, suffix: \" m\" };\n  }\n  if (value >= 1000) {\n    return { displayValue: value / 1000, suffix: \" k\" };\n  }\n  return { displayValue: value, suffix: \"\" };\n}\n\nexport default function Counter({\n  value,\n  fontSize = 48,\n  suffix = \"€\",\n  prefix,\n  className,\n  textColor = \"inherit\",\n  fontWeight = 600,\n}: CounterProps) {\n  const height = fontSize;\n  const { displayValue, suffix: autoSuffix } = formatValue(value);\n\n  // Générer les places pour le nombre formaté\n  const valueStr = displayValue.toFixed(displayValue % 1 === 0 ? 0 : 1);\n  const places: PlaceValue[] = [...valueStr].map((ch, i, a) => {\n    if (ch === \".\") return \".\";\n    const dotIndex = a.indexOf(\".\");\n    const isInteger = dotIndex === -1;\n    const exponent = isInteger ? a.length - i - 1 : i < dotIndex ? dotIndex - i - 1 : -(i - dotIndex);\n    return 10 ** exponent;\n  });\n\n  return (\n    <span className={cn(\"relative inline-block\", className)}>\n      <span\n        className=\"flex overflow-hidden leading-none\"\n        style={{\n          fontSize,\n          color: textColor,\n          fontWeight,\n          gap: 2,\n          borderRadius: 4,\n        }}\n      >\n        {prefix && <span>{prefix}</span>}\n        {places.map((place, index) => (\n          <Digit key={`${place}-${index}`} place={place} value={displayValue} height={height} />\n        ))}\n        <span className=\"ml-1\">\n          {autoSuffix}\n          {suffix}\n        </span>\n      </span>\n    </span>\n  );\n}\n\n/**\n * Composant simplifié pour les montants M&A\n * Format: \"500 m€\" (espace avant m€)\n */\nexport function MoneyCounter({\n  value,\n  className,\n  size = \"lg\",\n}: {\n  value: number;\n  className?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n}) {\n  const sizeConfig = {\n    sm: { fontSize: 24, fontWeight: 500 },\n    md: { fontSize: 36, fontWeight: 600 },\n    lg: { fontSize: 48, fontWeight: 700 },\n  };\n\n  const config = sizeConfig[size];\n\n  return (\n    <Counter value={value} fontSize={config.fontSize} fontWeight={config.fontWeight} suffix=\"€\" className={className} />\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/motion/Counter.tsx"},"span":[3558,3563],"sourceCode":"\"use client\";\n\n/**\n * Counter - Compteur animé pour valeurs financières\n * Adapté pour Alecia Colab - Format français (500 m€)\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { type MotionValue, motion, useSpring, useTransform } from \"motion/react\";\nimport type React from \"react\";\nimport { useEffect } from \"react\";\n\ntype PlaceValue = number | \".\";\n\ninterface NumberProps {\n  mv: MotionValue<number>;\n  number: number;\n  height: number;\n}\n\nfunction AnimatedNumber({ mv, number, height }: NumberProps) {\n  const y = useTransform(mv, (latest) => {\n    const placeValue = latest % 10;\n    const offset = (10 + number - placeValue) % 10;\n    let memo = offset * height;\n    if (offset > 5) {\n      memo -= 10 * height;\n    }\n    return memo;\n  });\n\n  return (\n    <motion.span className=\"absolute top-0 right-0 bottom-0 left-0 flex items-center justify-center\" style={{ y }}>\n      {number}\n    </motion.span>\n  );\n}\n\ninterface DigitProps {\n  place: PlaceValue;\n  value: number;\n  height: number;\n}\n\nfunction Digit({ place, value, height }: DigitProps) {\n  if (place === \".\") {\n    return (\n      <span className=\"relative font-variant-numeric-tabular-nums\" style={{ height, width: \"0.5ch\" }}>\n        ,\n      </span>\n    );\n  }\n\n  const valueRoundedToPlace = Math.floor(value / place);\n  const animatedValue = useSpring(valueRoundedToPlace, {\n    stiffness: 100,\n    damping: 20,\n  });\n\n  useEffect(() => {\n    animatedValue.set(valueRoundedToPlace);\n  }, [animatedValue, valueRoundedToPlace]);\n\n  return (\n    <span className=\"relative font-variant-numeric-tabular-nums\" style={{ height, width: \"1ch\" }}>\n      {Array.from({ length: 10 }, (_, i) => (\n        <AnimatedNumber key={i} mv={animatedValue} number={i} height={height} />\n      ))}\n    </span>\n  );\n}\n\ninterface CounterProps {\n  value: number;\n  fontSize?: number;\n  suffix?: string;\n  prefix?: string;\n  className?: string;\n  textColor?: string;\n  fontWeight?: React.CSSProperties[\"fontWeight\"];\n}\n\n/**\n * Formatte un nombre en format français (m pour millions)\n * Ex: 500000000 -> \"500 m\"\n */\nfunction formatValue(value: number): { displayValue: number; suffix: string } {\n  if (value >= 1000000000) {\n    return { displayValue: value / 1000000000, suffix: \" Md\" };\n  }\n  if (value >= 1000000) {\n    return { displayValue: value / 1000000, suffix: \" m\" };\n  }\n  if (value >= 1000) {\n    return { displayValue: value / 1000, suffix: \" k\" };\n  }\n  return { displayValue: value, suffix: \"\" };\n}\n\nexport default function Counter({\n  value,\n  fontSize = 48,\n  suffix = \"€\",\n  prefix,\n  className,\n  textColor = \"inherit\",\n  fontWeight = 600,\n}: CounterProps) {\n  const height = fontSize;\n  const { displayValue, suffix: autoSuffix } = formatValue(value);\n\n  // Générer les places pour le nombre formaté\n  const valueStr = displayValue.toFixed(displayValue % 1 === 0 ? 0 : 1);\n  const places: PlaceValue[] = [...valueStr].map((ch, i, a) => {\n    if (ch === \".\") return \".\";\n    const dotIndex = a.indexOf(\".\");\n    const isInteger = dotIndex === -1;\n    const exponent = isInteger ? a.length - i - 1 : i < dotIndex ? dotIndex - i - 1 : -(i - dotIndex);\n    return 10 ** exponent;\n  });\n\n  return (\n    <span className={cn(\"relative inline-block\", className)}>\n      <span\n        className=\"flex overflow-hidden leading-none\"\n        style={{\n          fontSize,\n          color: textColor,\n          fontWeight,\n          gap: 2,\n          borderRadius: 4,\n        }}\n      >\n        {prefix && <span>{prefix}</span>}\n        {places.map((place, index) => (\n          <Digit key={`${place}-${index}`} place={place} value={displayValue} height={height} />\n        ))}\n        <span className=\"ml-1\">\n          {autoSuffix}\n          {suffix}\n        </span>\n      </span>\n    </span>\n  );\n}\n\n/**\n * Composant simplifié pour les montants M&A\n * Format: \"500 m€\" (espace avant m€)\n */\nexport function MoneyCounter({\n  value,\n  className,\n  size = \"lg\",\n}: {\n  value: number;\n  className?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n}) {\n  const sizeConfig = {\n    sm: { fontSize: 24, fontWeight: 500 },\n    md: { fontSize: 36, fontWeight: 600 },\n    lg: { fontSize: 48, fontWeight: 700 },\n  };\n\n  const config = sizeConfig[size];\n\n  return (\n    <Counter value={value} fontSize={config.fontSize} fontWeight={config.fontWeight} suffix=\"€\" className={className} />\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useSemanticElements","severity":"error","description":"The elements with the following roles can be changed to the following elements:\n<select>\n","message":[{"elements":[],"content":"The elements with the following roles can be changed to the following elements:\n<select>\n"}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"For examples and more information, see "},{"elements":[{"Hyperlink":{"href":"https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles"}}],"content":"WAI-ARIA Roles"}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/navigation/ActionSearchBar.tsx"},"span":[7526,7557],"sourceCode":"\"use client\";\n\n/**\n * ActionSearchBar - Barre de recherche et commandes rapides\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { Input } from \"@/components/tailwind/ui/input\";\nimport useDebounce from \"@/hooks/use-debounce\";\nimport {\n  Briefcase,\n  Building,\n  FileText,\n  History,\n  LayoutGrid,\n  PlusCircle,\n  Search,\n  Send,\n  Settings,\n  Users,\n} from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\n\ninterface Action {\n  id: string;\n  label: string;\n  icon: React.ReactNode;\n  description?: string;\n  shortcut?: string;\n  category?: string;\n}\n\ninterface ActionSearchBarProps {\n  actions?: Action[];\n  defaultOpen?: boolean;\n  onActionSelect?: (action: Action) => void;\n  placeholder?: string;\n}\n\nconst ANIMATION_VARIANTS = {\n  container: {\n    hidden: { opacity: 0, height: 0 },\n    show: {\n      opacity: 1,\n      height: \"auto\",\n      transition: {\n        height: { duration: 0.4 },\n        staggerChildren: 0.1,\n      },\n    },\n    exit: {\n      opacity: 0,\n      height: 0,\n      transition: {\n        height: { duration: 0.3 },\n        opacity: { duration: 0.2 },\n      },\n    },\n  },\n  item: {\n    hidden: { opacity: 0, y: 20 },\n    show: {\n      opacity: 1,\n      y: 0,\n      transition: { duration: 0.3 },\n    },\n    exit: {\n      opacity: 0,\n      y: -10,\n      transition: { duration: 0.2 },\n    },\n  },\n} as const;\n\nconst defaultActions: Action[] = [\n  {\n    id: \"new-deal\",\n    label: \"Nouveau deal\",\n    icon: <PlusCircle className=\"h-4 w-4 text-blue-500\" />,\n    description: \"Créer un nouveau deal\",\n    shortcut: \"⌘N\",\n    category: \"Actions\",\n  },\n  {\n    id: \"new-note\",\n    label: \"Nouvelle note\",\n    icon: <FileText className=\"h-4 w-4 text-green-500\" />,\n    description: \"Créer un document\",\n    shortcut: \"⌘⇧N\",\n    category: \"Actions\",\n  },\n  {\n    id: \"pipeline\",\n    label: \"Pipeline\",\n    icon: <LayoutGrid className=\"h-4 w-4 text-purple-500\" />,\n    description: \"Voir le pipeline\",\n    shortcut: \"⌘P\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"deals\",\n    label: \"Rechercher deals\",\n    icon: <Briefcase className=\"h-4 w-4 text-orange-500\" />,\n    description: \"Tous les deals\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"companies\",\n    label: \"Sociétés\",\n    icon: <Building className=\"h-4 w-4 text-indigo-500\" />,\n    description: \"Liste des sociétés\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"team\",\n    label: \"Équipe\",\n    icon: <Users className=\"h-4 w-4 text-pink-500\" />,\n    description: \"Collaborateurs\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"history\",\n    label: \"Historique\",\n    icon: <History className=\"h-4 w-4 text-gray-500\" />,\n    description: \"Activité récente\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"settings\",\n    label: \"Paramètres\",\n    icon: <Settings className=\"h-4 w-4 text-gray-500\" />,\n    description: \"Configuration\",\n    shortcut: \"⌘,\",\n    category: \"Système\",\n  },\n];\n\nexport default function ActionSearchBar({\n  actions = defaultActions,\n  defaultOpen = false,\n  onActionSelect,\n  placeholder = \"Rechercher une commande...\",\n}: ActionSearchBarProps) {\n  const [query, setQuery] = useState(\"\");\n  const [isFocused, setIsFocused] = useState(defaultOpen);\n  const [activeIndex, setActiveIndex] = useState(-1);\n  const debouncedQuery = useDebounce(query, 200);\n\n  const filteredActions = useMemo(() => {\n    if (!debouncedQuery) return actions;\n\n    const normalizedQuery = debouncedQuery.toLowerCase().trim();\n    return actions.filter((action) => {\n      const searchableText = `${action.label} ${action.description || \"\"}`.toLowerCase();\n      return searchableText.includes(normalizedQuery);\n    });\n  }, [debouncedQuery, actions]);\n\n  useEffect(() => {\n    if (!isFocused) {\n      setActiveIndex(-1);\n    } else {\n      setActiveIndex(-1);\n    }\n  }, [filteredActions, isFocused]);\n\n  const handleInputChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setQuery(e.target.value);\n    setActiveIndex(-1);\n  }, []);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (!filteredActions.length) return;\n\n      switch (e.key) {\n        case \"ArrowDown\":\n          e.preventDefault();\n          setActiveIndex((prev) => (prev < filteredActions.length - 1 ? prev + 1 : 0));\n          break;\n        case \"ArrowUp\":\n          e.preventDefault();\n          setActiveIndex((prev) => (prev > 0 ? prev - 1 : filteredActions.length - 1));\n          break;\n        case \"Enter\":\n          e.preventDefault();\n          if (activeIndex >= 0 && filteredActions[activeIndex]) {\n            onActionSelect?.(filteredActions[activeIndex]);\n          }\n          break;\n        case \"Escape\":\n          setIsFocused(false);\n          setActiveIndex(-1);\n          break;\n      }\n    },\n    [filteredActions, activeIndex, onActionSelect],\n  );\n\n  const handleActionClick = useCallback(\n    (action: Action) => {\n      onActionSelect?.(action);\n      setIsFocused(false);\n      setQuery(\"\");\n    },\n    [onActionSelect],\n  );\n\n  return (\n    <div className=\"w-full max-w-xl mx-auto\">\n      <div className=\"relative flex flex-col justify-start items-center min-h-[300px]\">\n        <div className=\"w-full max-w-sm sticky top-0 bg-background z-10 pt-4 pb-1\">\n          <label className=\"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1 block\" htmlFor=\"action-search\">\n            Commandes\n          </label>\n          <div className=\"relative\">\n            <Input\n              type=\"text\"\n              placeholder={placeholder}\n              value={query}\n              onChange={handleInputChange}\n              onFocus={() => setIsFocused(true)}\n              onBlur={() => setTimeout(() => setIsFocused(false), 200)}\n              onKeyDown={handleKeyDown}\n              role=\"combobox\"\n              aria-expanded={isFocused}\n              aria-autocomplete=\"list\"\n              id=\"action-search\"\n              autoComplete=\"off\"\n              className=\"pl-3 pr-9 py-1.5 h-9 text-sm rounded-lg focus-visible:ring-offset-0\"\n            />\n            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4\">\n              <AnimatePresence mode=\"popLayout\">\n                {query.length > 0 ? (\n                  <motion.div\n                    key=\"send\"\n                    initial={{ y: -20, opacity: 0 }}\n                    animate={{ y: 0, opacity: 1 }}\n                    exit={{ y: 20, opacity: 0 }}\n                    transition={{ duration: 0.2 }}\n                  >\n                    <Send className=\"w-4 h-4 text-gray-400 dark:text-gray-500\" />\n                  </motion.div>\n                ) : (\n                  <motion.div\n                    key=\"search\"\n                    initial={{ y: -20, opacity: 0 }}\n                    animate={{ y: 0, opacity: 1 }}\n                    exit={{ y: 20, opacity: 0 }}\n                    transition={{ duration: 0.2 }}\n                  >\n                    <Search className=\"w-4 h-4 text-gray-400 dark:text-gray-500\" />\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"w-full max-w-sm\">\n          <AnimatePresence>\n            {isFocused && (\n              <motion.div\n                className=\"w-full border rounded-md shadow-xs overflow-hidden dark:border-gray-800 bg-white dark:bg-black mt-1\"\n                variants={ANIMATION_VARIANTS.container}\n                role=\"listbox\"\n                aria-label=\"Résultats de recherche\"\n                initial=\"hidden\"\n                animate=\"show\"\n                exit=\"exit\"\n              >\n                <motion.ul>\n                  {filteredActions.map((action, index) => (\n                    <motion.li\n                      key={action.id}\n                      id={`action-${action.id}`}\n                      className={`px-3 py-2 flex items-center justify-between hover:bg-gray-200 dark:hover:bg-zinc-900 cursor-pointer rounded-md ${\n                        activeIndex === index ? \"bg-gray-100 dark:bg-zinc-800\" : \"\"\n                      }`}\n                      variants={ANIMATION_VARIANTS.item}\n                      layout\n                      onClick={() => handleActionClick(action)}\n                      role=\"option\"\n                      aria-selected={activeIndex === index}\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-gray-500\" aria-hidden=\"true\">\n                          {action.icon}\n                        </span>\n                        <span className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">{action.label}</span>\n                        {action.description && <span className=\"text-xs text-gray-400\">{action.description}</span>}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {action.shortcut && <span className=\"text-xs text-gray-400\">{action.shortcut}</span>}\n                        {action.category && <span className=\"text-xs text-gray-400 text-right\">{action.category}</span>}\n                      </div>\n                    </motion.li>\n                  ))}\n                </motion.ul>\n                <div className=\"mt-2 px-3 py-2 border-t border-gray-100 dark:border-gray-800\">\n                  <div className=\"flex items-center justify-between text-xs text-gray-500\">\n                    <span>Appuyez sur ⌘K pour ouvrir</span>\n                    <span>ESC pour fermer</span>\n                  </div>\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useSemanticElements","severity":"error","description":"The elements with the following roles can be changed to the following elements:\n<option>\n","message":[{"elements":[],"content":"The elements with the following roles can be changed to the following elements:\n<option>\n"}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"For examples and more information, see "},{"elements":[{"Hyperlink":{"href":"https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles"}}],"content":"WAI-ARIA Roles"}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/navigation/ActionSearchBar.tsx"},"span":[8332,8368],"sourceCode":"\"use client\";\n\n/**\n * ActionSearchBar - Barre de recherche et commandes rapides\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { Input } from \"@/components/tailwind/ui/input\";\nimport useDebounce from \"@/hooks/use-debounce\";\nimport {\n  Briefcase,\n  Building,\n  FileText,\n  History,\n  LayoutGrid,\n  PlusCircle,\n  Search,\n  Send,\n  Settings,\n  Users,\n} from \"lucide-react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\n\ninterface Action {\n  id: string;\n  label: string;\n  icon: React.ReactNode;\n  description?: string;\n  shortcut?: string;\n  category?: string;\n}\n\ninterface ActionSearchBarProps {\n  actions?: Action[];\n  defaultOpen?: boolean;\n  onActionSelect?: (action: Action) => void;\n  placeholder?: string;\n}\n\nconst ANIMATION_VARIANTS = {\n  container: {\n    hidden: { opacity: 0, height: 0 },\n    show: {\n      opacity: 1,\n      height: \"auto\",\n      transition: {\n        height: { duration: 0.4 },\n        staggerChildren: 0.1,\n      },\n    },\n    exit: {\n      opacity: 0,\n      height: 0,\n      transition: {\n        height: { duration: 0.3 },\n        opacity: { duration: 0.2 },\n      },\n    },\n  },\n  item: {\n    hidden: { opacity: 0, y: 20 },\n    show: {\n      opacity: 1,\n      y: 0,\n      transition: { duration: 0.3 },\n    },\n    exit: {\n      opacity: 0,\n      y: -10,\n      transition: { duration: 0.2 },\n    },\n  },\n} as const;\n\nconst defaultActions: Action[] = [\n  {\n    id: \"new-deal\",\n    label: \"Nouveau deal\",\n    icon: <PlusCircle className=\"h-4 w-4 text-blue-500\" />,\n    description: \"Créer un nouveau deal\",\n    shortcut: \"⌘N\",\n    category: \"Actions\",\n  },\n  {\n    id: \"new-note\",\n    label: \"Nouvelle note\",\n    icon: <FileText className=\"h-4 w-4 text-green-500\" />,\n    description: \"Créer un document\",\n    shortcut: \"⌘⇧N\",\n    category: \"Actions\",\n  },\n  {\n    id: \"pipeline\",\n    label: \"Pipeline\",\n    icon: <LayoutGrid className=\"h-4 w-4 text-purple-500\" />,\n    description: \"Voir le pipeline\",\n    shortcut: \"⌘P\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"deals\",\n    label: \"Rechercher deals\",\n    icon: <Briefcase className=\"h-4 w-4 text-orange-500\" />,\n    description: \"Tous les deals\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"companies\",\n    label: \"Sociétés\",\n    icon: <Building className=\"h-4 w-4 text-indigo-500\" />,\n    description: \"Liste des sociétés\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"team\",\n    label: \"Équipe\",\n    icon: <Users className=\"h-4 w-4 text-pink-500\" />,\n    description: \"Collaborateurs\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"history\",\n    label: \"Historique\",\n    icon: <History className=\"h-4 w-4 text-gray-500\" />,\n    description: \"Activité récente\",\n    category: \"Navigation\",\n  },\n  {\n    id: \"settings\",\n    label: \"Paramètres\",\n    icon: <Settings className=\"h-4 w-4 text-gray-500\" />,\n    description: \"Configuration\",\n    shortcut: \"⌘,\",\n    category: \"Système\",\n  },\n];\n\nexport default function ActionSearchBar({\n  actions = defaultActions,\n  defaultOpen = false,\n  onActionSelect,\n  placeholder = \"Rechercher une commande...\",\n}: ActionSearchBarProps) {\n  const [query, setQuery] = useState(\"\");\n  const [isFocused, setIsFocused] = useState(defaultOpen);\n  const [activeIndex, setActiveIndex] = useState(-1);\n  const debouncedQuery = useDebounce(query, 200);\n\n  const filteredActions = useMemo(() => {\n    if (!debouncedQuery) return actions;\n\n    const normalizedQuery = debouncedQuery.toLowerCase().trim();\n    return actions.filter((action) => {\n      const searchableText = `${action.label} ${action.description || \"\"}`.toLowerCase();\n      return searchableText.includes(normalizedQuery);\n    });\n  }, [debouncedQuery, actions]);\n\n  useEffect(() => {\n    if (!isFocused) {\n      setActiveIndex(-1);\n    } else {\n      setActiveIndex(-1);\n    }\n  }, [filteredActions, isFocused]);\n\n  const handleInputChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setQuery(e.target.value);\n    setActiveIndex(-1);\n  }, []);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (!filteredActions.length) return;\n\n      switch (e.key) {\n        case \"ArrowDown\":\n          e.preventDefault();\n          setActiveIndex((prev) => (prev < filteredActions.length - 1 ? prev + 1 : 0));\n          break;\n        case \"ArrowUp\":\n          e.preventDefault();\n          setActiveIndex((prev) => (prev > 0 ? prev - 1 : filteredActions.length - 1));\n          break;\n        case \"Enter\":\n          e.preventDefault();\n          if (activeIndex >= 0 && filteredActions[activeIndex]) {\n            onActionSelect?.(filteredActions[activeIndex]);\n          }\n          break;\n        case \"Escape\":\n          setIsFocused(false);\n          setActiveIndex(-1);\n          break;\n      }\n    },\n    [filteredActions, activeIndex, onActionSelect],\n  );\n\n  const handleActionClick = useCallback(\n    (action: Action) => {\n      onActionSelect?.(action);\n      setIsFocused(false);\n      setQuery(\"\");\n    },\n    [onActionSelect],\n  );\n\n  return (\n    <div className=\"w-full max-w-xl mx-auto\">\n      <div className=\"relative flex flex-col justify-start items-center min-h-[300px]\">\n        <div className=\"w-full max-w-sm sticky top-0 bg-background z-10 pt-4 pb-1\">\n          <label className=\"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1 block\" htmlFor=\"action-search\">\n            Commandes\n          </label>\n          <div className=\"relative\">\n            <Input\n              type=\"text\"\n              placeholder={placeholder}\n              value={query}\n              onChange={handleInputChange}\n              onFocus={() => setIsFocused(true)}\n              onBlur={() => setTimeout(() => setIsFocused(false), 200)}\n              onKeyDown={handleKeyDown}\n              role=\"combobox\"\n              aria-expanded={isFocused}\n              aria-autocomplete=\"list\"\n              id=\"action-search\"\n              autoComplete=\"off\"\n              className=\"pl-3 pr-9 py-1.5 h-9 text-sm rounded-lg focus-visible:ring-offset-0\"\n            />\n            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4\">\n              <AnimatePresence mode=\"popLayout\">\n                {query.length > 0 ? (\n                  <motion.div\n                    key=\"send\"\n                    initial={{ y: -20, opacity: 0 }}\n                    animate={{ y: 0, opacity: 1 }}\n                    exit={{ y: 20, opacity: 0 }}\n                    transition={{ duration: 0.2 }}\n                  >\n                    <Send className=\"w-4 h-4 text-gray-400 dark:text-gray-500\" />\n                  </motion.div>\n                ) : (\n                  <motion.div\n                    key=\"search\"\n                    initial={{ y: -20, opacity: 0 }}\n                    animate={{ y: 0, opacity: 1 }}\n                    exit={{ y: 20, opacity: 0 }}\n                    transition={{ duration: 0.2 }}\n                  >\n                    <Search className=\"w-4 h-4 text-gray-400 dark:text-gray-500\" />\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"w-full max-w-sm\">\n          <AnimatePresence>\n            {isFocused && (\n              <motion.div\n                className=\"w-full border rounded-md shadow-xs overflow-hidden dark:border-gray-800 bg-white dark:bg-black mt-1\"\n                variants={ANIMATION_VARIANTS.container}\n                role=\"listbox\"\n                aria-label=\"Résultats de recherche\"\n                initial=\"hidden\"\n                animate=\"show\"\n                exit=\"exit\"\n              >\n                <motion.ul>\n                  {filteredActions.map((action, index) => (\n                    <motion.li\n                      key={action.id}\n                      id={`action-${action.id}`}\n                      className={`px-3 py-2 flex items-center justify-between hover:bg-gray-200 dark:hover:bg-zinc-900 cursor-pointer rounded-md ${\n                        activeIndex === index ? \"bg-gray-100 dark:bg-zinc-800\" : \"\"\n                      }`}\n                      variants={ANIMATION_VARIANTS.item}\n                      layout\n                      onClick={() => handleActionClick(action)}\n                      role=\"option\"\n                      aria-selected={activeIndex === index}\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-gray-500\" aria-hidden=\"true\">\n                          {action.icon}\n                        </span>\n                        <span className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">{action.label}</span>\n                        {action.description && <span className=\"text-xs text-gray-400\">{action.description}</span>}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {action.shortcut && <span className=\"text-xs text-gray-400\">{action.shortcut}</span>}\n                        {action.category && <span className=\"text-xs text-gray-400 text-right\">{action.category}</span>}\n                      </div>\n                    </motion.li>\n                  ))}\n                </motion.ul>\n                <div className=\"mt-2 px-3 py-2 border-t border-gray-100 dark:border-gray-800\">\n                  <div className=\"flex items-center justify-between text-xs text-gray-500\">\n                    <span>Appuyez sur ⌘K pour ouvrir</span>\n                    <span>ESC pour fermer</span>\n                  </div>\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useSemanticElements","severity":"error","description":"The elements with the following roles can be changed to the following elements:\n<button>\n<input type=\"button\">\n","message":[{"elements":[],"content":"The elements with the following roles can be changed to the following elements:\n<button>\n<input type=\"button\">\n"}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"For examples and more information, see "},{"elements":[{"Hyperlink":{"href":"https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles"}}],"content":"WAI-ARIA Roles"}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/navigation/Dock.tsx"},"span":[2233,2253],"sourceCode":"\"use client\";\n\n/**\n * Dock - Navigation inférieure type macOS\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { Briefcase, FileText, Home, Settings } from \"lucide-react\";\nimport {\n  AnimatePresence,\n  type MotionValue,\n  type SpringOptions,\n  motion,\n  useMotionValue,\n  useSpring,\n  useTransform,\n} from \"motion/react\";\nimport React, { Children, cloneElement, useEffect, useMemo, useRef, useState } from \"react\";\n\nexport interface DockItemData {\n  icon: React.ReactNode;\n  label: string;\n  onClick: () => void;\n  className?: string;\n}\n\ninterface DockProps {\n  items?: DockItemData[];\n  className?: string;\n  distance?: number;\n  panelHeight?: number;\n  baseItemSize?: number;\n  magnification?: number;\n  spring?: SpringOptions;\n}\n\ninterface DockItemProps {\n  className?: string;\n  children: React.ReactNode;\n  onClick?: () => void;\n  mouseX: MotionValue<number>;\n  spring: SpringOptions;\n  distance: number;\n  baseItemSize: number;\n  magnification: number;\n}\n\nfunction DockItem({\n  children,\n  className = \"\",\n  onClick,\n  mouseX,\n  spring,\n  distance,\n  magnification,\n  baseItemSize,\n}: DockItemProps) {\n  const ref = useRef<HTMLDivElement>(null);\n  const isHovered = useMotionValue(0);\n\n  const mouseDistance = useTransform(mouseX, (val) => {\n    const rect = ref.current?.getBoundingClientRect() ?? {\n      x: 0,\n      width: baseItemSize,\n    };\n    return val - rect.x - baseItemSize / 2;\n  });\n\n  const targetSize = useTransform(mouseDistance, [-distance, 0, distance], [baseItemSize, magnification, baseItemSize]);\n  const size = useSpring(targetSize, spring);\n\n  return (\n    <motion.div\n      ref={ref}\n      style={{ width: size, height: size }}\n      onHoverStart={() => isHovered.set(1)}\n      onHoverEnd={() => isHovered.set(0)}\n      onFocus={() => isHovered.set(1)}\n      onBlur={() => isHovered.set(0)}\n      onClick={onClick}\n      className={cn(\n        \"relative inline-flex items-center justify-center\",\n        \"rounded-xl bg-white dark:bg-gray-900\",\n        \"border border-gray-200 dark:border-gray-700\",\n        \"shadow-sm cursor-pointer outline-none\",\n        \"hover:shadow-md transition-shadow duration-200\",\n        className,\n      )}\n      tabIndex={0}\n      role=\"button\"\n    >\n      {Children.map(children, (child) =>\n        React.isValidElement(child)\n          ? cloneElement(child as React.ReactElement<{ isHovered?: MotionValue<number> }>, { isHovered })\n          : child,\n      )}\n    </motion.div>\n  );\n}\n\ninterface DockLabelProps {\n  className?: string;\n  children: React.ReactNode;\n  isHovered?: MotionValue<number>;\n}\n\nfunction DockLabel({ children, className = \"\", isHovered }: DockLabelProps) {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    if (!isHovered) return;\n    const unsubscribe = isHovered.on(\"change\", (latest) => {\n      setIsVisible(latest === 1);\n    });\n    return () => unsubscribe();\n  }, [isHovered]);\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0, y: 0 }}\n          animate={{ opacity: 1, y: -10 }}\n          exit={{ opacity: 0, y: 0 }}\n          transition={{ duration: 0.2 }}\n          className={cn(\n            \"absolute -top-8 left-1/2 -translate-x-1/2\",\n            \"w-max whitespace-nowrap\",\n            \"rounded-md border border-gray-200 dark:border-gray-700\",\n            \"bg-white dark:bg-gray-900 px-2 py-1\",\n            \"text-xs font-medium text-gray-900 dark:text-white\",\n            \"shadow-sm\",\n            className,\n          )}\n          role=\"tooltip\"\n        >\n          {children}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n\ninterface DockIconProps {\n  className?: string;\n  children: React.ReactNode;\n}\n\nfunction DockIcon({ children, className = \"\" }: DockIconProps) {\n  return (\n    <div className={cn(\"flex items-center justify-center\", \"text-gray-600 dark:text-gray-400\", className)}>\n      {children}\n    </div>\n  );\n}\n\n// Configuration par défaut en français\nconst defaultItems: DockItemData[] = [\n  {\n    icon: <Home className=\"h-5 w-5\" />,\n    label: \"Accueil\",\n    onClick: () => {},\n  },\n  {\n    icon: <Briefcase className=\"h-5 w-5\" />,\n    label: \"Pipeline\",\n    onClick: () => {},\n  },\n  {\n    icon: <FileText className=\"h-5 w-5\" />,\n    label: \"Documents\",\n    onClick: () => {},\n  },\n  {\n    icon: <Settings className=\"h-5 w-5\" />,\n    label: \"Paramètres\",\n    onClick: () => {},\n  },\n];\n\nexport default function Dock({\n  items = defaultItems,\n  className = \"\",\n  spring = { mass: 0.1, stiffness: 150, damping: 12 },\n  magnification = 70,\n  distance = 200,\n  panelHeight = 64,\n  baseItemSize = 48,\n}: DockProps) {\n  const mouseX = useMotionValue(Number.POSITIVE_INFINITY);\n  const isHovered = useMotionValue(0);\n\n  const maxHeight = useMemo(\n    () => Math.max(panelHeight + 20, magnification + magnification / 2 + 4),\n    [magnification, panelHeight],\n  );\n  const heightRow = useTransform(isHovered, [0, 1], [panelHeight, maxHeight]);\n  const height = useSpring(heightRow, spring);\n\n  return (\n    <motion.div style={{ height }} className=\"fixed bottom-4 left-1/2 -translate-x-1/2 z-50\">\n      <motion.div\n        onMouseMove={({ pageX }) => {\n          isHovered.set(1);\n          mouseX.set(pageX);\n        }}\n        onMouseLeave={() => {\n          isHovered.set(0);\n          mouseX.set(Number.POSITIVE_INFINITY);\n        }}\n        className={cn(\n          \"flex items-end gap-3 px-3 pb-2\",\n          \"rounded-2xl border border-gray-200 dark:border-gray-700\",\n          \"bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg\",\n          \"shadow-lg\",\n          className,\n        )}\n        style={{ height: panelHeight }}\n        role=\"toolbar\"\n        aria-label=\"Navigation principale\"\n      >\n        {items.map((item, index) => (\n          <DockItem\n            key={index}\n            onClick={item.onClick}\n            className={item.className}\n            mouseX={mouseX}\n            spring={spring}\n            distance={distance}\n            magnification={magnification}\n            baseItemSize={baseItemSize}\n          >\n            <DockIcon>{item.icon}</DockIcon>\n            <DockLabel>{item.label}</DockLabel>\n          </DockItem>\n        ))}\n      </motion.div>\n    </motion.div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[5788,5793],"sourceCode":"\"use client\";\n\n/**\n * Dock - Navigation inférieure type macOS\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { Briefcase, FileText, Home, Settings } from \"lucide-react\";\nimport {\n  AnimatePresence,\n  type MotionValue,\n  type SpringOptions,\n  motion,\n  useMotionValue,\n  useSpring,\n  useTransform,\n} from \"motion/react\";\nimport React, { Children, cloneElement, useEffect, useMemo, useRef, useState } from \"react\";\n\nexport interface DockItemData {\n  icon: React.ReactNode;\n  label: string;\n  onClick: () => void;\n  className?: string;\n}\n\ninterface DockProps {\n  items?: DockItemData[];\n  className?: string;\n  distance?: number;\n  panelHeight?: number;\n  baseItemSize?: number;\n  magnification?: number;\n  spring?: SpringOptions;\n}\n\ninterface DockItemProps {\n  className?: string;\n  children: React.ReactNode;\n  onClick?: () => void;\n  mouseX: MotionValue<number>;\n  spring: SpringOptions;\n  distance: number;\n  baseItemSize: number;\n  magnification: number;\n}\n\nfunction DockItem({\n  children,\n  className = \"\",\n  onClick,\n  mouseX,\n  spring,\n  distance,\n  magnification,\n  baseItemSize,\n}: DockItemProps) {\n  const ref = useRef<HTMLDivElement>(null);\n  const isHovered = useMotionValue(0);\n\n  const mouseDistance = useTransform(mouseX, (val) => {\n    const rect = ref.current?.getBoundingClientRect() ?? {\n      x: 0,\n      width: baseItemSize,\n    };\n    return val - rect.x - baseItemSize / 2;\n  });\n\n  const targetSize = useTransform(mouseDistance, [-distance, 0, distance], [baseItemSize, magnification, baseItemSize]);\n  const size = useSpring(targetSize, spring);\n\n  return (\n    <motion.div\n      ref={ref}\n      style={{ width: size, height: size }}\n      onHoverStart={() => isHovered.set(1)}\n      onHoverEnd={() => isHovered.set(0)}\n      onFocus={() => isHovered.set(1)}\n      onBlur={() => isHovered.set(0)}\n      onClick={onClick}\n      className={cn(\n        \"relative inline-flex items-center justify-center\",\n        \"rounded-xl bg-white dark:bg-gray-900\",\n        \"border border-gray-200 dark:border-gray-700\",\n        \"shadow-sm cursor-pointer outline-none\",\n        \"hover:shadow-md transition-shadow duration-200\",\n        className,\n      )}\n      tabIndex={0}\n      role=\"button\"\n    >\n      {Children.map(children, (child) =>\n        React.isValidElement(child)\n          ? cloneElement(child as React.ReactElement<{ isHovered?: MotionValue<number> }>, { isHovered })\n          : child,\n      )}\n    </motion.div>\n  );\n}\n\ninterface DockLabelProps {\n  className?: string;\n  children: React.ReactNode;\n  isHovered?: MotionValue<number>;\n}\n\nfunction DockLabel({ children, className = \"\", isHovered }: DockLabelProps) {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    if (!isHovered) return;\n    const unsubscribe = isHovered.on(\"change\", (latest) => {\n      setIsVisible(latest === 1);\n    });\n    return () => unsubscribe();\n  }, [isHovered]);\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0, y: 0 }}\n          animate={{ opacity: 1, y: -10 }}\n          exit={{ opacity: 0, y: 0 }}\n          transition={{ duration: 0.2 }}\n          className={cn(\n            \"absolute -top-8 left-1/2 -translate-x-1/2\",\n            \"w-max whitespace-nowrap\",\n            \"rounded-md border border-gray-200 dark:border-gray-700\",\n            \"bg-white dark:bg-gray-900 px-2 py-1\",\n            \"text-xs font-medium text-gray-900 dark:text-white\",\n            \"shadow-sm\",\n            className,\n          )}\n          role=\"tooltip\"\n        >\n          {children}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n\ninterface DockIconProps {\n  className?: string;\n  children: React.ReactNode;\n}\n\nfunction DockIcon({ children, className = \"\" }: DockIconProps) {\n  return (\n    <div className={cn(\"flex items-center justify-center\", \"text-gray-600 dark:text-gray-400\", className)}>\n      {children}\n    </div>\n  );\n}\n\n// Configuration par défaut en français\nconst defaultItems: DockItemData[] = [\n  {\n    icon: <Home className=\"h-5 w-5\" />,\n    label: \"Accueil\",\n    onClick: () => {},\n  },\n  {\n    icon: <Briefcase className=\"h-5 w-5\" />,\n    label: \"Pipeline\",\n    onClick: () => {},\n  },\n  {\n    icon: <FileText className=\"h-5 w-5\" />,\n    label: \"Documents\",\n    onClick: () => {},\n  },\n  {\n    icon: <Settings className=\"h-5 w-5\" />,\n    label: \"Paramètres\",\n    onClick: () => {},\n  },\n];\n\nexport default function Dock({\n  items = defaultItems,\n  className = \"\",\n  spring = { mass: 0.1, stiffness: 150, damping: 12 },\n  magnification = 70,\n  distance = 200,\n  panelHeight = 64,\n  baseItemSize = 48,\n}: DockProps) {\n  const mouseX = useMotionValue(Number.POSITIVE_INFINITY);\n  const isHovered = useMotionValue(0);\n\n  const maxHeight = useMemo(\n    () => Math.max(panelHeight + 20, magnification + magnification / 2 + 4),\n    [magnification, panelHeight],\n  );\n  const heightRow = useTransform(isHovered, [0, 1], [panelHeight, maxHeight]);\n  const height = useSpring(heightRow, spring);\n\n  return (\n    <motion.div style={{ height }} className=\"fixed bottom-4 left-1/2 -translate-x-1/2 z-50\">\n      <motion.div\n        onMouseMove={({ pageX }) => {\n          isHovered.set(1);\n          mouseX.set(pageX);\n        }}\n        onMouseLeave={() => {\n          isHovered.set(0);\n          mouseX.set(Number.POSITIVE_INFINITY);\n        }}\n        className={cn(\n          \"flex items-end gap-3 px-3 pb-2\",\n          \"rounded-2xl border border-gray-200 dark:border-gray-700\",\n          \"bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg\",\n          \"shadow-lg\",\n          className,\n        )}\n        style={{ height: panelHeight }}\n        role=\"toolbar\"\n        aria-label=\"Navigation principale\"\n      >\n        {items.map((item, index) => (\n          <DockItem\n            key={index}\n            onClick={item.onClick}\n            className={item.className}\n            mouseX={mouseX}\n            spring={spring}\n            distance={distance}\n            magnification={magnification}\n            baseItemSize={baseItemSize}\n          >\n            <DockIcon>{item.icon}</DockIcon>\n            <DockLabel>{item.label}</DockLabel>\n          </DockItem>\n        ))}\n      </motion.div>\n    </motion.div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/navigation/Dock.tsx"},"span":[5837,5842],"sourceCode":"\"use client\";\n\n/**\n * Dock - Navigation inférieure type macOS\n * Adapté pour Alecia Colab - Interface française\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { Briefcase, FileText, Home, Settings } from \"lucide-react\";\nimport {\n  AnimatePresence,\n  type MotionValue,\n  type SpringOptions,\n  motion,\n  useMotionValue,\n  useSpring,\n  useTransform,\n} from \"motion/react\";\nimport React, { Children, cloneElement, useEffect, useMemo, useRef, useState } from \"react\";\n\nexport interface DockItemData {\n  icon: React.ReactNode;\n  label: string;\n  onClick: () => void;\n  className?: string;\n}\n\ninterface DockProps {\n  items?: DockItemData[];\n  className?: string;\n  distance?: number;\n  panelHeight?: number;\n  baseItemSize?: number;\n  magnification?: number;\n  spring?: SpringOptions;\n}\n\ninterface DockItemProps {\n  className?: string;\n  children: React.ReactNode;\n  onClick?: () => void;\n  mouseX: MotionValue<number>;\n  spring: SpringOptions;\n  distance: number;\n  baseItemSize: number;\n  magnification: number;\n}\n\nfunction DockItem({\n  children,\n  className = \"\",\n  onClick,\n  mouseX,\n  spring,\n  distance,\n  magnification,\n  baseItemSize,\n}: DockItemProps) {\n  const ref = useRef<HTMLDivElement>(null);\n  const isHovered = useMotionValue(0);\n\n  const mouseDistance = useTransform(mouseX, (val) => {\n    const rect = ref.current?.getBoundingClientRect() ?? {\n      x: 0,\n      width: baseItemSize,\n    };\n    return val - rect.x - baseItemSize / 2;\n  });\n\n  const targetSize = useTransform(mouseDistance, [-distance, 0, distance], [baseItemSize, magnification, baseItemSize]);\n  const size = useSpring(targetSize, spring);\n\n  return (\n    <motion.div\n      ref={ref}\n      style={{ width: size, height: size }}\n      onHoverStart={() => isHovered.set(1)}\n      onHoverEnd={() => isHovered.set(0)}\n      onFocus={() => isHovered.set(1)}\n      onBlur={() => isHovered.set(0)}\n      onClick={onClick}\n      className={cn(\n        \"relative inline-flex items-center justify-center\",\n        \"rounded-xl bg-white dark:bg-gray-900\",\n        \"border border-gray-200 dark:border-gray-700\",\n        \"shadow-sm cursor-pointer outline-none\",\n        \"hover:shadow-md transition-shadow duration-200\",\n        className,\n      )}\n      tabIndex={0}\n      role=\"button\"\n    >\n      {Children.map(children, (child) =>\n        React.isValidElement(child)\n          ? cloneElement(child as React.ReactElement<{ isHovered?: MotionValue<number> }>, { isHovered })\n          : child,\n      )}\n    </motion.div>\n  );\n}\n\ninterface DockLabelProps {\n  className?: string;\n  children: React.ReactNode;\n  isHovered?: MotionValue<number>;\n}\n\nfunction DockLabel({ children, className = \"\", isHovered }: DockLabelProps) {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    if (!isHovered) return;\n    const unsubscribe = isHovered.on(\"change\", (latest) => {\n      setIsVisible(latest === 1);\n    });\n    return () => unsubscribe();\n  }, [isHovered]);\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0, y: 0 }}\n          animate={{ opacity: 1, y: -10 }}\n          exit={{ opacity: 0, y: 0 }}\n          transition={{ duration: 0.2 }}\n          className={cn(\n            \"absolute -top-8 left-1/2 -translate-x-1/2\",\n            \"w-max whitespace-nowrap\",\n            \"rounded-md border border-gray-200 dark:border-gray-700\",\n            \"bg-white dark:bg-gray-900 px-2 py-1\",\n            \"text-xs font-medium text-gray-900 dark:text-white\",\n            \"shadow-sm\",\n            className,\n          )}\n          role=\"tooltip\"\n        >\n          {children}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n\ninterface DockIconProps {\n  className?: string;\n  children: React.ReactNode;\n}\n\nfunction DockIcon({ children, className = \"\" }: DockIconProps) {\n  return (\n    <div className={cn(\"flex items-center justify-center\", \"text-gray-600 dark:text-gray-400\", className)}>\n      {children}\n    </div>\n  );\n}\n\n// Configuration par défaut en français\nconst defaultItems: DockItemData[] = [\n  {\n    icon: <Home className=\"h-5 w-5\" />,\n    label: \"Accueil\",\n    onClick: () => {},\n  },\n  {\n    icon: <Briefcase className=\"h-5 w-5\" />,\n    label: \"Pipeline\",\n    onClick: () => {},\n  },\n  {\n    icon: <FileText className=\"h-5 w-5\" />,\n    label: \"Documents\",\n    onClick: () => {},\n  },\n  {\n    icon: <Settings className=\"h-5 w-5\" />,\n    label: \"Paramètres\",\n    onClick: () => {},\n  },\n];\n\nexport default function Dock({\n  items = defaultItems,\n  className = \"\",\n  spring = { mass: 0.1, stiffness: 150, damping: 12 },\n  magnification = 70,\n  distance = 200,\n  panelHeight = 64,\n  baseItemSize = 48,\n}: DockProps) {\n  const mouseX = useMotionValue(Number.POSITIVE_INFINITY);\n  const isHovered = useMotionValue(0);\n\n  const maxHeight = useMemo(\n    () => Math.max(panelHeight + 20, magnification + magnification / 2 + 4),\n    [magnification, panelHeight],\n  );\n  const heightRow = useTransform(isHovered, [0, 1], [panelHeight, maxHeight]);\n  const height = useSpring(heightRow, spring);\n\n  return (\n    <motion.div style={{ height }} className=\"fixed bottom-4 left-1/2 -translate-x-1/2 z-50\">\n      <motion.div\n        onMouseMove={({ pageX }) => {\n          isHovered.set(1);\n          mouseX.set(pageX);\n        }}\n        onMouseLeave={() => {\n          isHovered.set(0);\n          mouseX.set(Number.POSITIVE_INFINITY);\n        }}\n        className={cn(\n          \"flex items-end gap-3 px-3 pb-2\",\n          \"rounded-2xl border border-gray-200 dark:border-gray-700\",\n          \"bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg\",\n          \"shadow-lg\",\n          className,\n        )}\n        style={{ height: panelHeight }}\n        role=\"toolbar\"\n        aria-label=\"Navigation principale\"\n      >\n        {items.map((item, index) => (\n          <DockItem\n            key={index}\n            onClick={item.onClick}\n            className={item.className}\n            mouseX={mouseX}\n            spring={spring}\n            distance={distance}\n            magnification={magnification}\n            baseItemSize={baseItemSize}\n          >\n            <DockIcon>{item.icon}</DockIcon>\n            <DockLabel>{item.label}</DockLabel>\n          </DockItem>\n        ))}\n      </motion.div>\n    </motion.div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./convex/_generated/api.d.ts"},"span":[1147,1150],"sourceCode":"/* eslint-disable */\n/**\n * Generated `api` utility.\n *\n * THIS CODE IS AUTOMATICALLY GENERATED.\n *\n * To regenerate, run `npx convex dev`.\n * @module\n */\n\nimport type * as boards from \"../boards.js\";\nimport type * as deals from \"../deals.js\";\nimport type * as documentVersions from \"../documentVersions.js\";\nimport type * as documents from \"../documents.js\";\nimport type * as presence from \"../presence.js\";\nimport type * as presentations from \"../presentations.js\";\nimport type * as propertyDefinitions from \"../propertyDefinitions.js\";\n\nimport type { ApiFromModules, FilterApi, FunctionReference } from \"convex/server\";\n\ndeclare const fullApi: ApiFromModules<{\n  boards: typeof boards;\n  deals: typeof deals;\n  documentVersions: typeof documentVersions;\n  documents: typeof documents;\n  presence: typeof presence;\n  presentations: typeof presentations;\n  propertyDefinitions: typeof propertyDefinitions;\n}>;\n\n/**\n * A utility for referencing Convex functions in your app's public API.\n *\n * Usage:\n * ```js\n * const myFunctionReference = api.myModule.myFunction;\n * ```\n */\nexport declare const api: FilterApi<typeof fullApi, FunctionReference<any, \"public\">>;\n\n/**\n * A utility for referencing Convex functions in your app's internal API.\n *\n * Usage:\n * ```js\n * const myFunctionReference = internal.myModule.myFunction;\n * ```\n */\nexport declare const internal: FilterApi<typeof fullApi, FunctionReference<any, \"internal\">>;\n\nexport declare const components: {};\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./convex/_generated/api.d.ts"},"span":[1412,1415],"sourceCode":"/* eslint-disable */\n/**\n * Generated `api` utility.\n *\n * THIS CODE IS AUTOMATICALLY GENERATED.\n *\n * To regenerate, run `npx convex dev`.\n * @module\n */\n\nimport type * as boards from \"../boards.js\";\nimport type * as deals from \"../deals.js\";\nimport type * as documentVersions from \"../documentVersions.js\";\nimport type * as documents from \"../documents.js\";\nimport type * as presence from \"../presence.js\";\nimport type * as presentations from \"../presentations.js\";\nimport type * as propertyDefinitions from \"../propertyDefinitions.js\";\n\nimport type { ApiFromModules, FilterApi, FunctionReference } from \"convex/server\";\n\ndeclare const fullApi: ApiFromModules<{\n  boards: typeof boards;\n  deals: typeof deals;\n  documentVersions: typeof documentVersions;\n  documents: typeof documents;\n  presence: typeof presence;\n  presentations: typeof presentations;\n  propertyDefinitions: typeof propertyDefinitions;\n}>;\n\n/**\n * A utility for referencing Convex functions in your app's public API.\n *\n * Usage:\n * ```js\n * const myFunctionReference = api.myModule.myFunction;\n * ```\n */\nexport declare const api: FilterApi<typeof fullApi, FunctionReference<any, \"public\">>;\n\n/**\n * A utility for referencing Convex functions in your app's internal API.\n *\n * Usage:\n * ```js\n * const myFunctionReference = internal.myModule.myFunction;\n * ```\n */\nexport declare const internal: FilterApi<typeof fullApi, FunctionReference<any, \"internal\">>;\n\nexport declare const components: {};\n"},"tags":[],"source":null},{"category":"lint/complexity/noBannedTypes","severity":"error","description":"Don't use '{}' as a type.","message":[{"elements":[],"content":"Don't use '{}' as a type."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Prefer explicitly define the object shape. '{}' means \"any non-nullable value\"."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./convex/_generated/api.d.ts"},"span":[1465,1467],"sourceCode":"/* eslint-disable */\n/**\n * Generated `api` utility.\n *\n * THIS CODE IS AUTOMATICALLY GENERATED.\n *\n * To regenerate, run `npx convex dev`.\n * @module\n */\n\nimport type * as boards from \"../boards.js\";\nimport type * as deals from \"../deals.js\";\nimport type * as documentVersions from \"../documentVersions.js\";\nimport type * as documents from \"../documents.js\";\nimport type * as presence from \"../presence.js\";\nimport type * as presentations from \"../presentations.js\";\nimport type * as propertyDefinitions from \"../propertyDefinitions.js\";\n\nimport type { ApiFromModules, FilterApi, FunctionReference } from \"convex/server\";\n\ndeclare const fullApi: ApiFromModules<{\n  boards: typeof boards;\n  deals: typeof deals;\n  documentVersions: typeof documentVersions;\n  documents: typeof documents;\n  presence: typeof presence;\n  presentations: typeof presentations;\n  propertyDefinitions: typeof propertyDefinitions;\n}>;\n\n/**\n * A utility for referencing Convex functions in your app's public API.\n *\n * Usage:\n * ```js\n * const myFunctionReference = api.myModule.myFunction;\n * ```\n */\nexport declare const api: FilterApi<typeof fullApi, FunctionReference<any, \"public\">>;\n\n/**\n * A utility for referencing Convex functions in your app's internal API.\n *\n * Usage:\n * ```js\n * const myFunctionReference = internal.myModule.myFunction;\n * ```\n */\nexport declare const internal: FilterApi<typeof fullApi, FunctionReference<any, \"internal\">>;\n\nexport declare const components: {};\n"},"tags":[],"source":null},{"category":"lint/a11y/noSvgWithoutTitle","severity":"error","description":"Alternative text title element cannot be empty","message":[{"elements":[],"content":"Alternative text "},{"elements":["Emphasis"],"content":"title"},{"elements":[],"content":" element cannot be empty"}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"For accessibility purposes, "},{"elements":["Emphasis"],"content":"SVGs"},{"elements":[],"content":" should have an alternative text, provided via "},{"elements":["Emphasis"],"content":"title"},{"elements":[],"content":" element. If the svg element has role=\"img\", you should add the "},{"elements":["Emphasis"],"content":"aria-label"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"aria-labelledby"},{"elements":[],"content":" attribute."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/presence/LiveCursors.tsx"},"span":[1841,2052],"sourceCode":"\"use client\";\n\n/**\n * LiveCursors - Curseurs collaboratifs en temps réel\n * Inspiré des bonnes pratiques Liveblocks\n * Adapté pour Alecia Colab avec Convex\n */\n\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\n\ninterface CursorPosition {\n  x: number;\n  y: number;\n}\n\ninterface UserCursor {\n  id: string;\n  name: string;\n  color: string;\n  position: CursorPosition | null;\n  lastActive: number;\n}\n\ninterface LiveCursorsProps {\n  roomId: string;\n  userId: string;\n  userName?: string;\n  userColor?: string;\n  enabled?: boolean;\n  throttleMs?: number; // Défaut 16ms pour 60fps\n  className?: string;\n}\n\n// Couleurs par défaut pour les curseurs\nconst CURSOR_COLORS = [\n  \"#FF6B6B\",\n  \"#4ECDC4\",\n  \"#45B7D1\",\n  \"#96CEB4\",\n  \"#FFEAA7\",\n  \"#DDA0DD\",\n  \"#98D8C8\",\n  \"#F7DC6F\",\n  \"#BB8FCE\",\n  \"#85C1E9\",\n];\n\n// Générer une couleur cohérente basée sur l'ID utilisateur\nfunction getUserColor(userId: string): string {\n  let hash = 0;\n  for (let i = 0; i < userId.length; i++) {\n    hash = (hash << 5) - hash + userId.charCodeAt(i);\n    hash |= 0;\n  }\n  return CURSOR_COLORS[Math.abs(hash) % CURSOR_COLORS.length];\n}\n\n/**\n * Composant Curseur individuel\n */\nfunction Cursor({\n  name,\n  color,\n  x,\n  y,\n}: {\n  name: string;\n  color: string;\n  x: number;\n  y: number;\n}) {\n  return (\n    <motion.div\n      className=\"pointer-events-none fixed z-[9999]\"\n      initial={{ opacity: 0, scale: 0.5 }}\n      animate={{ opacity: 1, scale: 1, x, y }}\n      exit={{ opacity: 0, scale: 0.5 }}\n      transition={{\n        type: \"spring\",\n        damping: 30,\n        stiffness: 500,\n        mass: 0.5,\n      }}\n    >\n      {/* Forme du curseur */}\n      <svg\n        width=\"24\"\n        height=\"36\"\n        viewBox=\"0 0 24 36\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        style={{ filter: \"drop-shadow(0 1px 2px rgba(0,0,0,0.3))\" }}\n      >\n        <path d=\"M5.65376 12.4863L0.185547 5.60416L4.72656 0.5L11.6086 5.97421L5.65376 12.4863Z\" fill={color} />\n        <path d=\"M1 5L5 0L11 5L6 12L1 5Z\" fill={color} />\n      </svg>\n\n      {/* Étiquette utilisateur */}\n      <motion.div\n        className={cn(\n          \"absolute left-4 top-4 px-2 py-0.5 rounded-md text-xs font-medium text-white whitespace-nowrap\",\n          \"shadow-sm\",\n        )}\n        style={{ backgroundColor: color }}\n        initial={{ opacity: 0, y: -5 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.1 }}\n      >\n        {name}\n      </motion.div>\n    </motion.div>\n  );\n}\n\n/**\n * Hook principal pour les curseurs en temps réel\n */\nexport function useLiveCursors({\n  roomId,\n  userId,\n  userName = \"Anonyme\",\n  userColor,\n  enabled = true,\n  throttleMs = 16, // 60fps\n}: Omit<LiveCursorsProps, \"className\">) {\n  const lastUpdateRef = useRef<number>(0);\n  const cursorPositionRef = useRef<CursorPosition | null>(null);\n\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n  const color = userColor || getUserColor(userId);\n\n  // Récupérer les autres curseurs\n  const otherCursors = useQuery(\n    api.presence.getActiveUsers,\n    isConvexConfigured && enabled ? { resourceType: \"document\", resourceId: roomId } : \"skip\",\n  );\n\n  // Mutation de présence\n  const updatePresence = useMutation(api.presence.heartbeat);\n\n  // Mettre à jour la position du curseur (throttled)\n  const updateCursor = useCallback(\n    (position: CursorPosition | null) => {\n      if (!enabled || !isConvexConfigured) return;\n\n      const now = Date.now();\n      if (now - lastUpdateRef.current < throttleMs) return;\n\n      lastUpdateRef.current = now;\n      cursorPositionRef.current = position;\n\n      updatePresence({\n        resourceType: \"document\",\n        resourceId: roomId,\n        userId,\n        userName,\n        userColor: color,\n        cursorPosition: position ? { x: position.x, y: position.y } : undefined,\n      }).catch(() => {});\n    },\n    [enabled, isConvexConfigured, throttleMs, roomId, userId, userName, color, updatePresence],\n  );\n\n  // Handler pour les mouvements de souris\n  const handlePointerMove = useCallback(\n    (e: PointerEvent) => {\n      updateCursor({ x: e.clientX, y: e.clientY });\n    },\n    [updateCursor],\n  );\n\n  // Handler pour quand le curseur quitte la zone\n  const handlePointerLeave = useCallback(() => {\n    updateCursor(null);\n  }, [updateCursor]);\n\n  // Attacher les événements\n  useEffect(() => {\n    if (!enabled) return;\n\n    window.addEventListener(\"pointermove\", handlePointerMove);\n    window.addEventListener(\"pointerleave\", handlePointerLeave);\n\n    return () => {\n      window.removeEventListener(\"pointermove\", handlePointerMove);\n      window.removeEventListener(\"pointerleave\", handlePointerLeave);\n    };\n  }, [enabled, handlePointerMove, handlePointerLeave]);\n\n  // Filtrer les autres utilisateurs\n  const cursors: UserCursor[] = (otherCursors || [])\n    .filter((u) => u.userId !== userId && u.cursorPosition)\n    .map((u) => ({\n      id: u.userId,\n      name: u.userName || \"Anonyme\",\n      color: u.userColor || getUserColor(u.userId),\n      position: u.cursorPosition as CursorPosition | null,\n      lastActive: u.lastActiveAt,\n    }));\n\n  return { cursors, updateCursor };\n}\n\n/**\n * Composant conteneur pour afficher tous les curseurs\n */\nexport default function LiveCursors({\n  roomId,\n  userId,\n  userName = \"Anonyme\",\n  userColor,\n  enabled = true,\n  throttleMs = 16,\n  className,\n}: LiveCursorsProps) {\n  const { cursors } = useLiveCursors({\n    roomId,\n    userId,\n    userName,\n    userColor,\n    enabled,\n    throttleMs,\n  });\n\n  return (\n    <div className={cn(\"fixed inset-0 pointer-events-none\", className)}>\n      <AnimatePresence>\n        {cursors.map((cursor) =>\n          cursor.position ? (\n            <Cursor\n              key={cursor.id}\n              name={cursor.name}\n              color={cursor.color}\n              x={cursor.position.x}\n              y={cursor.position.y}\n            />\n          ) : null,\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n/**\n * Composant simplifié pour l'éditeur\n */\nexport function EditorLiveCursors({\n  documentId,\n  className,\n}: {\n  documentId: string;\n  className?: string;\n}) {\n  // Utiliser une version client-safe\n  const [userId, setUserId] = React.useState<string | null>(null);\n  const [userName, setUserName] = React.useState<string>(\"Anonyme\");\n\n  React.useEffect(() => {\n    // En production, récupérer depuis Clerk\n    try {\n      const clerk = require(\"@clerk/nextjs\");\n      const { user } = clerk.useUser?.() || {};\n      if (user) {\n        setUserId(user.id);\n        setUserName(user.fullName || user.firstName || \"Anonyme\");\n      }\n    } catch {\n      // Fallback pour dev\n      setUserId(`user-${Math.random().toString(36).substring(7)}`);\n    }\n  }, []);\n\n  if (!userId) return null;\n\n  return <LiveCursors roomId={documentId} userId={userId} userName={userName} enabled={true} className={className} />;\n}\n\n// Import React pour le composant simplifié\nimport React from \"react\";\n"},"tags":[],"source":null},{"category":"lint/a11y/useKeyWithClickEvents","severity":"error","description":"Enforce to have the onClick mouse event with the onKeyUp, the onKeyDown, or the onKeyPress keyboard event.","message":[{"elements":[],"content":"Enforce to have the "},{"elements":["Emphasis"],"content":"onClick"},{"elements":[],"content":" mouse event with the "},{"elements":["Emphasis"],"content":"onKeyUp"},{"elements":[],"content":", the "},{"elements":["Emphasis"],"content":"onKeyDown"},{"elements":[],"content":", or the "},{"elements":["Emphasis"],"content":"onKeyPress"},{"elements":[],"content":" keyboard event."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Actions triggered using mouse events should have corresponding keyboard events to account for keyboard-only navigation."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/version-history/VersionHistorySidebar.tsx"},"span":[4065,4552],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport { ChevronRight, Clock, Eye, History, Loader2, RotateCcw, User, X } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Badge } from \"../tailwind/ui/badge\";\nimport { Button } from \"../tailwind/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"../tailwind/ui/dialog\";\nimport { ScrollArea } from \"../tailwind/ui/scroll-area\";\n\ninterface VersionHistorySidebarProps {\n  documentId: Id<\"colab_documents\">;\n  isOpen: boolean;\n  onClose: () => void;\n  onPreviewVersion?: (content: string) => void;\n}\n\nexport function VersionHistorySidebar({ documentId, isOpen, onClose, onPreviewVersion }: VersionHistorySidebarProps) {\n  const [selectedVersion, setSelectedVersion] = useState<number | null>(null);\n  const [isRestoreDialogOpen, setIsRestoreDialogOpen] = useState(false);\n  const [isRestoring, setIsRestoring] = useState(false);\n\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n  const versions = useQuery(api.documentVersions.listVersions, isConvexConfigured ? { documentId } : \"skip\");\n  const restoreVersion = useMutation(api.documentVersions.restoreVersion);\n\n  const handlePreview = (content: string, versionNumber: number) => {\n    setSelectedVersion(versionNumber);\n    onPreviewVersion?.(content);\n  };\n\n  const handleRestore = async () => {\n    if (!selectedVersion) return;\n\n    setIsRestoring(true);\n    try {\n      await restoreVersion({\n        documentId,\n        versionNumber: selectedVersion,\n      });\n      setIsRestoreDialogOpen(false);\n      setSelectedVersion(null);\n    } catch (error) {\n      console.error(\"Failed to restore version:\", error);\n    } finally {\n      setIsRestoring(false);\n    }\n  };\n\n  const formatDate = (timestamp: number) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    const diffHours = Math.floor(diffMs / 3600000);\n    const diffDays = Math.floor(diffMs / 86400000);\n\n    if (diffMins < 1) return \"Just now\";\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffHours < 24) return `${diffHours}h ago`;\n    if (diffDays < 7) return `${diffDays}d ago`;\n    return date.toLocaleDateString();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <>\n      <div className=\"fixed right-0 top-0 h-full w-80 bg-background border-l shadow-lg z-50 flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b\">\n          <div className=\"flex items-center gap-2\">\n            <History className=\"h-5 w-5\" />\n            <h2 className=\"font-semibold\">Version History</h2>\n          </div>\n          <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n\n        {/* Version list */}\n        <ScrollArea className=\"flex-1 p-4\">\n          {!isConvexConfigured ? (\n            <div className=\"text-center text-muted-foreground py-8\">\n              <History className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n              <p className=\"text-sm\">Configure Convex to enable version history</p>\n            </div>\n          ) : versions === undefined ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : versions.length === 0 ? (\n            <div className=\"text-center text-muted-foreground py-8\">\n              <History className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n              <p className=\"text-sm\">No versions saved yet</p>\n              <p className=\"text-xs mt-1\">Versions are created automatically as you edit</p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {versions.map((version, index) => (\n                <div\n                  key={version._id}\n                  className={`\n                    p-3 rounded-lg border cursor-pointer transition-all\n                    ${\n                      selectedVersion === version.versionNumber\n                        ? \"border-primary bg-primary/5\"\n                        : \"hover:border-primary/50\"\n                    }\n                  `}\n                  onClick={() => handlePreview(version.content, version.versionNumber)}\n                >\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          v{version.versionNumber}\n                        </Badge>\n                        {index === 0 && <Badge className=\"text-xs bg-green-100 text-green-800\">Latest</Badge>}\n                      </div>\n\n                      <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n                        <Clock className=\"h-3 w-3\" />\n                        <span>{formatDate(version.createdAt)}</span>\n                      </div>\n\n                      {version.createdBy && (\n                        <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n                          <User className=\"h-3 w-3\" />\n                          <span className=\"truncate\">{version.createdBy}</span>\n                        </div>\n                      )}\n\n                      {version.changeDescription && (\n                        <p className=\"text-xs text-muted-foreground mt-2 line-clamp-2\">{version.changeDescription}</p>\n                      )}\n                    </div>\n\n                    <ChevronRight className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n\n        {/* Footer with actions */}\n        {selectedVersion && (\n          <div className=\"p-4 border-t flex gap-2\">\n            <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => setSelectedVersion(null)}>\n              <Eye className=\"h-4 w-4 mr-1\" />\n              Clear Preview\n            </Button>\n            <Button size=\"sm\" className=\"flex-1\" onClick={() => setIsRestoreDialogOpen(true)}>\n              <RotateCcw className=\"h-4 w-4 mr-1\" />\n              Restore v{selectedVersion}\n            </Button>\n          </div>\n        )}\n      </div>\n\n      {/* Restore confirmation dialog */}\n      <Dialog open={isRestoreDialogOpen} onOpenChange={setIsRestoreDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Restore Version {selectedVersion}?</DialogTitle>\n            <DialogDescription>\n              This will replace the current document content with version {selectedVersion}. A new version will be\n              created to preserve the current state.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsRestoreDialogOpen(false)} disabled={isRestoring}>\n              Cancel\n            </Button>\n            <Button onClick={handleRestore} disabled={isRestoring}>\n              {isRestoring ? <Loader2 className=\"h-4 w-4 animate-spin mr-1\" /> : <RotateCcw className=\"h-4 w-4 mr-1\" />}\n              Restore\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/presentations/PresentationDashboard.tsx"},"span":[5301,5304],"sourceCode":"\"use client\";\n\nimport { generateOutlineAction } from \"@/app/actions/presentation/generate\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport { parsePresentationStream } from \"@/lib/presentation-parser\";\nimport type { Slide } from \"@/lib/presentation-parser\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { readStreamableValue } from \"ai/rsc\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport { Loader2, Plus, Presentation } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\n\nexport function PresentationDashboard() {\n  const router = useRouter();\n\n  // Safe use of useUser with fallback for environments without Clerk\n  let user: { id: string } | null | undefined = null;\n  let isLoaded = true;\n\n  try {\n    const clerk = useUser();\n    user = clerk.user;\n    isLoaded = clerk.isLoaded;\n  } catch (_e) {\n    // If Clerk is not available (e.g. no provider), use a mock or null\n    // In dev without keys, we might want to mock it to test UI\n    if (process.env.NODE_ENV === \"development\") {\n      user = { id: \"dev_user_mock\" };\n      isLoaded = true;\n    }\n  }\n\n  const createPresentation = useMutation(api.presentations.create);\n  const updatePresentation = useMutation(api.presentations.update);\n  // @ts-ignore\n  const presentations = useQuery(api.presentations.list, isLoaded && user ? { userId: user.id } : \"skip\");\n\n  const [prompt, setPrompt] = useState(\"\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [previewSlides, setPreviewSlides] = useState<Slide[]>([]);\n\n  const handleGenerate = async () => {\n    if (!prompt.trim() || !user) return;\n\n    setIsGenerating(true);\n    setPreviewSlides([]);\n\n    try {\n      // 1. Create draft presentation\n      const presentationId = await createPresentation({\n        title: prompt.slice(0, 50) + (prompt.length > 50 ? \"...\" : \"\"),\n        userId: user.id,\n        theme: \"corporate\",\n        language: \"fr-FR\",\n      });\n\n      // 2. Start generation\n      const { stream } = await generateOutlineAction(prompt);\n\n      let fullText = \"\";\n      for await (const delta of readStreamableValue(stream)) {\n        fullText += delta;\n\n        // Progressive parsing for preview\n        const currentSlides = parsePresentationStream(fullText);\n        setPreviewSlides(currentSlides);\n      }\n\n      // 3. Save final slides\n      const slides = parsePresentationStream(fullText);\n      await updatePresentation({\n        id: presentationId,\n        slides,\n        status: \"complete\",\n      });\n\n      router.push(`/presentations/${presentationId}`);\n    } catch (error) {\n      console.error(\"Generation failed:\", error);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-8\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-3xl font-bold\">Générateur de Présentations</h1>\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2\">\n        <Card className=\"h-full flex flex-col\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Plus className=\"h-5 w-5\" />\n              Nouvelle présentation\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4 flex-1\">\n            <Textarea\n              placeholder=\"Décrivez votre sujet de présentation...\"\n              value={prompt}\n              onChange={(e) => setPrompt(e.target.value)}\n              className=\"min-h-[150px]\"\n              disabled={isGenerating}\n            />\n            <Button onClick={handleGenerate} disabled={isGenerating || !prompt.trim() || !user} className=\"w-full\">\n              {isGenerating ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Génération en cours ({previewSlides.length} slides)...\n                </>\n              ) : (\n                \"Générer la présentation\"\n              )}\n            </Button>\n\n            {/* Live Preview during generation */}\n            {isGenerating && previewSlides.length > 0 && (\n              <div className=\"mt-4 p-4 border rounded-lg bg-muted/50 max-h-[200px] overflow-y-auto\">\n                <h3 className=\"text-sm font-semibold mb-2\">Aperçu en temps réel :</h3>\n                <ul className=\"space-y-2 text-sm\">\n                  {previewSlides.map((slide, i) => (\n                    // biome-ignore lint/suspicious/noArrayIndexKey: Index stable for preview\n                    <li key={i} className=\"flex items-center gap-2\">\n                      <span className=\"w-4 h-4 rounded-full bg-primary/20 flex items-center justify-center text-[10px]\">\n                        {i + 1}\n                      </span>\n                      <span className=\"truncate\">{slide.title || \"...\"}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2\">\n          {presentations?.slice(0, 4).map((p: any) => (\n            <Card\n              key={p._id}\n              className=\"cursor-pointer hover:bg-accent/50 transition-colors\"\n              onClick={() => router.push(`/presentations/${p._id}`)}\n            >\n              <CardHeader className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"h-10 w-10 rounded bg-primary/10 flex items-center justify-center\">\n                    <Presentation className=\"h-5 w-5 text-primary\" />\n                  </div>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {new Date(p.createdAt).toLocaleDateString(\"fr-FR\")}\n                  </span>\n                </div>\n              </CardHeader>\n              <CardContent className=\"p-4 pt-0\">\n                <h3 className=\"font-semibold line-clamp-2\">{p.title}</h3>\n                <p className=\"text-sm text-muted-foreground mt-1\">{p.slides.length} diapositives</p>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/presentations/PresentationList.tsx"},"span":[2100,2103],"sourceCode":"\"use client\";\n\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { api } from \"@/convex/_generated/api\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { useQuery } from \"convex/react\";\nimport { Plus, Presentation } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\n\nexport function PresentationList() {\n  const router = useRouter();\n\n  // Safe use of useUser with fallback for environments without Clerk\n  let user: { id: string } | null | undefined = null;\n  let isLoaded = true;\n\n  try {\n    const clerk = useUser();\n    user = clerk.user;\n    isLoaded = clerk.isLoaded;\n  } catch (_e) {\n    // If Clerk is not available (e.g. no provider), use a mock or null\n    // In dev without keys, we might want to mock it to test UI\n    if (process.env.NODE_ENV === \"development\") {\n      user = { id: \"dev_user_mock\" };\n      isLoaded = true;\n    }\n  }\n\n  // @ts-ignore\n  const presentations = useQuery(api.presentations.list, isLoaded && user ? { userId: user.id } : \"skip\");\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-8\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-3xl font-bold\">Mes Présentations</h1>\n        <Button onClick={() => router.push(\"/presentations/new\")}>\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Nouvelle présentation\n        </Button>\n      </div>\n\n      <div className=\"grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4\">\n        {/* Create New Card */}\n        <Card\n          className=\"cursor-pointer hover:bg-accent/50 transition-colors border-dashed flex flex-col items-center justify-center min-h-[160px]\"\n          onClick={() => router.push(\"/presentations/new\")}\n        >\n          <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center mb-4\">\n            <Plus className=\"h-6 w-6 text-primary\" />\n          </div>\n          <span className=\"font-semibold text-primary\">Créer une présentation</span>\n        </Card>\n\n        {presentations?.map((p: any) => (\n          <Card\n            key={p._id}\n            className=\"cursor-pointer hover:bg-accent/50 transition-colors flex flex-col\"\n            onClick={() => router.push(`/presentations/${p._id}`)}\n          >\n            <CardHeader className=\"p-4 flex-1\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"h-10 w-10 rounded bg-primary/10 flex items-center justify-center shrink-0\">\n                  <Presentation className=\"h-5 w-5 text-primary\" />\n                </div>\n                <span className=\"text-xs text-muted-foreground ml-2\">\n                  {new Date(p.createdAt).toLocaleDateString(\"fr-FR\")}\n                </span>\n              </div>\n              <h3 className=\"font-semibold mt-3 line-clamp-2\">{p.title}</h3>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0 mt-auto\">\n              <p className=\"text-sm text-muted-foreground\">\n                {p.slides.length} diapositive{p.slides.length > 1 ? \"s\" : \"\"}\n              </p>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {presentations && presentations.length === 0 && (\n        <div className=\"text-center text-muted-foreground py-12\">Aucune présentation pour le moment.</div>\n      )}\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[5019,5020],"sourceCode":"\"use client\";\n\nimport { generateOutlineAction } from \"@/app/actions/presentation/generate\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport { parsePresentationStream } from \"@/lib/presentation-parser\";\nimport type { Slide } from \"@/lib/presentation-parser\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { readStreamableValue } from \"ai/rsc\";\nimport { useMutation } from \"convex/react\";\nimport { ChevronLeft, Loader2, Wand2 } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\n\nexport function PresentationGenerator() {\n  const router = useRouter();\n\n  // Safe use of useUser with fallback for environments without Clerk\n  let user: { id: string } | null | undefined = null;\n  let _isLoaded = true;\n\n  try {\n    const clerk = useUser();\n    user = clerk.user;\n    _isLoaded = clerk.isLoaded;\n  } catch (_e) {\n    if (process.env.NODE_ENV === \"development\") {\n      user = { id: \"dev_user_mock\" };\n      _isLoaded = true;\n    }\n  }\n\n  const createPresentation = useMutation(api.presentations.create);\n  const updatePresentation = useMutation(api.presentations.update);\n\n  const [prompt, setPrompt] = useState(\"\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [previewSlides, setPreviewSlides] = useState<Slide[]>([]);\n\n  const handleGenerate = async () => {\n    if (!prompt.trim() || !user) return;\n\n    setIsGenerating(true);\n    setPreviewSlides([]);\n\n    try {\n      // 1. Create draft presentation\n      const presentationId = await createPresentation({\n        title: prompt.slice(0, 50) + (prompt.length > 50 ? \"...\" : \"\"),\n        userId: user.id,\n        theme: \"corporate\",\n        language: \"fr-FR\",\n      });\n\n      // 2. Start generation\n      const { stream } = await generateOutlineAction(prompt);\n\n      let fullText = \"\";\n      for await (const delta of readStreamableValue(stream)) {\n        fullText += delta;\n\n        // Progressive parsing for preview\n        const currentSlides = parsePresentationStream(fullText);\n        setPreviewSlides(currentSlides);\n      }\n\n      // 3. Save final slides\n      const slides = parsePresentationStream(fullText);\n      await updatePresentation({\n        id: presentationId,\n        slides,\n        status: \"complete\",\n      });\n\n      router.push(`/presentations/${presentationId}`);\n    } catch (error) {\n      console.error(\"Generation failed:\", error);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  return (\n    <div className=\"container max-w-3xl mx-auto p-6 space-y-8\">\n      <div className=\"flex items-center gap-4\">\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => router.back()}>\n          <ChevronLeft className=\"h-5 w-5\" />\n        </Button>\n        <h1 className=\"text-2xl font-bold\">Nouvelle Présentation IA</h1>\n      </div>\n\n      <Card className=\"border-2 border-primary/10 shadow-lg\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Wand2 className=\"h-5 w-5 text-primary\" />\n            Décrivez votre présentation\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"space-y-2\">\n            <Textarea\n              placeholder=\"Ex: Stratégie de croissance pour une startup SaaS B2B, avec focus sur l'expansion internationale et l'acquisition client...\"\n              value={prompt}\n              onChange={(e) => setPrompt(e.target.value)}\n              className=\"min-h-[200px] text-lg p-4 resize-none\"\n              disabled={isGenerating}\n            />\n            <p className=\"text-sm text-muted-foreground text-right\">Soyez précis pour de meilleurs résultats.</p>\n          </div>\n\n          <Button\n            onClick={handleGenerate}\n            disabled={isGenerating || !prompt.trim() || !user}\n            className=\"w-full h-12 text-lg\"\n          >\n            {isGenerating ? (\n              <>\n                <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                Génération en cours ({previewSlides.length} slides)...\n              </>\n            ) : (\n              \"Générer la présentation\"\n            )}\n          </Button>\n\n          {/* Live Preview during generation */}\n          {isGenerating && previewSlides.length > 0 && (\n            <div className=\"mt-8 border rounded-xl overflow-hidden bg-muted/30\">\n              <div className=\"bg-muted p-3 border-b text-sm font-medium flex justify-between items-center\">\n                <span>Aperçu en temps réel</span>\n                <span className=\"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full animate-pulse\">\n                  Génération...\n                </span>\n              </div>\n              <div className=\"p-4 max-h-[300px] overflow-y-auto space-y-3\">\n                {previewSlides.map((slide, i) => (\n                  // biome-ignore lint/suspicious/noArrayIndexKey: Index stable for preview\n                  <div\n                    key={i}\n                    className=\"flex items-start gap-3 p-3 bg-card rounded-lg border shadow-sm animate-in fade-in slide-in-from-bottom-2 duration-500\"\n                  >\n                    <span className=\"w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold shrink-0 mt-0.5\">\n                      {i + 1}\n                    </span>\n                    <div>\n                      <h4 className=\"font-semibold text-sm\">{slide.title || \"Titre en cours...\"}</h4>\n                      <p className=\"text-xs text-muted-foreground mt-1\">{slide.content.length} éléments</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/presentations/PresentationGenerator.tsx"},"span":[5167,5168],"sourceCode":"\"use client\";\n\nimport { generateOutlineAction } from \"@/app/actions/presentation/generate\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport { parsePresentationStream } from \"@/lib/presentation-parser\";\nimport type { Slide } from \"@/lib/presentation-parser\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { readStreamableValue } from \"ai/rsc\";\nimport { useMutation } from \"convex/react\";\nimport { ChevronLeft, Loader2, Wand2 } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\n\nexport function PresentationGenerator() {\n  const router = useRouter();\n\n  // Safe use of useUser with fallback for environments without Clerk\n  let user: { id: string } | null | undefined = null;\n  let _isLoaded = true;\n\n  try {\n    const clerk = useUser();\n    user = clerk.user;\n    _isLoaded = clerk.isLoaded;\n  } catch (_e) {\n    if (process.env.NODE_ENV === \"development\") {\n      user = { id: \"dev_user_mock\" };\n      _isLoaded = true;\n    }\n  }\n\n  const createPresentation = useMutation(api.presentations.create);\n  const updatePresentation = useMutation(api.presentations.update);\n\n  const [prompt, setPrompt] = useState(\"\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [previewSlides, setPreviewSlides] = useState<Slide[]>([]);\n\n  const handleGenerate = async () => {\n    if (!prompt.trim() || !user) return;\n\n    setIsGenerating(true);\n    setPreviewSlides([]);\n\n    try {\n      // 1. Create draft presentation\n      const presentationId = await createPresentation({\n        title: prompt.slice(0, 50) + (prompt.length > 50 ? \"...\" : \"\"),\n        userId: user.id,\n        theme: \"corporate\",\n        language: \"fr-FR\",\n      });\n\n      // 2. Start generation\n      const { stream } = await generateOutlineAction(prompt);\n\n      let fullText = \"\";\n      for await (const delta of readStreamableValue(stream)) {\n        fullText += delta;\n\n        // Progressive parsing for preview\n        const currentSlides = parsePresentationStream(fullText);\n        setPreviewSlides(currentSlides);\n      }\n\n      // 3. Save final slides\n      const slides = parsePresentationStream(fullText);\n      await updatePresentation({\n        id: presentationId,\n        slides,\n        status: \"complete\",\n      });\n\n      router.push(`/presentations/${presentationId}`);\n    } catch (error) {\n      console.error(\"Generation failed:\", error);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  return (\n    <div className=\"container max-w-3xl mx-auto p-6 space-y-8\">\n      <div className=\"flex items-center gap-4\">\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => router.back()}>\n          <ChevronLeft className=\"h-5 w-5\" />\n        </Button>\n        <h1 className=\"text-2xl font-bold\">Nouvelle Présentation IA</h1>\n      </div>\n\n      <Card className=\"border-2 border-primary/10 shadow-lg\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Wand2 className=\"h-5 w-5 text-primary\" />\n            Décrivez votre présentation\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"space-y-2\">\n            <Textarea\n              placeholder=\"Ex: Stratégie de croissance pour une startup SaaS B2B, avec focus sur l'expansion internationale et l'acquisition client...\"\n              value={prompt}\n              onChange={(e) => setPrompt(e.target.value)}\n              className=\"min-h-[200px] text-lg p-4 resize-none\"\n              disabled={isGenerating}\n            />\n            <p className=\"text-sm text-muted-foreground text-right\">Soyez précis pour de meilleurs résultats.</p>\n          </div>\n\n          <Button\n            onClick={handleGenerate}\n            disabled={isGenerating || !prompt.trim() || !user}\n            className=\"w-full h-12 text-lg\"\n          >\n            {isGenerating ? (\n              <>\n                <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                Génération en cours ({previewSlides.length} slides)...\n              </>\n            ) : (\n              \"Générer la présentation\"\n            )}\n          </Button>\n\n          {/* Live Preview during generation */}\n          {isGenerating && previewSlides.length > 0 && (\n            <div className=\"mt-8 border rounded-xl overflow-hidden bg-muted/30\">\n              <div className=\"bg-muted p-3 border-b text-sm font-medium flex justify-between items-center\">\n                <span>Aperçu en temps réel</span>\n                <span className=\"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full animate-pulse\">\n                  Génération...\n                </span>\n              </div>\n              <div className=\"p-4 max-h-[300px] overflow-y-auto space-y-3\">\n                {previewSlides.map((slide, i) => (\n                  // biome-ignore lint/suspicious/noArrayIndexKey: Index stable for preview\n                  <div\n                    key={i}\n                    className=\"flex items-start gap-3 p-3 bg-card rounded-lg border shadow-sm animate-in fade-in slide-in-from-bottom-2 duration-500\"\n                  >\n                    <span className=\"w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold shrink-0 mt-0.5\">\n                      {i + 1}\n                    </span>\n                    <div>\n                      <h4 className=\"font-semibold text-sm\">{slide.title || \"Titre en cours...\"}</h4>\n                      <p className=\"text-xs text-muted-foreground mt-1\">{slide.content.length} éléments</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"suppressions/unused","severity":"warning","description":"Suppression comment has no effect. Remove the suppression or make sure you are suppressing the correct rule.","message":[{"elements":[],"content":"Suppression comment has no effect. Remove the suppression or make sure you are suppressing the correct rule."}],"advices":{"advices":[]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/presentations/PresentationGenerator.tsx"},"span":[5045,5118],"sourceCode":"\"use client\";\n\nimport { generateOutlineAction } from \"@/app/actions/presentation/generate\";\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/tailwind/ui/card\";\nimport { Textarea } from \"@/components/tailwind/ui/textarea\";\nimport { api } from \"@/convex/_generated/api\";\nimport { parsePresentationStream } from \"@/lib/presentation-parser\";\nimport type { Slide } from \"@/lib/presentation-parser\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { readStreamableValue } from \"ai/rsc\";\nimport { useMutation } from \"convex/react\";\nimport { ChevronLeft, Loader2, Wand2 } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\n\nexport function PresentationGenerator() {\n  const router = useRouter();\n\n  // Safe use of useUser with fallback for environments without Clerk\n  let user: { id: string } | null | undefined = null;\n  let _isLoaded = true;\n\n  try {\n    const clerk = useUser();\n    user = clerk.user;\n    _isLoaded = clerk.isLoaded;\n  } catch (_e) {\n    if (process.env.NODE_ENV === \"development\") {\n      user = { id: \"dev_user_mock\" };\n      _isLoaded = true;\n    }\n  }\n\n  const createPresentation = useMutation(api.presentations.create);\n  const updatePresentation = useMutation(api.presentations.update);\n\n  const [prompt, setPrompt] = useState(\"\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [previewSlides, setPreviewSlides] = useState<Slide[]>([]);\n\n  const handleGenerate = async () => {\n    if (!prompt.trim() || !user) return;\n\n    setIsGenerating(true);\n    setPreviewSlides([]);\n\n    try {\n      // 1. Create draft presentation\n      const presentationId = await createPresentation({\n        title: prompt.slice(0, 50) + (prompt.length > 50 ? \"...\" : \"\"),\n        userId: user.id,\n        theme: \"corporate\",\n        language: \"fr-FR\",\n      });\n\n      // 2. Start generation\n      const { stream } = await generateOutlineAction(prompt);\n\n      let fullText = \"\";\n      for await (const delta of readStreamableValue(stream)) {\n        fullText += delta;\n\n        // Progressive parsing for preview\n        const currentSlides = parsePresentationStream(fullText);\n        setPreviewSlides(currentSlides);\n      }\n\n      // 3. Save final slides\n      const slides = parsePresentationStream(fullText);\n      await updatePresentation({\n        id: presentationId,\n        slides,\n        status: \"complete\",\n      });\n\n      router.push(`/presentations/${presentationId}`);\n    } catch (error) {\n      console.error(\"Generation failed:\", error);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  return (\n    <div className=\"container max-w-3xl mx-auto p-6 space-y-8\">\n      <div className=\"flex items-center gap-4\">\n        <Button variant=\"ghost\" size=\"icon\" onClick={() => router.back()}>\n          <ChevronLeft className=\"h-5 w-5\" />\n        </Button>\n        <h1 className=\"text-2xl font-bold\">Nouvelle Présentation IA</h1>\n      </div>\n\n      <Card className=\"border-2 border-primary/10 shadow-lg\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Wand2 className=\"h-5 w-5 text-primary\" />\n            Décrivez votre présentation\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"space-y-2\">\n            <Textarea\n              placeholder=\"Ex: Stratégie de croissance pour une startup SaaS B2B, avec focus sur l'expansion internationale et l'acquisition client...\"\n              value={prompt}\n              onChange={(e) => setPrompt(e.target.value)}\n              className=\"min-h-[200px] text-lg p-4 resize-none\"\n              disabled={isGenerating}\n            />\n            <p className=\"text-sm text-muted-foreground text-right\">Soyez précis pour de meilleurs résultats.</p>\n          </div>\n\n          <Button\n            onClick={handleGenerate}\n            disabled={isGenerating || !prompt.trim() || !user}\n            className=\"w-full h-12 text-lg\"\n          >\n            {isGenerating ? (\n              <>\n                <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                Génération en cours ({previewSlides.length} slides)...\n              </>\n            ) : (\n              \"Générer la présentation\"\n            )}\n          </Button>\n\n          {/* Live Preview during generation */}\n          {isGenerating && previewSlides.length > 0 && (\n            <div className=\"mt-8 border rounded-xl overflow-hidden bg-muted/30\">\n              <div className=\"bg-muted p-3 border-b text-sm font-medium flex justify-between items-center\">\n                <span>Aperçu en temps réel</span>\n                <span className=\"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full animate-pulse\">\n                  Génération...\n                </span>\n              </div>\n              <div className=\"p-4 max-h-[300px] overflow-y-auto space-y-3\">\n                {previewSlides.map((slide, i) => (\n                  // biome-ignore lint/suspicious/noArrayIndexKey: Index stable for preview\n                  <div\n                    key={i}\n                    className=\"flex items-start gap-3 p-3 bg-card rounded-lg border shadow-sm animate-in fade-in slide-in-from-bottom-2 duration-500\"\n                  >\n                    <span className=\"w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold shrink-0 mt-0.5\">\n                      {i + 1}\n                    </span>\n                    <div>\n                      <h4 className=\"font-semibold text-sm\">{slide.title || \"Titre en cours...\"}</h4>\n                      <p className=\"text-xs text-muted-foreground mt-1\">{slide.content.length} éléments</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[2714,2715],"sourceCode":"\"use client\";\n\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport { useDocuments } from \"@/hooks/use-convex\";\nimport { formatRelativeTime } from \"@/lib/format-relative-time\";\nimport { t } from \"@/lib/i18n\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { Clock, FileText, Plus } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\n\ninterface RecentFilesProps {\n  limit?: number;\n  showCreateButton?: boolean;\n}\n\nexport function RecentFiles({ limit = 5, showCreateButton = true }: RecentFilesProps) {\n  const [_mounted, setMounted] = useState(false);\n  const { user } = useUser();\n  const { documents, isLoading, isConvexAvailable } = useDocuments(user?.id);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const recentDocuments = documents\n    .filter((doc) => !doc.isArchived)\n    .map((doc) => ({\n      id: doc._id,\n      title: doc.title || t(\"editor.untitled\"),\n      href: `/documents/${doc._id}`,\n      timestamp: doc.updatedAt ?? doc.createdAt ?? doc._creationTime,\n    }))\n    .sort((a, b) => b.timestamp - a.timestamp)\n    .slice(0, limit);\n\n  if (isLoading && isConvexAvailable) {\n    return <RecentFilesSkeleton count={limit} />;\n  }\n\n  if (recentDocuments.length === 0) {\n    return <RecentFilesEmpty showCreateButton={showCreateButton} />;\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      <div className=\"flex items-center gap-2 text-muted-foreground\">\n        <Clock className=\"h-4 w-4\" />\n        <span className=\"text-sm font-medium\">Recent Documents</span>\n      </div>\n      <div className=\"space-y-2\">\n        {recentDocuments.map((doc) => (\n          <Link key={doc.id} href={doc.href}>\n            <div className=\"flex items-center gap-3 p-3 rounded-lg border hover:bg-accent transition-colors\">\n              <FileText className=\"h-5 w-5 text-muted-foreground\" />\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-medium truncate\">{doc.title}</p>\n                <p className=\"text-xs text-muted-foreground\">{formatRelativeTime(doc.timestamp)}</p>\n              </div>\n            </div>\n          </Link>\n        ))}\n      </div>\n      {showCreateButton && (\n        <Button className=\"w-full\" variant=\"outline\" asChild>\n          <Link href=\"/documents\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Document\n          </Link>\n        </Button>\n      )}\n    </div>\n  );\n}\n\nfunction RecentFilesSkeleton({ count }: { count: number }) {\n  return (\n    <div className=\"space-y-3\">\n      <Skeleton className=\"h-5 w-40\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: count }).map((_, i) => (\n          <div key={i} className=\"flex items-center gap-3 p-2\">\n            <Skeleton className=\"h-4 w-4\" />\n            <div className=\"flex-1 space-y-1\">\n              <Skeleton className=\"h-4 w-3/4\" />\n              <Skeleton className=\"h-3 w-1/4\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction RecentFilesEmpty({ showCreateButton }: { showCreateButton: boolean }) {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n      <div className=\"rounded-full bg-muted p-3 mb-3\">\n        <FileText className=\"h-6 w-6 text-muted-foreground\" />\n      </div>\n      <h3 className=\"text-sm font-semibold\">No recent documents</h3>\n      <p className=\"text-xs text-muted-foreground mt-1\">Your recently accessed documents will appear here</p>\n      {showCreateButton && (\n        <Button className=\"mt-4\" size=\"sm\" asChild>\n          <Link href=\"/documents\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Document\n          </Link>\n        </Button>\n      )}\n    </div>\n  );\n}\n\nexport { RecentFilesSkeleton, RecentFilesEmpty };\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/recent-files/RecentFiles.tsx"},"span":[2742,2743],"sourceCode":"\"use client\";\n\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\nimport { useDocuments } from \"@/hooks/use-convex\";\nimport { formatRelativeTime } from \"@/lib/format-relative-time\";\nimport { t } from \"@/lib/i18n\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { Clock, FileText, Plus } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\n\ninterface RecentFilesProps {\n  limit?: number;\n  showCreateButton?: boolean;\n}\n\nexport function RecentFiles({ limit = 5, showCreateButton = true }: RecentFilesProps) {\n  const [_mounted, setMounted] = useState(false);\n  const { user } = useUser();\n  const { documents, isLoading, isConvexAvailable } = useDocuments(user?.id);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const recentDocuments = documents\n    .filter((doc) => !doc.isArchived)\n    .map((doc) => ({\n      id: doc._id,\n      title: doc.title || t(\"editor.untitled\"),\n      href: `/documents/${doc._id}`,\n      timestamp: doc.updatedAt ?? doc.createdAt ?? doc._creationTime,\n    }))\n    .sort((a, b) => b.timestamp - a.timestamp)\n    .slice(0, limit);\n\n  if (isLoading && isConvexAvailable) {\n    return <RecentFilesSkeleton count={limit} />;\n  }\n\n  if (recentDocuments.length === 0) {\n    return <RecentFilesEmpty showCreateButton={showCreateButton} />;\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      <div className=\"flex items-center gap-2 text-muted-foreground\">\n        <Clock className=\"h-4 w-4\" />\n        <span className=\"text-sm font-medium\">Recent Documents</span>\n      </div>\n      <div className=\"space-y-2\">\n        {recentDocuments.map((doc) => (\n          <Link key={doc.id} href={doc.href}>\n            <div className=\"flex items-center gap-3 p-3 rounded-lg border hover:bg-accent transition-colors\">\n              <FileText className=\"h-5 w-5 text-muted-foreground\" />\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-medium truncate\">{doc.title}</p>\n                <p className=\"text-xs text-muted-foreground\">{formatRelativeTime(doc.timestamp)}</p>\n              </div>\n            </div>\n          </Link>\n        ))}\n      </div>\n      {showCreateButton && (\n        <Button className=\"w-full\" variant=\"outline\" asChild>\n          <Link href=\"/documents\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Document\n          </Link>\n        </Button>\n      )}\n    </div>\n  );\n}\n\nfunction RecentFilesSkeleton({ count }: { count: number }) {\n  return (\n    <div className=\"space-y-3\">\n      <Skeleton className=\"h-5 w-40\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: count }).map((_, i) => (\n          <div key={i} className=\"flex items-center gap-3 p-2\">\n            <Skeleton className=\"h-4 w-4\" />\n            <div className=\"flex-1 space-y-1\">\n              <Skeleton className=\"h-4 w-3/4\" />\n              <Skeleton className=\"h-3 w-1/4\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction RecentFilesEmpty({ showCreateButton }: { showCreateButton: boolean }) {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n      <div className=\"rounded-full bg-muted p-3 mb-3\">\n        <FileText className=\"h-6 w-6 text-muted-foreground\" />\n      </div>\n      <h3 className=\"text-sm font-semibold\">No recent documents</h3>\n      <p className=\"text-xs text-muted-foreground mt-1\">Your recently accessed documents will appear here</p>\n      {showCreateButton && (\n        <Button className=\"mt-4\" size=\"sm\" asChild>\n          <Link href=\"/documents\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Document\n          </Link>\n        </Button>\n      )}\n    </div>\n  );\n}\n\nexport { RecentFilesSkeleton, RecentFilesEmpty };\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/presentations/SlideEditor.tsx"},"span":[3435,3438],"sourceCode":"\"use client\";\n\nimport { Button } from \"@/components/tailwind/ui/button\";\nimport { api } from \"@/convex/_generated/api\";\nimport type { Id } from \"@/convex/_generated/dataModel\";\nimport type { Slide } from \"@/lib/presentation-parser\";\nimport { cn } from \"@/lib/utils\";\nimport { useMutation, useQuery } from \"convex/react\";\nimport html2canvas from \"html2canvas\";\nimport jsPDF from \"jspdf\";\nimport { Download, GripVertical } from \"lucide-react\";\nimport { Plus } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { DragDropContext, Draggable, Droppable } from \"react-beautiful-dnd\";\n\nexport const exportToPDF = async (elementId: string, fileName: string) => {\n  const element = document.getElementById(elementId);\n  if (!element) return;\n\n  try {\n    const canvas = await html2canvas(element, { scale: 2 });\n    const imgData = canvas.toDataURL(\"image/png\");\n    // Landscape A4 size approx in px at 72dpi is 842x595, but we use canvas dimensions\n    const pdf = new jsPDF({\n      orientation: \"landscape\",\n      unit: \"px\",\n      format: [canvas.width, canvas.height],\n    });\n\n    pdf.addImage(imgData, \"PNG\", 0, 0, canvas.width, canvas.height);\n    pdf.save(`${fileName}.pdf`);\n  } catch (error) {\n    console.error(\"Export PDF failed\", error);\n  }\n};\n\ninterface SlideEditorProps {\n  presentationId: Id<\"colab_presentations\">;\n}\n\nconst ALECIA_THEMES = {\n  midnight: {\n    background: \"bg-[var(--alecia-midnight)]\",\n    text: \"text-white\",\n    accent: \"text-[var(--alecia-sky)]\",\n    bgAccent: \"bg-[var(--alecia-sky)]\",\n  },\n  corporate: {\n    background: \"bg-[var(--alecia-corporate)]\",\n    text: \"text-white\",\n    accent: \"text-[var(--alecia-gold-accent)]\",\n    bgAccent: \"bg-[var(--alecia-gold-accent)]\",\n  },\n  light: {\n    background: \"bg-[var(--alecia-off-white)]\",\n    text: \"text-[var(--alecia-midnight)]\",\n    accent: \"text-[var(--alecia-red)]\",\n    bgAccent: \"bg-[var(--alecia-red)]\",\n  },\n};\n\nexport function SlideEditor({ presentationId }: SlideEditorProps) {\n  const presentation = useQuery(api.presentations.get, { id: presentationId });\n  const updatePresentation = useMutation(api.presentations.update);\n\n  const [currentSlideIndex, setCurrentSlideIndex] = useState(0);\n  const [slides, setSlides] = useState<Slide[]>([]);\n  const [enabled, setEnabled] = useState(false);\n\n  useEffect(() => {\n    const animation = requestAnimationFrame(() => setEnabled(true));\n    return () => {\n      cancelAnimationFrame(animation);\n      setEnabled(false);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (presentation?.slides) {\n      setSlides(presentation.slides as unknown as Slide[]);\n    }\n  }, [presentation?.slides]);\n\n  if (!presentation) {\n    return <div>Chargement...</div>;\n  }\n\n  const currentSlide = slides[currentSlideIndex];\n  // @ts-ignore\n  const theme = ALECIA_THEMES[presentation.theme as keyof typeof ALECIA_THEMES] || ALECIA_THEMES.corporate;\n\n  const handleExportPDF = () => {\n    exportToPDF(\"slide-content\", presentation.title || \"presentation\");\n  };\n\n  const handleAddSlide = async () => {\n    const newSlide: Slide = {\n      id: Math.random().toString(36).substring(7),\n      title: \"Nouvelle diapositive\",\n      content: [],\n    };\n\n    const newSlides = [...slides, newSlide];\n    setSlides(newSlides);\n    setCurrentSlideIndex(newSlides.length - 1);\n\n    await updatePresentation({\n      id: presentationId,\n      slides: newSlides,\n    });\n  };\n\n  const onDragEnd = async (result: any) => {\n    if (!result.destination) {\n      return;\n    }\n\n    const reorderedSlides = Array.from(slides);\n    const [removed] = reorderedSlides.splice(result.source.index, 1);\n    reorderedSlides.splice(result.destination.index, 0, removed);\n\n    setSlides(reorderedSlides);\n\n    // Optimistically update, then sync with server\n    // If the index changed, update currentSlideIndex to follow the slide\n    if (currentSlideIndex === result.source.index) {\n      setCurrentSlideIndex(result.destination.index);\n    } else if (currentSlideIndex > result.source.index && currentSlideIndex <= result.destination.index) {\n      setCurrentSlideIndex(currentSlideIndex - 1);\n    } else if (currentSlideIndex < result.source.index && currentSlideIndex >= result.destination.index) {\n      setCurrentSlideIndex(currentSlideIndex + 1);\n    }\n\n    await updatePresentation({\n      id: presentationId,\n      slides: reorderedSlides,\n    });\n  };\n\n  if (!enabled) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex h-[calc(100vh-4rem)] flex-col md:flex-row overflow-hidden\">\n      {/* Sidebar: Slide List with Drag and Drop */}\n      <div className=\"w-full md:w-64 border-r bg-muted/30 overflow-y-auto p-4 space-y-4 print:hidden flex flex-col\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h2 className=\"font-semibold text-sm\">Diapositives</h2>\n          <Button variant=\"ghost\" size=\"icon\" onClick={handleAddSlide} title=\"Ajouter une diapositive\">\n            <Plus className=\"h-4 w-4\" />\n          </Button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto space-y-2\">\n          <DragDropContext onDragEnd={onDragEnd}>\n            <Droppable droppableId=\"slides-list\">\n              {(provided) => (\n                <div {...provided.droppableProps} ref={provided.innerRef} className=\"space-y-2\">\n                  {slides.map((slide, index) => (\n                    <Draggable\n                      key={slide.id || `slide-${index}`}\n                      draggableId={slide.id || `slide-${index}`}\n                      index={index}\n                    >\n                      {(provided, snapshot) => (\n                        <div\n                          ref={provided.innerRef}\n                          {...provided.draggableProps}\n                          className={cn(\n                            \"flex items-center gap-2 rounded-lg border text-sm transition-all hover:bg-accent bg-card\",\n                            currentSlideIndex === index ? \"bg-accent border-primary ring-1 ring-primary\" : \"\",\n                            snapshot.isDragging ? \"shadow-lg scale-105 z-50\" : \"\",\n                          )}\n                        >\n                          <div\n                            {...provided.dragHandleProps}\n                            className=\"p-2 cursor-grab active:cursor-grabbing text-muted-foreground hover:text-foreground\"\n                          >\n                            <GripVertical className=\"h-4 w-4\" />\n                          </div>\n                          <button\n                            type=\"button\"\n                            onClick={() => setCurrentSlideIndex(index)}\n                            className=\"flex-1 text-left p-2 pl-0 truncate\"\n                          >\n                            <span className=\"font-medium mr-2\">{index + 1}.</span>\n                            {slide.title}\n                          </button>\n                        </div>\n                      )}\n                    </Draggable>\n                  ))}\n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n        </div>\n      </div>\n\n      {/* Main Editor Area */}\n      <div className=\"flex-1 flex flex-col bg-muted/10\">\n        {/* Toolbar */}\n        <div className=\"h-14 border-b bg-background px-4 flex items-center justify-between print:hidden\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"font-semibold\">{presentation.title}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={handleExportPDF}>\n              <Download className=\"mr-2 h-4 w-4\" />\n              Exporter en PDF\n            </Button>\n          </div>\n        </div>\n\n        {/* Slide Preview / Edit */}\n        <div className=\"flex-1 overflow-auto p-8 flex items-center justify-center print:p-0\">\n          {currentSlide ? (\n            <div\n              id=\"slide-content\"\n              className=\"w-full max-w-4xl aspect-video shadow-2xl rounded-lg overflow-hidden print:shadow-none print:w-full print:h-screen print:rounded-none\"\n            >\n              <div className={cn(\"w-full h-full p-12 flex flex-col\", theme.background, theme.text)}>\n                <h1 className={cn(\"text-4xl font-bold mb-8\", theme.accent)}>{currentSlide.title}</h1>\n\n                <div className=\"flex-1 space-y-6\">\n                  {currentSlide.content?.map((block, i) => (\n                    // biome-ignore lint/suspicious/noArrayIndexKey: No stable ID available for blocks\n                    <div key={i} className=\"text-xl\">\n                      {block.type === \"bullet\" && (\n                        <div className=\"flex items-start gap-3\">\n                          <span className={cn(\"mt-2 h-2 w-2 rounded-full flex-shrink-0\", theme.bgAccent)} />\n                          <p>{block.content}</p>\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n\n                {currentSlide.rootImage && (\n                  <div className=\"mt-8 h-48 bg-black/20 rounded-lg flex items-center justify-center border-2 border-dashed border-white/20\">\n                    <p className=\"text-sm opacity-70\">Image placeholder: {currentSlide.rootImage.query}</p>\n                  </div>\n                )}\n\n                {currentSlide.notes && (\n                  <div className=\"hidden print:block mt-8 p-4 border-t border-white/20 text-sm\">\n                    <p className=\"font-bold mb-1\">Notes:</p>\n                    <p>{currentSlide.notes}</p>\n                  </div>\n                )}\n\n                <div className=\"mt-auto text-sm opacity-50 flex justify-between\">\n                  <span>Alecia Colab</span>\n                  <span>\n                    {currentSlideIndex + 1} / {slides.length}\n                  </span>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"text-muted-foreground\">Sélectionnez une diapositive</div>\n          )}\n        </div>\n      </div>\n\n      {/* Print-only View (renders all slides) */}\n      <div className=\"hidden print:block fixed inset-0 bg-white z-[9999]\">\n        {slides.map((slide, index) => (\n          // biome-ignore lint/suspicious/noArrayIndexKey: Index is stable for print view\n          <div key={`print-slide-${index}`} className=\"w-screen h-screen page-break-after-always\">\n            <div className={cn(\"w-full h-full p-12 flex flex-col\", theme.background, theme.text)}>\n              <h1 className={cn(\"text-4xl font-bold mb-8\", theme.accent)}>{slide.title}</h1>\n\n              <div className=\"flex-1 space-y-6\">\n                {slide.content?.map((block, i) => (\n                  // biome-ignore lint/suspicious/noArrayIndexKey: No stable ID available for blocks\n                  <div key={i} className=\"text-xl\">\n                    {block.type === \"bullet\" && (\n                      <div className=\"flex items-start gap-3\">\n                        <span className={cn(\"mt-2 h-2 w-2 rounded-full flex-shrink-0\", theme.bgAccent)} />\n                        <p>{block.content}</p>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n\n              {slide.notes && (\n                <div className=\"mt-8 p-4 border-t border-white/20 text-sm\">\n                  <p className=\"font-bold mb-1\">Notes:</p>\n                  <p>{slide.notes}</p>\n                </div>\n              )}\n\n              <div className=\"mt-auto text-sm opacity-50 flex justify-between\">\n                <span>Alecia Colab</span>\n                <span>\n                  {index + 1} / {slides.length}\n                </span>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[529,530],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/ui/loading-skeletons.tsx"},"span":[558,559],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[1279,1280],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/ui/loading-skeletons.tsx"},"span":[1311,1312],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[1868,1869],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/ui/loading-skeletons.tsx"},"span":[1900,1901],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[2454,2455],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/ui/loading-skeletons.tsx"},"span":[2480,2481],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[3041,3042],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/ui/loading-skeletons.tsx"},"span":[3074,3075],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noArrayIndexKey","severity":"error","description":"Avoid using the index of an array as key property in an element.","message":[{"elements":[],"content":"Avoid using the index of an array as key property in an element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"This is the source of the key value."}]]},{"frame":{"path":null,"span":[3290,3291],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"}},{"log":["info",[{"elements":[],"content":"The order of the items may change, and this also affects performances and component state."}]]},{"log":["info",[{"elements":[],"content":"Check the "},{"elements":[{"Hyperlink":{"href":"https://reactjs.org/docs/lists-and-keys.html#keys"}}],"content":"React documentation"},{"elements":[],"content":". "}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/ui/loading-skeletons.tsx"},"span":[3323,3324],"sourceCode":"import { Card, CardContent, CardHeader } from \"@/components/tailwind/ui/card\";\nimport { Skeleton } from \"@/components/tailwind/ui/skeleton\";\n\nexport function DashboardSkeleton() {\n  return (\n    <div className=\"space-y-8\">\n      {/* Welcome skeleton */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-10 w-64\" />\n        <Skeleton className=\"h-5 w-96\" />\n      </div>\n\n      {/* Stats grid skeleton */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        {Array.from({ length: 4 }).map((_, i) => (\n          <Card key={i}>\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <Skeleton className=\"h-4 w-24\" />\n              <Skeleton className=\"h-4 w-4\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-8 w-16 mb-1\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Content grid skeleton */}\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <Skeleton className=\"h-6 w-40\" />\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {Array.from({ length: 3 }).map((_, i) => (\n              <div key={i} className=\"flex items-start gap-3\">\n                <Skeleton className=\"h-10 w-10 rounded\" />\n                <div className=\"flex-1 space-y-2\">\n                  <Skeleton className=\"h-4 w-3/4\" />\n                  <Skeleton className=\"h-3 w-1/2\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <div className=\"flex-1 space-y-1\">\n                  <Skeleton className=\"h-3 w-full\" />\n                  <Skeleton className=\"h-2 w-16\" />\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function DocumentListSkeleton({ count = 5 }: { count?: number }) {\n  return (\n    <div className=\"space-y-2\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-3 rounded-lg border\">\n          <Skeleton className=\"h-10 w-10 rounded\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/4\" />\n          </div>\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport function SidebarSkeleton() {\n  return (\n    <div className=\"p-4 space-y-6\">\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-2\">\n        {Array.from({ length: 5 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-9 w-full\" />\n        ))}\n      </div>\n      <Skeleton className=\"h-px w-full\" />\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-24\" />\n        {Array.from({ length: 3 }).map((_, i) => (\n          <Skeleton key={i} className=\"h-8 w-full\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/useButtonType","severity":"error","description":"Provide an explicit type prop for the button element.","message":[{"elements":[],"content":"Provide an explicit "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" prop for the "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" element."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"The default "},{"elements":["Emphasis"],"content":"type"},{"elements":[],"content":" of a button is "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", which causes the submission of a form when placed inside a `form` element. This is likely not the behaviour that you want inside a React application."}]]},{"log":["info",[{"elements":[],"content":"Allowed button types are: "},{"elements":["Emphasis"],"content":"submit"},{"elements":[],"content":", "},{"elements":["Emphasis"],"content":"button"},{"elements":[],"content":" or "},{"elements":["Emphasis"],"content":"reset"},{"elements":[],"content":""}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/tailwind/advanced-editor.tsx"},"span":[5960,6351],"sourceCode":"\"use client\";\nimport { defaultEditorContent } from \"@/lib/content\";\nimport { useMutation } from \"convex/react\";\nimport { History, Save } from \"lucide-react\";\nimport {\n  EditorCommand,\n  EditorCommandEmpty,\n  EditorCommandItem,\n  EditorCommandList,\n  EditorContent,\n  type EditorInstance,\n  EditorRoot,\n  ImageResizer,\n  type JSONContent,\n  handleCommandNavigation,\n  handleImageDrop,\n  handleImagePaste,\n} from \"novel\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useDebouncedCallback } from \"use-debounce\";\nimport { api } from \"../../convex/_generated/api\";\nimport { defaultExtensions } from \"./extensions\";\nimport { ColorSelector } from \"./selectors/color-selector\";\nimport { LinkSelector } from \"./selectors/link-selector\";\nimport { MathSelector } from \"./selectors/math-selector\";\nimport { NodeSelector } from \"./selectors/node-selector\";\nimport { Separator } from \"./ui/separator\";\n\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { usePresence } from \"../../hooks/use-presence\";\nimport { PresenceIndicator } from \"../presence/PresenceAvatars\";\nimport { VersionHistorySidebar } from \"../version-history/VersionHistorySidebar\";\nimport GenerativeMenuSwitch from \"./generative/generative-menu-switch\";\nimport { uploadFn } from \"./image-upload\";\nimport { TextButtons } from \"./selectors/text-buttons\";\nimport { slashCommand, suggestionItems } from \"./slash-command\";\n\nconst hljs = require(\"highlight.js\");\n\nconst extensions = [...defaultExtensions, slashCommand];\n\ninterface TailwindAdvancedEditorProps {\n  documentId: string;\n}\n\nconst TailwindAdvancedEditor = ({ documentId }: TailwindAdvancedEditorProps) => {\n  const [initialContent, setInitialContent] = useState<null | JSONContent>(null);\n  const [saveStatus, setSaveStatus] = useState(\"Enregistré\");\n  const [charsCount, setCharsCount] = useState<number>();\n  const [showVersionHistory, setShowVersionHistory] = useState(false);\n  const [lastVersionSaved, setLastVersionSaved] = useState<number>(0);\n  const editorRef = useRef<EditorInstance | null>(null);\n\n  const [openNode, setOpenNode] = useState(false);\n  const [openColor, setOpenColor] = useState(false);\n  const [openLink, setOpenLink] = useState(false);\n  const [openAI, setOpenAI] = useState(false);\n\n  // Presence tracking\n  const { otherUsers } = usePresence({\n    resourceType: \"document\",\n    resourceId: documentId,\n    enabled: true,\n  });\n\n  // Convex mutations (only if configured)\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n  const saveVersionMutation = useMutation(api.documentVersions.saveVersion);\n\n  // Apply Codeblock Highlighting on the HTML from editor.getHTML()\n  const highlightCodeblocks = (content: string) => {\n    const doc = new DOMParser().parseFromString(content, \"text/html\");\n    doc.querySelectorAll(\"pre code\").forEach((el) => {\n      // @ts-ignore\n      hljs.highlightElement(el);\n    });\n    return new XMLSerializer().serializeToString(doc);\n  };\n\n  // Save version to Convex (debounced - every 5 minutes or manual)\n  const saveVersion = useCallback(\n    async (editor: EditorInstance, isManual = false) => {\n      if (!isConvexConfigured) return;\n\n      const now = Date.now();\n      // Auto-save version every 5 minutes or on manual save\n      if (!isManual && now - lastVersionSaved < 5 * 60 * 1000) return;\n\n      try {\n        const _json = editor.getJSON();\n        const _markdown = editor.storage.markdown?.getMarkdown() || \"\";\n\n        // Note: In production, use actual document ID from route\n        // For now, this is a placeholder that won't work until you have real document IDs\n        // await saveVersionMutation({\n        //   documentId: documentId as Id<\"colab_documents\">,\n        //   content: JSON.stringify(json),\n        //   markdown,\n        //   changeDescription: isManual ? \"Sauvegarde manuelle\" : \"Sauvegarde automatique\",\n        // });\n\n        setLastVersionSaved(now);\n        console.log(\"Version sauvegardée:\", isManual ? \"manuelle\" : \"auto\");\n      } catch (error) {\n        console.error(\"Erreur sauvegarde version:\", error);\n      }\n    },\n    [isConvexConfigured, lastVersionSaved, saveVersionMutation],\n  );\n\n  const debouncedUpdates = useDebouncedCallback(async (editor: EditorInstance) => {\n    const json = editor.getJSON();\n    setCharsCount(editor.storage.characterCount.words());\n    window.localStorage.setItem(\"html-content\", highlightCodeblocks(editor.getHTML()));\n    window.localStorage.setItem(\"novel-content\", JSON.stringify(json));\n    window.localStorage.setItem(\"markdown\", editor.storage.markdown.getMarkdown());\n    window.localStorage.setItem(\"alecia-last-saved\", new Date().toISOString());\n    setSaveStatus(\"Enregistré\");\n\n    // Try to save version periodically\n    saveVersion(editor, false);\n  }, 500);\n\n  // Handle preview version from sidebar\n  const handlePreviewVersion = useCallback((content: string) => {\n    try {\n      const parsed = JSON.parse(content);\n      // Show in a preview mode (could open a modal or side-by-side view)\n      console.log(\"Preview version:\", parsed);\n    } catch (error) {\n      console.error(\"Error previewing version:\", error);\n    }\n  }, []);\n\n  useEffect(() => {\n    try {\n      const content = window.localStorage.getItem(\"novel-content\");\n      if (content) {\n        setInitialContent(JSON.parse(content));\n      } else {\n        setInitialContent(defaultEditorContent);\n      }\n    } catch (error) {\n      console.error(\"Error loading editor content:\", error);\n      setInitialContent(defaultEditorContent);\n    }\n  }, []);\n\n  if (!initialContent) return null;\n\n  return (\n    <div className=\"relative w-full max-w-screen-lg\">\n      {/* Header avec status, présence et historique */}\n      <div className=\"flex absolute right-5 top-5 z-10 mb-5 gap-2 items-center\">\n        {/* Indicateur de présence */}\n        {otherUsers.length > 0 && <PresenceIndicator users={otherUsers} />}\n\n        {/* Bouton Historique */}\n        <button\n          onClick={() => setShowVersionHistory(!showVersionHistory)}\n          className={`flex items-center gap-1.5 rounded-lg px-2 py-1 text-sm transition-colors ${\n            showVersionHistory\n              ? \"bg-primary text-primary-foreground\"\n              : \"bg-muted hover:bg-muted/80 text-muted-foreground\"\n          }`}\n          title=\"Historique des versions\"\n        >\n          <History className=\"h-4 w-4\" />\n          <span className=\"hidden sm:inline\">Historique</span>\n        </button>\n\n        {/* Status de sauvegarde */}\n        <div\n          className={`rounded-lg px-2 py-1 text-sm flex items-center gap-1.5 ${\n            saveStatus === \"Enregistré\"\n              ? \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\"\n              : \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\"\n          }`}\n        >\n          <Save className=\"h-3 w-3\" />\n          {saveStatus}\n        </div>\n\n        {/* Compteur de mots */}\n        <div className={charsCount ? \"rounded-lg bg-accent px-2 py-1 text-sm text-muted-foreground\" : \"hidden\"}>\n          {charsCount} mots\n        </div>\n      </div>\n\n      {/* Sidebar historique */}\n      {showVersionHistory && (\n        <div className=\"absolute right-0 top-16 z-20 w-80\">\n          <VersionHistorySidebar\n            documentId={documentId as unknown as Id<\"colab_documents\">}\n            isOpen={showVersionHistory}\n            onClose={() => setShowVersionHistory(false)}\n            onPreviewVersion={handlePreviewVersion}\n          />\n        </div>\n      )}\n\n      <EditorRoot>\n        <EditorContent\n          initialContent={initialContent}\n          extensions={extensions}\n          className=\"relative min-h-[500px] w-full max-w-screen-lg border-muted bg-background sm:mb-[calc(20vh)] sm:rounded-lg sm:border sm:shadow-lg\"\n          editorProps={{\n            handleDOMEvents: {\n              keydown: (_view, event) => handleCommandNavigation(event),\n            },\n            handlePaste: (view, event) => handleImagePaste(view, event, uploadFn),\n            handleDrop: (view, event, _slice, moved) => handleImageDrop(view, event, moved, uploadFn),\n            attributes: {\n              class:\n                \"prose prose-lg dark:prose-invert prose-headings:font-title font-default focus:outline-none max-w-full\",\n            },\n          }}\n          onUpdate={({ editor }) => {\n            editorRef.current = editor;\n            debouncedUpdates(editor);\n            setSaveStatus(\"Non enregistré\");\n          }}\n          slotAfter={<ImageResizer />}\n        >\n          <EditorCommand className=\"z-50 h-auto max-h-[330px] overflow-y-auto rounded-md border border-muted bg-background px-1 py-2 shadow-md transition-all\">\n            <EditorCommandEmpty className=\"px-2 text-muted-foreground\">Aucun résultat</EditorCommandEmpty>\n            <EditorCommandList>\n              {suggestionItems.map((item) => (\n                <EditorCommandItem\n                  value={item.title}\n                  onCommand={(val) => item.command(val)}\n                  className=\"flex w-full items-center space-x-2 rounded-md px-2 py-1 text-left text-sm hover:bg-accent aria-selected:bg-accent\"\n                  key={item.title}\n                >\n                  <div className=\"flex h-10 w-10 items-center justify-center rounded-md border border-muted bg-background\">\n                    {item.icon}\n                  </div>\n                  <div>\n                    <p className=\"font-medium\">{item.title}</p>\n                    <p className=\"text-xs text-muted-foreground\">{item.description}</p>\n                  </div>\n                </EditorCommandItem>\n              ))}\n            </EditorCommandList>\n          </EditorCommand>\n\n          <GenerativeMenuSwitch open={openAI} onOpenChange={setOpenAI}>\n            <Separator orientation=\"vertical\" />\n            <NodeSelector open={openNode} onOpenChange={setOpenNode} />\n            <Separator orientation=\"vertical\" />\n\n            <LinkSelector open={openLink} onOpenChange={setOpenLink} />\n            <Separator orientation=\"vertical\" />\n            <MathSelector />\n            <Separator orientation=\"vertical\" />\n            <TextButtons />\n            <Separator orientation=\"vertical\" />\n            <ColorSelector open={openColor} onOpenChange={setOpenColor} />\n          </GenerativeMenuSwitch>\n        </EditorContent>\n      </EditorRoot>\n    </div>\n  );\n};\n\nexport default TailwindAdvancedEditor;\n"},"tags":[],"source":null},{"category":"lint/a11y/noLabelWithoutControl","severity":"error","description":"A form label must be associated with an input.","message":[{"elements":[],"content":"A form label must be associated with an input."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Consider adding a `for` or `htmlFor` attribute to the label element or moving the input element to inside the label element."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/tailwind/deal-pipeline.tsx"},"span":[5910,5971],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  Calendar,\n  DollarSign,\n  Loader2,\n  MoreVertical,\n  Plus,\n  TrendingUp,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Badge } from \"./ui/badge\";\nimport { Button } from \"./ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"./ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"./ui/dialog\";\nimport { ScrollArea } from \"./ui/scroll-area\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  lead?: string;\n  createdAt: number;\n  updatedAt: number;\n}\n\n// Mock deals as fallback when Convex is not available\nconst mockDeals: Deal[] = [\n  {\n    _id: \"mock-1\" as Id<\"colab_deals\">,\n    company: \"TechVenture Inc.\",\n    stage: \"due-diligence\",\n    valuation: \"$25M\",\n    lead: \"John Doe\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n  {\n    _id: \"mock-2\" as Id<\"colab_deals\">,\n    company: \"HealthCare Solutions\",\n    stage: \"negotiation\",\n    valuation: \"$50M\",\n    lead: \"Jane Smith\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n  {\n    _id: \"mock-3\" as Id<\"colab_deals\">,\n    company: \"FinTech Innovations\",\n    stage: \"sourcing\",\n    valuation: \"$15M\",\n    lead: \"Mike Johnson\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n];\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100\",\n  \"due-diligence\": \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\",\n  negotiation: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100\",\n  closing: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100\",\n  \"closed-won\": \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\",\n  \"closed-lost\": \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n};\n\nconst stageLabels: Record<DealStage, string> = {\n  sourcing: \"Sourcing\",\n  \"due-diligence\": \"Due Diligence\",\n  negotiation: \"Negotiation\",\n  closing: \"Closing\",\n  \"closed-won\": \"Won\",\n  \"closed-lost\": \"Lost\",\n};\n\nconst pipelineStages: DealStage[] = [\"sourcing\", \"due-diligence\", \"negotiation\", \"closing\"];\n\nexport default function DealPipeline() {\n  const [selectedStage, setSelectedStage] = useState<DealStage | null>(null);\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newDealCompany, setNewDealCompany] = useState(\"\");\n  const [newDealValuation, setNewDealValuation] = useState(\"\");\n  const [newDealLead, setNewDealLead] = useState(\"\");\n\n  // Try to use Convex, fallback to mock data\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  // Convex queries - will skip if not configured\n  const convexDeals = useQuery(api.deals.list, isConvexConfigured ? {} : \"skip\");\n\n  const createDeal = useMutation(api.deals.create);\n  const moveDealStage = useMutation(api.deals.moveStage);\n\n  // Use Convex deals if available, otherwise fallback to mock\n  const deals: Deal[] = convexDeals ?? mockDeals;\n  const isLoading = isConvexConfigured && convexDeals === undefined;\n\n  const filteredDeals = selectedStage\n    ? deals.filter((deal) => deal.stage === selectedStage)\n    : deals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage));\n\n  const dealsByStage = pipelineStages.reduce(\n    (acc, stage) => {\n      acc[stage] = deals.filter((d) => d.stage === stage).length;\n      return acc;\n    },\n    {} as Record<DealStage, number>,\n  );\n\n  const handleCreateDeal = async () => {\n    if (!newDealCompany.trim()) return;\n\n    try {\n      await createDeal({\n        company: newDealCompany,\n        stage: \"sourcing\",\n        valuation: newDealValuation || undefined,\n        lead: newDealLead || undefined,\n      });\n      setNewDealCompany(\"\");\n      setNewDealValuation(\"\");\n      setNewDealLead(\"\");\n      setIsCreateOpen(false);\n    } catch (error) {\n      console.error(\"Failed to create deal:\", error);\n    }\n  };\n\n  const handleMoveToNextStage = async (deal: Deal) => {\n    const currentIndex = pipelineStages.indexOf(deal.stage);\n    if (currentIndex === -1 || currentIndex >= pipelineStages.length - 1) return;\n\n    const nextStage = pipelineStages[currentIndex + 1];\n    try {\n      await moveDealStage({\n        id: deal._id,\n        stage: nextStage,\n      });\n    } catch (error) {\n      console.error(\"Failed to move deal:\", error);\n    }\n  };\n\n  const formatDate = (timestamp: number) => {\n    return new Date(timestamp).toLocaleDateString();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n          <Briefcase className=\"h-6 w-6\" />\n          Deal Pipeline\n          {!isConvexConfigured && (\n            <Badge variant=\"outline\" className=\"ml-2 text-xs\">\n              Demo Mode\n            </Badge>\n          )}\n        </h2>\n        <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n          <DialogTrigger asChild>\n            <Button disabled={!isConvexConfigured}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Deal\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Create New Deal</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div>\n                <label className=\"text-sm font-medium\">Company Name *</label>\n                <input\n                  type=\"text\"\n                  value={newDealCompany}\n                  onChange={(e) => setNewDealCompany(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"Enter company name\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">Valuation</label>\n                <input\n                  type=\"text\"\n                  value={newDealValuation}\n                  onChange={(e) => setNewDealValuation(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"e.g., $10M\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">Deal Lead</label>\n                <input\n                  type=\"text\"\n                  value={newDealLead}\n                  onChange={(e) => setNewDealLead(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"Lead person name\"\n                />\n              </div>\n              <Button onClick={handleCreateDeal} className=\"w-full\">\n                Create Deal\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stage Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        {pipelineStages.map((stage) => (\n          <Card\n            key={stage}\n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStage === stage ? \"ring-2 ring-primary\" : \"\"\n            }`}\n            onClick={() => setSelectedStage(selectedStage === stage ? null : stage)}\n          >\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">{stageLabels[stage]}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{dealsByStage[stage] || 0}</div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Deal Cards */}\n      <ScrollArea className=\"h-[500px]\">\n        <div className=\"space-y-3\">\n          {filteredDeals.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No deals found.{\" \"}\n              {isConvexConfigured ? \"Create a new deal to get started.\" : \"Configure Convex to enable persistence.\"}\n            </div>\n          ) : (\n            filteredDeals.map((deal) => (\n              <Card key={deal._id} className=\"hover:shadow-md transition-all\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"space-y-2 flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <Building className=\"h-4 w-4 text-muted-foreground\" />\n                        <h3 className=\"font-semibold\">{deal.company}</h3>\n                      </div>\n\n                      <div className=\"flex flex-wrap gap-3 text-sm text-muted-foreground\">\n                        {deal.valuation && (\n                          <div className=\"flex items-center gap-1\">\n                            <DollarSign className=\"h-3 w-3\" />\n                            <span>{deal.valuation}</span>\n                          </div>\n                        )}\n                        {deal.lead && (\n                          <div className=\"flex items-center gap-1\">\n                            <TrendingUp className=\"h-3 w-3\" />\n                            <span>{deal.lead}</span>\n                          </div>\n                        )}\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"h-3 w-3\" />\n                          <span>{formatDate(deal.createdAt)}</span>\n                        </div>\n                      </div>\n\n                      <Badge className={stageColors[deal.stage]}>{stageLabels[deal.stage]}</Badge>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      {isConvexConfigured && pipelineStages.indexOf(deal.stage) < pipelineStages.length - 1 && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleMoveToNextStage(deal)}\n                          title=\"Move to next stage\"\n                        >\n                          <ArrowRight className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/noLabelWithoutControl","severity":"error","description":"A form label must be associated with an input.","message":[{"elements":[],"content":"A form label must be associated with an input."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Consider adding a `for` or `htmlFor` attribute to the label element or moving the input element to inside the label element."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/tailwind/deal-pipeline.tsx"},"span":[6333,6389],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  Calendar,\n  DollarSign,\n  Loader2,\n  MoreVertical,\n  Plus,\n  TrendingUp,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Badge } from \"./ui/badge\";\nimport { Button } from \"./ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"./ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"./ui/dialog\";\nimport { ScrollArea } from \"./ui/scroll-area\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  lead?: string;\n  createdAt: number;\n  updatedAt: number;\n}\n\n// Mock deals as fallback when Convex is not available\nconst mockDeals: Deal[] = [\n  {\n    _id: \"mock-1\" as Id<\"colab_deals\">,\n    company: \"TechVenture Inc.\",\n    stage: \"due-diligence\",\n    valuation: \"$25M\",\n    lead: \"John Doe\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n  {\n    _id: \"mock-2\" as Id<\"colab_deals\">,\n    company: \"HealthCare Solutions\",\n    stage: \"negotiation\",\n    valuation: \"$50M\",\n    lead: \"Jane Smith\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n  {\n    _id: \"mock-3\" as Id<\"colab_deals\">,\n    company: \"FinTech Innovations\",\n    stage: \"sourcing\",\n    valuation: \"$15M\",\n    lead: \"Mike Johnson\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n];\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100\",\n  \"due-diligence\": \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\",\n  negotiation: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100\",\n  closing: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100\",\n  \"closed-won\": \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\",\n  \"closed-lost\": \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n};\n\nconst stageLabels: Record<DealStage, string> = {\n  sourcing: \"Sourcing\",\n  \"due-diligence\": \"Due Diligence\",\n  negotiation: \"Negotiation\",\n  closing: \"Closing\",\n  \"closed-won\": \"Won\",\n  \"closed-lost\": \"Lost\",\n};\n\nconst pipelineStages: DealStage[] = [\"sourcing\", \"due-diligence\", \"negotiation\", \"closing\"];\n\nexport default function DealPipeline() {\n  const [selectedStage, setSelectedStage] = useState<DealStage | null>(null);\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newDealCompany, setNewDealCompany] = useState(\"\");\n  const [newDealValuation, setNewDealValuation] = useState(\"\");\n  const [newDealLead, setNewDealLead] = useState(\"\");\n\n  // Try to use Convex, fallback to mock data\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  // Convex queries - will skip if not configured\n  const convexDeals = useQuery(api.deals.list, isConvexConfigured ? {} : \"skip\");\n\n  const createDeal = useMutation(api.deals.create);\n  const moveDealStage = useMutation(api.deals.moveStage);\n\n  // Use Convex deals if available, otherwise fallback to mock\n  const deals: Deal[] = convexDeals ?? mockDeals;\n  const isLoading = isConvexConfigured && convexDeals === undefined;\n\n  const filteredDeals = selectedStage\n    ? deals.filter((deal) => deal.stage === selectedStage)\n    : deals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage));\n\n  const dealsByStage = pipelineStages.reduce(\n    (acc, stage) => {\n      acc[stage] = deals.filter((d) => d.stage === stage).length;\n      return acc;\n    },\n    {} as Record<DealStage, number>,\n  );\n\n  const handleCreateDeal = async () => {\n    if (!newDealCompany.trim()) return;\n\n    try {\n      await createDeal({\n        company: newDealCompany,\n        stage: \"sourcing\",\n        valuation: newDealValuation || undefined,\n        lead: newDealLead || undefined,\n      });\n      setNewDealCompany(\"\");\n      setNewDealValuation(\"\");\n      setNewDealLead(\"\");\n      setIsCreateOpen(false);\n    } catch (error) {\n      console.error(\"Failed to create deal:\", error);\n    }\n  };\n\n  const handleMoveToNextStage = async (deal: Deal) => {\n    const currentIndex = pipelineStages.indexOf(deal.stage);\n    if (currentIndex === -1 || currentIndex >= pipelineStages.length - 1) return;\n\n    const nextStage = pipelineStages[currentIndex + 1];\n    try {\n      await moveDealStage({\n        id: deal._id,\n        stage: nextStage,\n      });\n    } catch (error) {\n      console.error(\"Failed to move deal:\", error);\n    }\n  };\n\n  const formatDate = (timestamp: number) => {\n    return new Date(timestamp).toLocaleDateString();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n          <Briefcase className=\"h-6 w-6\" />\n          Deal Pipeline\n          {!isConvexConfigured && (\n            <Badge variant=\"outline\" className=\"ml-2 text-xs\">\n              Demo Mode\n            </Badge>\n          )}\n        </h2>\n        <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n          <DialogTrigger asChild>\n            <Button disabled={!isConvexConfigured}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Deal\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Create New Deal</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div>\n                <label className=\"text-sm font-medium\">Company Name *</label>\n                <input\n                  type=\"text\"\n                  value={newDealCompany}\n                  onChange={(e) => setNewDealCompany(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"Enter company name\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">Valuation</label>\n                <input\n                  type=\"text\"\n                  value={newDealValuation}\n                  onChange={(e) => setNewDealValuation(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"e.g., $10M\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">Deal Lead</label>\n                <input\n                  type=\"text\"\n                  value={newDealLead}\n                  onChange={(e) => setNewDealLead(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"Lead person name\"\n                />\n              </div>\n              <Button onClick={handleCreateDeal} className=\"w-full\">\n                Create Deal\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stage Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        {pipelineStages.map((stage) => (\n          <Card\n            key={stage}\n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStage === stage ? \"ring-2 ring-primary\" : \"\"\n            }`}\n            onClick={() => setSelectedStage(selectedStage === stage ? null : stage)}\n          >\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">{stageLabels[stage]}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{dealsByStage[stage] || 0}</div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Deal Cards */}\n      <ScrollArea className=\"h-[500px]\">\n        <div className=\"space-y-3\">\n          {filteredDeals.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No deals found.{\" \"}\n              {isConvexConfigured ? \"Create a new deal to get started.\" : \"Configure Convex to enable persistence.\"}\n            </div>\n          ) : (\n            filteredDeals.map((deal) => (\n              <Card key={deal._id} className=\"hover:shadow-md transition-all\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"space-y-2 flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <Building className=\"h-4 w-4 text-muted-foreground\" />\n                        <h3 className=\"font-semibold\">{deal.company}</h3>\n                      </div>\n\n                      <div className=\"flex flex-wrap gap-3 text-sm text-muted-foreground\">\n                        {deal.valuation && (\n                          <div className=\"flex items-center gap-1\">\n                            <DollarSign className=\"h-3 w-3\" />\n                            <span>{deal.valuation}</span>\n                          </div>\n                        )}\n                        {deal.lead && (\n                          <div className=\"flex items-center gap-1\">\n                            <TrendingUp className=\"h-3 w-3\" />\n                            <span>{deal.lead}</span>\n                          </div>\n                        )}\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"h-3 w-3\" />\n                          <span>{formatDate(deal.createdAt)}</span>\n                        </div>\n                      </div>\n\n                      <Badge className={stageColors[deal.stage]}>{stageLabels[deal.stage]}</Badge>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      {isConvexConfigured && pipelineStages.indexOf(deal.stage) < pipelineStages.length - 1 && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleMoveToNextStage(deal)}\n                          title=\"Move to next stage\"\n                        >\n                          <ArrowRight className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/a11y/noLabelWithoutControl","severity":"error","description":"A form label must be associated with an input.","message":[{"elements":[],"content":"A form label must be associated with an input."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Consider adding a `for` or `htmlFor` attribute to the label element or moving the input element to inside the label element."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/tailwind/deal-pipeline.tsx"},"span":[6747,6803],"sourceCode":"\"use client\";\n\nimport { useMutation, useQuery } from \"convex/react\";\nimport {\n  ArrowRight,\n  Briefcase,\n  Building,\n  Calendar,\n  DollarSign,\n  Loader2,\n  MoreVertical,\n  Plus,\n  TrendingUp,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { api } from \"../../convex/_generated/api\";\nimport type { Id } from \"../../convex/_generated/dataModel\";\nimport { Badge } from \"./ui/badge\";\nimport { Button } from \"./ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"./ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"./ui/dialog\";\nimport { ScrollArea } from \"./ui/scroll-area\";\n\ntype DealStage = \"sourcing\" | \"due-diligence\" | \"negotiation\" | \"closing\" | \"closed-won\" | \"closed-lost\";\n\ninterface Deal {\n  _id: Id<\"colab_deals\">;\n  company: string;\n  stage: DealStage;\n  valuation?: string;\n  lead?: string;\n  createdAt: number;\n  updatedAt: number;\n}\n\n// Mock deals as fallback when Convex is not available\nconst mockDeals: Deal[] = [\n  {\n    _id: \"mock-1\" as Id<\"colab_deals\">,\n    company: \"TechVenture Inc.\",\n    stage: \"due-diligence\",\n    valuation: \"$25M\",\n    lead: \"John Doe\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n  {\n    _id: \"mock-2\" as Id<\"colab_deals\">,\n    company: \"HealthCare Solutions\",\n    stage: \"negotiation\",\n    valuation: \"$50M\",\n    lead: \"Jane Smith\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n  {\n    _id: \"mock-3\" as Id<\"colab_deals\">,\n    company: \"FinTech Innovations\",\n    stage: \"sourcing\",\n    valuation: \"$15M\",\n    lead: \"Mike Johnson\",\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  },\n];\n\nconst stageColors: Record<DealStage, string> = {\n  sourcing: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100\",\n  \"due-diligence\": \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100\",\n  negotiation: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100\",\n  closing: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100\",\n  \"closed-won\": \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100\",\n  \"closed-lost\": \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100\",\n};\n\nconst stageLabels: Record<DealStage, string> = {\n  sourcing: \"Sourcing\",\n  \"due-diligence\": \"Due Diligence\",\n  negotiation: \"Negotiation\",\n  closing: \"Closing\",\n  \"closed-won\": \"Won\",\n  \"closed-lost\": \"Lost\",\n};\n\nconst pipelineStages: DealStage[] = [\"sourcing\", \"due-diligence\", \"negotiation\", \"closing\"];\n\nexport default function DealPipeline() {\n  const [selectedStage, setSelectedStage] = useState<DealStage | null>(null);\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newDealCompany, setNewDealCompany] = useState(\"\");\n  const [newDealValuation, setNewDealValuation] = useState(\"\");\n  const [newDealLead, setNewDealLead] = useState(\"\");\n\n  // Try to use Convex, fallback to mock data\n  const isConvexConfigured = !!process.env.NEXT_PUBLIC_CONVEX_URL;\n\n  // Convex queries - will skip if not configured\n  const convexDeals = useQuery(api.deals.list, isConvexConfigured ? {} : \"skip\");\n\n  const createDeal = useMutation(api.deals.create);\n  const moveDealStage = useMutation(api.deals.moveStage);\n\n  // Use Convex deals if available, otherwise fallback to mock\n  const deals: Deal[] = convexDeals ?? mockDeals;\n  const isLoading = isConvexConfigured && convexDeals === undefined;\n\n  const filteredDeals = selectedStage\n    ? deals.filter((deal) => deal.stage === selectedStage)\n    : deals.filter((deal) => ![\"closed-won\", \"closed-lost\"].includes(deal.stage));\n\n  const dealsByStage = pipelineStages.reduce(\n    (acc, stage) => {\n      acc[stage] = deals.filter((d) => d.stage === stage).length;\n      return acc;\n    },\n    {} as Record<DealStage, number>,\n  );\n\n  const handleCreateDeal = async () => {\n    if (!newDealCompany.trim()) return;\n\n    try {\n      await createDeal({\n        company: newDealCompany,\n        stage: \"sourcing\",\n        valuation: newDealValuation || undefined,\n        lead: newDealLead || undefined,\n      });\n      setNewDealCompany(\"\");\n      setNewDealValuation(\"\");\n      setNewDealLead(\"\");\n      setIsCreateOpen(false);\n    } catch (error) {\n      console.error(\"Failed to create deal:\", error);\n    }\n  };\n\n  const handleMoveToNextStage = async (deal: Deal) => {\n    const currentIndex = pipelineStages.indexOf(deal.stage);\n    if (currentIndex === -1 || currentIndex >= pipelineStages.length - 1) return;\n\n    const nextStage = pipelineStages[currentIndex + 1];\n    try {\n      await moveDealStage({\n        id: deal._id,\n        stage: nextStage,\n      });\n    } catch (error) {\n      console.error(\"Failed to move deal:\", error);\n    }\n  };\n\n  const formatDate = (timestamp: number) => {\n    return new Date(timestamp).toLocaleDateString();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n          <Briefcase className=\"h-6 w-6\" />\n          Deal Pipeline\n          {!isConvexConfigured && (\n            <Badge variant=\"outline\" className=\"ml-2 text-xs\">\n              Demo Mode\n            </Badge>\n          )}\n        </h2>\n        <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n          <DialogTrigger asChild>\n            <Button disabled={!isConvexConfigured}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Deal\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Create New Deal</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div>\n                <label className=\"text-sm font-medium\">Company Name *</label>\n                <input\n                  type=\"text\"\n                  value={newDealCompany}\n                  onChange={(e) => setNewDealCompany(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"Enter company name\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">Valuation</label>\n                <input\n                  type=\"text\"\n                  value={newDealValuation}\n                  onChange={(e) => setNewDealValuation(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"e.g., $10M\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">Deal Lead</label>\n                <input\n                  type=\"text\"\n                  value={newDealLead}\n                  onChange={(e) => setNewDealLead(e.target.value)}\n                  className=\"w-full mt-1 px-3 py-2 border rounded-md\"\n                  placeholder=\"Lead person name\"\n                />\n              </div>\n              <Button onClick={handleCreateDeal} className=\"w-full\">\n                Create Deal\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stage Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        {pipelineStages.map((stage) => (\n          <Card\n            key={stage}\n            className={`cursor-pointer transition-all hover:shadow-md ${\n              selectedStage === stage ? \"ring-2 ring-primary\" : \"\"\n            }`}\n            onClick={() => setSelectedStage(selectedStage === stage ? null : stage)}\n          >\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">{stageLabels[stage]}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{dealsByStage[stage] || 0}</div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Deal Cards */}\n      <ScrollArea className=\"h-[500px]\">\n        <div className=\"space-y-3\">\n          {filteredDeals.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No deals found.{\" \"}\n              {isConvexConfigured ? \"Create a new deal to get started.\" : \"Configure Convex to enable persistence.\"}\n            </div>\n          ) : (\n            filteredDeals.map((deal) => (\n              <Card key={deal._id} className=\"hover:shadow-md transition-all\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"space-y-2 flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <Building className=\"h-4 w-4 text-muted-foreground\" />\n                        <h3 className=\"font-semibold\">{deal.company}</h3>\n                      </div>\n\n                      <div className=\"flex flex-wrap gap-3 text-sm text-muted-foreground\">\n                        {deal.valuation && (\n                          <div className=\"flex items-center gap-1\">\n                            <DollarSign className=\"h-3 w-3\" />\n                            <span>{deal.valuation}</span>\n                          </div>\n                        )}\n                        {deal.lead && (\n                          <div className=\"flex items-center gap-1\">\n                            <TrendingUp className=\"h-3 w-3\" />\n                            <span>{deal.lead}</span>\n                          </div>\n                        )}\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"h-3 w-3\" />\n                          <span>{formatDate(deal.createdAt)}</span>\n                        </div>\n                      </div>\n\n                      <Badge className={stageColors[deal.stage]}>{stageLabels[deal.stage]}</Badge>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      {isConvexConfigured && pipelineStages.indexOf(deal.stage) < pipelineStages.length - 1 && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleMoveToNextStage(deal)}\n                          title=\"Move to next stage\"\n                        >\n                          <ArrowRight className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                      <Button variant=\"ghost\" size=\"icon\">\n                        <MoreVertical className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/suspicious/noExplicitAny","severity":"error","description":"Unexpected any. Specify a different type.","message":[{"elements":[],"content":"Unexpected "},{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":". Specify a different type."}],"advices":{"advices":[{"log":["info",[{"elements":["Emphasis"],"content":"any"},{"elements":[],"content":" disables many type checking rules. Its use should be avoided."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/tailwind/image-upload.ts"},"span":[50,53],"sourceCode":"export const uploadFn = async (file: File, _view: any, _pos: number) => {\n  // Mock upload or use Vercel Blob if keys are configured\n  // For now, we'll return a local URL to preview\n  return URL.createObjectURL(file);\n};\n"},"tags":[],"source":null},{"category":"lint/correctness/noUnusedVariables","severity":"warning","description":"This variable is unused.","message":[{"elements":[],"content":"This variable is unused."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Unused variables usually are result of incomplete refactoring, typos and other source of bugs."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/tailwind/generative/ai-selector.tsx"},"span":[748,757],"sourceCode":"import { Button } from \"@/components/tailwind/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/tailwind/ui/command\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/tailwind/ui/popover\";\nimport type { Editor } from \"@tiptap/core\";\nimport { useCompletion } from \"ai/react\";\nimport { Sparkles } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { AI_ACTIONS } from \"../ai/ai-actions\";\n\ninterface AISelectorProps {\n  editor: Editor;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function AISelector({ editor, open, onOpenChange }: AISelectorProps) {\n  const { complete, isLoading } = useCompletion({\n    api: \"/api/generate\",\n    onResponse: (response) => {\n      if (response.status === 429) {\n        toast.error(\"Limite de débit atteinte.\");\n        return;\n      }\n    },\n    onError: (e) => {\n      toast.error(e.message);\n    },\n    onFinish: (_prompt, completion) => {\n      // Replace selection with completion or handle it\n      // For now, we will just insert it.\n      // But novel usually handles this with completion updates.\n      // Let's insert it at selection\n      const selection = editor.state.selection;\n      editor.chain().focus().insertContentAt({ from: selection.from, to: selection.to }, completion).run();\n    },\n  });\n\n  const [inputValue, setInputValue] = useState(\"\");\n\n  const handleAction = async (action: (typeof AI_ACTIONS)[number]) => {\n    const selection = editor.state.selection;\n    const text = editor.state.doc.textBetween(selection.from, selection.to, \" \");\n\n    if (!text) {\n      toast.error(\"Veuillez sélectionner du texte pour utiliser l'IA.\");\n      return;\n    }\n\n    const prompt = `${action.prompt}:\\n\"${text}\"`;\n\n    complete(prompt);\n\n    toast.info(`IA: ${action.label}...`);\n    onOpenChange(false);\n  };\n\n  useEffect(() => {\n    const handleAIAction = (e: Event) => {\n      const customEvent = e as CustomEvent;\n      const { action, prompt } = customEvent.detail;\n      const aiAction = AI_ACTIONS.find((a) => a.value === action);\n      if (aiAction) {\n        handleAction(aiAction);\n      }\n    };\n\n    editor.view.dom.addEventListener(\"ai-action\", handleAIAction);\n    return () => {\n      editor.view.dom.removeEventListener(\"ai-action\", handleAIAction);\n    };\n  }, [editor, handleAction]);\n\n  return (\n    <Popover open={open} onOpenChange={onOpenChange}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          className=\"gap-2 rounded-none border-none text-purple-500 hover:text-purple-600\"\n          size=\"sm\"\n        >\n          <Sparkles className=\"h-4 w-4\" />\n          IA\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-72 p-0\" align=\"start\">\n        <Command>\n          <CommandInput placeholder=\"Demander à l'IA...\" value={inputValue} onValueChange={setInputValue} autoFocus />\n          <CommandList>\n            <CommandEmpty>Aucune action trouvée.</CommandEmpty>\n            <CommandGroup heading=\"Actions IA\">\n              {AI_ACTIONS.map((action) => (\n                <CommandItem\n                  key={action.value}\n                  onSelect={() => handleAction(action)}\n                  className=\"flex cursor-pointer items-center gap-2\"\n                >\n                  {action.icon}\n                  <span>{action.label}</span>\n                </CommandItem>\n              ))}\n            </CommandGroup>\n          </CommandList>\n        </Command>\n      </PopoverContent>\n    </Popover>\n  );\n}\n"},"tags":[],"source":null},{"category":"lint/correctness/noUnusedVariables","severity":"warning","description":"This variable is unused.","message":[{"elements":[],"content":"This variable is unused."}],"advices":{"advices":[{"log":["info",[{"elements":[],"content":"Unused variables usually are result of incomplete refactoring, typos and other source of bugs."}]]}]},"verboseAdvices":{"advices":[]},"location":{"path":{"file":"./components/tailwind/generative/ai-selector.tsx"},"span":[2069,2075],"sourceCode":"import { Button } from \"@/components/tailwind/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/tailwind/ui/command\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/tailwind/ui/popover\";\nimport type { Editor } from \"@tiptap/core\";\nimport { useCompletion } from \"ai/react\";\nimport { Sparkles } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport { AI_ACTIONS } from \"../ai/ai-actions\";\n\ninterface AISelectorProps {\n  editor: Editor;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function AISelector({ editor, open, onOpenChange }: AISelectorProps) {\n  const { complete, isLoading } = useCompletion({\n    api: \"/api/generate\",\n    onResponse: (response) => {\n      if (response.status === 429) {\n        toast.error(\"Limite de débit atteinte.\");\n        return;\n      }\n    },\n    onError: (e) => {\n      toast.error(e.message);\n    },\n    onFinish: (_prompt, completion) => {\n      // Replace selection with completion or handle it\n      // For now, we will just insert it.\n      // But novel usually handles this with completion updates.\n      // Let's insert it at selection\n      const selection = editor.state.selection;\n      editor.chain().focus().insertContentAt({ from: selection.from, to: selection.to }, completion).run();\n    },\n  });\n\n  const [inputValue, setInputValue] = useState(\"\");\n\n  const handleAction = async (action: (typeof AI_ACTIONS)[number]) => {\n    const selection = editor.state.selection;\n    const text = editor.state.doc.textBetween(selection.from, selection.to, \" \");\n\n    if (!text) {\n      toast.error(\"Veuillez sélectionner du texte pour utiliser l'IA.\");\n      return;\n    }\n\n    const prompt = `${action.prompt}:\\n\"${text}\"`;\n\n    complete(prompt);\n\n    toast.info(`IA: ${action.label}...`);\n    onOpenChange(false);\n  };\n\n  useEffect(() => {\n    const handleAIAction = (e: Event) => {\n      const customEvent = e as CustomEvent;\n      const { action, prompt } = customEvent.detail;\n      const aiAction = AI_ACTIONS.find((a) => a.value === action);\n      if (aiAction) {\n        handleAction(aiAction);\n      }\n    };\n\n    editor.view.dom.addEventListener(\"ai-action\", handleAIAction);\n    return () => {\n      editor.view.dom.removeEventListener(\"ai-action\", handleAIAction);\n    };\n  }, [editor, handleAction]);\n\n  return (\n    <Popover open={open} onOpenChange={onOpenChange}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          className=\"gap-2 rounded-none border-none text-purple-500 hover:text-purple-600\"\n          size=\"sm\"\n        >\n          <Sparkles className=\"h-4 w-4\" />\n          IA\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-72 p-0\" align=\"start\">\n        <Command>\n          <CommandInput placeholder=\"Demander à l'IA...\" value={inputValue} onValueChange={setInputValue} autoFocus />\n          <CommandList>\n            <CommandEmpty>Aucune action trouvée.</CommandEmpty>\n            <CommandGroup heading=\"Actions IA\">\n              {AI_ACTIONS.map((action) => (\n                <CommandItem\n                  key={action.value}\n                  onSelect={() => handleAction(action)}\n                  className=\"flex cursor-pointer items-center gap-2\"\n                >\n                  {action.icon}\n                  <span>{action.label}</span>\n                </CommandItem>\n              ))}\n            </CommandGroup>\n          </CommandList>\n        </Command>\n      </PopoverContent>\n    </Popover>\n  );\n}\n"},"tags":[],"source":null}],"command":"lint"}
alecia-colab-web:lint: lint ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
alecia-colab-web:lint:
alecia-colab-web:lint:   × Some errors were emitted while running checks.
alecia-colab-web:lint:
alecia-colab-web:lint:
alecia-colab-web:lint:  ELIFECYCLE  Command failed with exit code 1.

 Tasks:    1 successful, 2 total
Cached:    1 cached, 2 total
  Time:    993ms
Failed:    alecia-colab-web#lint

 ELIFECYCLE  Command failed with exit code 1.
